var _nch="b20b1e0ccd9e96dd8cb7b06532aaa5c27a4d2fb2";var jQuery=giscloud.exposeJQuery();
/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{b(jQuery)}}(function(z){var u=/\+/g;function C(a){return r.raw?a:encodeURIComponent(a)}function F(a){return r.raw?a:decodeURIComponent(a)}function E(a){return C(r.json?JSON.stringify(a):String(a))}function D(b){if(b.indexOf('"')===0){b=b.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{b=decodeURIComponent(b.replace(u," "));return r.json?JSON.parse(b):b}catch(a){}}function B(a,b){var f=r.raw?a:D(a);return z.isFunction(b)?b(f):f}var r=z.cookie=function(O,b,o){if(b!==undefined&&!z.isFunction(b)){o=z.extend({},r.defaults,o);if(typeof o.expires==="number"){var N=o.expires,p=o.expires=new Date();p.setDate(p.getDate()+N)}return(document.cookie=[C(O),"=",E(b),o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join(""))}var l=O?undefined:{};var M=document.cookie?document.cookie.split("; "):[];for(var f=0,j=M.length;f<j;f++){var g=M[f].split("=");var a=F(g.shift());var K=g.join("=");if(O&&O===a){l=B(K,b);break}if(!O&&(K=B(K))!==undefined){l[a]=K}}return l};r.defaults={};z.removeCookie=function(a,b){if(z.cookie(a)===undefined){return false}z.cookie(a,"",z.extend({},b,{expires:-1}));return !z.cookie(a)}}));
/*!
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
(function(ai,am){var Z=ai.fn.domManip,ak="_tmplitem",W=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,ae={},an={},S,T={key:0,data:{}},U=0,ac=0,al=[];function Y(g,j,b,a){var f={data:a||(a===0||a===false)?a:(j?j.data:{}),_wrap:j?j._wrap:null,tmpl:null,parent:j||null,nodes:[],calls:ap,nest:aq,wrap:ag,html:ab,update:R};if(g){ai.extend(f,g,{nodes:[],parent:j})}if(b){f.tmpl=b;f._ctnt=f._ctnt||f.tmpl(ai,f);f.key=++U;(al.length?an:ae)[U]=f}return f}ai.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,a){ai.fn[b]=function(l){var f=[],r=ai(l),g,u,j,o,p=this.length===1&&this[0].parentNode;S=ae||{};if(p&&p.nodeType===11&&p.childNodes.length===1&&r.length===1){r[a](this[0]);f=this}else{for(u=0,j=r.length;u<j;u++){ac=u;g=(u>0?this.clone(true):this).get();ai(r[u])[a](g);f=f.concat(g)}ac=0;f=this.pushStack(f,b,r.selector)}o=S;S=null;ai.tmpl.complete(o);return f}});ai.fn.extend({tmpl:function(a,b,f){return ai.tmpl(this[0],a,b,f)},tmplItem:function(){return ai.tmplItem(this[0])},template:function(a){return ai.template(a,this[0])},domManip:function(j,b,f,a){if(j[0]&&ai.isArray(j[0])){var p=ai.makeArray(arguments),r=j[0],g=r.length,o=0,l;while(o<g&&!(l=ai.data(r[o++],"tmplItem"))){}if(l&&ac){p[2]=function(u){ai.tmpl.afterManip(this,u,f)}}Z.apply(this,p)}else{Z.apply(this,arguments)}ac=0;if(!S){ai.tmpl.complete(ae)}return this}});ai.extend({tmpl:function(g,a,b,j){var f,l=!j;if(l){j=T;g=ai.template[g]||ai.template(null,g);an={}}else{if(!g){g=j.tmpl;ae[j.key]=j;j.nodes=[];if(j.wrapped){aa(j,j.wrapped)}return ai(ah(j,null,j.tmpl(ai,j)))}}if(!g){return[]}if(typeof a==="function"){a=a.call(j||{})}if(b&&b.wrapped){aa(b,b.wrapped)}f=ai.isArray(a)?ai.map(a,function(o){return o?Y(b,j,g,o):null}):[Y(b,j,g,a)];return l?ai(ah(j,null,f)):f},tmplItem:function(a){var b;if(a instanceof ai){a=a[0]}while(a&&a.nodeType===1&&!(b=ai.data(a,"tmplItem"))&&(a=a.parentNode)){}return b||T},template:function(a,b){if(b){if(typeof b==="string"){b=aj(b)}else{if(b instanceof ai){b=b[0]||{}}}if(b.nodeType){b=ai.data(b,"tmpl")||ai.data(b,"tmpl",aj(b.innerHTML))}return typeof a==="string"?(ai.template[a]=b):b}return a?(typeof a!=="string"?ai.template(null,a):(ai.template[a]||ai.template(null,W.test(a)?a:ai(a)))):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});ai.extend(ai.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(a){ae={}},afterManip:function V(b,g,a){var f=g.nodeType===11?ai.makeArray(g.childNodes):g.nodeType===1?[g]:[];a.call(b,g);af(f);ac++}});function ah(j,a,f){var b,g=f?ai.map(f,function(l){return(typeof l==="string")?(j.key?l.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+ak+'="'+j.key+'" $2'):l):ah(l,j,l._ctnt)}):j;if(a){return g}g=g.join("");g.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(r,p,l,o){b=ai(l).get();af(b);if(p){b=ar(p).concat(b)}if(o){b=b.concat(ar(o))}});return b?b:ar(g)}function ar(a){var b=document.createElement("div");b.innerHTML=a;return ai.makeArray(b.childNodes)}function aj(a){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+ai.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(b,p,g,o,l,B,j){var u=ai.tmpl.tag[g],r,f,z;if(!u){throw"Unknown template tag: "+g}r=u._default||[];if(B&&!/\w$/.test(l)){l+=B;B=""}if(l){l=ad(l);j=j?(","+ad(j)+")"):(B?")":"");f=B?(l.indexOf(".")>-1?l+ad(B):("("+l+").call($item"+j)):l;z=B?f:"(typeof("+l+")==='function'?("+l+").call($item):("+l+"))"}else{z=f=r.$1||"null"}o=ad(o);return"');"+u[p?"close":"open"].split("$notnull_1").join(l?"typeof("+l+")!=='undefined' && ("+l+")!=null":"true").split("$1a").join(z).split("$1").join(f).split("$2").join(o||r.$2||"")+"__.push('"})+"');}return __;")}function aa(a,b){a._wrap=ah(a,true,ai.isArray(b)?b:[W.test(b)?b:ai(b).html()]).join("")}function ad(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function ao(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function af(f){var a="_"+ac,p,r,j={},g,l,o;for(g=0,l=f.length;g<l;g++){if((p=f[g]).nodeType!==1){continue}r=p.getElementsByTagName("*");for(o=r.length-1;o>=0;o--){b(r[o])}b(p)}function b(z){var D,B=z,C,F,E;if((E=z.getAttribute(ak))){while(B.parentNode&&(B=B.parentNode).nodeType===1&&!(D=B.getAttribute(ak))){}if(D!==E){B=B.parentNode?(B.nodeType===11?0:(B.getAttribute(ak)||0)):0;if(!(F=ae[E])){F=an[E];F=Y(F,ae[B]||an[B]);F.key=++U;ae[U]=F}if(ac){u(E)}}z.removeAttribute(ak)}else{if(ac&&(F=ai.data(z,"tmplItem"))){u(F.key);ae[F.key]=F;B=ai.data(z.parentNode,"tmplItem");B=B?B.key:0}}if(F){C=F;while(C&&C.key!=B){C.nodes.push(z);C=C.parent}delete F._ctnt;delete F._wrap;ai.data(z,"tmplItem",F)}function u(G){G=G+a;F=j[G]=(j[G]||Y(F,ae[F.parent.key+a]||F.parent))}}}function ap(b,g,a,f){if(!b){return al.pop()}al.push({_:b,tmpl:g,item:this,data:a,options:f})}function aq(f,a,b){return ai.tmpl(ai.template(f),a,b,this)}function ag(a,f){var b=a.options||{};b.wrapped=f;return ai.tmpl(ai.template(a.tmpl),a.data,b,a.item)}function ab(b,a){var f=this._wrap;return ai.map(ai(ai.isArray(f)?f.join(""):f).filter(b||"*"),function(g){return a?g.innerText||g.textContent:g.outerHTML||ao(g)})}function R(){var a=this.nodes;ai.tmpl(null,null,null,this).insertBefore(a[0]);ai(a).remove()}})(jQuery);
/*!

 handlebars v1.0.12

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
!function(a){function b(u){return"function"==typeof u}function f(u){return u&&"object"==typeof u?"[object Array]"===l.call(u):!1}function g(z){var B=z&&z[0]||1,C=j.COMPILER_REVISION;if(B!==C){if(C>B){var D=j.REVISION_CHANGES[C],u=j.REVISION_CHANGES[B];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+D+") or downgrade your runtime to an older version ("+u+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+z[1]+")."}}var j={};j.VERSION="1.0.0",j.COMPILER_REVISION=4,j.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},j.helpers={},j.partials={};var l=Object.prototype.toString,o="[object Object]";b(/x/)&&(b=function(u){return"function"==typeof u&&"[object Function]"===l.call(u)}),j.registerHelper=function(z,B,u){if(l.call(z)===o){if(u||B){throw new j.Exception("Arg not supported with multiple helpers")}j.Utils.extend(this.helpers,z)}else{u&&(B.not=u),this.helpers[z]=B}},j.registerPartial=function(u,z){l.call(u)===o?j.Utils.extend(this.partials,u):this.partials[u]=z},j.registerHelper("helperMissing",function(u){if(2===arguments.length){return a}throw new Error("Missing helper: '"+u+"'")}),j.registerHelper("blockHelperMissing",function(u,C){var z=C.inverse||function(){},B=C.fn;return b(u)&&(u=u.call(this)),u===!0?B(this):u===!1||null==u?z(this):f(u)?u.length>0?j.helpers.each(u,C):z(this):B(u)}),j.createFrame=function(u){var z={};return j.Utils.extend(z,u),z},j.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(z,B){if(j.logger.level<=z){var u=j.logger.methodMap[z];"undefined"!=typeof console&&console[u]&&console[u].call(console,B)}}},j.log=function(u,z){j.logger.log(u,z)},j.registerHelper("each",function(z,B){var E,F=B.fn,G=B.inverse,u=0,C="";if(b(z)&&(z=z.call(this)),B.data&&(E=j.createFrame(B.data)),z&&"object"==typeof z){if(f(z)){for(var D=z.length;D>u;u++){E&&(E.index=u),C+=F(z[u],{data:E})}}else{for(var H in z){z.hasOwnProperty(H)&&(E&&(E.key=H),C+=F(z[H],{data:E}),u++)}}}return 0===u&&(C=G(this)),C}),j.registerHelper("if",function(u,z){return b(u)&&(u=u.call(this)),j.Utils.isEmpty(u)?z.inverse(this):z.fn(this)}),j.registerHelper("unless",function(u,z){return j.helpers["if"].call(this,u,{fn:z.inverse,inverse:z.fn})}),j.registerHelper("with",function(u,z){return b(u)&&(u=u.call(this)),j.Utils.isEmpty(u)?void 0:z.fn(u)}),j.registerHelper("log",function(z,B){var u=B.data&&null!=B.data.level?parseInt(B.data.level,10):1;j.log(u,z)});var p=function(){function z(){this.yy={}}var B={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,inMustache_repetition0:28,inMustache_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,hash:35,hash_repetition_plus0:36,hashSegment:37,ID:38,EQUALS:39,DATA:40,pathSegments:41,SEP:42,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",38:"ID",39:"EQUALS",40:"DATA",42:"SEP"},productions_:[0,[3,2],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[35,1],[37,3],[26,1],[26,1],[26,1],[30,2],[21,1],[41,3],[41,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[36,1],[36,2]],performAction:function(I,E,C,D,F,G){var H=G.length-1;switch(F){case 1:return new D.ProgramNode(G[H-1]);case 2:this.$=new D.ProgramNode([],G[H]);break;case 3:this.$=new D.ProgramNode(G[H-2],G[H]);break;case 4:this.$=new D.ProgramNode(G[H-1],[]);break;case 5:this.$=new D.ProgramNode(G[H]);break;case 6:this.$=new D.ProgramNode([]);break;case 7:this.$=new D.ProgramNode([]);break;case 8:this.$=[G[H]];break;case 9:G[H-1].push(G[H]),this.$=G[H-1];break;case 10:this.$=new D.BlockNode(G[H-2],G[H-1].inverse,G[H-1],G[H]);break;case 11:this.$=new D.BlockNode(G[H-2],G[H-1],G[H-1].inverse,G[H]);break;case 12:this.$=G[H];break;case 13:this.$=G[H];break;case 14:this.$=new D.ContentNode(G[H]);break;case 15:this.$=new D.CommentNode(G[H]);break;case 16:this.$=new D.MustacheNode(G[H-1][0],G[H-1][1]);break;case 17:this.$=new D.MustacheNode(G[H-1][0],G[H-1][1]);break;case 18:this.$=G[H-1];break;case 19:this.$=new D.MustacheNode(G[H-1][0],G[H-1][1],"&"===G[H-2][2]);break;case 20:this.$=new D.MustacheNode(G[H-1][0],G[H-1][1],!0);break;case 21:this.$=new D.PartialNode(G[H-2],G[H-1]);break;case 22:break;case 23:this.$=[[G[H-2]].concat(G[H-1]),G[H]];break;case 24:this.$=[[G[H]],null];break;case 25:this.$=G[H];break;case 26:this.$=new D.StringNode(G[H]);break;case 27:this.$=new D.IntegerNode(G[H]);break;case 28:this.$=new D.BooleanNode(G[H]);break;case 29:this.$=G[H];break;case 30:this.$=new D.HashNode(G[H]);break;case 31:this.$=[G[H-2],G[H]];break;case 32:this.$=new D.PartialNameNode(G[H]);break;case 33:this.$=new D.PartialNameNode(new D.StringNode(G[H]));break;case 34:this.$=new D.PartialNameNode(new D.IntegerNode(G[H]));break;case 35:this.$=new D.DataNode(G[H]);break;case 36:this.$=new D.IdNode(G[H]);break;case 37:G[H-2].push({part:G[H],separator:G[H-1]}),this.$=G[H-2];break;case 38:this.$=[{part:G[H]}];break;case 41:this.$=[];break;case 42:G[H-1].push(G[H]);break;case 45:this.$=[G[H]];break;case 46:G[H-1].push(G[H])}},table:[{3:1,4:2,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],22:[1,12],23:[1,13],25:[1,14]},{1:[3]},{5:[1,15],8:16,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],22:[1,12],23:[1,13],25:[1,14]},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:19,6:17,7:18,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,20],20:[2,7],22:[1,12],23:[1,13],25:[1,14]},{4:19,6:21,7:18,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,20],20:[2,7],22:[1,12],23:[1,13],25:[1,14]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:22,21:23,30:24,38:[1,27],40:[1,26],41:25},{17:28,21:23,30:24,38:[1,27],40:[1,26],41:25},{17:29,21:23,30:24,38:[1,27],40:[1,26],41:25},{17:30,21:23,30:24,38:[1,27],40:[1,26],41:25},{21:32,26:31,32:[1,33],33:[1,34],38:[1,27],41:25},{1:[2,1]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{10:35,20:[1,36]},{4:37,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],20:[2,6],22:[1,12],23:[1,13],25:[1,14]},{7:38,8:16,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,20],20:[2,5],22:[1,12],23:[1,13],25:[1,14]},{17:22,18:[1,39],21:23,30:24,38:[1,27],40:[1,26],41:25},{10:40,20:[1,36]},{18:[1,41]},{18:[2,41],24:[2,41],28:42,32:[2,41],33:[2,41],34:[2,41],38:[2,41],40:[2,41]},{18:[2,24],24:[2,24]},{18:[2,36],24:[2,36],32:[2,36],33:[2,36],34:[2,36],38:[2,36],40:[2,36],42:[1,43]},{21:44,38:[1,27],41:25},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],38:[2,38],40:[2,38],42:[2,38]},{18:[1,45]},{18:[1,46]},{24:[1,47]},{18:[2,39],21:49,27:48,38:[1,27],41:25},{18:[2,32],38:[2,32]},{18:[2,33],38:[2,33]},{18:[2,34],38:[2,34]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:50,38:[1,27],41:25},{8:16,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],20:[2,2],22:[1,12],23:[1,13],25:[1,14]},{4:51,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],20:[2,4],22:[1,12],23:[1,13],25:[1,14]},{14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,43],21:55,24:[2,43],29:52,30:59,31:53,32:[1,56],33:[1,57],34:[1,58],35:54,36:60,37:61,38:[1,62],40:[1,26],41:25},{38:[1,63]},{18:[2,35],24:[2,35],32:[2,35],33:[2,35],34:[2,35],38:[2,35],40:[2,35]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{18:[1,64]},{18:[2,40]},{18:[1,65]},{8:16,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],20:[2,3],22:[1,12],23:[1,13],25:[1,14]},{18:[2,23],24:[2,23]},{18:[2,42],24:[2,42],32:[2,42],33:[2,42],34:[2,42],38:[2,42],40:[2,42]},{18:[2,44],24:[2,44]},{18:[2,25],24:[2,25],32:[2,25],33:[2,25],34:[2,25],38:[2,25],40:[2,25]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],38:[2,26],40:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],38:[2,27],40:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],38:[2,28],40:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],38:[2,29],40:[2,29]},{18:[2,30],24:[2,30],37:66,38:[1,67]},{18:[2,45],24:[2,45],38:[2,45]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],38:[2,38],39:[1,68],40:[2,38],42:[2,38]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],38:[2,37],40:[2,37],42:[2,37]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,46],24:[2,46],38:[2,46]},{39:[1,68]},{21:55,30:59,31:69,32:[1,56],33:[1,57],34:[1,58],38:[1,27],40:[1,26],41:25},{18:[2,31],24:[2,31],38:[2,31]}],defaultActions:{15:[2,1],49:[2,40]},parseError:function(C){throw new Error(C)},parse:function(H){function I(){var ag;return ag=J.lexer.lex()||1,"number"!=typeof ag&&(ag=J.symbols_[ag]||ag),ag}var J=this,K=[0],M=[null],N=[],O=this.table,P="",Q=0,R=0,S=0;this.lexer.setInput(H),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var T=this.lexer.yylloc;N.push(T);var ah=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var ai,aj,ak,al,am,an,C,D,E,F={};;){if(ak=K[K.length-1],this.defaultActions[ak]?al=this.defaultActions[ak]:((null===ai||"undefined"==typeof ai)&&(ai=I()),al=O[ak]&&O[ak][ai]),"undefined"==typeof al||!al.length||!al[0]){var G="";if(!S){E=[];for(an in O[ak]){this.terminals_[an]&&an>2&&E.push("'"+this.terminals_[an]+"'")}G=this.lexer.showPosition?"Parse error on line "+(Q+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+E.join(", ")+", got '"+(this.terminals_[ai]||ai)+"'":"Parse error on line "+(Q+1)+": Unexpected "+(1==ai?"end of input":"'"+(this.terminals_[ai]||ai)+"'"),this.parseError(G,{text:this.lexer.match,token:this.terminals_[ai]||ai,line:this.lexer.yylineno,loc:T,expected:E})}}if(al[0] instanceof Array&&al.length>1){throw new Error("Parse Error: multiple actions possible at state: "+ak+", token: "+ai)}switch(al[0]){case 1:K.push(ai),M.push(this.lexer.yytext),N.push(this.lexer.yylloc),K.push(al[1]),ai=null,aj?(ai=aj,aj=null):(R=this.lexer.yyleng,P=this.lexer.yytext,Q=this.lexer.yylineno,T=this.lexer.yylloc,S>0&&S--);break;case 2:if(C=this.productions_[al[1]][1],F.$=M[M.length-C],F._$={first_line:N[N.length-(C||1)].first_line,last_line:N[N.length-1].last_line,first_column:N[N.length-(C||1)].first_column,last_column:N[N.length-1].last_column},ah&&(F._$.range=[N[N.length-(C||1)].range[0],N[N.length-1].range[1]]),am=this.performAction.call(F,P,R,Q,this.yy,al[1],M,N),"undefined"!=typeof am){return am}C&&(K=K.slice(0,2*-1*C),M=M.slice(0,-1*C),N=N.slice(0,-1*C)),K.push(this.productions_[al[1]][0]),M.push(F.$),N.push(F._$),D=O[K[K.length-2]][K[K.length-1]],K.push(D);break;case 3:return !0}}return !0}},u=function(){var C={EOF:1,parseError:function(E,D){if(!this.yy.parser){throw new Error(E)}this.yy.parser.parseError(E,D)},setInput:function(D){return this._input=D,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var E=this._input[0];this.yytext+=E,this.yyleng++,this.offset++,this.match+=E,this.matched+=E;var D=E.match(/(?:\r\n?|\n).*/g);return D?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),E},unput:function(H){var D=H.length,E=H.split(/(?:\r\n?|\n)/g);this._input=H+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-D-1),this.offset-=D;var F=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),E.length-1&&(this.yylineno-=E.length-1);var G=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:E?(E.length===F.length?this.yylloc.first_column:0)+F[F.length-E.length].length-E[0].length:this.yylloc.first_column-D},this.options.ranges&&(this.yylloc.range=[G[0],G[0]+this.yyleng-D]),this},more:function(){return this._more=!0,this},less:function(D){this.unput(this.match.slice(D))},pastInput:function(){var D=this.matched.substr(0,this.matched.length-this.match.length);return(D.length>20?"...":"")+D.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var D=this.match;return D.length<20&&(D+=this._input.substr(0,20-D.length)),(D.substr(0,20)+(D.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var E=this.pastInput(),D=new Array(E.length+1).join("-");return E+this.upcomingInput()+"\n"+D+"^"},next:function(){if(this.done){return this.EOF}this._input||(this.done=!0);var J,F,D,E,G;this._more||(this.yytext="",this.match="");for(var H=this._currentRules(),I=0;I<H.length&&(D=this._input.match(this.rules[H[I]]),!D||F&&!(D[0].length>F[0].length)||(F=D,E=I,this.options.flex));I++){}return F?(G=F[0].match(/(?:\r\n?|\n).*/g),G&&(this.yylineno+=G.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:G?G[G.length-1].length-G[G.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+F[0].length},this.yytext+=F[0],this.match+=F[0],this.matches=F,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(F[0].length),this.matched+=F[0],J=this.performAction.call(this,this.yy,this,H[E],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),J?J:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var D=this.next();return"undefined"!=typeof D?D:this.lex()},begin:function(D){this.conditionStack.push(D)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(D){this.begin(D)}};return C.options={},C.performAction=function(H,D,E,F){function G(J,I){return D.yytext=D.yytext.substr(J,D.yyleng-I)}switch(E){case 0:return D.yytext="\\",14;case 1:if("\\"!==D.yytext.slice(-1)&&this.begin("mu"),"\\"===D.yytext.slice(-1)&&(G(0,1),this.begin("emu")),D.yytext){return 14}break;case 2:return 14;case 3:return"\\"!==D.yytext.slice(-1)&&this.popState(),"\\"===D.yytext.slice(-1)&&G(0,1),14;case 4:return G(0,4),this.popState(),15;case 5:return 25;case 6:return 16;case 7:return 20;case 8:return 19;case 9:return 19;case 10:return 23;case 11:return 22;case 12:this.popState(),this.begin("com");break;case 13:return G(3,5),this.popState(),15;case 14:return 22;case 15:return 39;case 16:return 38;case 17:return 38;case 18:return 42;case 19:break;case 20:return this.popState(),24;case 21:return this.popState(),18;case 22:return D.yytext=G(1,2).replace(/\\"/g,'"'),32;case 23:return D.yytext=G(1,2).replace(/\\'/g,"'"),32;case 24:return 40;case 25:return 34;case 26:return 34;case 27:return 33;case 28:return 38;case 29:return D.yytext=G(1,2),38;case 30:return"INVALID";case 31:return 5}},C.rules=[/^(?:\\\\(?=(\{\{)))/,/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[}\/ ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],C.conditions={mu:{rules:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!1},emu:{rules:[3],inclusive:!1},com:{rules:[4],inclusive:!1},INITIAL:{rules:[0,1,2,31],inclusive:!0}},C}();return B.lexer=u,z.prototype=B,B.Parser=z,new z}();j.Parser=p,j.parse=function(u){return u.constructor===j.AST.ProgramNode?u:(j.Parser.yy=j.AST,j.Parser.parse(u))},j.AST={},j.AST.ProgramNode=function(u,z){this.type="program",this.statements=u,z&&(this.inverse=new j.AST.ProgramNode(z))},j.AST.MustacheNode=function(z,C,B){this.type="mustache",this.escaped=!B,this.hash=C;var D=this.id=z[0],E=this.params=z.slice(1),u=this.eligibleHelper=D.isSimple;this.isHelper=u&&(E.length||C)},j.AST.PartialNode=function(u,z){this.type="partial",this.partialName=u,this.context=z},j.AST.BlockNode=function(B,C,u,z){if(B.id.original!==z.original){throw new j.Exception(B.id.original+" doesn't match "+z.original)}this.type="block",this.mustache=B,this.program=C,this.inverse=u,this.inverse&&!this.program&&(this.isInverse=!0)},j.AST.ContentNode=function(u){this.type="content",this.string=u},j.AST.HashNode=function(u){this.type="hash",this.pairs=u},j.AST.IdNode=function(z){this.type="ID";for(var C="",u=[],B=0,D=0,E=z.length;E>D;D++){var F=z[D].part;if(C+=(z[D].separator||"")+F,".."===F||"."===F||"this"===F){if(u.length>0){throw new j.Exception("Invalid path: "+C)}".."===F?B++:this.isScoped=!0}else{u.push(F)}}this.original=C,this.parts=u,this.string=u.join("."),this.depth=B,this.isSimple=1===z.length&&!this.isScoped&&0===B,this.stringModeValue=this.string},j.AST.PartialNameNode=function(u){this.type="PARTIAL_NAME",this.name=u.original},j.AST.DataNode=function(u){this.type="DATA",this.id=u},j.AST.StringNode=function(u){this.type="STRING",this.original=this.string=this.stringModeValue=u},j.AST.IntegerNode=function(u){this.type="INTEGER",this.original=this.integer=u,this.stringModeValue=Number(u)},j.AST.BooleanNode=function(u){this.type="BOOLEAN",this.bool=u,this.stringModeValue="true"===u},j.AST.CommentNode=function(u){this.type="comment",this.comment=u};var U=["description","fileName","lineNumber","message","name","number","stack"];j.Exception=function(){for(var u=Error.prototype.constructor.apply(this,arguments),z=0;z<U.length;z++){this[U[z]]=u[U[z]]}},j.Exception.prototype=new Error,j.SafeString=function(u){this.string=u},j.SafeString.prototype.toString=function(){return""+this.string};var V={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},W=/[&<>"'`]/g,Y=/[&<>"'`]/,Z=function(u){return V[u]||"&amp;"};j.Utils={extend:function(z,B){for(var u in B){B.hasOwnProperty(u)&&(z[u]=B[u])}},escapeExpression:function(u){return u instanceof j.SafeString?u.toString():u||0===u?(u=""+u,Y.test(u)?u.replace(W,Z):u):""},isEmpty:function(u){return u||0===u?f(u)&&0===u.length?!0:!1:!0}};var ab=j.Compiler=function(){};ab.prototype={compiler:ab,disassemble:function(){for(var B,D,u,z=this.opcodes,C=[],E=0,F=z.length;F>E;E++){if(B=z[E],"DECLARE"===B.opcode){C.push("DECLARE "+B.name+"="+B.value)}else{D=[];for(var G=0;G<B.args.length;G++){u=B.args[G],"string"==typeof u&&(u='"'+u.replace("\n","\\n")+'"'),D.push(u)}C.push(B.opcode+" "+D.join(" "))}}return C.join("\n")},equals:function(z){var C=this.opcodes.length;if(z.opcodes.length!==C){return !1}for(var B=0;C>B;B++){var D=this.opcodes[B],E=z.opcodes[B];if(D.opcode!==E.opcode||D.args.length!==E.args.length){return !1}for(var u=0;u<D.args.length;u++){if(D.args[u]!==E.args[u]){return !1}}}if(C=this.children.length,z.children.length!==C){return !1}for(B=0;C>B;B++){if(!this.children[B].equals(z.children[B])){return !1}}return !0},guid:0,compile:function(B,C){this.children=[],this.depths={list:[]},this.options=C;var u=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},u){for(var z in u){this.options.knownHelpers[z]=u[z]}}return this.program(B)},accept:function(u){return this[u.type](u)},program:function(B){var C,D=B.statements;this.opcodes=[];for(var u=0,z=D.length;z>u;u++){C=D[u],this[C.type](C)}return this.isSimple=1===z,this.depths.list=this.depths.list.sort(function(E,F){return E-F}),this},compileProgram:function(z){var C,B=(new this.compiler).compile(z,this.options),D=this.guid++;this.usePartial=this.usePartial||B.usePartial,this.children[D]=B;for(var E=0,u=B.depths.list.length;u>E;E++){C=B.depths.list[E],2>C||this.addDepth(C-1)}return D},block:function(B){var C=B.mustache,D=B.program,u=B.inverse;D&&(D=this.compileProgram(D)),u&&(u=this.compileProgram(u));var z=this.classifyMustache(C);"helper"===z?this.helperMustache(C,D,u):"simple"===z?(this.simpleMustache(C),this.opcode("pushProgram",D),this.opcode("pushProgram",u),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(C,D,u),this.opcode("pushProgram",D),this.opcode("pushProgram",u),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(z){var C,B,D=z.pairs;this.opcode("pushHash");for(var E=0,u=D.length;u>E;E++){C=D[E],B=C[1],this.options.stringParams?(B.depth&&this.addDepth(B.depth),this.opcode("getContext",B.depth||0),this.opcode("pushStringParam",B.stringModeValue,B.type)):this.accept(B),this.opcode("assignToHash",C[0])}this.opcode("popHash")},partial:function(u){var z=u.partialName;this.usePartial=!0,u.context?this.ID(u.context):this.opcode("push","depth0"),this.opcode("invokePartial",z.name),this.opcode("append")},content:function(u){this.opcode("appendContent",u.string)},mustache:function(z){var B=this.options,u=this.classifyMustache(z);"simple"===u?this.simpleMustache(z):"helper"===u?this.helperMustache(z):this.ambiguousMustache(z),z.escaped&&!B.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(z,C,B){var D=z.id,E=D.parts[0],u=null!=C||null!=B;this.opcode("getContext",D.depth),this.opcode("pushProgram",C),this.opcode("pushProgram",B),this.opcode("invokeAmbiguous",E,u)},simpleMustache:function(u){var z=u.id;"DATA"===z.type?this.DATA(z):z.parts.length?this.ID(z):(this.addDepth(z.depth),this.opcode("getContext",z.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(B,C,D){var u=this.setupFullMustacheParams(B,C,D),z=B.id.parts[0];if(this.options.knownHelpers[z]){this.opcode("invokeKnownHelper",u.length,z)}else{if(this.options.knownHelpersOnly){throw new Error("You specified knownHelpersOnly, but used the unknown helper "+z)}this.opcode("invokeHelper",u.length,z)}},ID:function(B){this.addDepth(B.depth),this.opcode("getContext",B.depth);var C=B.parts[0];C?this.opcode("lookupOnContext",B.parts[0]):this.opcode("pushContext");for(var u=1,z=B.parts.length;z>u;u++){this.opcode("lookup",B.parts[u])}},DATA:function(B){if(this.options.data=!0,B.id.isScoped||B.id.depth){throw new j.Exception("Scoped data references are not supported: "+B.original)}this.opcode("lookupData");for(var C=B.id.parts,u=0,z=C.length;z>u;u++){this.opcode("lookup",C[u])}},STRING:function(u){this.opcode("pushString",u.string)},INTEGER:function(u){this.opcode("pushLiteral",u.integer)},BOOLEAN:function(u){this.opcode("pushLiteral",u.bool)},comment:function(){},opcode:function(u){this.opcodes.push({opcode:u,args:[].slice.call(arguments,1)})},declare:function(u,z){this.opcodes.push({opcode:"DECLARE",name:u,value:z})},addDepth:function(u){if(isNaN(u)){throw new Error("EWOT")}0!==u&&(this.depths[u]||(this.depths[u]=!0,this.depths.list.push(u)))},classifyMustache:function(B){var C=B.isHelper,D=B.eligibleHelper,u=this.options;if(D&&!C){var z=B.id.parts[0];u.knownHelpers[z]?C=!0:u.knownHelpersOnly&&(D=!1)}return C?"helper":D?"ambiguous":"simple"},pushParams:function(z){for(var B,u=z.length;u--;){B=z[u],this.options.stringParams?(B.depth&&this.addDepth(B.depth),this.opcode("getContext",B.depth||0),this.opcode("pushStringParam",B.stringModeValue,B.type)):this[B.type](B)}},setupMustacheParams:function(u){var z=u.params;return this.pushParams(z),u.hash?this.hash(u.hash):this.opcode("emptyHash"),z},setupFullMustacheParams:function(B,C,u){var z=B.params;return this.pushParams(z),this.opcode("pushProgram",C),this.opcode("pushProgram",u),B.hash?this.hash(B.hash):this.opcode("emptyHash"),z}},j.precompile=function(B,C){if(null==B||"string"!=typeof B&&B.constructor!==j.AST.ProgramNode){throw new j.Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+B)}C=C||{},"data" in C||(C.data=!0);var u=j.parse(B),z=(new ab).compile(u,C);return(new j.JavaScriptCompiler).compile(z,C)},j.compile=function(z,u){function B(){var E=j.parse(z),F=(new ab).compile(E,u),D=(new j.JavaScriptCompiler).compile(F,u,a,!0);return j.template(D)}if(null==z||"string"!=typeof z&&z.constructor!==j.AST.ProgramNode){throw new j.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+z)}u=u||{},"data" in u||(u.data=!0);var C;return function(E,D){return C||(C=B()),C.call(this,E,D)}};var ac=function(u){this.value=u},ad=j.JavaScriptCompiler=function(){};ad.prototype={nameLookup:function(u,z){return/^[0-9]+$/.test(z)?u+"["+z+"]":ad.isValidJavaScriptVariableName(z)?u+"."+z:u+"['"+z+"']"},appendToBuffer:function(u){return this.environment.isSimple?"return "+u+";":{appendToBuffer:!0,content:u,toString:function(){return"buffer += "+u+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(z,C,u,B){this.environment=z,this.options=C||{},j.log(j.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!u,this.context=u||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(z,C);var D,E=z.opcodes;this.i=0;for(var F=E.length;this.i<F;this.i++){D=E[this.i],"DECLARE"===D.opcode?this[D.name]=D.value:this[D.opcode].apply(this,D.args)}return this.createFunctionContext(B)},nextOpcode:function(){var u=this.environment.opcodes;return u[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var z=[];if(this.isChild){z.push("")}else{var B=this.namespace,u="helpers = this.merge(helpers, "+B+".helpers);";this.environment.usePartial&&(u=u+" partials = this.merge(partials, "+B+".partials);"),this.options.data&&(u+=" data = data || {};"),z.push(u)}this.environment.isSimple?z.push(""):z.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=z},createFunctionContext:function(u){var B=this.stackVars.concat(this.registers.list);if(B.length>0&&(this.source[1]=this.source[1]+", "+B.join(", ")),!this.isChild){for(var C in this.context.aliases){this.context.aliases.hasOwnProperty(C)&&(this.source[1]=this.source[1]+", "+C+"="+this.context.aliases[C])}}this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var F=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],G=0,I=this.environment.depths.list.length;I>G;G++){F.push("depth"+this.environment.depths.list[G])}var z=this.mergeSource();if(!this.isChild){var D=j.COMPILER_REVISION,E=j.REVISION_CHANGES[D];z="this.compilerInfo = ["+D+",'"+E+"'];\n"+z}if(u){return F.push(z),Function.apply(this,F)}var H="function "+(this.name||"")+"("+F.join(",")+") {\n  "+z+"}";return j.log(j.logger.DEBUG,H+"\n\n"),H},mergeSource:function(){for(var z,D="",u=0,B=this.source.length;B>u;u++){var C=this.source[u];C.appendToBuffer?z=z?z+"\n    + "+C.content:C.content:(z&&(D+="buffer += "+z+";\n  ",z=a),D+=C+"\n  ")}return D},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var u=["depth0"];this.setupParams(0,u),this.replaceStack(function(z){return u.splice(1,0,z),"blockHelperMissing.call("+u.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var u=["depth0"];this.setupParams(0,u);var z=this.topStack();u.splice(1,0,z),u[u.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+z+" = blockHelperMissing.call("+u.join(", ")+"); }")},appendContent:function(u){this.source.push(this.appendToBuffer(this.quotedString(u)))},append:function(){this.flushInline();var u=this.popStack();this.source.push("if("+u+" || "+u+" === 0) { "+this.appendToBuffer(u)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(u){this.lastContext!==u&&(this.lastContext=u)},lookupOnContext:function(u){this.push(this.nameLookup("depth"+this.lastContext,u,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(u){return"typeof "+u+" === functionType ? "+u+".apply(depth0) : "+u})},lookup:function(u){this.replaceStack(function(z){return z+" == null || "+z+" === false ? "+z+" : "+this.nameLookup(z,u,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(u,z){this.pushStackLiteral("depth"+this.lastContext),this.pushString(z),"string"==typeof u?this.pushString(u):this.pushStackLiteral(u)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var u=this.hash;this.hash=a,this.options.stringParams&&(this.register("hashContexts","{"+u.contexts.join(",")+"}"),this.register("hashTypes","{"+u.types.join(",")+"}")),this.push("{\n    "+u.values.join(",\n    ")+"\n  }")},pushString:function(u){this.pushStackLiteral(this.quotedString(u))},push:function(u){return this.inlineStack.push(u),u},pushLiteral:function(u){this.pushStackLiteral(u)},pushProgram:function(u){null!=u?this.pushStackLiteral(this.programExpression(u)):this.pushStackLiteral(null)},invokeHelper:function(B,C){this.context.aliases.helperMissing="helpers.helperMissing";var u=this.lastHelper=this.setupHelper(B,C,!0),z=this.nameLookup("depth"+this.lastContext,C,"context");this.push(u.name+" || "+z),this.replaceStack(function(D){return D+" ? "+D+".call("+u.callParams+") : helperMissing.call("+u.helperMissingParams+")"})},invokeKnownHelper:function(z,B){var u=this.setupHelper(z,B);this.push(u.name+".call("+u.callParams+")")},invokeAmbiguous:function(z,C){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var B=this.setupHelper(0,z,C),D=this.lastHelper=this.nameLookup("helpers",z,"helper"),E=this.nameLookup("depth"+this.lastContext,z,"context"),u=this.nextStack();this.source.push("if ("+u+" = "+D+") { "+u+" = "+u+".call("+B.callParams+"); }"),this.source.push("else { "+u+" = "+E+"; "+u+" = typeof "+u+" === functionType ? "+u+".apply(depth0) : "+u+"; }")},invokePartial:function(u){var z=[this.nameLookup("partials",u,"partial"),"'"+u+"'",this.popStack(),"helpers","partials"];this.options.data&&z.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+z.join(", ")+")")},assignToHash:function(B){var C,D,u=this.popStack();this.options.stringParams&&(D=this.popStack(),C=this.popStack());var z=this.hash;C&&z.contexts.push("'"+B+"': "+C),D&&z.types.push("'"+B+"': "+D),z.values.push("'"+B+"': ("+u+")")},compiler:ad,compileChildren:function(B,D){for(var u,z,C=B.children,E=0,F=C.length;F>E;E++){u=C[E],z=new this.compiler;var G=this.matchExistingProgram(u);null==G?(this.context.programs.push(""),G=this.context.programs.length,u.index=G,u.name="program"+G,this.context.programs[G]=z.compile(u,D,this.context),this.context.environments[G]=u):(u.index=G,u.name="program"+G)}},matchExistingProgram:function(B){for(var C=0,u=this.context.environments.length;u>C;C++){var z=this.context.environments[C];if(z&&z.equals(B)){return C}}},programExpression:function(z){if(this.context.aliases.self="this",null==z){return"self.noop"}for(var C,u=this.environment.children[z],B=u.depths.list,D=[u.index,u.name,"data"],E=0,F=B.length;F>E;E++){C=B[E],1===C?D.push("depth0"):D.push("depth"+(C-1))}return(0===B.length?"self.program(":"self.programWithDepth(")+D.join(", ")+")"},register:function(u,z){this.useRegister(u),this.source.push(u+" = "+z+";")},useRegister:function(u){this.registers[u]||(this.registers[u]=!0,this.registers.list.push(u))},pushStackLiteral:function(u){return this.push(new ac(u))},pushStack:function(u){this.flushInline();var z=this.incrStack();return u&&this.source.push(z+" = "+u+";"),this.compileStack.push(z),z},replaceStack:function(z){var C,u="",B=this.isInline();if(B){var D=this.popStack(!0);if(D instanceof ac){C=D.value}else{var E=this.stackSlot?this.topStackName():this.incrStack();u="("+this.push(E)+" = "+D+"),",C=this.topStack()}}else{C=this.topStack()}var F=z.call(this,C);return B?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+u+F+")")):(/^stack/.test(C)||(C=this.nextStack()),this.source.push(C+" = ("+u+F+");")),C},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var B=this.inlineStack;if(B.length){this.inlineStack=[];for(var C=0,u=B.length;u>C;C++){var z=B[C];z instanceof ac?this.compileStack.push(z):this.pushStack(z)}}},isInline:function(){return this.inlineStack.length},popStack:function(z){var B=this.isInline(),u=(B?this.inlineStack:this.compileStack).pop();return !z&&u instanceof ac?u.value:(B||this.stackSlot--,u)},topStack:function(z){var B=this.isInline()?this.inlineStack:this.compileStack,u=B[B.length-1];return !z&&u instanceof ac?u.value:u},quotedString:function(u){return'"'+u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(B,C,D){var u=[];this.setupParams(B,u,D);var z=this.nameLookup("helpers",C,"helper");return{params:u,name:z,callParams:["depth0"].concat(u).join(", "),helperMissingParams:D&&["depth0",this.quotedString(C)].concat(u).join(", ")}},setupParams:function(u,B,C){var F,G,I,z=[],D=[],E=[];z.push("hash:"+this.popStack()),G=this.popStack(),I=this.popStack(),(I||G)&&(I||(this.context.aliases.self="this",I="self.noop"),G||(this.context.aliases.self="this",G="self.noop"),z.push("inverse:"+G),z.push("fn:"+I));for(var H=0;u>H;H++){F=this.popStack(),B.push(F),this.options.stringParams&&(E.push(this.popStack()),D.push(this.popStack()))}return this.options.stringParams&&(z.push("contexts:["+D.join(",")+"]"),z.push("types:["+E.join(",")+"]"),z.push("hashContexts:hashContexts"),z.push("hashTypes:hashTypes")),this.options.data&&z.push("data:data"),z="{"+z.join(",")+"}",C?(this.register("options",z),B.push("options")):B.push(z),B.join(", ")}};for(var ae="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),af=ad.RESERVED_WORDS={},r=0,aa=ae.length;aa>r;r++){af[ae[r]]=!0}ad.isValidJavaScriptVariableName=function(u){return !ad.RESERVED_WORDS[u]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(u)?!0:!1},j.VM={template:function(u){var z={escapeExpression:j.Utils.escapeExpression,invokePartial:j.VM.invokePartial,programs:[],program:function(B,C,D){var E=this.programs[B];return D?E=j.VM.program(B,C,D):E||(E=this.programs[B]=j.VM.program(B,C)),E},merge:function(B,C){var D=B||C;return B&&C&&B!==C&&(D={},j.Utils.extend(D,C),j.Utils.extend(D,B)),D},programWithDepth:j.VM.programWithDepth,noop:j.VM.noop,compilerInfo:null};return function(E,F){F=F||{};var G,D,B=F.partial?F:j;F.partial||(G=F.helpers,D=F.partials);var C=u.call(z,B,E,G,D,F.data);return F.partial||g(z.compilerInfo),C}},programWithDepth:function(B,C,D){var u=Array.prototype.slice.call(arguments,3),z=function(E,F){return F=F||{},C.apply(this,[E,F.data||D].concat(u))};return z.program=B,z.depth=u.length,z},program:function(B,C,u){var z=function(D,E){return E=E||{},C(D,E.data||u)};return z.program=B,z.depth=0,z},noop:function(){return""},invokePartial:function(z,B,D,E,F,u){var C={partial:!0,helpers:E,partials:F,data:u};if(z===a){throw new j.Exception("The partial "+B+" could not be found")}if(z instanceof Function){return z(D,C)}if(j.compile){return F[B]=j.compile(z,{data:u!==a}),F[B](D,C)}throw new j.Exception("The partial "+B+" could not be compiled when running in runtime-only mode")}},j.template=j.VM.template,"object"==typeof module&&module.exports?module.exports=j:"function"==typeof define&&define.amd?define(function(){return j}):this.Handlebars=j}.call(this);(function(g){var f={};g.fn.handlebars=function(b,a){if(b instanceof jQuery){b=g(b).html()}f[b]=Handlebars.compile(b);this.html(f[b](a))};Handlebars.registerHelper("debug",function(a){console.log("Current Context");console.log("====================");console.log(this);if(a){console.log("Value");console.log("====================");console.log(a)}})})(jQuery);(function(D){D.fn.editInPlace=function(b){var a=D.extend({},D.fn.editInPlace.defaults,b);B(a);z(a.saving_image);return this.each(function(){var f=D(this);if(f.data("editInPlace")){return}f.data("editInPlace",true);new u(a,f).init()})};D.fn.editInPlace.defaults={url:"",bg_over:"#ffc",bg_out:"transparent",hover_class:"",show_buttons:false,save_button:'<button class="inplace_save">Save</button>',cancel_button:'<button class="inplace_cancel">Cancel</button>',params:"",field_type:"text",default_text:"(Click here to add text)",use_html:false,textarea_rows:10,textarea_cols:25,select_text:"Choose new value",select_options:"",text_size:null,saving_text:undefined,saving_image:"",saving_animation_color:"transparent",value_required:false,element_id:"element_id",update_value:"update_value",original_value:"original_value",original_html:"original_html",save_if_nothing_changed:false,on_blur:"save",cancel:"",callback:null,callback_skip_dom_reset:false,success:null,error:null,error_sink:function(b,a){alert(a)},preinit:null,postclose:null,delegate:null};var C={shouldOpenEditInPlace:function(a,b,f){},willOpenEditInPlace:function(a,b){},didOpenEditInPlace:function(a,b){},shouldCloseEditInPlace:function(a,b,f){},willCloseEditInPlace:function(a,b){},didCloseEditInPlace:function(a,b){},missingCommaErrorPreventer:""};function u(b,a){this.settings=b;this.dom=a;this.originalValue=null;this.didInsertDefaultText=false;this.shouldDelayReinit=false}D.extend(u.prototype,{init:function(){this.setDefaultTextIfNeccessary();this.connectOpeningEvents()},reinit:function(){if(this.shouldDelayReinit){return}this.triggerCallback(this.settings.postclose,this.dom);this.triggerDelegateCall("didCloseEditInPlace");this.markEditorAsInactive();this.connectOpeningEvents()},setDefaultTextIfNeccessary:function(){if(""!==this.dom.html()){return}this.dom.html(this.settings.default_text);this.didInsertDefaultText=true},connectOpeningEvents:function(){var a=this;this.dom.bind("mouseenter.editInPlace",function(){a.addHoverEffect()}).bind("mouseleave.editInPlace",function(){a.removeHoverEffect()}).bind("click.editInPlace",function(b){a.openEditor(b)})},disconnectOpeningEvents:function(){this.dom.unbind(".editInPlace")},addHoverEffect:function(){if(this.settings.hover_class){this.dom.addClass(this.settings.hover_class)}else{this.dom.css("background-color",this.settings.bg_over)}},removeHoverEffect:function(){if(this.settings.hover_class){this.dom.removeClass(this.settings.hover_class)}else{this.dom.css("background-color",this.settings.bg_out)}},openEditor:function(a){if(!this.shouldOpenEditor(a)){return}this.disconnectOpeningEvents();this.removeHoverEffect();this.removeInsertedDefaultTextIfNeccessary();this.saveOriginalValue();this.markEditorAsActive();this.replaceContentWithEditor();this.setInitialValue();this.workAroundMissingBlurBug();this.connectClosingEventsToEditor();this.triggerDelegateCall("didOpenEditInPlace")},shouldOpenEditor:function(a){if(this.isClickedObjectCancelled(a.target)){return false}if(false===this.triggerCallback(this.settings.preinit,this.dom)){return false}if(false===this.triggerDelegateCall("shouldOpenEditInPlace",true,a)){return false}return true},removeInsertedDefaultTextIfNeccessary:function(){if(!this.didInsertDefaultText||this.dom.html()!==this.settings.default_text){return}this.dom.html("");this.didInsertDefaultText=false},isClickedObjectCancelled:function(a){if(!this.settings.cancel){return false}var f=D(a).parents().andSelf();var b=f.filter(this.settings.cancel);return 0!==b.length},saveOriginalValue:function(){if(this.settings.use_html){this.originalValue=this.dom.html()}else{this.originalValue=r(this.dom.text())}},restoreOriginalValue:function(){this.setClosedEditorContent(this.originalValue)},setClosedEditorContent:function(a){if(this.settings.use_html){this.dom.html(a)}else{this.dom.text(a)}},workAroundMissingBlurBug:function(){var a=this.dom.find(":input");this.dom.parents(":last").find(".editInPlace-active :input").not(a).blur()},replaceContentWithEditor:function(){var a=(this.settings.show_buttons)?this.settings.save_button+" "+this.settings.cancel_button:"";var b=this.createEditorElement();this.dom.html("").append('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;"></form>').find("form").append(b).append(a)},createEditorElement:function(){if(-1===D.inArray(this.settings.field_type,["text","textarea","select"])){throw"Unknown field_type <fnord>, supported are 'text', 'textarea' and 'select'"}var a=null;if("select"===this.settings.field_type){a=this.createSelectEditor()}else{if("text"===this.settings.field_type){a=D('<input type="text" '+this.inputNameAndClass()+' size="'+this.settings.text_size+'" />')}else{if("textarea"===this.settings.field_type){a=D("<textarea "+this.inputNameAndClass()+' rows="'+this.settings.textarea_rows+'"  cols="'+this.settings.textarea_cols+'" />')}}}return a},setInitialValue:function(){var b=this.triggerDelegateCall("willOpenEditInPlace",this.originalValue);var a=this.dom.find(":input");a.val(b);if(a.val()!==b){a.val("")}},inputNameAndClass:function(){return' name="inplace_value" class="inplace_field" '},createSelectEditor:function(){var o=D("<select"+this.inputNameAndClass()+'><option disabled="true" value="">'+this.settings.select_text+"</option></select>");var b=this.settings.select_options;if(!D.isArray(b)){b=b.split(",")}for(var a=0;a<b.length;a++){var g=b[a];if(!D.isArray(g)){g=g.split(":")}var l=r(g[1]||g[0]);var f=r(g[0]);var j=D("<option>").val(l).text(f);o.append(j)}return o},connectClosingEventsToEditor:function(){var g=this;function a(j){g.handleCancelEditor(j);return false}function f(j){g.handleSaveEditor(j);return false}var b=this.dom.find("form");b.find(".inplace_field").focus().select();b.find(".inplace_cancel").click(a);b.find(".inplace_save").click(f);if(!this.settings.show_buttons){if("save"===this.settings.on_blur){b.find(".inplace_field").blur(f)}else{b.find(".inplace_field").blur(a)}if(D.browser.mozilla||D.browser.msie){this.bindSubmitOnEnterInInput()}}b.keyup(function(l){var j=27;if(j===l.which){return a()}});if(D.browser.safari){this.bindSubmitOnEnterInInput()}b.submit(f)},bindSubmitOnEnterInInput:function(){if("textarea"===this.settings.field_type){return}var a=this;this.dom.find(":input").keyup(function(f){var b=13;if(b===f.which){return a.dom.find("form").submit()}})},handleCancelEditor:function(b){if(false===this.triggerDelegateCall("shouldCloseEditInPlace",true,b)){return}var a=this.dom.find(":input").val();a=this.triggerDelegateCall("willCloseEditInPlace",a);this.restoreOriginalValue();if(p(a)&&!this.isDisabledDefaultSelectChoice()){this.setClosedEditorContent(a)}this.reinit()},handleSaveEditor:function(b){if(false===this.triggerDelegateCall("shouldCloseEditInPlace",true,b)){return}var a=this.dom.find(":input").val();a=this.triggerDelegateCall("willCloseEditInPlace",a);if(this.isDisabledDefaultSelectChoice()||this.isUnchangedInput(a)){this.handleCancelEditor(b);return}if(this.didForgetRequiredText(a)){this.handleCancelEditor(b);this.reportError("Error: You must enter a value to save this field");return}this.showSaving(a);if(this.settings.callback){this.handleSubmitToCallback(a)}else{this.handleSubmitToServer(a)}},didForgetRequiredText:function(a){return this.settings.value_required&&(""===a||undefined===a||null===a)},isDisabledDefaultSelectChoice:function(){return this.dom.find("option").eq(0).is(":selected:disabled")},isUnchangedInput:function(a){return !this.settings.save_if_nothing_changed&&this.originalValue===a},showSaving:function(a){if(this.settings.callback&&this.settings.callback_skip_dom_reset){return}var b=a;if(p(this.settings.saving_text)){b=this.settings.saving_text}if(p(this.settings.saving_image)){b=D("<img />").attr("src",this.settings.saving_image).attr("alt",b)}this.dom.html(b)},handleSubmitToCallback:function(b){this.enableOrDisableAnimationCallbacks(true,false);var a=this.triggerCallback(this.settings.callback,this.id(),b,this.originalValue,this.settings.params,this.savingAnimationCallbacks());if(this.settings.callback_skip_dom_reset){}else{if(undefined===a){this.reportError("Error: Failed to save value: "+b);this.restoreOriginalValue()}else{this.dom.html(a)}}if(this.didCallNoCallbacks()){this.enableOrDisableAnimationCallbacks(false,false);this.reinit()}},handleSubmitToServer:function(f){var a=this.settings.update_value+"="+encodeURIComponent(f)+"&"+this.settings.element_id+"="+this.dom.attr("id")+((this.settings.params)?"&"+this.settings.params:"")+"&"+this.settings.original_html+"="+encodeURIComponent(this.originalValue)+"&"+this.settings.original_value+"="+encodeURIComponent(this.originalValue);this.enableOrDisableAnimationCallbacks(true,false);this.didStartSaving();var b=this;D.ajax({url:b.settings.url,type:"POST",data:a,dataType:"html",complete:function(g){b.didEndSaving()},success:function(j){var g=j||b.settings.default_text;b.dom.html(g);b.triggerCallback(b.settings.success,j)},error:function(g){b.dom.html(b.originalHTML);if(b.settings.error){b.triggerCallback(b.settings.error,g)}else{b.reportError("Failed to save value: "+g.responseText||"Unspecified Error")}}})},triggerCallback:function(a){if(!a){return}var b=Array.prototype.slice.call(arguments,1);return a.apply(this.dom[0],b)},triggerDelegateCall:function(a,b,f){if(!this.settings.delegate||!D.isFunction(this.settings.delegate[a])){return b}var g=this.settings.delegate[a](this.dom,this.settings,f);return(undefined===g)?b:g},reportError:function(a){this.triggerCallback(this.settings.error_sink,this.id(),a)},id:function(){return this.dom.attr("id")},markEditorAsActive:function(){this.dom.addClass("editInPlace-active")},markEditorAsInactive:function(){this.dom.removeClass("editInPlace-active")},savingAnimationCallbacks:function(){var a=this;return{didStartSaving:function(){a.didStartSaving()},didEndSaving:function(){a.didEndSaving()}}},enableOrDisableAnimationCallbacks:function(a,b){this.didStartSaving.enabled=a;this.didEndSaving.enabled=b},didCallNoCallbacks:function(){return this.didStartSaving.enabled&&!this.didEndSaving.enabled},assertCanCall:function(a){if(!this[a].enabled){throw new Error("Cannot call "+a+" now. See documentation for details.")}},didStartSaving:function(){this.assertCanCall("didStartSaving");this.shouldDelayReinit=true;this.enableOrDisableAnimationCallbacks(false,true);this.startSavingAnimation()},didEndSaving:function(){this.assertCanCall("didEndSaving");this.shouldDelayReinit=false;this.enableOrDisableAnimationCallbacks(false,false);this.reinit();this.stopSavingAnimation()},startSavingAnimation:function(){var a=this;this.dom.animate({backgroundColor:this.settings.saving_animation_color},400).animate({backgroundColor:"transparent"},400,"swing",function(){setTimeout(function(){a.startSavingAnimation()},10)})},stopSavingAnimation:function(){this.dom.stop(true).css({backgroundColor:""})},missingCommaErrorPreventer:""});function B(a){if(a.url||a.callback){return}throw new Error("Need to set either url: or callback: option for the inline editor to work.")}function z(a){if(""===a){return}var b=new Image();b.src=a}function r(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}function p(a){if(undefined===a||null===a){return false}if(0===a.length){return false}return true}})(jQuery);(function(b){b.InFieldLabels=function(p,l,a){var o=this;o.$label=b(p);o.label=p;o.$field=b(l);o.field=l;o.$label.data("InFieldLabels",o);o.showing=true;o.init=function(){var f;o.options=b.extend({},b.InFieldLabels.defaultOptions,a);if(o.options.className){o.$label.addClass(o.options.className)}setTimeout(function(){if(o.$field.val()!==""){o.$label.hide();o.showing=false}else{o.$label.show();o.showing=true}},200);o.$field.focus(function(){o.fadeOnFocus()}).blur(function(){o.checkForEmpty(true)}).bind("keydown.infieldlabel",function(g){o.hideOnChange(g)}).bind("paste",function(){o.setOpacity(0)}).change(function(){o.checkForEmpty()}).bind("onPropertyChange",function(){o.checkForEmpty()}).bind("keyup.infieldlabel",function(){o.checkForEmpty()});if(o.options.pollDuration>0){f=setInterval(function(){if(o.$field.val()!==""){o.$label.hide();o.showing=false;clearInterval(f)}},o.options.pollDuration)}};o.fadeOnFocus=function(){if(o.showing){o.setOpacity(o.options.fadeOpacity)}};o.setOpacity=function(f){o.$label.stop().animate({opacity:f},o.options.fadeDuration,function(){if(f===0){o.$label.hide()}});o.showing=(f>0)};o.checkForEmpty=function(f){if(o.$field.val()===""){o.prepForShow();o.setOpacity(f?1:o.options.fadeOpacity)}else{o.setOpacity(0)}};o.prepForShow=function(){if(!o.showing){o.$label.css({opacity:0}).show();o.$field.bind("keydown.infieldlabel",function(f){o.hideOnChange(f)})}};o.hideOnChange=function(f){if((f.keyCode===16)||(f.keyCode===9)){return}if(o.showing){o.$label.hide();o.showing=false}o.$field.unbind("keydown.infieldlabel")};o.init()};b.InFieldLabels.defaultOptions={fadeOpacity:0.5,fadeDuration:300,pollDuration:0,enabledInputTypes:["text","search","tel","url","email","password","number","textarea"],className:false};b.fn.inFieldLabels=function(a){var g=a&&a.enabledInputTypes||b.InFieldLabels.defaultOptions.enabledInputTypes;return this.each(function(){var f=b(this).attr("for"),o,p;if(!f){return}o=document.getElementById(f);if(!o){return}p=b.inArray(o.type,g);if(p===-1&&o.nodeName!=="TEXTAREA"){return}(new b.InFieldLabels(this,o,a))})}}(jQuery));
/*!
 * jQuery contextMenu - Plugin for simple contextMenu handling
 *
 * Version: git-master
 *
 * Authors: Rodney Rehm, Addy Osmani (patches for FF)
 * Web: http://medialize.github.com/jQuery-contextMenu/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
(function(Z,Y){Z.support.htmlMenuitem=("HTMLMenuItemElement" in window);Z.support.htmlCommand=("HTMLCommandElement" in window);Z.support.eventSelectstart=("onselectstart" in document.documentElement);if(!Z.ui||!Z.ui.widget){var K=Z.cleanData;Z.cleanData=function(f){for(var b=0,a;(a=f[b])!=null;b++){try{Z(a).triggerHandler("remove")}catch(g){}}K(f)}}var M=null,aa=false,P=Z(window),T=0,U={},S={},I={},R={selector:null,appendTo:null,trigger:"right",autoHide:false,delay:200,reposition:true,determinePosition:function(b){if(Z.ui&&Z.ui.position){b.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none")}else{var a=this.offset();a.top+=this.outerHeight();a.left+=this.outerWidth()/2-b.outerWidth()/2;b.css(a)}},position:function(o,f,g){var j=this,l;if(!f&&!g){o.determinePosition.call(this,o.$menu);return}else{if(f==="maintain"&&g==="maintain"){l=o.$menu.position()}else{l={top:g,left:f}}}var r=P.scrollTop()+P.height(),b=P.scrollLeft()+P.width(),a=o.$menu.height(),p=o.$menu.width();if(l.top+a>r){l.top-=a}if(l.left+p>b){l.left-=p}o.$menu.css(l)},positionSubmenu:function(b){if(Z.ui&&Z.ui.position){b.css("display","block").position({my:"left top",at:"right top",of:this,collision:"flipfit fit"}).css("display","")}else{var a={top:0,left:this.outerWidth()};b.css(a)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:Z.noop,hide:Z.noop},callback:null,items:{}},N={timer:null,pageX:null,pageY:null},W=function(a){var b=0,f=a;while(true){b=Math.max(b,parseInt(f.css("z-index"),10)||0);f=f.parent();if(!f||!f.length||"html body".indexOf(f.prop("nodeName").toLowerCase())>-1){break}}return b},J={abortevent:function(a){a.preventDefault();a.stopImmediatePropagation()},contextmenu:function(a){var b=Z(this);a.preventDefault();a.stopImmediatePropagation();if(a.data.trigger!="right"&&a.originalEvent){return}if(b.hasClass("context-menu-active")){return}if(!b.hasClass("context-menu-disabled")){M=b;if(a.data.build){var f=a.data.build(M,a);if(f===false){return}a.data=Z.extend(true,{},R,a.data,f||{});if(!a.data.items||Z.isEmptyObject(a.data.items)){if(window.console){(console.error||console.log)("No items specified to show in contextMenu")}throw new Error("No Items sepcified")}a.data.$trigger=M;V.create(a.data)}V.show.call(b,a.data,a.pageX,a.pageY)}},click:function(a){a.preventDefault();a.stopImmediatePropagation();Z(this).trigger(Z.Event("contextmenu",{data:a.data,pageX:a.pageX,pageY:a.pageY}))},mousedown:function(a){var b=Z(this);if(M&&M.length&&!M.is(b)){M.data("contextMenu").$menu.trigger("contextmenu:hide")}if(a.button==2){M=b.data("contextMenuActive",true)}},mouseup:function(a){var b=Z(this);if(b.data("contextMenuActive")&&M&&M.length&&M.is(b)&&!b.hasClass("context-menu-disabled")){a.preventDefault();a.stopImmediatePropagation();M=b;b.trigger(Z.Event("contextmenu",{data:a.data,pageX:a.pageX,pageY:a.pageY}))}b.removeData("contextMenuActive")},mouseenter:function(a){var b=Z(this),f=Z(a.relatedTarget),g=Z(document);if(f.is(".context-menu-list")||f.closest(".context-menu-list").length){return}if(M&&M.length){return}N.pageX=a.pageX;N.pageY=a.pageY;N.data=a.data;g.on("mousemove.contextMenuShow",J.mousemove);N.timer=setTimeout(function(){N.timer=null;g.off("mousemove.contextMenuShow");M=b;b.trigger(Z.Event("contextmenu",{data:N.data,pageX:N.pageX,pageY:N.pageY}))},a.data.delay)},mousemove:function(a){N.pageX=a.pageX;N.pageY=a.pageY},mouseleave:function(a){var b=Z(a.relatedTarget);if(b.is(".context-menu-list")||b.closest(".context-menu-list").length){return}try{clearTimeout(N.timer)}catch(a){}N.timer=null},layerClick:function(o){var j=Z(this),f=j.data("contextMenuRoot"),r=false,p=o.button,b=o.pageX,g=o.pageY,l,u,a;o.preventDefault();o.stopImmediatePropagation();setTimeout(function(){var z,B,C;var D=((f.trigger=="left"&&p===0)||(f.trigger=="right"&&p===2));if(document.elementFromPoint){f.$layer.hide();l=document.elementFromPoint(b-P.scrollLeft(),g-P.scrollTop());f.$layer.show()}if(f.reposition&&D){if(document.elementFromPoint){if(f.$trigger.is(l)||f.$trigger.has(l).length){f.position.call(f.$trigger,f,b,g);return}}else{u=f.$trigger.offset();z=Z(window);u.top+=z.scrollTop();if(u.top<=o.pageY){u.left+=z.scrollLeft();if(u.left<=o.pageX){u.bottom=u.top+f.$trigger.outerHeight();if(u.bottom>=o.pageY){u.right=u.left+f.$trigger.outerWidth();if(u.right>=o.pageX){f.position.call(f.$trigger,f,b,g);return}}}}}}if(l&&D){f.$trigger.one("contextmenu:hidden",function(){Z(l).contextMenu({x:b,y:g})})}f.$menu.trigger("contextmenu:hide")},50)},keyStop:function(a,b){if(!b.isInput){a.preventDefault()}a.stopPropagation()},key:function(g){var a=M.data("contextMenu")||{};switch(g.keyCode){case 9:case 38:J.keyStop(g,a);if(a.isInput){if(g.keyCode==9&&g.shiftKey){g.preventDefault();a.$selected&&a.$selected.find("input, textarea, select").blur();a.$menu.trigger("prevcommand");return}else{if(g.keyCode==38&&a.$selected.find("input, textarea, select").prop("type")=="checkbox"){g.preventDefault();return}}}else{if(g.keyCode!=9||g.shiftKey){a.$menu.trigger("prevcommand");return}}case 40:J.keyStop(g,a);if(a.isInput){if(g.keyCode==9){g.preventDefault();a.$selected&&a.$selected.find("input, textarea, select").blur();a.$menu.trigger("nextcommand");return}else{if(g.keyCode==40&&a.$selected.find("input, textarea, select").prop("type")=="checkbox"){g.preventDefault();return}}}else{a.$menu.trigger("nextcommand");return}break;case 37:J.keyStop(g,a);if(a.isInput||!a.$selected||!a.$selected.length){break}if(!a.$selected.parent().hasClass("context-menu-root")){var j=a.$selected.parent().parent();a.$selected.trigger("contextmenu:blur");a.$selected=j;return}break;case 39:J.keyStop(g,a);if(a.isInput||!a.$selected||!a.$selected.length){break}var b=a.$selected.data("contextMenu")||{};if(b.$menu&&a.$selected.hasClass("context-menu-submenu")){a.$selected=null;b.$selected=null;b.$menu.trigger("nextcommand");return}break;case 35:case 36:if(a.$selected&&a.$selected.find("input, textarea, select").length){return}else{(a.$selected&&a.$selected.parent()||a.$menu).children(":not(.disabled, .not-selectable)")[g.keyCode==36?"first":"last"]().trigger("contextmenu:focus");g.preventDefault();return}break;case 13:J.keyStop(g,a);if(a.isInput){if(a.$selected&&!a.$selected.is("textarea, select")){g.preventDefault();return}break}a.$selected&&a.$selected.trigger("mouseup");return;case 32:case 33:case 34:J.keyStop(g,a);return;case 27:J.keyStop(g,a);a.$menu.trigger("contextmenu:hide");return;default:var f=(String.fromCharCode(g.keyCode)).toUpperCase();if(a.accesskeys[f]){a.accesskeys[f].$node.trigger(a.accesskeys[f].$menu?"contextmenu:focus":"mouseup");return}break}g.stopPropagation();a.$selected&&a.$selected.trigger(g)},prevItem:function(l){l.stopPropagation();var o=Z(this).data("contextMenu")||{};if(o.$selected){var f=o.$selected;o=o.$selected.parent().data("contextMenu")||{};o.$selected=f}var a=o.$menu.children(),b=!o.$selected||!o.$selected.prev().length?a.last():o.$selected.prev(),g=b;while(b.hasClass("disabled")||b.hasClass("not-selectable")){if(b.prev().length){b=b.prev()}else{b=a.last()}if(b.is(g)){return}}if(o.$selected){J.itemMouseleave.call(o.$selected.get(0),l)}J.itemMouseenter.call(b.get(0),l);var j=b.find("input, textarea, select");if(j.length){j.focus()}},nextItem:function(l){l.stopPropagation();var o=Z(this).data("contextMenu")||{};if(o.$selected){var f=o.$selected;o=o.$selected.parent().data("contextMenu")||{};o.$selected=f}var a=o.$menu.children(),b=!o.$selected||!o.$selected.next().length?a.first():o.$selected.next(),g=b;while(b.hasClass("disabled")||b.hasClass("not-selectable")){if(b.next().length){b=b.next()}else{b=a.first()}if(b.is(g)){return}}if(o.$selected){J.itemMouseleave.call(o.$selected.get(0),l)}J.itemMouseenter.call(b.get(0),l);var j=b.find("input, textarea, select");if(j.length){j.focus()}},focusInput:function(g){var j=Z(this).closest(".context-menu-item"),a=j.data(),b=a.contextMenu,f=a.contextMenuRoot;f.$selected=b.$selected=j;f.isInput=b.isInput=true},blurInput:function(g){var j=Z(this).closest(".context-menu-item"),a=j.data(),b=a.contextMenu,f=a.contextMenuRoot;f.isInput=b.isInput=false},menuMouseenter:function(a){var b=Z(this).data().contextMenuRoot;b.hovering=true},menuMouseleave:function(a){var b=Z(this).data().contextMenuRoot;if(b.$layer&&b.$layer.is(a.relatedTarget)){b.hovering=false}},itemMouseenter:function(g){var j=Z(this),a=j.data(),b=a.contextMenu,f=a.contextMenuRoot;f.hovering=true;if(g&&f.$layer&&f.$layer.is(g.relatedTarget)){g.preventDefault();g.stopImmediatePropagation()}(b.$menu?b:f).$menu.children(".hover").trigger("contextmenu:blur");if(j.hasClass("disabled")||j.hasClass("not-selectable")){b.$selected=null;return}j.trigger("contextmenu:focus")},itemMouseleave:function(g){var j=Z(this),a=j.data(),b=a.contextMenu,f=a.contextMenuRoot;if(f!==b&&f.$layer&&f.$layer.is(g.relatedTarget)){f.$selected&&f.$selected.trigger("contextmenu:blur");g.preventDefault();g.stopImmediatePropagation();f.$selected=b.$selected=b.$node;return}j.trigger("contextmenu:blur")},itemClick:function(j){var l=Z(this),o=l.data(),a=o.contextMenu,f=o.contextMenuRoot,b=o.contextMenuKey,g;if(!a.items[b]||l.is(".disabled, .context-menu-submenu, .context-menu-separator, .not-selectable")){return}j.preventDefault();j.stopImmediatePropagation();if(Z.isFunction(f.callbacks[b])&&Object.prototype.hasOwnProperty.call(f.callbacks,b)){g=f.callbacks[b]}else{if(Z.isFunction(f.callback)){g=f.callback}else{return}}if(g.call(f.$trigger,b,f)!==false){f.$menu.trigger("contextmenu:hide")}else{if(f.$menu.parent().length){V.update.call(f.$trigger,f)}}},inputClick:function(a){a.stopImmediatePropagation()},hideMenu:function(a,b){var f=Z(this).data("contextMenuRoot");V.hide.call(f.$trigger,f,b&&b.force)},focusItem:function(g){g.stopPropagation();var j=Z(this),a=j.data(),b=a.contextMenu,f=a.contextMenuRoot;j.addClass("hover").siblings(".hover").trigger("contextmenu:blur");b.$selected=f.$selected=j;if(b.$node){f.positionSubmenu.call(b.$node,b.$menu)}},blurItem:function(g){g.stopPropagation();var j=Z(this),a=j.data(),b=a.contextMenu,f=a.contextMenuRoot;j.removeClass("hover");b.$selected=null}},V={show:function(l,b,g){var f=Z(this),j,a={};Z("#context-menu-layer").trigger("mousedown");l.$trigger=f;if(l.events.show.call(f,l)===false){M=null;return}V.update.call(f,l);l.position.call(f,l,b,g);if(l.zIndex){a.zIndex=W(f)+l.zIndex}V.layer.call(l.$menu,l,a.zIndex);l.$menu.find("ul").css("zIndex",a.zIndex+1);l.$menu.css(a)[l.animation.show](l.animation.duration,function(){f.trigger("contextmenu:visible")});f.data("contextMenu",l).addClass("context-menu-active");Z(document).off("keydown.contextMenu").on("keydown.contextMenu",J.key);if(l.autoHide){Z(document).on("mousemove.contextMenuAutoHide",function(p){var o=f.offset();o.right=o.left+f.outerWidth();o.bottom=o.top+f.outerHeight();if(l.$layer&&!l.hovering&&(!(p.pageX>=o.left&&p.pageX<=o.right)||!(p.pageY>=o.top&&p.pageY<=o.bottom))){l.$menu.trigger("contextmenu:hide")}})}},hide:function(b,a){var f=Z(this);if(!b){b=f.data("contextMenu")||{}}if(!a&&b.events&&b.events.hide.call(f,b)===false){return}f.removeData("contextMenu").removeClass("context-menu-active");if(b.$layer){setTimeout((function(j){return function(){j.remove()}})(b.$layer),10);try{delete b.$layer}catch(g){b.$layer=null}}M=null;b.$menu.find(".hover").trigger("contextmenu:blur");b.$selected=null;Z(document).off(".contextMenuAutoHide").off("keydown.contextMenu");b.$menu&&b.$menu[b.animation.hide](b.animation.duration,function(){if(b.build){b.$menu.remove();Z.each(b,function(o,l){switch(o){case"ns":case"selector":case"build":case"trigger":return true;default:b[o]=Y;try{delete b[o]}catch(j){}return true}})}setTimeout(function(){f.trigger("contextmenu:hidden")},10)})},create:function(a,b){if(b===Y){b=a}a.$menu=Z('<ul class="context-menu-list"></ul>').addClass(a.className||"").data({contextMenu:a,contextMenuRoot:b});Z.each(["callbacks","commands","inputs"],function(g,f){a[f]={};if(!b[f]){b[f]={}}});b.accesskeys||(b.accesskeys={});Z.each(a.items,function(r,p){var g=Z('<li class="context-menu-item"></li>').addClass(p.className||""),f=null,j=null;g.on("click",Z.noop);p.$node=g.data({contextMenu:a,contextMenuRoot:b,contextMenuKey:r});if(p.accesskey){var o=Q(p.accesskey);for(var u=0,l;l=o[u];u++){if(!b.accesskeys[l]){b.accesskeys[l]=p;p._name=p.name.replace(new RegExp("("+l+")","i"),'<span class="context-menu-accesskey">$1</span>');break}}}if(typeof p=="string"){g.addClass("context-menu-separator not-selectable")}else{if(p.type&&I[p.type]){I[p.type].call(g,p,a,b);Z.each([a,b],function(z,B){B.commands[r]=p;if(Z.isFunction(p.callback)){B.callbacks[r]=p.callback}})}else{if(p.type=="html"){g.addClass("context-menu-html not-selectable")}else{if(p.type){f=Z("<label></label>").appendTo(g);Z("<span></span>").html(p._name||p.name).appendTo(f);g.addClass("context-menu-input");a.hasTypes=true;Z.each([a,b],function(z,B){B.commands[r]=p;B.inputs[r]=p})}else{if(p.items){p.type="sub"}}}switch(p.type){case"text":j=Z('<input type="text" value="1" name="" value="">').attr("name","context-menu-input-"+r).val(p.value||"").appendTo(f);break;case"textarea":j=Z('<textarea name=""></textarea>').attr("name","context-menu-input-"+r).val(p.value||"").appendTo(f);if(p.height){j.height(p.height)}break;case"checkbox":j=Z('<input type="checkbox" value="1" name="" value="">').attr("name","context-menu-input-"+r).val(p.value||"").prop("checked",!!p.selected).prependTo(f);break;case"radio":j=Z('<input type="radio" value="1" name="" value="">').attr("name","context-menu-input-"+p.radio).val(p.value||"").prop("checked",!!p.selected).prependTo(f);break;case"select":j=Z('<select name="">').attr("name","context-menu-input-"+r).appendTo(f);if(p.options){Z.each(p.options,function(B,z){Z("<option></option>").val(B).text(z).appendTo(j)});j.val(p.selected)}break;case"sub":Z("<span></span>").html(p._name||p.name).appendTo(g);p.appendTo=p.$node;V.create(p,b);g.data("contextMenu",p).addClass("context-menu-submenu");p.callback=null;break;case"html":Z(p.html).appendTo(g);break;default:Z.each([a,b],function(z,B){B.commands[r]=p;if(Z.isFunction(p.callback)){B.callbacks[r]=p.callback}});Z("<span></span>").html(p._name||p.name||"").appendTo(g);break}if(p.type&&p.type!="sub"&&p.type!="html"){j.on("focus",J.focusInput).on("blur",J.blurInput);if(p.events){j.on(p.events,a)}}if(p.icon){g.addClass("icon icon-"+p.icon)}}}p.$input=j;p.$label=f;g.appendTo(a.$menu);if(!a.hasTypes&&Z.support.eventSelectstart){g.on("selectstart.disableTextSelect",J.abortevent)}});if(!a.$node){a.$menu.css("display","none").addClass("context-menu-root")}a.$menu.appendTo(a.appendTo||document.body)},resize:function(b,a){b.css({position:"absolute",display:"block"});b.data("width",Math.ceil(b.width())+1);b.css({position:"static",minWidth:"0px",maxWidth:"100000px"});b.find("> li > ul").each(function(){V.resize(Z(this),true)});if(!a){b.find("ul").andSelf().css({position:"",display:"",minWidth:"",maxWidth:""}).width(function(){return Z(this).data("width")})}},update:function(a,b){var f=this;if(b===Y){b=a;V.resize(a.$menu)}a.$menu.children().each(function(){var o=Z(this),l=o.data("contextMenuKey"),g=a.items[l],j=(Z.isFunction(g.disabled)&&g.disabled.call(f,l,b))||g.disabled===true;o[j?"addClass":"removeClass"]("disabled");if(g.type){o.find("input, select, textarea").prop("disabled",j);switch(g.type){case"text":case"textarea":g.$input.val(g.value||"");break;case"checkbox":case"radio":g.$input.val(g.value||"").prop("checked",!!g.selected);break;case"select":g.$input.val(g.selected||"");break}}if(g.$menu){V.update.call(f,g,b)}})},layer:function(b,a){var f=b.$layer=Z('<div id="context-menu-layer" style="position:fixed; z-index:'+a+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:P.height(),width:P.width(),display:"block"}).data("contextMenuRoot",b).insertBefore(this).on("contextmenu",J.abortevent).on("mousedown",J.layerClick);if(!Z.support.fixedPosition){f.css({position:"absolute",height:Z(document).height()})}return f}};function Q(g){var a=g.split(/\s+/),j=[];for(var b=0,f;f=a[b];b++){f=f[0].toUpperCase();j.push(f)}return j}Z.fn.contextMenu=function(b){if(b===Y){this.first().trigger("contextmenu")}else{if(b.x&&b.y){this.first().trigger(Z.Event("contextmenu",{pageX:b.x,pageY:b.y}))}else{if(b==="hide"){var a=this.data("contextMenu").$menu;a&&a.trigger("contextmenu:hide")}else{if(b==="destroy"){Z.contextMenu("destroy",{context:this})}else{if(Z.isPlainObject(b)){b.context=this;Z.contextMenu("create",b)}else{if(b){this.removeClass("context-menu-disabled")}else{if(!b){this.addClass("context-menu-disabled")}}}}}}}return this};Z.contextMenu=function(j,a){if(typeof j!="string"){a=j;j="create"}if(typeof a=="string"){a={selector:a}}else{if(a===Y){a={}}}var o=Z.extend(true,{},R,a||{});var l=Z(document);var f=l;var b=false;if(!o.context||!o.context.length){o.context=document}else{f=Z(o.context).first();o.context=f.get(0);b=o.context!==document}switch(j){case"create":if(!o.selector){throw new Error("No selector specified")}if(o.selector.match(/.context-menu-(list|item|input)($|\s)/)){throw new Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className')}if(!o.build&&(!o.items||Z.isEmptyObject(o.items))){throw new Error("No Items sepcified")}T++;o.ns=".contextMenu"+T;if(!b){U[o.selector]=o.ns}S[o.ns]=o;if(!o.trigger){o.trigger="right"}if(!aa){l.on({"contextmenu:hide.contextMenu":J.hideMenu,"prevcommand.contextMenu":J.prevItem,"nextcommand.contextMenu":J.nextItem,"contextmenu.contextMenu":J.abortevent,"mouseenter.contextMenu":J.menuMouseenter,"mouseleave.contextMenu":J.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",J.inputClick).on({"mouseup.contextMenu":J.itemClick,"contextmenu:focus.contextMenu":J.focusItem,"contextmenu:blur.contextMenu":J.blurItem,"contextmenu.contextMenu":J.abortevent,"mouseenter.contextMenu":J.itemMouseenter,"mouseleave.contextMenu":J.itemMouseleave},".context-menu-item");aa=true}f.on("contextmenu"+o.ns,o.selector,o,J.contextmenu);if(b){f.on("remove"+o.ns,function(){Z(this).contextMenu("destroy")})}switch(o.trigger){case"hover":f.on("mouseenter"+o.ns,o.selector,o,J.mouseenter).on("mouseleave"+o.ns,o.selector,o,J.mouseleave);break;case"left":f.on("click"+o.ns,o.selector,o,J.click);break}if(!o.build){V.create(o)}break;case"destroy":var r;if(b){var p=o.context;Z.each(S,function(B,u){if(u.context!==p){return true}r=Z(".context-menu-list").filter(":visible");if(r.length&&r.data().contextMenuRoot.$trigger.is(Z(u.context).find(u.selector))){r.trigger("contextmenu:hide",{force:true})}try{if(S[u.ns].$menu){S[u.ns].$menu.remove()}delete S[u.ns]}catch(z){S[u.ns]=null}Z(u.context).off(u.ns);return true})}else{if(!o.selector){l.off(".contextMenu .contextMenuAutoHide");Z.each(S,function(z,u){Z(u.context).off(u.ns)});U={};S={};T=0;aa=false;Z("#context-menu-layer, .context-menu-list").remove()}else{if(U[o.selector]){r=Z(".context-menu-list").filter(":visible");if(r.length&&r.data().contextMenuRoot.$trigger.is(o.selector)){r.trigger("contextmenu:hide",{force:true})}try{if(S[U[o.selector]].$menu){S[U[o.selector]].$menu.remove()}delete S[U[o.selector]]}catch(g){S[U[o.selector]]=null}l.off(U[o.selector])}}}break;case"html5":if((!Z.support.htmlCommand&&!Z.support.htmlMenuitem)||(typeof a=="boolean"&&a)){Z('menu[type="context"]').each(function(){if(this.id){Z.contextMenu({selector:"[contextmenu="+this.id+"]",items:Z.contextMenu.fromMenu(this)})}}).css("display","none")}break;default:throw new Error('Unknown operation "'+j+'"')}return this};Z.contextMenu.setInputValues=function(b,a){if(a===Y){a={}}Z.each(b.inputs,function(f,g){switch(g.type){case"text":case"textarea":g.value=a[f]||"";break;case"checkbox":g.selected=a[f]?true:false;break;case"radio":g.selected=(a[g.radio]||"")==g.value?true:false;break;case"select":g.selected=a[f]||"";break}})};Z.contextMenu.getInputValues=function(b,a){if(a===Y){a={}}Z.each(b.inputs,function(f,g){switch(g.type){case"text":case"textarea":case"select":a[f]=g.$input.val();break;case"checkbox":a[f]=g.$input.prop("checked");break;case"radio":if(g.$input.prop("checked")){a[g.radio]=g.value}break}});return a};function O(a){return(a.id&&Z('label[for="'+a.id+'"]').val())||a.name}function ab(a,b,f){if(!f){f=0}b.each(function(){var p=Z(this),j=this,g=this.nodeName.toLowerCase(),o,l;if(g=="label"&&p.find("input, textarea, select").length){o=p.text();p=p.children().first();j=p.get(0);g=j.nodeName.toLowerCase()}switch(g){case"menu":l={name:p.attr("label"),items:{}};f=ab(l.items,p.children(),f);break;case"a":case"button":l={name:p.text(),disabled:!!p.attr("disabled"),callback:(function(){return function(){p.click()}})()};break;case"menuitem":case"command":switch(p.attr("type")){case Y:case"command":case"menuitem":l={name:p.attr("label"),disabled:!!p.attr("disabled"),callback:(function(){return function(){p.click()}})()};break;case"checkbox":l={type:"checkbox",disabled:!!p.attr("disabled"),name:p.attr("label"),selected:!!p.attr("checked")};break;case"radio":l={type:"radio",disabled:!!p.attr("disabled"),name:p.attr("label"),radio:p.attr("radiogroup"),value:p.attr("id"),selected:!!p.attr("checked")};break;default:l=Y}break;case"hr":l="-------";break;case"input":switch(p.attr("type")){case"text":l={type:"text",name:o||O(j),disabled:!!p.attr("disabled"),value:p.val()};break;case"checkbox":l={type:"checkbox",name:o||O(j),disabled:!!p.attr("disabled"),selected:!!p.attr("checked")};break;case"radio":l={type:"radio",name:o||O(j),disabled:!!p.attr("disabled"),radio:!!p.attr("name"),value:p.val(),selected:!!p.attr("checked")};break;default:l=Y;break}break;case"select":l={type:"select",name:o||O(j),disabled:!!p.attr("disabled"),selected:p.val(),options:{}};p.children().each(function(){l.options[this.value]=Z(this).text()});break;case"textarea":l={type:"textarea",name:o||O(j),disabled:!!p.attr("disabled"),value:p.val()};break;case"label":break;default:l={type:"html",html:p.clone(true)};break}if(l){f++;a["key"+f]=l}});return f}Z.contextMenu.fromMenu=function(b){var a=Z(b),f={};ab(f,a.children());return f};Z.contextMenu.defaults=R;Z.contextMenu.types=I;Z.contextMenu.handle=J;Z.contextMenu.op=V;Z.contextMenu.menus=S})(jQuery);(function(g,l){var j=0;g.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:false,multiple:true,position:{}},_create:function(){var D=this.element.hide(),f=this.options;this.speed=g.fx.speeds._default;this._isOpen=false;var a=(this.button=g('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(f.classes).attr({title:D.attr("title"),"aria-haspopup":true,tabIndex:D.attr("tabIndex")}).insertAfter(D),C=(this.buttonlabel=g("<span />")).html(f.noneSelectedText).appendTo(a),o=(this.menu=g("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(f.classes).appendTo(document.body),F=(this.header=g("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(o),b=(this.headerLinkContainer=g("<ul />")).addClass("ui-helper-reset").html(function(){if(f.header===true){return'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+f.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+f.uncheckAllText+"</span></a></li>"}else{if(typeof f.header==="string"){return"<li>"+f.header+"</li>"}else{return""}}}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(F),E=(this.checkboxContainer=g("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(o);this._bindEvents();this.refresh(true);if(!f.multiple){o.addClass("ui-multiselect-single")}},_init:function(){if(this.options.header===false){this.header.hide()}if(!this.options.multiple){this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide()}if(this.options.autoOpen){this.open()}if(this.element.is(":disabled")){this.disable()}},refresh:function(f){var a=this.element,C=this.options,D=this.menu,F=this.checkboxContainer,o=[],b="",E=a.attr("id")||j++;a.find("option").each(function(p){var U=g(this),P=this.parentNode,R=this.innerHTML,B=this.title,Q=this.value,r="ui-multiselect-"+(this.id||E+"-option-"+p),z=this.disabled,u=this.selected,S=["ui-corner-all"],T=(z?"ui-multiselect-disabled ":" ")+this.className,O;if(P.tagName==="OPTGROUP"){O=P.getAttribute("label");if(g.inArray(O,o)===-1){b+='<li class="ui-multiselect-optgroup-label '+P.className+'"><a href="#">'+O+"</a></li>";o.push(O)}}if(z){S.push("ui-state-disabled")}if(u&&!C.multiple){S.push("ui-state-active")}b+='<li class="'+T+'">';b+='<label for="'+r+'" title="'+B+'" class="'+S.join(" ")+'">';b+='<input id="'+r+'" name="multiselect_'+E+'" type="'+(C.multiple?"checkbox":"radio")+'" value="'+Q+'" title="'+R+'"';if(u){b+=' checked="checked"';b+=' aria-selected="true"'}if(z){b+=' disabled="disabled"';b+=' aria-disabled="true"'}b+=" /><span>"+R+"</span></label></li>"});F.html(b);this.labels=D.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();if(!f){this._trigger("refresh")}},update:function(){var o=this.options,b=this.inputs,f=b.filter(":checked"),a=f.length,u;if(a===0){u=o.noneSelectedText}else{if(g.isFunction(o.selectedText)){u=o.selectedText.call(this,a,b.length,f.get())}else{if(/\d/.test(o.selectedList)&&o.selectedList>0&&a<=o.selectedList){u=f.map(function(){return g(this).next().html()}).get().join(", ")}else{u=o.selectedText.replace("#",a).replace("#",b.length)}}}this.buttonlabel.html(u);return u},_bindEvents:function(){var f=this,b=this.button;function a(){f[f._isOpen?"close":"open"]();return false}b.find("span").bind("click.multiselect",a);b.bind({click:a,keypress:function(p){switch(p.which){case 27:case 38:case 37:f.close();break;case 39:case 40:f.open();break}},mouseenter:function(){if(!b.hasClass("ui-state-disabled")){g(this).addClass("ui-state-hover")}},mouseleave:function(){g(this).removeClass("ui-state-hover")},focus:function(){if(!b.hasClass("ui-state-disabled")){g(this).addClass("ui-state-focus")}},blur:function(){g(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(p){if(g(this).hasClass("ui-multiselect-close")){f.close()}else{f[g(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]()}p.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(F){F.preventDefault();var B=g(this),C=B.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),E=C.get(),D=B.parent().text();if(f._trigger("beforeoptgrouptoggle",F,{inputs:E,label:D})===false){return}f._toggleChecked(C.filter(":checked").length!==C.length,C);f._trigger("optgrouptoggle",F,{inputs:E,label:D,checked:E[0].checked})}).delegate("label","mouseenter.multiselect",function(){if(!g(this).hasClass("ui-state-disabled")){f.labels.removeClass("ui-state-hover");g(this).addClass("ui-state-hover").find("input").focus()}}).delegate("label","keydown.multiselect",function(p){p.preventDefault();switch(p.which){case 9:case 27:f.close();break;case 38:case 40:case 37:case 39:f._traverse(p.which,this);break;case 13:g(this).find("input")[0].click();break}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(B){var C=g(this),F=this.value,D=this.checked,E=f.element.find("option");if(this.disabled||f._trigger("click",B,{value:F,text:this.title,checked:D})===false){B.preventDefault();return}C.focus();C.attr("aria-selected",D);E.each(function(){if(this.value===F){this.selected=D}else{if(!f.options.multiple){this.selected=false}}});if(!f.options.multiple){f.labels.removeClass("ui-state-active");C.closest("label").toggleClass("ui-state-active",D);f.close()}f.element.trigger("change");setTimeout(g.proxy(f.update,f),10)});g(document).bind("mousedown.multiselect",function(p){if(f._isOpen&&!g.contains(f.menu[0],p.target)&&!g.contains(f.button[0],p.target)&&p.target!==f.button[0]){f.close()}});g(this.element[0].form).bind("reset.multiselect",function(){setTimeout(g.proxy(f.refresh,f),10)})},_setButtonWidth:function(){var b=this.element.outerWidth(),a=this.options;if(a.minWidth=="auto"){return}if(/\d/.test(a.minWidth)&&b<a.minWidth){b=a.minWidth}this.button.width(b)},_setMenuWidth:function(){var b=this.menu,a=this.button.outerWidth()-parseInt(b.css("padding-left"),10)-parseInt(b.css("padding-right"),10)-parseInt(b.css("border-right-width"),10)-parseInt(b.css("border-left-width"),10);b.width(a||this.button.outerWidth())},_traverse:function(z,u){var a=g(u),b=z===38||z===37,f=a.parent()[b?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[b?"last":"first"]();if(!f.length){var B=this.menu.find("ul").last();this.menu.find("label")[b?"last":"first"]().trigger("mouseover");B.scrollTop(b?B.height():0)}else{f.find("label").trigger("mouseover")}},_toggleState:function(a,b){return function(){if(!this.disabled){this[a]=b}if(b){this.setAttribute("aria-selected",true)}else{this.removeAttribute("aria-selected")}}},_toggleChecked:function(f,r){var u=(r&&r.length)?r:this.inputs,a=this;u.each(this._toggleState("checked",f));u.eq(0).focus();this.update();var b=u.map(function(){return this.value}).get();this.element.find("option").each(function(){if(!this.disabled&&g.inArray(this.value,b)>-1){a._toggleState("selected",f).call(this)}});if(u.length){this.element.trigger("change")}},_toggleDisabled:function(b){this.button.attr({disabled:b,"aria-disabled":b})[b?"addClass":"removeClass"]("ui-state-disabled");var f=this.menu.find("input");var a="ech-multiselect-disabled";if(b){f=f.filter(":enabled").data(a,true)}else{f=f.filter(function(){return g.data(this,a)===true}).removeData(a)}f.attr({disabled:b,"arial-disabled":b}).parent()[b?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:b,"aria-disabled":b})},open:function(b){var f=this,E=this.button,H=this.menu,F=this.speed,G=this.options,J=[];if(this._trigger("beforeopen")===false||E.hasClass("ui-state-disabled")||this._isOpen){return}var o=H.find("ul").last(),a=G.show,I=E.offset();if(g.isArray(G.show)){a=G.show[0];F=G.show[1]||f.speed}if(a){J=[a,F]}o.scrollTop(0).height(G.height);if(g.ui.position&&!g.isEmptyObject(G.position)){G.position.of=G.position.of||E;H.show().position(G.position).hide()}else{H.css({top:I.top+E.outerHeight(),left:I.left})}g.fn.show.apply(H,J);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");E.addClass("ui-state-active");this._isOpen=true;this._trigger("open")},close:function(){if(this._trigger("beforeclose")===false){return}var o=this.options,b=o.hide,a=this.speed,f=[];if(g.isArray(o.hide)){b=o.hide[0];a=o.hide[1]||this.speed}if(b){f=[b,a]}g.fn.hide.apply(this.menu,f);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=false;this._trigger("close")},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(a){this._toggleChecked(true);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){g.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(f,b){var a=this.menu;switch(f){case"header":a.find("div.ui-multiselect-header")[b?"show":"hide"]();break;case"checkAllText":a.find("a.ui-multiselect-all span").eq(-1).text(b);break;case"uncheckAllText":a.find("a.ui-multiselect-none span").eq(-1).text(b);break;case"height":a.find("ul").last().height(parseInt(b,10));break;case"minWidth":this.options[f]=parseInt(b,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[f]=b;this.update();break;case"classes":a.add(this.button).removeClass(this.options.classes).addClass(b);break;case"multiple":a.toggleClass("ui-multiselect-single",!b);this.options.multiple=b;this.element[0].multiple=b;this.refresh()}g.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);(function(f){f.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",191:"/",220:"\\",222:"'",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};function g(o){if(typeof o.data==="string"){o.data={keys:o.data}}if(!o.data||!o.data.keys||typeof o.data.keys!=="string"){return}var p=o.handler,b=o.data.keys.toLowerCase().split(" "),a=["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color"];o.handler=function(I){if(this!==I.target&&(/textarea|select/i.test(I.target.nodeName)||f.inArray(I.target.type,a)>-1)){return}var l=I.type!=="keypress"&&f.hotkeys.specialKeys[I.which],F=String.fromCharCode(I.which).toLowerCase(),H,J="",E={};if(I.altKey&&l!=="alt"){J+="alt+"}if(I.ctrlKey&&l!=="ctrl"){J+="ctrl+"}if(I.metaKey&&!I.ctrlKey&&l!=="meta"){J+="meta+"}if(I.shiftKey&&l!=="shift"){J+="shift+"}if(l){E[J+l]=true}else{E[J+F]=true;E[J+f.hotkeys.shiftNums[F]]=true;if(J==="shift+"){E[f.hotkeys.shiftNums[F]]=true}}for(var j=0,G=b.length;j<G;j++){if(E[b[j]]){return p.apply(this,arguments)}}}}f.each(["keydown","keyup","keypress"],function(){f.event.special[this]={add:g}})})(jQuery);!function(b){var j=function(){this.defined="undefined"!==typeof localStorage};j.prototype={constructor:j,get:function(a,f){return localStorage.getItem(a)?localStorage.getItem(a):"undefined"!==typeof f?f:null},has:function(a){return localStorage.getItem(a)?!0:!1},set:function(a,f,g){"string"===typeof f&&(""===f?this.destroy(a):localStorage.setItem(a,f));return"function"===typeof g?g():!0},destroy:function(a,f){localStorage.removeItem(a);return"function"===typeof f?f():!0},clean:function(a){for(var f=localStorage.length-1;0<=f;f--){"undefined"===typeof Array.indexOf&&-1!==localStorage.key(f).indexOf("garlic:")&&localStorage.removeItem(localStorage.key(f))}return"function"===typeof a?a():!0},clear:function(a){localStorage.clear();return"function"===typeof a?a():!0}};var l=function(a,f,g){this.init("garlic",a,f,g)};l.prototype={constructor:l,init:function(a,p,f,g){this.type=a;this.$element=b(p);this.options=this.getOptions(g);this.storage=f;this.path=this.options.getPath(this.$element)||this.getPath();this.parentForm=this.$element.closest("form");this.$element.addClass("garlic-auto-save");this.expiresFlag=!this.options.expires?!1:(this.$element.data("expires")?this.path:this.getPath(this.parentForm))+"_flag";this.$element.on(this.options.events.join("."+this.type+" "),!1,b.proxy(this.persist,this));if(this.options.destroy){b(this.parentForm).on("submit reset",!1,b.proxy(this.destroy,this))}this.retrieve()},getOptions:function(a){return b.extend({},b.fn[this.type].defaults,a,this.$element.data())},persist:function(){if(this.val!==this.$element.val()){this.val=this.$element.val();this.options.expires&&this.storage.set(this.expiresFlag,((new Date).getTime()+1000*this.options.expires).toString());if(this.$element.is("input[type=checkbox]")){return this.storage.set(this.path,this.$element.attr("checked")?"checked":"unchecked")}this.storage.set(this.path,this.$element.val())}},retrieve:function(){if(this.storage.has(this.path)){if(this.options.expires){var a=(new Date).getTime();if(this.storage.get(this.expiresFlag)<a.toString()){this.storage.destroy(this.path);return}this.$element.attr("expires-in",Math.floor((parseInt(this.storage.get(this.expiresFlag))-a)/1000))}a=this.storage.get(this.path);if(this.options.conflictManager.enabled&&this.detectConflict()){return this.conflictManager()}if(this.$element.is("input[type=radio], input[type=checkbox]")){if("checked"===a||this.$element.val()===a){return this.$element.attr("checked",!0)}"unchecked"===a&&this.$element.attr("checked",!1)}else{this.$element.val(a),this.options.onRetrieve(this.$element,a)}}},detectConflict:function(){var a=this;if(this.$element.is("input[type=checkbox], input[type=radio]")){return !1}if(this.$element.val()&&this.storage.get(this.path)!==this.$element.val()){if(this.$element.is("select")){var f=!1;this.$element.find("option").each(function(){0!==b(this).index()&&(b(this).attr("selected")&&b(this).val()!==a.storage.get(this.path))&&(f=!0)});return f}return !0}return !1},conflictManager:function(){if("function"===typeof this.options.conflictManager.onConflictDetected&&!this.options.conflictManager.onConflictDetected(this.$element,this.storage.get(this.path))){return !1}this.options.conflictManager.garlicPriority?(this.$element.data("swap-data",this.$element.val()),this.$element.data("swap-state","garlic"),this.$element.val(this.storage.get(this.path))):(this.$element.data("swap-data",this.storage.get(this.path)),this.$element.data("swap-state","default"));this.swapHandler();this.$element.addClass("garlic-conflict-detected");this.$element.closest("input[type=submit]").attr("disabled",!0)},swapHandler:function(){var a=b(this.options.conflictManager.template);this.$element.after(a.text(this.options.conflictManager.message));a.on("click",!1,b.proxy(this.swap,this))},swap:function(){var a=this.$element.data("swap-data");this.$element.data("swap-state","garlic"===this.$element.data("swap-state")?"default":"garlic");this.$element.data("swap-data",this.$element.val());b(this.$element).val(a)},destroy:function(){this.storage.destroy(this.path)},remove:function(){this.remove();this.$element.is("input[type=radio], input[type=checkbox]")?b(this.$element).attr("checked",!1):this.$element.val("")},getPath:function(a){"undefined"===typeof a&&(a=this.$element);if(this.options.getPath(a)){return this.options.getPath(a)}if(1!=a.length){return !1}for(var u="",z=a.is("input[type=checkbox]"),f=a;f.length;){a=f[0];var B=a.nodeName;if(!B){break}var B=B.toLowerCase(),f=f.parent(),g=f.children(B);if(b(a).is("form, input, select, textarea")||z){if(B+=b(a).attr("name")?"."+b(a).attr("name"):"",1<g.length&&!b(a).is("input[type=radio]")&&(B+=":eq("+g.index(a)+")"),u=B+(u?">"+u:""),"form"==a.nodeName.toLowerCase()){break}}}return"garlic:"+document.domain+(this.options.domain?"*":window.location.pathname)+">"+u},getStorage:function(){return this.storage}};b.fn.garlic=function(a,u){function z(r){var D=b(r),p=D.data("garlic"),o=b.extend({},f,D.data());if(("undefined"===typeof o.storage||o.storage)&&"password"!==b(r).attr("type")){if(p||D.data("garlic",p=new l(r,B,o)),"string"===typeof a&&"function"===typeof p[a]){return p[a]()}}}var f=b.extend(!0,{},b.fn.garlic.defaults,a,this.data()),B=new j,g=!1;if(!B.defined){return !1}this.each(function(){b(this).is("form")?b(this).find(f.inputs).each(function(){g=z(b(this))}):b(this).is(f.inputs)&&(g=z(b(this)))});return"function"===typeof u?u():g};b.fn.garlic.Constructor=l;b.fn.garlic.defaults={destroy:!0,inputs:"input, textarea, select",events:"DOMAttrModified textInput input change keypress paste focus".split(" "),domain:!1,expires:!1,conflictManager:{enabled:!0,garlicPriority:!0,template:'<span class="garlic-swap"></span>',message:"This is your saved data. Click here to see default one",onConflictDetected:function(){return !0}},getPath:function(){},onRetrieve:function(){}};b(window).on("load",function(){b('[data-persist="garlic"]').each(function(){b(this).garlic()})})}(window.jQuery||window.Zepto);(function(b){b.widget("ui.tagit",{options:{itemName:"item",fieldName:"tags",availableTags:[],tagSource:null,removeConfirmation:false,caseSensitive:true,allowSpaces:false,singleField:false,singleFieldDelimiter:",",singleFieldNode:null,tabIndex:null,onTagAdded:null,onTagRemoved:null,onTagClicked:null},_init:function(a,g){},_create:function(){var j=this;if(this.element.is("input")){this.tagList=b("<ul></ul>").insertAfter(this.element);this.options.singleField=true;this.options.singleFieldNode=this.element;this.element.css("display","none")}else{this.tagList=this.element.find("ul, ol").andSelf().last()}this._tagInput=b('<input type="text">').addClass("ui-widget-content");if(this.options.tabIndex){this._tagInput.attr("tabindex",this.options.tabIndex)}this.options.tagSource=this.options.tagSource||function(f,g){var u=f.term.toLowerCase();var r=b.grep(j.options.availableTags,function(o){return(o.toLowerCase().indexOf(u)===0)});g(j._subtractArray(r,j.assignedTags()))};this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(b('<li class="tagit-new"></li>').append(this._tagInput)).click(function(f){var g=b(f.target);if(g.hasClass("tagit-label")){j._trigger("onTagClicked",f,g.closest(".tagit-choice"))}else{j._tagInput.focus()}});this.tagList.children("li").each(function(){if(!b(this).hasClass("tagit-new")){j.createTag(b(this).html(),b(this).attr("class"));b(this).remove()}});if(this.options.singleField){if(this.options.singleFieldNode){var l=b(this.options.singleFieldNode);var a=l.val().split(this.options.singleFieldDelimiter);l.val("");b.each(a,function(f,g){j.createTag(g,null,true)})}else{this.options.singleFieldNode=this.tagList.after('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'">')}}this._tagInput.keydown(function(f){if(f.which==b.ui.keyCode.BACKSPACE&&j._tagInput.val()===""){var g=j._lastTag();if(!j.options.removeConfirmation||g.hasClass("remove")){j.removeTag(g)}else{if(j.options.removeConfirmation){g.addClass("remove ui-state-highlight")}}}else{if(j.options.removeConfirmation){j._lastTag().removeClass("remove ui-state-highlight")}}if(f.which==b.ui.keyCode.COMMA||f.which==b.ui.keyCode.ENTER||(f.which==b.ui.keyCode.TAB&&j._tagInput.val()!=="")||(f.which==b.ui.keyCode.SPACE&&j.options.allowSpaces!==true&&(b.trim(j._tagInput.val()).replace(/^s*/,"").charAt(0)!='"'||(b.trim(j._tagInput.val()).charAt(0)=='"'&&b.trim(j._tagInput.val()).charAt(b.trim(j._tagInput.val()).length-1)=='"'&&b.trim(j._tagInput.val()).length-1!==0)))){f.preventDefault();j.createTag(j._cleanedInput());j._tagInput.autocomplete("close")}}).blur(function(f){j.createTag(j._cleanedInput())});if(this.options.availableTags||this.options.tagSource){this._tagInput.autocomplete({autoFocus:false,minLength:0,source:this.options.tagSource,select:function(g,f){if(j._tagInput.val()===""){j.removeTag(j._lastTag(),false)}j.createTag(f.item.value);return false}});this._tagInput.focus(function(){})}},_cleanedInput:function(){return b.trim(this._tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.children(".tagit-choice:last")},assignedTags:function(){var g=this;var a=[];if(this.options.singleField){a=b(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter);if(a[0]===""){a=[]}}else{this.tagList.children(".tagit-choice").each(function(){a.push(g.tagLabel(this))})}return a},_updateSingleTagsField:function(a){b(this.options.singleFieldNode).val(a.join(this.options.singleFieldDelimiter))},_subtractArray:function(o,p){var a=[];for(var l=0;l<o.length;l++){if(b.inArray(o[l],p)==-1){a.push(o[l])}}return a},tagLabel:function(a){if(this.options.singleField){return b(a).children(".tagit-label").text()}else{return b(a).children("input").val()}},_isNew:function(j){var l=this;var a=true;this.tagList.children(".tagit-choice").each(function(f){if(l._formatStr(j)==l._formatStr(l.tagLabel(this))){a=false;return false}});return a},_formatStr:function(a){if(this.options.caseSensitive){return a}return b.trim(a.toLowerCase())},createTag:function(D,G,H){that=this;D=b.trim(D);if(!this._isNew(D)||D===""){return false}if(this.options.onlyFromAvailableTags){var K=false;var a=that._formatStr(D);b.each(this.options.availableTags,function(g,f){if(!that.options.caseSensitive){f=f.toLowerCase()}if(f==a){K=true}});if(!K){this._trigger("onError",null,C);return}}var E=b(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(D);var C=b("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(G).append(E);var I=b("<span></span>").addClass("ui-icon ui-icon-close");var F=b('<a><span class="text-icon">\xd7</span></a>').addClass("close").append(I).click(function(f){that.removeTag(C)});C.append(F);if(this.options.singleField){var J=this.assignedTags();J.push(D);this._updateSingleTagsField(J)}else{var M=E.html();C.append('<input type="hidden" style="display:none;" value="'+M+'" name="'+this.options.itemName+"["+this.options.fieldName+'][]">')}this._trigger("onTagAdded",null,C);this._tagInput.val("");this._tagInput.parent().before(C);if(!H){this._trigger("onTagAddedAfter",null,C)}},removeTag:function(a,p){if(typeof p==="undefined"){p=true}a=b(a);this._trigger("onTagRemoved",null,a);if(this.options.singleField){var l=this.assignedTags();var o=this.tagLabel(a);l=b.grep(l,function(f){return f!=o});this._updateSingleTagsField(l)}if(p){a.fadeOut("fast").hide("blind",{direction:"horizontal"},"fast",function(){a.remove()}).dequeue()}else{a.remove()}this._trigger("onTagRemovedAfter",null,a)},removeAll:function(){var a=this;this.tagList.children(".tagit-choice").each(function(j,l){a.removeTag(l,false)})}})})(jQuery);(function(b){jQuery.fn.selectToUISlider=function(j){var T=jQuery.extend({labels:3,tooltip:true,tooltipSrc:"text",labelSrc:"value",sliderOptions:null,data:null,selects:null},j);var S=(T.selects&&T.selects.length>0);var J=jQuery(T.selects);var R=(function(){var f=[];J.each(function(){f.push("handle_"+jQuery(this).attr("id"))});return f})();if(S){var Q=(function(){var f=[];J.eq(0).find("option").each(function(){f.push({value:jQuery(this).attr("value"),text:jQuery(this).text()})});return f})();var P=(function(){if(J.eq(0).find("optgroup").size()>0){var f=[];J.eq(0).find("optgroup").each(function(g){f[g]={};f[g].label=jQuery(this).attr("label");f[g].options=[];jQuery(this).find("option").each(function(){f[g].options.push({text:jQuery(this).text(),value:jQuery(this).attr("value")})})});return f}else{return null}})()}else{var Q=(function(){var f=[];jQuery(T.data).each(function(){jQuery(this.options).each(function(){f.push(this)})});return f})();var P=T.data}jQuery(this).data("options",Q);function M(f){return f.constructor==Array}function Z(f){return(T.tooltipSrc=="text")?Q[f].text:Q[f].value}var U={step:1,min:0,orientation:"horizontal",max:Q.length-1,range:S?(J.length>1):(T.data.length>1),slide:function(o,f){var g=jQuery(f.handle);var l=Z(f.value);g.attr("aria-valuetext",l).attr("aria-valuenow",f.value).find(".ui-slider-tooltip .ttContent").text(l)},values:(function(){var f=[];if(S){J.each(function(){f.push(jQuery(this).get(0).selectedIndex)})}else{f=j.defaultValues}return f})()};T.sliderOptions=(j)?jQuery.extend(U,j.sliderOptions):U;var N=jQuery(this);if(S){J.bind("change keyup click",function(){var g=jQuery(this).get(0).selectedIndex;var l=jQuery("#handle_"+jQuery(this).attr("id"));var f=l.data("handleNum");l.parents(".ui-slider:eq(0)").slider("values",f,g)});J.each(function(g){return;var f="";var o=jQuery("label[for="+jQuery(this).attr("id")+"]");var p=(o.size()>0)?"Slider control for "+o.text()+"":"";var l=o.attr("id")||o.attr("id","label_"+R[g]).attr("id");if(T.tooltip==false){f=' style="display: none;"'}jQuery('<a href="#" tabindex="0" id="'+R[g]+'" class="ui-slider-handle" role="slider" aria-labelledby="'+l+'" aria-valuemin="'+T.sliderOptions.min+'" aria-valuemax="'+T.sliderOptions.max+'" aria-valuenow="'+T.sliderOptions.values[g]+'" aria-valuetext="'+Z(T.sliderOptions.values[g])+'" ><span class="screenReaderContext">'+p+'</span><span class="ui-slider-tooltip ui-widget-content ui-corner-all"'+f+'><span class="ttContent"></span><span class="ui-tooltip-pointer-down ui-widget-content"><span class="ui-tooltip-pointer-down-inner"></span></span></span></a>').data("handleNum",g).appendTo(N)})}if(P){var O=0;var K=N.append('<dl class="ui-slider-scale ui-helper-reset" role="presentation"></dl>').find(".ui-slider-scale:eq(0)");jQuery(P).each(function(f){K.append('<dt style="width: '+(100/P.length).toFixed(2)+"%; left:"+(f/(P.length-1)*100).toFixed(2)+'%"><span>'+this.label+"</span></dt>");var g=this.options;jQuery(this.options).each(function(l){var p=(O==Q.length-1||O==0)?'style="display: none;"':"";var o=g[l].text;K.append('<dd style="left:'+Y(O)+'"><span class="ui-slider-label">'+o+'</span><span class="ui-slider-tic ui-widget-content"'+p+"></span></dd>");O++})})}else{var K=N.append('<ol class="ui-slider-scale ui-helper-reset" role="presentation"></ol>').find(".ui-slider-scale:eq(0)");jQuery(Q).each(function(l){var g=(l==Q.length-1||l==0)?'style="display: none;"':"";var f=this.text;K.append('<li style="left:'+Y(l)+'"><span class="ui-slider-label">'+f+'</span><span class="ui-slider-tic ui-widget-content"'+g+"></span></li>")})}function Y(f){return(f/(Q.length-1)*100).toFixed(2)+"%"}if(T.labels>1){N.find(".ui-slider-scale li:last span.ui-slider-label, .ui-slider-scale dd:last span.ui-slider-label").addClass("ui-slider-label-show")}var a=Math.max(1,Math.round(Q.length/T.labels));for(var W=0;W<Q.length;W+=a){if((Q.length-W)>a){N.find(".ui-slider-scale li:eq("+W+") span.ui-slider-label, .ui-slider-scale dd:eq("+W+") span.ui-slider-label").addClass("ui-slider-label-show")}}N.find(".ui-slider-scale dt").each(function(f){jQuery(this).css({left:((100/(P.length))*f).toFixed(2)+"%"})});N.slider(T.sliderOptions).attr("role","application").find(".ui-slider-label").each(function(){jQuery(this).css("marginLeft",-jQuery(this).width()/2)});N.find(".ui-tooltip-pointer-down-inner").each(function(){var f=jQuery(".ui-tooltip-pointer-down-inner").css("borderTopWidth");var g=jQuery(this).parents(".ui-slider-tooltip").css("backgroundColor");jQuery(this).css("border-top",f+" solid "+g)});var V=N.slider("values");if(M(V)){jQuery(V).each(function(f){N.find(".ui-slider-tooltip .ttContent").eq(f).text(Z(this))})}else{N.find(".ui-slider-tooltip .ttContent").eq(0).text(Z(V))}return this}})(jQuery);(function(j,g,l){giscloud.ui.Options=function(b,a,r){var u=this;function f(o){u.ulcont.empty();if(!o||!o.data.length){return}u.template.tmpl(o.data).appendTo(u.ulcont);u.lis=u.ulcont.children("li");u.lis.each(function(E,F){F=g(F);var D=g.tmplItem(F).data;F.children(".usr-opt-name").editInPlace({callback:function(B,z){u.updateOption(D.id,z,D.option_value);return z}});F.children(".usr-opt-value").editInPlace({callback:function(B,z){u.updateOption(D.id,D.option_name,z);return z}});F.mouseover(function(){F.find(".opt-tools").show()});F.mouseleave(function(){F.find(".opt-tools").hide()});var p=F.find(".opt-remove-bt");p.click(function(){var z=g.tmplItem(this).data;u.removeAppOption(z.id)})})}this.init=function(){u.container=g(b);u.options=a;u.restOptions=r;u.template=g('<div>    <li class="gc-list-item" >        <div class="usr-opt-name"  style="float:left; width:50%" >${option_name}</div>        <div class="usr-opt-value" style="float:left; width:30%; margin-left:20px" >${option_value}</div>        <div class="opt-tools" style="float:right; display:none; margin-top:-2px" >            <a style="" class="opt-remove-bt deletebutton" >'+gclang.Remove+"</a>        </div>    </li></div>");u.inpdiv=g("<div style='position:relative' ></div>").appendTo(u.container);var o=Math.round(Math.random()*10000000);u.keylabel=g("<label fo='opt_key_"+o+"' style='position:absolute; top:7px; left:7px; color:#999' ></label>").appendTo(u.inpdiv);u.keyinp=g("<input id='opt_key_"+o+"' type='text' placeholder='Name' style='width:200px' name='name' value='' />").appendTo(u.inpdiv);u.vallabel=g("<label fo='opt_val_"+o+"' style='position:absolute; top:7px; left:220px; color:#999' ></label>").appendTo(u.inpdiv);u.valinp=g("<input id='opt_val_"+o+"' type='text' placeholder='Value' style='width:100px; margin-left:5px' name='' value='' />").appendTo(u.inpdiv);u.addbt=g("<a style='margin-left:20px' class='linkbutton extrabig' >"+gclang.Add+"</a>").appendTo(u.inpdiv);u.ulcont=g("<ul style='margin-top:10px' class='gc-list' ></ul>").appendTo(u.container);u.keylabel.inFieldLabels();u.vallabel.inFieldLabels();u.valinp.keypress(function(p){if(p.keyCode==13){u.addOption()}});if(a.availableOptions){u.keyinp.autocomplete({source:a.availableOptions,minLength:0,select:function(p,B){u.keyinp.val(B.item.value)}});u.keyinp.focus(function(p){u.keyinp.autocomplete("search")})}else{u.keyinp.keypress(function(p){if(p.keyCode==13){u.addOption()}})}u.addbt.click(function(p){u.addOption()});u.listAppOption();return this};this.addOption=function(){var p=g.extend({name:u.keyinp.val(),value:u.valinp.val()},u.options);if(!p.name||!p.value){alert("Please enter the option name and value.");return}function o(B){u.listAppOption();if(B){}u.keyinp.val("");u.valinp.val("");om.showConfirm("Option has been added successfully.")}if(u.restOptions){giscloud.options.create({resource:u.restOptions.resource,id:u.restOptions.id},{option_name:p.name,option_value:p.value}).done(o)}else{om.kcall("option/add",p,o)}};this.removeAppOption=function(o){if(!o){return}function p(B){u.listAppOption()}if(u.restOptions){giscloud.options.remove(o).done(p)}else{om.kcall("option/remove",{option_id:o},p)}};this.updateOption=function(C,o,D){if(!C||!o||!D){return}function p(){u.listAppOption()}if(u.restOptions){giscloud.options.update(C,{resource:u.restOptions.resource,id:u.restOptions.id},{option_name:o,option_value:D}).done(p)}else{om.kcall("option/update",{option_id:C,name:o,value:D},p)}};this.listAppOption=function(){var o=g.extend({name:u.keyinp.val(),value:u.valinp.val()},u.options);u.ulcont.loader();if(u.restOptions){giscloud.options.list({resource:u.restOptions.resource,id:u.restOptions.id,option_type:u.restOptions.option_type}).done(f)}else{om.kcall("option/list",o,f)}};return this.init()}})(window,window.giscloud.exposeJQuery());!function(b){b(function(){b.support.transition=(function(){var a=(function(){var l=document.createElement("bootstrap"),o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},p;for(p in o){if(l.style[p]!==undefined){return o[p]}}}());return a&&{end:a}})()})}(window.jQuery);!function(o){var p='[data-dismiss="alert"]',j=function(a){o(a).on("click",p,this.close)};j.prototype.close=function(f){var g=o(this),a=g.attr("data-target"),u;if(!a){a=g.attr("href");a=a&&a.replace(/.*(?=#[^\s]*$)/,"")}u=o(a);f&&f.preventDefault();u.length||(u=g.hasClass("alert")?g:g.parent());u.trigger(f=o.Event("close"));if(f.isDefaultPrevented()){return}u.removeClass("in");function b(){u.trigger("closed").remove()}o.support.transition&&u.hasClass("fade")?u.on(o.support.transition.end,b):b()};var l=o.fn.alert;o.fn.alert=function(a){return this.each(function(){var f=o(this),b=f.data("alert");if(!b){f.data("alert",(b=new j(this)))}if(typeof a=="string"){b[a].call(f)}})};o.fn.alert.Constructor=j;o.fn.alert.noConflict=function(){o.fn.alert=l;return this};o(document).on("click.alert.data-api",p,j.prototype.close)}(window.jQuery);!function(l){var g=function(a,b){this.$element=l(a);this.options=l.extend({},l.fn.button.defaults,b)};g.prototype.setState=function(a){var r="disabled",f=this.$element,b=f.data(),u=f.is("input")?"val":"html";a=a+"Text";b.resetText||f.data("resetText",f[u]());f[u](b[a]||this.options[a]);setTimeout(function(){a=="loadingText"?f.addClass(r).attr(r,r):f.removeClass(r).removeAttr(r)},0)};g.prototype.toggle=function(){var a=this.$element.closest('[data-toggle="buttons-radio"]');a&&a.find(".active").removeClass("active");this.$element.toggleClass("active")};var j=l.fn.button;l.fn.button=function(a){return this.each(function(){var p=l(this),b=p.data("button"),f=typeof a=="object"&&a;if(!b){p.data("button",(b=new g(this,f)))}if(a=="toggle"){b.toggle()}else{if(a){b.setState(a)}}})};l.fn.button.defaults={loadingText:"loading..."};l.fn.button.Constructor=g;l.fn.button.noConflict=function(){l.fn.button=j;return this};l(document).on("click.button.data-api","[data-toggle^=button]",function(a){var b=l(a.target);if(!b.hasClass("btn")){b=b.closest(".btn")}b.button("toggle")})}(window.jQuery);!function(g){var l=function(a,b){this.$element=g(a);this.$indicators=this.$element.find(".carousel-indicators");this.options=b;this.options.pause=="hover"&&this.$element.on("mouseenter",g.proxy(this.pause,this)).on("mouseleave",g.proxy(this.cycle,this))};l.prototype={cycle:function(a){if(!a){this.paused=false}if(this.interval){clearInterval(this.interval)}this.options.interval&&!this.paused&&(this.interval=setInterval(g.proxy(this.next,this),this.options.interval));return this},getActiveIndex:function(){this.$active=this.$element.find(".item.active");this.$items=this.$active.parent().children();return this.$items.index(this.$active)},to:function(a){var f=this.getActiveIndex(),b=this;if(a>(this.$items.length-1)||a<0){return}if(this.sliding){return this.$element.one("slid",function(){b.to(a)})}if(f==a){return this.pause().cycle()}return this.slide(a>f?"next":"prev",g(this.$items[a]))},pause:function(a){if(!a){this.paused=true}if(this.$element.find(".next, .prev").length&&g.support.transition.end){this.$element.trigger(g.support.transition.end);this.cycle(true)}clearInterval(this.interval);this.interval=null;return this},next:function(){if(this.sliding){return}return this.slide("next")},prev:function(){if(this.sliding){return}return this.slide("prev")},slide:function(H,E){var f=this.$element.find(".item.active"),F=E||f[H](),a=this.interval,G=H=="next"?"left":"right",D=H=="next"?"first":"last",C=this,b;this.sliding=true;a&&this.pause();F=F.length?F:this.$element.find(".item")[D]();b=g.Event("slide",{relatedTarget:F[0],direction:G});if(F.hasClass("active")){return}if(this.$indicators.length){this.$indicators.find(".active").removeClass("active");this.$element.one("slid",function(){var o=g(C.$indicators.children()[C.getActiveIndex()]);o&&o.addClass("active")})}if(g.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(b);if(b.isDefaultPrevented()){return}F.addClass(H);F[0].offsetWidth;f.addClass(G);F.addClass(G);this.$element.one(g.support.transition.end,function(){F.removeClass([H,G].join(" ")).addClass("active");f.removeClass(["active",G].join(" "));C.sliding=false;setTimeout(function(){C.$element.trigger("slid")},0)})}else{this.$element.trigger(b);if(b.isDefaultPrevented()){return}f.removeClass("active");F.addClass("active");this.sliding=false;this.$element.trigger("slid")}a&&this.cycle();return this}};var j=g.fn.carousel;g.fn.carousel=function(a){return this.each(function(){var r=g(this),u=r.data("carousel"),f=g.extend({},g.fn.carousel.defaults,typeof a=="object"&&a),b=typeof a=="string"?a:f.slide;if(!u){r.data("carousel",(u=new l(this,f)))}if(typeof a=="number"){u.to(a)}else{if(b){u[b]()}else{if(f.interval){u.pause().cycle()}}}})};g.fn.carousel.defaults={interval:5000,pause:"hover"};g.fn.carousel.Constructor=l;g.fn.carousel.noConflict=function(){g.fn.carousel=j;return this};g(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(u){var z=g(this),b,f=g(z.attr("data-target")||(b=z.attr("href"))&&b.replace(/.*(?=#[^\s]+$)/,"")),a=g.extend({},f.data(),z.data()),B;f.carousel(a);if(B=z.attr("data-slide-to")){f.data("carousel").pause().to(B).cycle()}u.preventDefault()})}(window.jQuery);!function(g){var l=function(a,b){this.$element=g(a);this.options=g.extend({},g.fn.collapse.defaults,b);if(this.options.parent){this.$parent=g(this.options.parent)}this.options.toggle&&this.toggle()};l.prototype={constructor:l,dimension:function(){var a=this.$element.hasClass("width");return a?"width":"height"},show:function(){var p,f,a,b;if(this.transitioning||this.$element.hasClass("in")){return}p=this.dimension();f=g.camelCase(["scroll",p].join("-"));a=this.$parent&&this.$parent.find("> .accordion-group > .in");if(a&&a.length){b=a.data("collapse");if(b&&b.transitioning){return}a.collapse("hide");b||a.data("collapse",null)}this.$element[p](0);this.transition("addClass",g.Event("show"),"shown");g.support.transition&&this.$element[p](this.$element[0][f])},hide:function(){var a;if(this.transitioning||!this.$element.hasClass("in")){return}a=this.dimension();this.reset(this.$element[a]());this.transition("removeClass",g.Event("hide"),"hidden");this.$element[a](0)},reset:function(b){var a=this.dimension();this.$element.removeClass("collapse")[a](b||"auto")[0].offsetWidth;this.$element[b!==null?"addClass":"removeClass"]("collapse");return this},transition:function(r,b,a){var u=this,f=function(){if(b.type=="show"){u.reset()}u.transitioning=0;u.$element.trigger(a)};this.$element.triggerHandler(b);if(b.isDefaultPrevented()){return}this.transitioning=1;this.$element[r]("in");g.support.transition&&this.$element.hasClass("collapse")?this.$element.one(g.support.transition.end,f):f()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var j=g.fn.collapse;g.fn.collapse=function(a){return this.each(function(){var p=g(this),b=p.data("collapse"),f=g.extend({},g.fn.collapse.defaults,p.data(),typeof a=="object"&&a);if(!b){p.data("collapse",(b=new l(this,f)))}if(typeof a=="string"){b[a]()}})};g.fn.collapse.defaults={toggle:true};g.fn.collapse.Constructor=l;g.fn.collapse.noConflict=function(){g.fn.collapse=j;return this};g(document).on("click.collapse.data-api","[data-toggle=collapse]",function(r){var u=g(this),f,a=u.attr("data-target")||r.preventDefault()||(f=u.attr("href"))&&f.replace(/.*(?=#[^\s]+$)/,""),b=g(a).data("collapse")?"toggle":u.data();u[g(a).hasClass("in")?"addClass":"removeClass"]("collapsed");g(a).collapse(b)})}(window.jQuery);!function(r){var o="[data-toggle=dropdown]",p=function(a){var b=r(a).on("click.dropdown.data-api",this.toggle);r("html").on("click.dropdown.data-api",function(){b.parent().removeClass("open")})};p.prototype={constructor:p,toggle:function(a){var b=r(this),f,g;if(b.is(".disabled, :disabled")){return}f=u(b);g=f.hasClass("open");z();if(!g){if("ontouchstart" in document.documentElement){r('<div class="dropdown-backdrop"/>').insertBefore(r(this)).on("click",z)}f.toggleClass("open")}b.focus();return false},keydown:function(D){var l,j,g,a,b,f;if(!/(38|40|27)/.test(D.keyCode)){return}l=r(this);D.preventDefault();D.stopPropagation();if(l.is(".disabled, :disabled")){return}a=u(l);b=a.hasClass("open");if(!b||(b&&D.keyCode==27)){if(D.which==27){a.find(o).focus()}return l.click()}j=r("[role=menu] li:not(.divider):visible a",a);if(!j.length){return}f=j.index(j.filter(":focus"));if(D.keyCode==38&&f>0){f--}if(D.keyCode==40&&f<j.length-1){f++}if(!~f){f=0}j.eq(f).focus()}};function z(){r(".dropdown-backdrop").remove();r(o).each(function(){u(r(this)).removeClass("open")})}function u(a){var f=a.attr("data-target"),b;if(!f){f=a.attr("href");f=f&&/#/.test(f)&&f.replace(/.*(?=#[^\s]*$)/,"")}b=f&&r(f);if(!b||!b.length){b=a.parent()}return b}var B=r.fn.dropdown;r.fn.dropdown=function(a){return this.each(function(){var b=r(this),f=b.data("dropdown");if(!f){b.data("dropdown",(f=new p(this)))}if(typeof a=="string"){f[a].call(b)}})};r.fn.dropdown.Constructor=p;r.fn.dropdown.noConflict=function(){r.fn.dropdown=B;return this};r(document).on("click.dropdown.data-api",z).on("click.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dropdown.data-api",o,p.prototype.toggle).on("keydown.dropdown.data-api",o+", [role=menu]",p.prototype.keydown)}(window.jQuery);!function(l){var g=function(a,b){this.options=b;this.$element=l(a).delegate('[data-dismiss="modal"]',"click.dismiss.modal",l.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};g.prototype={constructor:g,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var b=this,a=l.Event("show");this.$element.trigger(a);if(this.isShown||a.isDefaultPrevented()){return}this.isShown=true;this.escape();this.backdrop(function(){var f=l.support.transition&&b.$element.hasClass("fade");if(!b.$element.parent().length){b.$element.appendTo(document.body)}b.$element.show();if(f){b.$element[0].offsetWidth}b.$element.addClass("in").attr("aria-hidden",false);b.enforceFocus();f?b.$element.one(l.support.transition.end,function(){b.$element.focus().trigger("shown")}):b.$element.focus().trigger("shown")})},hide:function(a){a&&a.preventDefault();var b=this;a=l.Event("hide");this.$element.trigger(a);if(!this.isShown||a.isDefaultPrevented()){return}this.isShown=false;this.escape();l(document).off("focusin.modal");this.$element.removeClass("in").attr("aria-hidden",true);l.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var a=this;l(document).on("focusin.modal",function(b){if(a.$element[0]!==b.target&&!a.$element.has(b.target).length){a.$element.focus()}})},escape:function(){var a=this;if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.modal",function(b){b.which==27&&a.hide()})}else{if(!this.isShown){this.$element.off("keyup.dismiss.modal")}}},hideWithTransition:function(){var b=this,a=setTimeout(function(){b.$element.off(l.support.transition.end);b.hideModal()},500);this.$element.one(l.support.transition.end,function(){clearTimeout(a);b.hideModal()})},hideModal:function(){var a=this;this.$element.hide();this.backdrop(function(){a.removeBackdrop();a.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(p){var a=this,b=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=l.support.transition&&b;this.$backdrop=l('<div class="modal-backdrop '+b+'" />').appendTo(document.body);this.$backdrop.click(this.options.backdrop=="static"?l.proxy(this.$element[0].focus,this.$element[0]):l.proxy(this.hide,this));if(f){this.$backdrop[0].offsetWidth}this.$backdrop.addClass("in");if(!p){return}f?this.$backdrop.one(l.support.transition.end,p):p()}else{if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");l.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(l.support.transition.end,p):p()}else{if(p){p()}}}}};var j=l.fn.modal;l.fn.modal=function(a){return this.each(function(){var p=l(this),b=p.data("modal"),f=l.extend({},l.fn.modal.defaults,p.data(),typeof a=="object"&&a);if(!b){p.data("modal",(b=new g(this,f)))}if(typeof a=="string"){b[a]()}else{if(f.show){b.show()}}})};l.fn.modal.defaults={backdrop:true,keyboard:true,show:true};l.fn.modal.Constructor=g;l.fn.modal.noConflict=function(){l.fn.modal=j;return this};l(document).on("click.modal.data-api",'[data-toggle="modal"]',function(r){var u=l(this),b=u.attr("href"),f=l(u.attr("data-target")||(b&&b.replace(/.*(?=#[^\s]+$)/,""))),a=f.data("modal")?"toggle":l.extend({remote:!/#/.test(b)&&b},f.data(),u.data());r.preventDefault();f.modal(a).one("hide",function(){u.focus()})})}(window.jQuery);!function(l){var g=function(a,b){this.init("tooltip",a,b)};g.prototype={constructor:g,init:function(f,D,a){var F,C,B,b,E;this.type=f;this.$element=l(D);this.options=this.getOptions(a);this.enabled=true;B=this.options.trigger.split(" ");for(E=B.length;E--;){b=B[E];if(b=="click"){this.$element.on("click."+this.type,this.options.selector,l.proxy(this.toggle,this))}else{if(b!="manual"){F=b=="hover"?"mouseenter":"focus";C=b=="hover"?"mouseleave":"blur";this.$element.on(F+"."+this.type,this.options.selector,l.proxy(this.enter,this));this.$element.on(C+"."+this.type,this.options.selector,l.proxy(this.leave,this))}}}this.options.selector?(this._options=l.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(a){a=l.extend({},l.fn[this.type].defaults,this.$element.data(),a);if(a.delay&&typeof a.delay=="number"){a.delay={show:a.delay,hide:a.delay}}return a},enter:function(p){var a=l.fn[this.type].defaults,b={},f;this._options&&l.each(this._options,function(u,o){if(a[u]!=o){b[u]=o}},this);f=l(p.currentTarget)[this.type](b).data(this.type);if(!f.options.delay||!f.options.delay.show){return f.show()}clearTimeout(this.timeout);f.hoverState="in";this.timeout=setTimeout(function(){if(f.hoverState=="in"){f.show()}},f.options.delay.show)},leave:function(a){var b=l(a.currentTarget)[this.type](this._options).data(this.type);if(this.timeout){clearTimeout(this.timeout)}if(!b.options.delay||!b.options.delay.hide){return b.hide()}b.hoverState="out";this.timeout=setTimeout(function(){if(b.hoverState=="out"){b.hide()}},b.options.delay.hide)},show:function(){var C,f,a,B,z,D,b=l.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(b);if(b.isDefaultPrevented()){return}C=this.tip();this.setContent();if(this.options.animation){C.addClass("fade")}z=typeof this.options.placement=="function"?this.options.placement.call(this,C[0],this.$element[0]):this.options.placement;C.detach().css({top:0,left:0,display:"block"});this.options.container?C.appendTo(this.options.container):C.insertAfter(this.$element);f=this.getPosition();a=C[0].offsetWidth;B=C[0].offsetHeight;switch(z){case"bottom":D={top:f.top+f.height,left:f.left+f.width/2-a/2};break;case"top":D={top:f.top-B,left:f.left+f.width/2-a/2};break;case"left":D={top:f.top+f.height/2-B/2,left:f.left-a};break;case"right":D={top:f.top+f.height/2-B/2,left:f.left+f.width};break}this.applyPlacement(D,z);this.$element.trigger("shown")}},applyPlacement:function(C,f){var a=this.tip(),E=a[0].offsetWidth,b=a[0].offsetHeight,F,H,G,D;a.offset(C).addClass(f).addClass("in");F=a[0].offsetWidth;H=a[0].offsetHeight;if(f=="top"&&H!=b){C.top=C.top+b-H;D=true}if(f=="bottom"||f=="top"){G=0;if(C.left<0){G=C.left*-2;C.left=0;a.offset(C);F=a[0].offsetWidth;H=a[0].offsetHeight}this.replaceArrow(G-E+F,F,"left")}else{this.replaceArrow(H-b,H,"top")}if(D){a.offset(C)}},replaceArrow:function(a,b,f){this.arrow().css(f,a?(50*(1-a/b)+"%"):"")},setContent:function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b);a.removeClass("fade in top bottom left right")},hide:function(){var f=this,a=this.tip(),b=l.Event("hide");this.$element.trigger(b);if(b.isDefaultPrevented()){return}a.removeClass("in");function p(){var o=setTimeout(function(){a.off(l.support.transition.end).detach()},500);a.one(l.support.transition.end,function(){clearTimeout(o);a.detach()})}l.support.transition&&this.$tip.hasClass("fade")?p():a.detach();this.$element.trigger("hidden");return this},fixTitle:function(){var a=this.$element;if(a.attr("title")||typeof(a.attr("data-original-title"))!="string"){a.attr("data-original-title",a.attr("title")||"").attr("title","")}},hasContent:function(){return this.getTitle()},getPosition:function(){var a=this.$element[0];return l.extend({},(typeof a.getBoundingClientRect=="function")?a.getBoundingClientRect():{width:a.offsetWidth,height:a.offsetHeight},this.$element.offset())},getTitle:function(){var a,f=this.$element,b=this.options;a=f.attr("data-original-title")||(typeof b.title=="function"?b.title.call(f[0]):b.title);return a},tip:function(){return this.$tip=this.$tip||l(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(a){var b=a?l(a.currentTarget)[this.type](this._options).data(this.type):this;b.tip().hasClass("in")?b.hide():b.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var j=l.fn.tooltip;l.fn.tooltip=function(a){return this.each(function(){var p=l(this),b=p.data("tooltip"),f=typeof a=="object"&&a;if(!b){p.data("tooltip",(b=new g(this,f)))}if(typeof a=="string"){b[a]()}})};l.fn.tooltip.Constructor=g;l.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:false,container:false};l.fn.tooltip.noConflict=function(){l.fn.tooltip=j;return this}}(window.jQuery);!function(l){var g=function(a,b){this.init("popover",a,b)};g.prototype=l.extend({},l.fn.tooltip.Constructor.prototype,{constructor:g,setContent:function(){var a=this.tip(),b=this.getTitle(),f=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b);a.find(".popover-content")[this.options.html?"html":"text"](f);a.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var b,f=this.$element,a=this.options;b=(typeof a.content=="function"?a.content.call(f[0]):a.content)||f.attr("data-content");return b},tip:function(){if(!this.$tip){this.$tip=l(this.options.template)}return this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var j=l.fn.popover;l.fn.popover=function(a){return this.each(function(){var p=l(this),b=p.data("popover"),f=typeof a=="object"&&a;if(!b){p.data("popover",(b=new g(this,f)))}if(typeof a=="string"){b[a]()}})};l.fn.popover.Constructor=g;l.fn.popover.defaults=l.extend({},l.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});l.fn.popover.noConflict=function(){l.fn.popover=j;return this}}(window.jQuery);!function(l){function g(u,a){var r=l.proxy(this.process,this),f=l(u).is("body")?l(window):l(u),b;this.options=l.extend({},l.fn.scrollspy.defaults,a);this.$scrollElement=f.on("scroll.scroll-spy.data-api",r);this.selector=(this.options.target||((b=l(u).attr("href"))&&b.replace(/.*(?=#[^\s]+$)/,""))||"")+" .nav li > a";this.$body=l("body");this.refresh();this.process()}g.prototype={constructor:g,refresh:function(){var b=this,a;this.offsets=l([]);this.targets=l([]);a=this.$body.find(this.selector).map(function(){var u=l(this),f=u.data("target")||u.attr("href"),r=/^#\w/.test(f)&&l(f);return(r&&r.length&&[[r.position().top+(!l.isWindow(b.$scrollElement.get(0))&&b.$scrollElement.scrollTop()),f]])||null}).sort(function(p,f){return p[0]-f[0]}).each(function(){b.offsets.push(this[0]);b.targets.push(this[1])})},process:function(){var B=this.$scrollElement.scrollTop()+this.options.offset,a=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,C=a-this.$scrollElement.height(),D=this.offsets,z=this.targets,f=this.activeTarget,b;if(B>=C){return f!=(b=z.last()[0])&&this.activate(b)}for(b=D.length;b--;){f!=z[b]&&B>=D[b]&&(!D[b+1]||B<=D[b+1])&&this.activate(z[b])}},activate:function(a){var b,f;this.activeTarget=a;l(this.selector).parent(".active").removeClass("active");f=this.selector+'[data-target="'+a+'"],'+this.selector+'[href="'+a+'"]';b=l(f).parent("li").addClass("active");if(b.parent(".dropdown-menu").length){b=b.closest("li.dropdown").addClass("active")}b.trigger("activate")}};var j=l.fn.scrollspy;l.fn.scrollspy=function(a){return this.each(function(){var p=l(this),b=p.data("scrollspy"),f=typeof a=="object"&&a;if(!b){p.data("scrollspy",(b=new g(this,f)))}if(typeof a=="string"){b[a]()}})};l.fn.scrollspy.Constructor=g;l.fn.scrollspy.defaults={offset:10};l.fn.scrollspy.noConflict=function(){l.fn.scrollspy=j;return this};l(window).on("load",function(){l('[data-spy="scroll"]').each(function(){var a=l(this);a.scrollspy(a.data())})})}(window.jQuery);!function(l){var g=function(a){this.element=l(a)};g.prototype={constructor:g,show:function(){var u=this.element,a=u.closest("ul:not(.dropdown-menu)"),b=u.attr("data-target"),B,f,z;if(!b){b=u.attr("href");b=b&&b.replace(/.*(?=#[^\s]*$)/,"")}if(u.parent("li").hasClass("active")){return}B=a.find(".active:last a")[0];z=l.Event("show",{relatedTarget:B});u.trigger(z);if(z.isDefaultPrevented()){return}f=l(b);this.activate(u.parent("li"),a);this.activate(f,f.parent(),function(){u.trigger({type:"shown",relatedTarget:B})})},activate:function(a,b,u){var f=b.find("> .active"),z=u&&l.support.transition&&f.hasClass("fade");function B(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");a.addClass("active");if(z){a[0].offsetWidth;a.addClass("in")}else{a.removeClass("fade")}if(a.parent(".dropdown-menu")){a.closest("li.dropdown").addClass("active")}u&&u()}z?f.one(l.support.transition.end,B):B();f.removeClass("in")}};var j=l.fn.tab;l.fn.tab=function(a){return this.each(function(){var b=l(this),f=b.data("tab");if(!f){b.data("tab",(f=new g(this)))}if(typeof a=="string"){f[a]()}})};l.fn.tab.Constructor=g;l.fn.tab.noConflict=function(){l.fn.tab=j;return this};l(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(a){a.preventDefault();l(this).tab("show")})}(window.jQuery);!function(g){var l=function(a,b){this.$element=g(a);this.options=g.extend({},g.fn.typeahead.defaults,b);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.source=this.options.source;this.$menu=g(this.options.menu);this.shown=false;this.listen()};l.prototype={constructor:l,select:function(){var a=this.$menu.find(".active").attr("data-value");this.$element.val(this.updater(a)).change();return this.hide()},updater:function(a){return a},show:function(){var a=g.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});this.$menu.insertAfter(this.$element).css({top:a.top+a.height,left:a.left}).show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},lookup:function(a){var b;this.query=this.$element.val();if(!this.query||this.query.length<this.options.minLength){return this.shown?this.hide():this}b=g.isFunction(this.source)?this.source(this.query,g.proxy(this.process,this)):this.source;return b?this.process(b):this},process:function(b){var a=this;b=g.grep(b,function(f){return a.matcher(f)});b=this.sorter(b);if(!b.length){return this.shown?this.hide():this}return this.render(b.slice(0,this.options.items)).show()},matcher:function(a){return ~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){var u=[],b=[],f=[],r;while(r=a.shift()){if(!r.toLowerCase().indexOf(this.query.toLowerCase())){u.push(r)}else{if(~r.indexOf(this.query)){b.push(r)}else{f.push(r)}}}return u.concat(b,f)},highlighter:function(b){var a=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return b.replace(new RegExp("("+a+")","ig"),function(f,p){return"<strong>"+p+"</strong>"})},render:function(b){var a=this;b=g(b).map(function(f,p){f=g(a.options.item).attr("data-value",p);f.find("a").html(a.highlighter(p));return f[0]});b.first().addClass("active");this.$menu.html(b);return this},next:function(b){var a=this.$menu.find(".active").removeClass("active"),f=a.next();if(!f.length){f=g(this.$menu.find("li")[0])}f.addClass("active")},prev:function(b){var a=this.$menu.find(".active").removeClass("active"),f=a.prev();if(!f.length){f=this.$menu.find("li").last()}f.addClass("active")},listen:function(){this.$element.on("focus",g.proxy(this.focus,this)).on("blur",g.proxy(this.blur,this)).on("keypress",g.proxy(this.keypress,this)).on("keyup",g.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",g.proxy(this.keydown,this))}this.$menu.on("click",g.proxy(this.click,this)).on("mouseenter","li",g.proxy(this.mouseenter,this)).on("mouseleave","li",g.proxy(this.mouseleave,this))},eventSupported:function(b){var a=b in this.$element;if(!a){this.$element.setAttribute(b,"return;");a=typeof this.$element[b]==="function"}return a},move:function(a){if(!this.shown){return}switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault();this.prev();break;case 40:a.preventDefault();this.next();break}a.stopPropagation()},keydown:function(a){this.suppressKeyPressRepeat=~g.inArray(a.keyCode,[40,38,9,13,27]);this.move(a)},keypress:function(a){if(this.suppressKeyPressRepeat){return}this.move(a)},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown){return}this.select();break;case 27:if(!this.shown){return}this.hide();break;default:this.lookup()}a.stopPropagation();a.preventDefault()},focus:function(a){this.focused=true},blur:function(a){this.focused=false;if(!this.mousedover&&this.shown){this.hide()}},click:function(a){a.stopPropagation();a.preventDefault();this.select();this.$element.focus()},mouseenter:function(a){this.mousedover=true;this.$menu.find(".active").removeClass("active");g(a.currentTarget).addClass("active")},mouseleave:function(a){this.mousedover=false;if(!this.focused&&this.shown){this.hide()}}};var j=g.fn.typeahead;g.fn.typeahead=function(a){return this.each(function(){var p=g(this),b=p.data("typeahead"),f=typeof a=="object"&&a;if(!b){p.data("typeahead",(b=new l(this,f)))}if(typeof a=="string"){b[a]()}})};g.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1};g.fn.typeahead.Constructor=l;g.fn.typeahead.noConflict=function(){g.fn.typeahead=j;return this};g(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(a){var b=g(this);if(b.data("typeahead")){return}b.typeahead(b.data())})}(window.jQuery);!function(l){var g=function(a,b){this.options=l.extend({},l.fn.affix.defaults,b);this.$window=l(window).on("scroll.affix.data-api",l.proxy(this.checkPosition,this)).on("click.affix.data-api",l.proxy(function(){setTimeout(l.proxy(this.checkPosition,this),1)},this));this.$element=l(a);this.checkPosition()};g.prototype.checkPosition=function(){if(!this.$element.is(":visible")){return}var D=l(document).height(),f=this.$window.scrollTop(),C=this.$element.offset(),F=this.options.offset,a=F.bottom,E=F.top,B="affix affix-top affix-bottom",b;if(typeof F!="object"){a=E=F}if(typeof E=="function"){E=F.top()}if(typeof a=="function"){a=F.bottom()}b=this.unpin!=null&&(f+this.unpin<=C.top)?false:a!=null&&(C.top+this.$element.height()>=D-a)?"bottom":E!=null&&f<=E?"top":false;if(this.affixed===b){return}this.affixed=b;this.unpin=b=="bottom"?C.top-f:null;this.$element.removeClass(B).addClass("affix"+(b?"-"+b:""))};var j=l.fn.affix;l.fn.affix=function(a){return this.each(function(){var p=l(this),b=p.data("affix"),f=typeof a=="object"&&a;if(!b){p.data("affix",(b=new g(this,f)))}if(typeof a=="string"){b[a]()}})};l.fn.affix.Constructor=g;l.fn.affix.defaults={offset:0};l.fn.affix.noConflict=function(){l.fn.affix=j;return this};l(window).on("load",function(){l('[data-spy="affix"]').each(function(){var a=l(this),b=a.data();b.offset=b.offset||{};b.offsetBottom&&(b.offset.bottom=b.offsetBottom);b.offsetTop&&(b.offset.top=b.offsetTop);a.affix(b)})})}(window.jQuery);(function(){this.MooTools={version:"1.3",build:"a3eed692dd85050d80168ec2c708efe901bb7db3"};var Z=this.typeOf=function(a){if(a==null){return"null"}if(a.$family){return a.$family()}if(a.nodeName){if(a.nodeType==1){return"element"}if(a.nodeType==3){return(/\S/).test(a.nodeValue)?"textnode":"whitespace"}}else{if(typeof a.length=="number"){if(a.callee){return"arguments"}if("item" in a){return"collection"}}}return typeof a};var K=this.instanceOf=function(f,b){if(f==null){return false}var a=f.$constructor||f.constructor;while(a){if(a===b){return true}a=a.parent}return f instanceof b};var Y=this.Function;var O=true;for(var Q in {toString:1}){O=null}if(O){O=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]}Y.prototype.overloadSetter=function(a){var b=this;return function(j,l){if(j==null){return this}if(a||typeof j!="string"){for(var g in j){b.call(this,g,j[g])}if(O){for(var f=O.length;f--;){g=O[f];if(j.hasOwnProperty(g)){b.call(this,g,j[g])}}}}else{b.call(this,j,l)}return this}};Y.prototype.overloadGetter=function(a){var b=this;return function(j){var g,l;if(a||typeof j!="string"){g=j}else{if(arguments.length>1){g=arguments}}if(g){l={};for(var f=0;f<g.length;f++){l[g[f]]=b.call(this,g[f])}}else{l=b.call(this,j)}return l}};Y.prototype.extend=function(b,a){this[b]=a}.overloadSetter();Y.prototype.implement=function(b,a){this.prototype[b]=a}.overloadSetter();var S=Array.prototype.slice;Y.from=function(a){return(Z(a)=="function")?a:function(){return a}};Array.from=function(a){if(a==null){return[]}return(P.isEnumerable(a)&&typeof a!="string")?(Z(a)=="array")?a:S.call(a):[a]};Number.from=function(a){var b=parseFloat(a);return isFinite(b)?b:null};String.from=function(a){return a+""};Y.implement({hide:function(){this.$hidden=true;return this},protect:function(){this.$protected=true;return this}});var P=this.Type=function(f,g){if(f){var a=f.toLowerCase();var b=function(j){return(Z(j)==a)};P["is"+f]=b;if(g!=null){g.prototype.$family=(function(){return a}).hide();g.type=b}}if(g==null){return null}g.extend(this);g.$constructor=P;g.prototype.$constructor=g;return g};var R=Object.prototype.toString;P.isEnumerable=function(a){return(a!=null&&typeof a.length=="number"&&R.call(a)!="[object Function]")};var ac={};var aa=function(b){var a=Z(b.prototype);return ac[a]||(ac[a]=[])};var V=function(a,f){if(f&&f.$hidden){return this}var b=aa(this);for(var l=0;l<b.length;l++){var g=b[l];if(Z(g)=="type"){V.call(g,a,f)}else{g.call(this,a,f)}}var j=this.prototype[a];if(j==null||!j.$protected){this.prototype[a]=f}if(this[a]==null&&Z(f)=="function"){M.call(this,a,function(o){return f.apply(o,S.call(arguments,1))})}return this};var M=function(b,f){if(f&&f.$hidden){return this}var a=this[b];if(a==null||!a.$protected){this[b]=f}return this};P.implement({implement:V.overloadSetter(),extend:M.overloadSetter(),alias:function(b,a){V.call(this,b,this.prototype[a])}.overloadSetter(),mirror:function(a){aa(this).push(a);return this}});new P("Type",P);var ab=function(u,l,p){var r=(l!=Object),b=l.prototype;if(r){l=new P(u,l)}for(var j=0,o=p.length;j<o;j++){var a=p[j],f=l[a],g=b[a];if(f){f.protect()}if(r&&g){delete b[a];b[a]=g.protect()}}if(r){l.implement(b)}return ab};ab("String",String,["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",Y,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=M.overloadSetter();Date.extend("now",function(){return +(new Date)});new P("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();Number.extend("random",function(a,b){return Math.floor(Math.random()*(b-a+1)+a)});Object.extend("forEach",function(b,g,f){for(var a in b){if(b.hasOwnProperty(a)){g.call(f,b[a],a,b)}}});Object.each=Object.forEach;Array.implement({forEach:function(g,f){for(var a=0,b=this.length;a<b;a++){if(a in this){g.call(f,this[a],a,this)}}},each:function(b,a){Array.forEach(this,b,a);return this}});var N=function(a){switch(Z(a)){case"array":return a.clone();case"object":return Object.clone(a);default:return a}};Array.implement("clone",function(){var b=this.length,a=new Array(b);while(b--){a[b]=N(this[b])}return a});var ad=function(a,b,f){switch(Z(f)){case"object":if(Z(a[b])=="object"){Object.merge(a[b],f)}else{a[b]=Object.clone(f)}break;case"array":a[b]=f.clone();break;default:a[b]=f}return a};Object.extend({merge:function(f,o,a){if(Z(o)=="string"){return ad(f,o,a)}for(var g=1,b=arguments.length;g<b;g++){var l=arguments[g];for(var j in l){ad(f,j,l[j])}}return f},clone:function(b){var f={};for(var a in b){f[a]=N(b[a])}return f},append:function(f){for(var g=1,a=arguments.length;g<a;g++){var b=arguments[g]||{};for(var j in b){f[j]=b[j]}}return f}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(a){new P(a)});var T=Date.now();String.extend("uniqueID",function(){return(T++).toString(36)});var W=this.Hash=new P("Hash",function(b){if(Z(b)=="hash"){b=Object.clone(b.getClean())}for(var a in b){this[a]=b[a]}return this});W.implement({forEach:function(b,a){Object.forEach(this,b,a)},getClean:function(){var a={};for(var b in this){if(this.hasOwnProperty(b)){a[b]=this[b]}}return a},getLength:function(){var a=0;for(var b in this){if(this.hasOwnProperty(b)){a++}}return a}});W.alias("each","forEach");Object.type=P.isObject;var U=this.Native=function(a){return new P(a.name,a.initialize)};U.type=P.type;U.implement=function(f,b){for(var a=0;a<f.length;a++){f[a].implement(b)}return U};var J=Array.type;Array.type=function(a){return K(a,Array)||J(a)};this.$A=function(a){return Array.from(a).slice()};this.$arguments=function(a){return function(){return arguments[a]}};this.$chk=function(a){return !!(a||a===0)};this.$clear=function(a){clearTimeout(a);clearInterval(a);return null};this.$defined=function(a){return(a!=null)};this.$each=function(g,a,f){var b=Z(g);((b=="arguments"||b=="collection"||b=="array"||b=="elements")?Array:Object).each(g,a,f)};this.$empty=function(){};this.$extend=function(a,b){return Object.append(a,b)};this.$H=function(a){return new W(a)};this.$merge=function(){var a=Array.slice(arguments);a.unshift({});return Object.merge.apply(null,a)};this.$lambda=Y.from;this.$mixin=Object.merge;this.$random=Number.random;this.$splat=Array.from;this.$time=Date.now;this.$type=function(b){var a=Z(b);if(a=="elements"){return"array"}return(a=="null")?false:a};this.$unlink=function(a){switch(Z(a)){case"object":return Object.clone(a);case"array":return Array.clone(a);case"hash":return new W(a);default:return a}}})();Array.implement({invoke:function(g){var f=Array.slice(arguments,1);return this.map(function(a){return a[g].apply(a,f)})},every:function(p,o){for(var j=0,l=this.length;j<l;j++){if((j in this)&&!p.call(o,this[j],j,this)){return false}}return true},filter:function(r,p){var u=[];for(var l=0,o=this.length;l<o;l++){if((l in this)&&r.call(p,this[l],l,this)){u.push(this[l])}}return u},clean:function(){return this.filter(function(b){return b!=null})},indexOf:function(p,o){var l=this.length;for(var j=(o<0)?Math.max(0,l+o):o||0;j<l;j++){if(this[j]===p){return j}}return -1},map:function(r,p){var u=[];for(var l=0,o=this.length;l<o;l++){if(l in this){u[l]=r.call(p,this[l],l,this)}}return u},some:function(p,o){for(var j=0,l=this.length;j<l;j++){if((j in this)&&p.call(o,this[j],j,this)){return true}}return false},associate:function(p){var o={},j=Math.min(this.length,p.length);for(var l=0;l<j;l++){o[p[l]]=this[l]}return o},link:function(u){var o={};for(var p=0,l=this.length;p<l;p++){for(var r in u){if(u[r](this[p])){o[r]=this[p];delete u[r];break}}}return o},contains:function(g,f){return this.indexOf(g,f)!=-1},append:function(b){this.push.apply(this,b);return this},getLast:function(){return(this.length)?this[this.length-1]:null},getRandom:function(){return(this.length)?this[Number.random(0,this.length-1)]:null},include:function(b){if(!this.contains(b)){this.push(b)}return this},combine:function(l){for(var g=0,j=l.length;g<j;g++){this.include(l[g])}return this},erase:function(f){for(var g=this.length;g--;){if(this[g]===f){this.splice(g,1)}}return this},empty:function(){this.length=0;return this},flatten:function(){var o=[];for(var j=0,l=this.length;j<l;j++){var p=typeOf(this[j]);if(p=="null"){continue}o=o.concat((p=="array"||p=="collection"||p=="arguments"||instanceOf(this[j],Array))?Array.flatten(this[j]):this[j])}return o},pick:function(){for(var f=0,g=this.length;f<g;f++){if(this[f]!=null){return this[f]}}return null},hexToRgb:function(f){if(this.length!=3){return null}var g=this.map(function(a){if(a.length==1){a+=a}return a.toInt(16)});return(f)?g:"rgb("+g+")"},rgbToHex:function(o){if(this.length<3){return null}if(this.length==4&&this[3]==0&&!o){return"transparent"}var j=[];for(var l=0;l<3;l++){var p=(this[l]-0).toString(16);j.push((p.length==1)?"0"+p:p)}return(o)?j:"#"+j.join("")}});Array.alias("extend","append");var $pick=function(){return Array.from(arguments).pick()};String.implement({test:function(g,f){return((typeOf(g)=="regexp")?g:new RegExp(""+g,f)).test(this)},contains:function(g,f){return(f)?(f+this+f).indexOf(f+g+f)>-1:this.indexOf(g)>-1},trim:function(){return this.replace(/^\s+|\s+$/g,"")},clean:function(){return this.replace(/\s+/g," ").trim()},camelCase:function(){return this.replace(/-\D/g,function(b){return b.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(b){return("-"+b.charAt(0).toLowerCase())})},capitalize:function(){return this.replace(/\b[a-z]/g,function(b){return b.toUpperCase()})},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(b){return parseInt(this,b||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(f){var g=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(g)?g.slice(1).hexToRgb(f):null},rgbToHex:function(f){var g=this.match(/\d{1,3}/g);return(g)?g.rgbToHex(f):null},substitute:function(g,f){return this.replace(f||(/\\?\{([^{}]+)\}/g),function(a,b){if(a.charAt(0)=="\\"){return a.slice(1)}return(g[b]!=null)?g[b]:""})}});Number.implement({limit:function(f,g){return Math.min(g,Math.max(f,this))},round:function(b){b=Math.pow(10,b||0).toFixed(b<0?-b:0);return Math.round(this*b)/b},times:function(g,l){for(var j=0;j<this;j++){g.call(l,j,this)}},toFloat:function(){return parseFloat(this)},toInt:function(b){return parseInt(this,b||10)}});Number.alias("each","times");(function(f){var g={};f.each(function(a){if(!Number[a]){g[a]=function(){return Math[a].apply(null,[this].concat(Array.from(arguments)))}}});Number.implement(g)})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);Function.extend({attempt:function(){for(var g=0,j=arguments.length;g<j;g++){try{return arguments[g]()}catch(l){}}return null}});Function.implement({attempt:function(j,l){try{return this.apply(l,Array.from(j))}catch(g){}return null},bind:function(l){var j=this,g=(arguments.length>1)?Array.slice(arguments,1):null;return function(){if(!g&&!arguments.length){return j.call(l)}if(g&&arguments.length){return j.apply(l,g.concat(Array.from(arguments)))}return j.apply(l,g||arguments)}},pass:function(g,l){var j=this;if(g!=null){g=Array.from(g)}return function(){return j.apply(l,g||arguments)}},delay:function(g,l,j){return setTimeout(this.pass(j,l),g)},periodical:function(l,g,j){return setInterval(this.pass(j,g),l)}});delete Function.prototype.bind;Function.implement({create:function(f){var g=this;f=f||{};return function(b){var l=f.arguments;l=(l!=null)?Array.from(l):Array.slice(arguments,(f.event)?1:0);if(f.event){l=[b||window.event].extend(l)}var a=function(){return g.apply(f.bind||null,l)};if(f.delay){return setTimeout(a,f.delay)}if(f.periodical){return setInterval(a,f.periodical)}if(f.attempt){return Function.attempt(a)}return a()}},bind:function(l,g){var j=this;if(g!=null){g=Array.from(g)}return function(){return j.apply(l,g||arguments)}},bindWithEvent:function(l,g){var j=this;if(g!=null){g=Array.from(g)}return function(a){return j.apply(l,(g==null)?arguments:[a].concat(g))}},run:function(g,f){return this.apply(f,Array.from(g))}});var $try=Function.attempt;Object.extend({subset:function(z,B){var r={};for(var u=0,p=B.length;u<p;u++){var l=B[u];r[l]=z[l]}return r},map:function(o,r,p){var u={};for(var l in o){if(o.hasOwnProperty(l)){u[l]=r.call(p,o[l],l,o)}}return u},filter:function(l,p,o){var j={};Object.each(l,function(a,b){if(p.call(o,a,b,l)){j[b]=a}});return j},every:function(l,p,o){for(var j in l){if(l.hasOwnProperty(j)&&!p.call(o,l[j],j)){return false}}return true},some:function(l,p,o){for(var j in l){if(l.hasOwnProperty(j)&&p.call(o,l[j],j)){return true}}return false},keys:function(j){var l=[];for(var g in j){if(j.hasOwnProperty(g)){l.push(g)}}return l},values:function(g){var j=[];for(var l in g){if(g.hasOwnProperty(l)){j.push(g[l])}}return j},getLength:function(b){return Object.keys(b).length},keyOf:function(j,l){for(var g in j){if(j.hasOwnProperty(g)&&j[g]===l){return g}}return null},contains:function(g,f){return Object.keyOf(g,f)!=null},toQueryString:function(j,g){var l=[];Object.each(j,function(p,a){if(g){a=g+"["+a+"]"}var b;switch(typeOf(p)){case"object":b=Object.toQueryString(p,a);break;case"array":var f={};p.each(function(o,u){f[u]=o});b=Object.toQueryString(f,a);break;default:b=a+"="+encodeURIComponent(p)}if(p!=null){l.push(b)}});return l.join("&")}});Hash.implement({has:Object.prototype.hasOwnProperty,keyOf:function(b){return Object.keyOf(this,b)},hasValue:function(b){return Object.contains(this,b)},extend:function(b){Hash.each(b||{},function(g,a){Hash.set(this,a,g)},this);return this},combine:function(b){Hash.each(b||{},function(g,a){Hash.include(this,a,g)},this);return this},erase:function(b){if(this.hasOwnProperty(b)){delete this[b]}return this},get:function(b){return(this.hasOwnProperty(b))?this[b]:null},set:function(g,f){if(!this[g]||this.hasOwnProperty(g)){this[g]=f}return this},empty:function(){Hash.each(this,function(f,g){delete this[g]},this);return this},include:function(g,f){if(this[g]==null){this[g]=f}return this},map:function(g,f){return new Hash(Object.map(this,g,f))},filter:function(g,f){return new Hash(Object.filter(this,g,f))},every:function(g,f){return Object.every(this,g,f)},some:function(g,f){return Object.some(this,g,f)},getKeys:function(){return Object.keys(this)},getValues:function(){return Object.values(this)},toQueryString:function(b){return Object.toQueryString(this,b)}});Hash.extend=Object.append;Hash.alias({indexOf:"keyOf",contains:"hasValue"});(function(){var Q=this.document;var G=Q.window=this;var R=1;this.$uid=(G.ActiveXObject)?function(a){return(a.uid||(a.uid=[R++]))[0]}:function(a){return a.uid||(a.uid=R++)};$uid(G);$uid(Q);var S=navigator.userAgent.toLowerCase(),P=navigator.platform.toLowerCase(),T=S.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],M=T[1]=="ie"&&Q.documentMode;var U=this.Browser={extend:Function.prototype.extend,name:(T[1]=="version")?T[3]:T[1],version:M||parseFloat((T[1]=="opera"&&T[4])?T[4]:T[2]),Platform:{name:S.match(/ip(?:ad|od|hone)/)?"ios":(S.match(/(?:webos|android)/)||P.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!(Q.evaluate),air:!!(G.runtime),query:!!(Q.querySelector),json:!!(G.JSON)},Plugins:{}};U[U.name]=true;U[U.name+parseInt(U.version,10)]=true;U.Platform[U.Platform.name]=true;U.Request=(function(){var a=function(){return new XMLHttpRequest()};var b=function(){return new ActiveXObject("MSXML2.XMLHTTP")};var f=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){a();return a},function(){b();return b},function(){f();return f})})();U.Features.xhr=!!(U.Request);var J=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")})||"0 r0").match(/\d+/g);U.Plugins.Flash={version:Number(J[0]||"0."+J[1])||0,build:Number(J[2])||0};U.exec=function(a){if(!a){return a}if(G.execScript){G.execScript(a)}else{var b=Q.createElement("script");b.setAttribute("type","text/javascript");b.text=a;Q.head.appendChild(b);Q.head.removeChild(b)}return a};String.implement("stripScripts",function(b){var f="";var a=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(j,g){f+=g+"\n";return""});if(b===true){U.exec(f)}else{if(typeOf(b)=="function"){b(f,a)}}return a});U.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.from("window").hide();Window.mirror(function(b,a){G[b]=a});this.Document=Q.$constructor=new Type("Document",function(){});Q.$family=Function.from("document").hide();Document.mirror(function(b,a){Q[b]=a});Q.html=Q.documentElement;Q.head=Q.getElementsByTagName("head")[0];if(Q.execCommand){try{Q.execCommand("BackgroundImageCache",false,true)}catch(K){}}if(this.attachEvent&&!this.addEventListener){var O=function(){this.detachEvent("onunload",O);Q.head=Q.html=Q.window=null};this.attachEvent("onunload",O)}var H=Array.from;try{H(Q.html.childNodes)}catch(K){Array.from=function(b){if(typeof b!="string"&&Type.isEnumerable(b)&&typeOf(b)!="array"){var f=b.length,a=new Array(f);while(f--){a[f]=b[f]}return a}return H(b)};var I=Array.prototype,F=I.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(b){var a=I[b];Array[b]=function(f){return a.apply(Array.from(f),F.call(arguments,1))}})}if(U.Platform.ios){U.Platform.ipod=true}U.Engine={};var N=function(a,b){U.Engine.name=a;U.Engine[a+b]=true;U.Engine.version=b};if(U.ie){U.Engine.trident=true;switch(U.version){case 6:N("trident",4);break;case 7:N("trident",5);break;case 8:N("trident",6)}}if(U.firefox){U.Engine.gecko=true;if(U.version>=3){N("gecko",19)}else{N("gecko",18)}}if(U.safari||U.chrome){U.Engine.webkit=true;switch(U.version){case 2:N("webkit",419);break;case 3:N("webkit",420);break;case 4:N("webkit",525)}}if(U.opera){U.Engine.presto=true;if(U.version>=9.6){N("presto",960)}else{if(U.version>=9.5){N("presto",950)}else{N("presto",925)}}}if(U.name=="unknown"){switch((S.match(/(?:webkit|khtml|gecko)/)||[])[0]){case"webkit":case"khtml":U.Engine.webkit=true;break;case"gecko":U.Engine.gecko=true}}this.$exec=U.exec})();var Event=new Type("Event",function(U,I){if(!I){I=window}var Z=I.document;U=U||I.event;if(U.$extended){return U}this.$extended=true;var H=U.type,S=U.target||U.srcElement,J={},R={};while(S&&S.nodeType==3){S=S.parentNode}if(H.indexOf("key")!=-1){var T=U.which||U.keyCode;var W=Object.keyOf(Event.Keys,T);if(H=="keydown"){var Q=T-111;if(Q>0&&Q<13){W="f"+Q}}if(!W){W=String.fromCharCode(T).toLowerCase()}}else{if(H.test(/click|mouse|menu/i)){Z=(!Z.compatMode||Z.compatMode=="CSS1Compat")?Z.html:Z.body;J={x:(U.pageX!=null)?U.pageX:U.clientX+Z.scrollLeft,y:(U.pageY!=null)?U.pageY:U.clientY+Z.scrollTop};R={x:(U.pageX!=null)?U.pageX-I.pageXOffset:U.clientX,y:(U.pageY!=null)?U.pageY-I.pageYOffset:U.clientY};if(H.test(/DOMMouseScroll|mousewheel/)){var M=(U.wheelDelta)?U.wheelDelta/120:-(U.detail||0)/3}var K=(U.which==3)||(U.button==2),Y=null;if(H.test(/over|out/)){Y=U.relatedTarget||U[(H=="mouseover"?"from":"to")+"Element"];var V=function(){while(Y&&Y.nodeType==3){Y=Y.parentNode}return true};var N=(Browser.firefox2)?V.attempt():V();Y=(N)?Y:null}}else{if(H.test(/gesture|touch/i)){this.rotation=U.rotation;this.scale=U.scale;this.targetTouches=U.targetTouches;this.changedTouches=U.changedTouches;var O=this.touches=U.touches;if(O&&O[0]){var P=O[0];J={x:P.pageX,y:P.pageY};R={x:P.clientX,y:P.clientY}}}}}return Object.append(this,{event:U,type:H,page:J,client:R,rightClick:K,wheel:M,relatedTarget:document.id(Y),target:document.id(S),code:T,key:W,shift:U.shiftKey,control:U.ctrlKey,alt:U.altKey,meta:U.metaKey})});Event.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};Event.Keys=new Hash(Event.Keys);Event.implement({stop:function(){return this.stopPropagation().preventDefault()},stopPropagation:function(){if(this.event.stopPropagation){this.event.stopPropagation()}else{this.event.cancelBubble=true}return this},preventDefault:function(){if(this.event.preventDefault){this.event.preventDefault()}else{this.event.returnValue=false}return this}});(function(){var r=this.Class=new Type("Class",function(a){if(instanceOf(a,Function)){a={initialize:a}}var b=function(){u(this);if(b.$prototyping){return this}this.$caller=null;var f=(this.initialize)?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return f}.extend(this).implement(a);b.$constructor=r;b.prototype.$constructor=b;b.prototype.parent=B;return b});var B=function(){if(!this.$caller){throw new Error('The method "parent" cannot be called.')}var f=this.$caller.$name,b=this.$caller.$owner.parent,a=(b)?b.prototype[f]:null;if(!a){throw new Error('The method "'+f+'" has no parent.')}return a.apply(this,arguments)};var u=function(g){for(var f in g){var a=g[f];switch(typeOf(a)){case"object":var b=function(){};b.prototype=a;g[f]=u(new b);break;case"array":g[f]=a.clone();break}}return g};var o=function(g,f,a){if(a.$origin){a=a.$origin}var b=function(){if(a.$protected&&this.$caller==null){throw new Error('The method "'+f+'" cannot be called.')}var D=this.caller,l=this.$caller;this.caller=l;this.$caller=b;var j=a.apply(this,arguments);this.$caller=l;this.caller=D;return j}.extend({$owner:g,$origin:a,$name:f});return b};var p=function(b,a,f){if(r.Mutators.hasOwnProperty(b)){a=r.Mutators[b].call(this,a);if(a==null){return this}}if(typeOf(a)=="function"){if(a.$hidden){return this}this.prototype[b]=(f)?a:o(this,b,a)}else{Object.merge(this.prototype,b,a)}return this};var z=function(b){b.$prototyping=true;var a=new b;delete b.$prototyping;return a};r.implement("implement",p.overloadSetter());r.Mutators={Extends:function(a){this.parent=a;this.prototype=z(a)},Implements:function(a){Array.from(a).each(function(b){var g=new b;for(var f in g){p.call(this,f,g[f],true)}},this)}}})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false},clearChain:function(){this.$chain.empty();return this}});var b=function(a){return a.replace(/^on([A-Z])/,function(l,j){return j.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(j,l,a){j=b(j);if(l==$empty){return this}this.$events[j]=(this.$events[j]||[]).include(l);if(a){l.internal=true}return this},addEvents:function(a){for(var g in a){this.addEvent(g,a[g])}return this},fireEvent:function(l,p,a){l=b(l);var o=this.$events[l];if(!o){return this}p=Array.from(p);o.each(function(f){if(a){f.delay(a,this,p)}else{f.apply(this,p)}},this);return this},removeEvent:function(l,o){l=b(l);var p=this.$events[l];if(p&&!o.internal){var a=p.indexOf(o);if(a!=-1){delete p[a]}}return this},removeEvents:function(o){var l;if(typeOf(o)=="object"){for(l in o){this.removeEvent(l,o[l])}return this}if(o){o=b(o)}for(l in this.$events){if(o&&o!=l){continue}var p=this.$events[l];for(var a=p.length;a--;){this.removeEvent(l,p[a])}}return this}});this.Options=new Class({setOptions:function(){var a=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(!this.addEvent){return this}for(var g in a){if(typeOf(a[g])!="function"||!(/^on[A-Z]/).test(g)){continue}this.addEvent(g,a[g]);delete a[g]}return this}})})();(function(){var P,F,I,J,R={},O={},G=/\\/g;var M=function(a,b){if(a==null){return null}if(a.Slick===true){return a}a=(""+a).replace(/^\s+|\s+$/g,"");J=!!b;var f=(J)?O:R;if(f[a]){return f[a]}P={Slick:true,expressions:[],raw:a,reverse:function(){return M(this.raw,true)}};F=-1;while(a!=(a=a.replace(S,Q))){}P.length=P.expressions.length;return f[a]=(J)?H(P):P};var E=function(a){if(a==="!"){return" "}else{if(a===" "){return"!"}else{if((/^!/).test(a)){return a.replace(/^!/,"")}else{return"!"+a}}}};var H=function(a){var g=a.expressions;for(var l=0;l<g.length;l++){var b=g[l];var j={parts:[],tag:"*",combinator:E(b[0].combinator)};for(var o=0;o<b.length;o++){var f=b[o];if(!f.reverseCombinator){f.reverseCombinator=" "}f.combinator=f.reverseCombinator;delete f.reverseCombinator}b.reverse().push(j)}return a};var K=function(a){return a.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,"\\$&")};var S=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|:+(<unicode>+)(?:\\((?:(?:([\"'])([^\\12]*)\\12)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+K(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));function Q(u,Z,g,p,aa,j,ab,l,o,r,C,b,B,ac,z){if(Z||F===-1){P.expressions[++F]=[];I=-1;if(Z){return""}}if(g||p||I===-1){g=g||" ";var D=P.expressions[F];if(J&&D[I]){D[I].reverseCombinator=E(g)}D[++I]={combinator:g,tag:"*"}}var ad=P.expressions[F][I];if(aa){ad.tag=aa.replace(G,"")}else{if(j){ad.id=j.replace(G,"")}else{if(ab){ab=ab.replace(G,"");if(!ad.classList){ad.classList=[]}if(!ad.classes){ad.classes=[]}ad.classList.push(ab);ad.classes.push({value:ab,regexp:new RegExp("(^|\\s)"+K(ab)+"(\\s|$)")})}else{if(b){z=z||ac;z=z?z.replace(G,""):null;if(!ad.pseudos){ad.pseudos=[]}ad.pseudos.push({key:b.replace(G,""),value:z})}else{if(l){l=l.replace(G,"");C=(C||"").replace(G,"");var f,a;switch(o){case"^=":a=new RegExp("^"+K(C));break;case"$=":a=new RegExp(K(C)+"$");break;case"~=":a=new RegExp("(^|\\s)"+K(C)+"(\\s|$)");break;case"|=":a=new RegExp("^"+K(C)+"(-|$)");break;case"=":f=function(T){return C==T};break;case"*=":f=function(T){return T&&T.indexOf(C)>-1};break;case"!=":f=function(T){return C!=T};break;default:f=function(T){return !!T}}if(C==""&&(/^[*$^]=$/).test(o)){f=function(){return false}}if(!f){f=function(T){return T&&a.test(T)}}if(!ad.attributes){ad.attributes=[]}ad.attributes.push({key:l,operator:o,value:C,test:f})}}}}}return""}var N=(this.Slick||{});N.parse=function(a){return M(a)};N.escapeRegExp=K;if(!this.Slick){this.Slick=N}}).apply((typeof exports!="undefined")?exports:this);(function(){var p={};p.isNativeCode=function(a){return(/\{\s*\[native code\]\s*\}/).test(""+a)};p.isXML=function(a){return(!!a.xmlVersion)||(!!a.xml)||(Object.prototype.toString.call(a)==="[object XMLDocument]")||(a.nodeType===9&&a.documentElement.nodeName!=="HTML")};p.setDocument=function(a){if(a.nodeType===9){}else{if(a.ownerDocument){a=a.ownerDocument}else{if(a.navigator){a=a.document}else{return}}}if(this.document===a){return}this.document=a;var J=this.root=a.documentElement;this.isXMLDocument=this.isXML(a);this.brokenStarGEBTN=this.starSelectsClosedQSA=this.idGetsName=this.brokenMixedCaseQSA=this.brokenGEBCN=this.brokenCheckedQSA=this.brokenEmptyAttributeQSA=this.isHTMLDocument=false;var b,H,I,l;var g,j;var o=a.createElement("div");J.appendChild(o);try{j="slick_getbyid_test";o.innerHTML='<a id="'+j+'"></a>';this.isHTMLDocument=!!a.getElementById(j)}catch(f){}if(this.isHTMLDocument){o.style.display="none";o.appendChild(a.createComment(""));H=(o.getElementsByTagName("*").length>0);try{o.innerHTML="foo</foo>";g=o.getElementsByTagName("*");b=(g&&g.length&&g[0].nodeName.charAt(0)=="/")}catch(f){}this.brokenStarGEBTN=H||b;if(o.querySelectorAll){try{o.innerHTML="foo</foo>";g=o.querySelectorAll("*");this.starSelectsClosedQSA=(g&&g.length&&g[0].nodeName.charAt(0)=="/")}catch(f){}}try{j="slick_id_gets_name";o.innerHTML='<a name="'+j+'"></a><b id="'+j+'"></b>';this.idGetsName=a.getElementById(j)===o.firstChild}catch(f){}try{o.innerHTML='<a class="MiXedCaSe"></a>';this.brokenMixedCaseQSA=!o.querySelectorAll(".MiXedCaSe").length}catch(f){}try{o.innerHTML='<a class="f"></a><a class="b"></a>';o.getElementsByClassName("b").length;o.firstChild.className="b";l=(o.getElementsByClassName("b").length!=2)}catch(f){}try{o.innerHTML='<a class="a"></a><a class="f b a"></a>';I=(o.getElementsByClassName("a").length!=2)}catch(f){}this.brokenGEBCN=l||I;try{o.innerHTML='<select><option selected="selected">a</option></select>';this.brokenCheckedQSA=(o.querySelectorAll(":checked").length==0)}catch(f){}try{o.innerHTML='<a class=""></a>';this.brokenEmptyAttributeQSA=(o.querySelectorAll('[class*=""]').length!=0)}catch(f){}}J.removeChild(o);o=null;this.hasAttribute=(J&&this.isNativeCode(J.hasAttribute))?function(E,F){return E.hasAttribute(F)}:function(E,F){E=E.getAttributeNode(F);return !!(E&&(E.specified||E.nodeValue))};this.contains=(J&&this.isNativeCode(J.contains))?function(F,E){return F.contains(E)}:(J&&J.compareDocumentPosition)?function(F,E){return F===E||!!(F.compareDocumentPosition(E)&16)}:function(F,E){if(E){do{if(E===F){return true}}while((E=E.parentNode))}return false};this.documentSorter=(J.compareDocumentPosition)?function(E,F){if(!E.compareDocumentPosition||!F.compareDocumentPosition){return 0}return E.compareDocumentPosition(F)&4?-1:E===F?0:1}:("sourceIndex" in J)?function(E,F){if(!E.sourceIndex||!F.sourceIndex){return 0}return E.sourceIndex-F.sourceIndex}:(a.createRange)?function(E,G){if(!E.ownerDocument||!G.ownerDocument){return 0}var F=E.ownerDocument.createRange(),M=G.ownerDocument.createRange();F.setStart(E,0);F.setEnd(E,0);M.setStart(G,0);M.setEnd(G,0);return F.compareBoundaryPoints(Range.START_TO_END,M)}:null;this.getUID=(this.isHTMLDocument)?this.getUIDHTML:this.getUIDXML};p.search=function(ap,ag,l,ao){var ah=this.found=(ao)?null:(l||[]);if(!ap){return ah}if(ap.navigator){ap=ap.document}else{if(!ap.nodeType){return ah}}var al,o;var af=this.uniques={};if(this.document!==(ap.ownerDocument||ap)){this.setDocument(ap)}var ae=!!(l&&l.length);if(ae){for(o=ah.length;o--;){this.uniques[this.getUID(ah[o])]=true}}if(typeof ag=="string"){for(o=this.overrides.length;o--;){var aj=this.overrides[o];if(aj.regexp.test(ag)){var ai=aj.method.call(ap,ag,ah,ao);if(ai===false){continue}if(ai===true){return ah}return ai}}al=this.Slick.parse(ag);if(!al.length){return ah}}else{if(ag==null){return ah}else{if(ag.Slick){al=ag}else{if(this.contains(ap.documentElement||ap,ag)){(ah)?ah.push(ag):ah=ag;return ah}else{return ah}}}}this.posNTH={};this.posNTHLast={};this.posNTHType={};this.posNTHTypeLast={};this.push=(!ae&&(ao||(al.length==1&&al.expressions[0].length==1)))?this.pushArray:this.pushUID;if(ah==null){ah=[]}var Z,ab,ac;var aa,a,ad,b,j,am,aq;var an,ak,ar,g,f=al.expressions;search:for(o=0;(ak=f[o]);o++){for(Z=0;(ar=ak[Z]);Z++){aa="combinator:"+ar.combinator;if(!this[aa]){continue search}a=(this.isXMLDocument)?ar.tag:ar.tag.toUpperCase();ad=ar.id;b=ar.classList;j=ar.classes;am=ar.attributes;aq=ar.pseudos;g=(Z===(ak.length-1));this.bitUniques={};if(g){this.uniques=af;this.found=ah}else{this.uniques={};this.found=[]}if(Z===0){this[aa](ap,a,ad,j,am,aq,b);if(ao&&g&&ah.length){break search}}else{if(ao&&g){for(ab=0,ac=an.length;ab<ac;ab++){this[aa](an[ab],a,ad,j,am,aq,b);if(ah.length){break search}}}else{for(ab=0,ac=an.length;ab<ac;ab++){this[aa](an[ab],a,ad,j,am,aq,b)}}}an=this.found}}if(ae||(al.expressions.length>1)){this.sort(ah)}return(ao)?(ah[0]||null):ah};p.uidx=1;p.uidk="slick:uniqueid";p.getUIDXML=function(a){var b=a.getAttribute(this.uidk);if(!b){b=this.uidx++;a.setAttribute(this.uidk,b)}return b};p.getUIDHTML=function(a){return a.uniqueNumber||(a.uniqueNumber=this.uidx++)};p.sort=function(a){if(!this.documentSorter){return a}a.sort(this.documentSorter);return a};p.cacheNTH={};p.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/;p.parseNTHArgument=function(j){var a=j.match(this.matchNTH);if(!a){return false}var g=a[2]||false;var b=a[1]||1;if(b=="-"){b=-1}var f=+a[3]||0;a=(g=="n")?{a:b,b:f}:(g=="odd")?{a:2,b:1}:(g=="even")?{a:2,b:0}:{a:0,b:b};return(this.cacheNTH[j]=a)};p.createNTHPseudo=function(g,b,f,a){return function(j,o){var T=this.getUID(j);if(!this[f][T]){var N=j.parentNode;if(!N){return false}var l=N[g],U=1;if(a){var O=j.nodeName;do{if(l.nodeName!==O){continue}this[f][this.getUID(l)]=U++}while((l=l[b]))}else{do{if(l.nodeType!==1){continue}this[f][this.getUID(l)]=U++}while((l=l[b]))}}o=o||"n";var S=this.cacheNTH[o]||this.parseNTHArgument(o);if(!S){return false}var P=S.a,Q=S.b,R=this[f][T];if(P==0){return Q==R}if(P>0){if(R<Q){return false}}else{if(Q<R){return false}}return((R-Q)%P)==0}};p.pushArray=function(j,f,g,a,b,l){if(this.matchSelector(j,f,g,a,b,l)){this.found.push(j)}};p.pushUID=function(o,g,f,l,b,j){var a=this.getUID(o);if(!this.uniques[a]&&this.matchSelector(o,g,f,l,b,j)){this.uniques[a]=true;this.found.push(o)}};p.matchNode=function(l,g){var a=this.Slick.parse(g);if(!a){return true}if(a.length==1&&a.expressions[0].length==1){var f=a.expressions[0][0];return this.matchSelector(l,(this.isXMLDocument)?f.tag:f.tag.toUpperCase(),f.id,f.classes,f.attributes,f.pseudos)}var b=this.search(this.document,a);for(var j=0,o;o=b[j++];){if(o===l){return true}}return false};p.matchPseudo=function(j,f,g){var b="pseudo:"+f;if(this[b]){return this[b](j,g)}var a=this.getAttribute(j,f);return(g)?g==a:!!a};p.matchSelector=function(o,G,j,l,g,a){if(G){if(G=="*"){if(o.nodeName<"@"){return false}}else{if(o.nodeName!=G){return false}}}if(j&&o.getAttribute("id")!=j){return false}var f,b,H;if(l){for(f=l.length;f--;){H=("className" in o)?o.className:o.getAttribute("class");if(!(H&&l[f].regexp.test(H))){return false}}}if(g){for(f=g.length;f--;){b=g[f];if(b.operator?!b.test(this.getAttribute(o,b.key)):!this.hasAttribute(o,b.key)){return false}}}if(a){for(f=a.length;f--;){b=a[f];if(!this.matchPseudo(o,b.key,b.value)){return false}}}return true};var u={" ":function(l,o,j,g,f,J,H){var b,I,a;if(this.isHTMLDocument){getById:if(j){I=this.document.getElementById(j);if((!I&&l.all)||(this.idGetsName&&I&&I.getAttributeNode("id").nodeValue!=j)){a=l.all[j];if(!a){return}if(!a[0]){a=[a]}for(b=0;I=a[b++];){if(I.getAttributeNode("id").nodeValue==j){this.push(I,o,null,g,f,J);break}}return}if(!I){if(this.contains(this.document.documentElement,l)){return}else{break getById}}else{if(this.document!==l&&!this.contains(l,I)){return}}this.push(I,o,null,g,f,J);return}getByClass:if(g&&l.getElementsByClassName&&!this.brokenGEBCN){a=l.getElementsByClassName(H.join(" "));if(!(a&&a.length)){break getByClass}for(b=0;I=a[b++];){this.push(I,o,j,null,f,J)}return}}getByTag:{a=l.getElementsByTagName(o);if(!(a&&a.length)){break getByTag}if(!this.brokenStarGEBTN){o=null}for(b=0;I=a[b++];){this.push(I,o,j,g,f,J)}}},">":function(j,f,g,a,b,l){if((j=j.firstChild)){do{if(j.nodeType===1){this.push(j,f,g,a,b,l)}}while((j=j.nextSibling))}},"+":function(j,f,g,a,b,l){while((j=j.nextSibling)){if(j.nodeType===1){this.push(j,f,g,a,b,l);break}}},"^":function(j,f,g,a,b,l){j=j.firstChild;if(j){if(j.nodeType===1){this.push(j,f,g,a,b,l)}else{this["combinator:+"](j,f,g,a,b,l)}}},"~":function(o,g,f,l,b,j){while((o=o.nextSibling)){if(o.nodeType!==1){continue}var a=this.getUID(o);if(this.bitUniques[a]){break}this.bitUniques[a]=true;this.push(o,g,f,l,b,j)}},"++":function(j,f,g,a,b,l){this["combinator:+"](j,f,g,a,b,l);this["combinator:!+"](j,f,g,a,b,l)},"~~":function(j,f,g,a,b,l){this["combinator:~"](j,f,g,a,b,l);this["combinator:!~"](j,f,g,a,b,l)},"!":function(j,f,g,a,b,l){while((j=j.parentNode)){if(j!==this.document){this.push(j,f,g,a,b,l)}}},"!>":function(j,f,g,a,b,l){j=j.parentNode;if(j!==this.document){this.push(j,f,g,a,b,l)}},"!+":function(j,f,g,a,b,l){while((j=j.previousSibling)){if(j.nodeType===1){this.push(j,f,g,a,b,l);break}}},"!^":function(j,f,g,a,b,l){j=j.lastChild;if(j){if(j.nodeType===1){this.push(j,f,g,a,b,l)}else{this["combinator:!+"](j,f,g,a,b,l)}}},"!~":function(o,g,f,l,b,j){while((o=o.previousSibling)){if(o.nodeType!==1){continue}var a=this.getUID(o);if(this.bitUniques[a]){break}this.bitUniques[a]=true;this.push(o,g,f,l,b,j)}}};for(var D in u){p["combinator:"+D]=u[D]}var r={empty:function(b){var a=b.firstChild;return !(a&&a.nodeType==1)&&!(b.innerText||b.textContent||"").length},not:function(b,a){return !this.matchNode(b,a)},contains:function(b,a){return(b.innerText||b.textContent||"").indexOf(a)>-1},"first-child":function(a){while((a=a.previousSibling)){if(a.nodeType===1){return false}}return true},"last-child":function(a){while((a=a.nextSibling)){if(a.nodeType===1){return false}}return true},"only-child":function(a){var b=a;while((b=b.previousSibling)){if(b.nodeType===1){return false}}var f=a;while((f=f.nextSibling)){if(f.nodeType===1){return false}}return true},"nth-child":p.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":p.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":p.createNTHPseudo("firstChild","nextSibling","posNTHType",true),"nth-last-of-type":p.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",true),index:function(a,b){return this["pseudo:nth-child"](a,""+b+1)},even:function(a,b){return this["pseudo:nth-child"](a,"2n")},odd:function(a,b){return this["pseudo:nth-child"](a,"2n+1")},"first-of-type":function(b){var a=b.nodeName;while((b=b.previousSibling)){if(b.nodeName===a){return false}}return true},"last-of-type":function(b){var a=b.nodeName;while((b=b.nextSibling)){if(b.nodeName===a){return false}}return true},"only-of-type":function(a){var b=a,g=a.nodeName;while((b=b.previousSibling)){if(b.nodeName===g){return false}}var f=a;while((f=f.nextSibling)){if(f.nodeName===g){return false}}return true},enabled:function(a){return(a.disabled===false)},disabled:function(a){return(a.disabled===true)},checked:function(a){return a.checked||a.selected},focus:function(a){return this.isHTMLDocument&&this.document.activeElement===a&&(a.href||a.type||this.hasAttribute(a,"tabindex"))},root:function(a){return(a===this.root)},selected:function(a){return a.selected}};for(var C in r){p["pseudo:"+C]=r[C]}p.attributeGetters={"class":function(){return("className" in this)?this.className:this.getAttribute("class")},"for":function(){return("htmlFor" in this)?this.htmlFor:this.getAttribute("for")},href:function(){return("href" in this)?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return(this.style)?this.style.cssText:this.getAttribute("style")}};p.getAttribute=function(a,f){var g=this.attributeGetters[f];if(g){return g.call(a)}var b=a.getAttributeNode(f);return b?b.nodeValue:null};p.overrides=[];p.override=function(b,a){this.overrides.push({regexp:b,method:a})};var z=/\[.*[*$^]=(?:["']{2})?\]/;p.override(/./,function(f,o,j){if(!this.querySelectorAll||this.nodeType!=9||!p.isHTMLDocument||p.brokenMixedCaseQSA||(p.brokenCheckedQSA&&f.indexOf(":checked")>-1)||(p.brokenEmptyAttributeQSA&&z.test(f))||B.disableQSA){return false}var b,F;try{if(j){return this.querySelector(f)||null}else{b=this.querySelectorAll(f)}}catch(a){return false}var l,g=!!(o.length);if(p.starSelectsClosedQSA){for(l=0;F=b[l++];){if(F.nodeName>"@"&&(!g||!p.uniques[p.getUIDHTML(F)])){o.push(F)}}}else{for(l=0;F=b[l++];){if(!g||!p.uniques[p.getUIDHTML(F)]){o.push(F)}}}if(g){p.sort(o)}return true});p.override(/^[\w-]+$|^\*$/,function(f,o,j){var b=f;if(b=="*"&&p.brokenStarGEBTN){return false}var a=this.getElementsByTagName(b);if(j){return a[0]||null}var l,F,g=!!(o.length);for(l=0;F=a[l++];){if(!g||!p.uniques[p.getUID(F)]){o.push(F)}}if(g){p.sort(o)}return true});p.override(/^\.[\w-]+$/,function(a,G,g){if(!p.isHTMLDocument||(!this.getElementsByClassName&&this.querySelectorAll)){return false}var j,o,l,b=!!(G&&G.length),H=a.substring(1);if(this.getElementsByClassName&&!p.brokenGEBCN){j=this.getElementsByClassName(H);if(g){return j[0]||null}for(l=0;o=j[l++];){if(!b||!p.uniques[p.getUIDHTML(o)]){G.push(o)}}}else{var f=new RegExp("(^|\\s)"+B.escapeRegExp(H)+"(\\s|$)");j=this.getElementsByTagName("*");for(l=0;o=j[l++];){H=o.className;if(!H||!f.test(H)){continue}if(g){return o}if(!b||!p.uniques[p.getUIDHTML(o)]){G.push(o)}}}if(b){p.sort(G)}return(g)?null:true});p.override(/^#[\w-]+$/,function(l,a,j){if(!p.isHTMLDocument||this.nodeType!=9){return false}var g=l.substring(1),b=this.getElementById(g);if(!b){return a}if(p.idGetsName&&b.getAttributeNode("id").nodeValue!=g){return false}if(j){return b||null}var f=!!(a.length);if(!f||!p.uniques[p.getUIDHTML(b)]){a.push(b)}if(f){p.sort(a)}return true});if(typeof document!="undefined"){p.setDocument(document)}var B=p.Slick=(this.Slick||{});B.version="0.9dev";B.search=function(b,a,f){return p.search(b,a,f)};B.find=function(b,a){return p.search(b,a,null,true)};B.contains=function(b,a){p.setDocument(b);return p.contains(b,a)};B.getAttribute=function(a,b){return p.getAttribute(a,b)};B.match=function(a,b){if(!(a&&b)){return false}if(!b||b===a){return true}if(typeof b!="string"){return false}p.setDocument(a);return p.matchNode(a,b)};B.defineAttributeGetter=function(b,a){p.attributeGetters[b]=a;return this};B.lookupAttributeGetter=function(a){return p.attributeGetters[a]};B.definePseudo=function(b,a){p["pseudo:"+b]=function(g,f){return a.call(g,f)};return this};B.lookupPseudo=function(b){var a=p["pseudo:"+b];if(a){return function(f){return a.call(this,f)}}return null};B.override=function(a,b){p.override(a,b);return this};B.isXML=p.isXML;B.uidOf=function(a){return p.getUIDHTML(a)};if(!this.Slick){this.Slick=B}}).apply((typeof exports!="undefined")?exports:this);var Element=function(l,E){var C=Element.Constructors[l];if(C){return C(E)}if(typeof l!="string"){return document.id(l).set(E)}if(!E){E={}}if(!l.test(/^[\w-]+$/)){var z=Slick.parse(l).expressions[0][0];l=(z.tag=="*")?"div":z.tag;if(z.id&&E.id==null){E.id=z.id}var B=z.attributes;if(B){for(var F=0,D=B.length;F<D;F++){var u=B[F];if(u.value!=null&&u.operator=="="&&E[u.key]==null){E[u.key]=u.value}}}if(z.classList&&E["class"]==null){E["class"]=z.classList.join(" ")}}return document.newElement(l,E)};if(Browser.Element){Element.prototype=Browser.Element.prototype}new Type("Element",Element).mirror(function(g){if(Array.prototype[g]){return}var f={};f[g]=function(){var z=[],b=arguments,a=true;for(var C=0,l=this.length;C<l;C++){var D=this[C],B=z[C]=D[g].apply(D,b);a=(a&&typeOf(B)=="element")}return(a)?new Elements(z):z};Elements.implement(f)});if(!Browser.Element){Element.parent=Object;Element.Prototype={"$family":Function.from("element").hide()};Element.mirror(function(g,f){Element.Prototype[g]=f})}Element.Constructors={};Element.Constructors=new Hash;var IFrame=new Type("IFrame",function(){var p=Array.link(arguments,{properties:Type.isObject,iframe:function(a){return(a!=null)}});var u=p.properties||{},l;if(p.iframe){l=document.id(p.iframe)}var r=u.onload||function(){};delete u.onload;u.id=u.name=[u.id,u.name,l?(l.id||l.name):"IFrame_"+String.uniqueID()].pick();l=new Element(l||"iframe",u);var o=function(){r.call(l.contentWindow)};if(window.frames[u.id]){o()}else{l.addListener("load",o)}return l});var Elements=this.Elements=function(o){if(o&&o.length){var p={},r;for(var u=0;r=o[u++];){var l=Slick.uidOf(r);if(!p[l]){p[l]=true;this.push(r)}}}};Elements.prototype={length:0};Elements.parent=Array;new Type("Elements",Elements).implement({filter:function(g,f){if(!g){return this}return new Elements(Array.filter(this,(typeOf(g)=="string")?function(a){return a.match(g)}:g,f))}.protect(),push:function(){var o=this.length;for(var j=0,l=arguments.length;j<l;j++){var p=document.id(arguments[j]);if(p){this[o++]=p}}return(this.length=o)}.protect(),concat:function(){var j=new Elements(this);for(var p=0,l=arguments.length;p<l;p++){var o=arguments[p];if(Type.isEnumerable(o)){j.append(o)}else{j.push(o)}}return j}.protect(),append:function(l){for(var g=0,j=l.length;g<j;g++){this.push(l[g])}return this}.protect(),empty:function(){while(this.length){delete this[--this.length]}return this}.protect()});(function(){var r=Array.prototype.splice,o={"0":0,"1":1,length:2};r.call(o,1,1);if(o[1]==1){Elements.implement("splice",function(){var a=this.length;r.apply(this,arguments);while(a>=this.length){delete this[a--]}return this}.protect())}Elements.implement(Array.prototype);Array.mirror(Elements);var u;try{var p=document.createElement("<input name=x>");u=(p.name=="x")}catch(B){}var z=function(a){return(""+a).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};Document.implement({newElement:function(b,a){if(a&&a.checked!=null){a.defaultChecked=a.checked}if(u&&a){b="<"+b;if(a.name){b+=' name="'+z(a.name)+'"'}if(a.type){b+=' type="'+z(a.type)+'"'}b+=">";delete a.name;delete a.type}return this.id(this.createElement(b)).set(a)}})})();Document.implement({newTextNode:function(b){return this.createTextNode(b)},getDocument:function(){return this},getWindow:function(){return this.window},id:(function(){var b={string:function(j,l,a){j=Slick.find(a,"#"+j.replace(/(\W)/g,"\\$1"));return(j)?b.element(j,l):null},element:function(a,g){$uid(a);if(!g&&!a.$family&&!(/^object|embed$/i).test(a.tagName)){Object.append(a,Element.Prototype)}return a},object:function(l,j,a){if(l.toElement){return b.element(l.toElement(a),j)}return null}};b.textnode=b.whitespace=b.window=b.document=function(a){return a};return function(p,l,o){if(p&&p.$family&&p.uid){return p}var a=typeOf(p);return(b[a])?b[a](p,l,o||document):null}})()});if(window.$==null){Window.implement("$",function(g,f){return document.id(g,f,this.document)})}Window.implement({getDocument:function(){return this.document},getWindow:function(){return this}});[Document,Element].invoke("implement",{getElements:function(b){return Slick.search(this,b,new Elements)},getElement:function(b){return document.id(Slick.find(this,b))}});(function(l,r,o){this.Selectors={};var p=this.Selectors.Pseudo=new Hash();var u=function(){for(var a in p){if(p.hasOwnProperty(a)){Slick.definePseudo(a,p[a]);delete p[a]}}};Slick.search=function(f,b,a){u();return l.call(this,f,b,a)};Slick.find=function(a,b){u();return r.call(this,a,b)};Slick.match=function(b,a){u();return o.call(this,b,a)}})(Slick.search,Slick.find,Slick.match);if(window.$$==null){Window.implement("$$",function(p){var B=new Elements;if(arguments.length==1&&typeof p=="string"){return Slick.search(this.document,p,B)}var z=Array.flatten(arguments);for(var u=0,l=z.length;u<l;u++){var r=z[u];switch(typeOf(r)){case"element":B.push(r);break;case"string":Slick.search(this.document,r,B)}}return B})}if(window.$$==null){Window.implement("$$",function(b){if(arguments.length==1){if(typeof b=="string"){return Slick.search(this.document,b,new Elements)}else{if(Type.isEnumerable(b)){return new Elements(b)}}}return new Elements(arguments)})}(function(){var S={},I={};var H={input:"checked",option:"selected",textarea:"value"};var N=function(a){return(I[a]||(I[a]={}))};var F=function(a){if(a.removeEvents){a.removeEvents()}if(a.clearAttributes){a.clearAttributes()}var b=a.uid;if(b!=null){delete S[b];delete I[b]}return a};var E=["defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","maxLength","readOnly","rowSpan","tabIndex","useMap"];var O=["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer"];var K={html:"innerHTML","class":"className","for":"htmlFor",text:(function(){var a=document.createElement("div");return(a.innerText==null)?"textContent":"innerText"})()};var G=["type"];var J=["value","defaultValue"];var P=/^(?:href|src|usemap)$/i;O=O.associate(O);E=E.associate(E.map(String.toLowerCase));G=G.associate(G);Object.append(K,J.associate(J));var Q={before:function(b,f){var a=f.parentNode;if(a){a.insertBefore(b,f)}},after:function(b,f){var a=f.parentNode;if(a){a.insertBefore(b,f.nextSibling)}},bottom:function(a,b){b.appendChild(a)},top:function(a,b){b.insertBefore(a,b.firstChild)}};Q.inside=Q.bottom;Object.each(Q,function(b,a){a=a.capitalize();var f={};f["inject"+a]=function(g){b(this,document.id(g,true));return this};f["grab"+a]=function(g){b(document.id(g,true),this);return this};Element.implement(f)});var R=function(a,b){if(!a){return b}a=Slick.parse(a);var f=a.expressions;for(var g=f.length;g--;){f[g][0].combinator=b}return a};Element.implement({set:function(a,b){var f=Element.Properties[a];(f&&f.set)?f.set.call(this,b):this.setProperty(a,b)}.overloadSetter(),get:function(a){var b=Element.Properties[a];return(b&&b.get)?b.get.apply(this):this.getProperty(a)}.overloadGetter(),erase:function(a){var b=Element.Properties[a];(b&&b.erase)?b.erase.apply(this):this.removeProperty(a);return this},setProperty:function(b,a){b=E[b]||b;if(a==null){return this.removeProperty(b)}var f=K[b];(f)?this[f]=a:(O[b])?this[b]=!!a:this.setAttribute(b,""+a);return this},setProperties:function(b){for(var a in b){this.setProperty(a,b[a])}return this},getProperty:function(a){a=E[a]||a;var b=K[a]||G[a];return(b)?this[b]:(O[a])?!!this[a]:(P.test(a)?this.getAttribute(a,2):(b=this.getAttributeNode(a))?b.nodeValue:null)||null},getProperties:function(){var a=Array.from(arguments);return a.map(this.getProperty,this).associate(a)},removeProperty:function(a){a=E[a]||a;var b=K[a];(b)?this[b]="":(O[a])?this[a]=false:this.removeAttribute(a);return this},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this},hasClass:function(a){return this.className.clean().contains(a," ")},addClass:function(a){if(!this.hasClass(a)){this.className=(this.className+" "+a).clean()}return this},removeClass:function(a){this.className=this.className.replace(new RegExp("(^|\\s)"+a+"(?:\\s|$)"),"$1");return this},toggleClass:function(b,a){if(a==null){a=!this.hasClass(b)}return(a)?this.addClass(b):this.removeClass(b)},adopt:function(){var f=this,l,a=Array.flatten(arguments),b=a.length;if(b>1){f=l=document.createDocumentFragment()}for(var g=0;g<b;g++){var j=document.id(a[g],true);if(j){f.appendChild(j)}}if(l){this.appendChild(l)}return this},appendText:function(a,b){return this.grab(this.getDocument().newTextNode(a),b)},grab:function(a,b){Q[b||"bottom"](document.id(a,true),this);return this},inject:function(a,b){Q[b||"bottom"](this,document.id(a,true));return this},replaces:function(a){a=document.id(a,true);a.parentNode.replaceChild(this,a);return this},wraps:function(a,b){a=document.id(a,true);return this.replaces(a).grab(a,b)},getPrevious:function(a){return document.id(Slick.find(this,R(a,"!~")))},getAllPrevious:function(a){return Slick.search(this,R(a,"!~"),new Elements)},getNext:function(a){return document.id(Slick.find(this,R(a,"~")))},getAllNext:function(a){return Slick.search(this,R(a,"~"),new Elements)},getFirst:function(a){return document.id(Slick.search(this,R(a,">"))[0])},getLast:function(a){return document.id(Slick.search(this,R(a,">")).getLast())},getParent:function(a){return document.id(Slick.find(this,R(a,"!")))},getParents:function(a){return Slick.search(this,R(a,"!"),new Elements)},getSiblings:function(a){return Slick.search(this,R(a,"~~"),new Elements)},getChildren:function(a){return Slick.search(this,R(a,">"),new Elements)},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(a){return document.id(Slick.find(this,"#"+(""+a).replace(/(\W)/g,"\\$1")))},getSelected:function(){this.selectedIndex;return new Elements(Array.from(this.options).filter(function(a){return a.selected}))},toQueryString:function(){var a=[];this.getElements("input, select, textarea").each(function(f){var g=f.type;if(!f.name||f.disabled||g=="submit"||g=="reset"||g=="file"||g=="image"){return}var b=(f.get("tag")=="select")?f.getSelected().map(function(j){return document.id(j).get("value")}):((g=="radio"||g=="checkbox")&&!f.checked)?null:f.get("value");Array.from(b).each(function(j){if(typeof j!="undefined"){a.push(encodeURIComponent(f.name)+"="+encodeURIComponent(j))}})});return a.join("&")},clone:function(p,u){p=p!==false;var f=this.cloneNode(p);var g=function(D,W){if(!u){D.removeAttribute("id")}if(Browser.ie){D.clearAttributes();D.mergeAttributes(W);D.removeAttribute("uid");if(D.options){var C=D.options,Z=W.options;for(var Y=C.length;Y--;){C[Y].selected=Z[Y].selected}}}var B=H[W.tagName.toLowerCase()];if(B&&W[B]){D[B]=W[B]}};var o;if(p){var z=f.getElementsByTagName("*"),r=this.getElementsByTagName("*");for(o=z.length;o--;){g(z[o],r[o])}}g(f,this);if(Browser.ie){var j=this.getElementsByTagName("object"),l=f.getElementsByTagName("object"),a=j.length,b=l.length;for(o=0;o<a&&o<b;o++){l[o].outerHTML=j[o].outerHTML}}return document.id(f)},destroy:function(){var a=F(this).getElementsByTagName("*");Array.each(a,F);Element.dispose(this);return null},empty:function(){Array.from(this.childNodes).each(Element.dispose);return this},dispose:function(){return(this.parentNode)?this.parentNode.removeChild(this):this},match:function(a){return !a||Slick.match(this,a)}});var M={contains:function(a){return Slick.contains(this,a)}};if(!document.contains){Document.implement(M)}if(!document.createElement("div").contains){Element.implement(M)}Element.implement("hasChild",function(a){return this!==a&&this.contains(a)});[Element,Window,Document].invoke("implement",{addListener:function(a,b){if(a=="unload"){var g=b,f=this;b=function(){f.removeListener("unload",b);g()}}else{S[this.uid]=this}if(this.addEventListener){this.addEventListener(a,b,false)}else{this.attachEvent("on"+a,b)}return this},removeListener:function(a,b){if(this.removeEventListener){this.removeEventListener(a,b,false)}else{this.detachEvent("on"+a,b)}return this},retrieve:function(f,g){var a=N(this.uid),b=a[f];if(g!=null&&b==null){b=a[f]=g}return b!=null?b:null},store:function(b,f){var a=N(this.uid);a[b]=f;return this},eliminate:function(b){var a=N(this.uid);delete a[b];return this}});if(window.attachEvent&&!window.addEventListener){window.addListener("unload",function(){Object.each(S,F);if(window.CollectGarbage){CollectGarbage()}})}})();Element.Properties={};Element.Properties=new Hash;Element.Properties.style={set:function(b){this.style.cssText=b},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};(function(b){if(b!=null){Element.Properties.maxlength=Element.Properties.maxLength={get:function(){var a=this.getAttribute("maxLength");return a==b?null:a}}}})(document.createElement("input").getAttribute("maxLength"));Element.Properties.html=(function(){var p=Function.attempt(function(){var a=document.createElement("table");a.innerHTML="<tr><td></td></tr>"});var o=document.createElement("div");var l={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};l.thead=l.tfoot=l.tbody;var j={set:function(){var a=Array.flatten(arguments).join("");var g=(!p&&l[this.get("tag")]);if(g){var f=o;f.innerHTML=g[1]+a+g[2];for(var b=g[0];b--;){f=f.firstChild}this.empty().adopt(f.childNodes)}else{this.innerHTML=a}}};j.erase=j.set;return j})();(function(){var u=document.html;Element.Properties.styles={set:function(a){this.setStyles(a)}};var p=(u.style.opacity!=null);var r=/alpha\(opacity=([\d.]+)\)/i;var l=function(f,a){if(!f.currentStyle||!f.currentStyle.hasLayout){f.style.zoom=1}if(p){f.style.opacity=a}else{a=(a==1)?"":"alpha(opacity="+a*100+")";var b=f.style.filter||f.getComputedStyle("filter")||"";f.style.filter=b.test(r)?b.replace(r,a):b+a}};Element.Properties.opacity={set:function(b){var a=this.style.visibility;if(b==0&&a!="hidden"){this.style.visibility="hidden"}else{if(b!=0&&a!="visible"){this.style.visibility="visible"}}l(this,b)},get:(p)?function(){var a=this.style.opacity||this.getComputedStyle("opacity");return(a=="")?1:a}:function(){var a,b=(this.style.filter||this.getComputedStyle("filter"));if(b){a=b.match(r)}return(a==null||b==null)?1:(a[1]/100)}};var o=(u.style.cssFloat==null)?"styleFloat":"cssFloat";Element.implement({getComputedStyle:function(b){if(this.currentStyle){return this.currentStyle[b.camelCase()]}var f=Element.getDocument(this).defaultView,a=f?f.getComputedStyle(this,null):null;return(a)?a.getPropertyValue((b==o)?"float":b.hyphenate()):null},setOpacity:function(a){l(this,a);return this},getOpacity:function(){return this.get("opacity")},setStyle:function(f,a){switch(f){case"opacity":return this.set("opacity",parseFloat(a));case"float":f=o}f=f.camelCase();if(typeOf(a)!="string"){var b=(Element.Styles[f]||"@").split(" ");a=Array.from(a).map(function(g,j){if(!b[j]){return""}return(typeOf(g)=="number")?b[j].replace("@",Math.round(g)):g}).join(" ")}else{if(a==String(Number(a))){a=Math.round(a)}}this.style[f]=a;return this},getStyle:function(D){switch(D){case"opacity":return this.get("opacity");case"float":D=o}D=D.camelCase();var a=this.style[D];if(!a||D=="zIndex"){a=[];for(var C in Element.ShortStyles){if(D!=C){continue}for(var b in Element.ShortStyles[C]){a.push(this.getStyle(b))}return a.join(" ")}a=this.getComputedStyle(D)}if(a){a=String(a);var g=a.match(/rgba?\([\d\s,]+\)/);if(g){a=a.replace(g[0],g[0].rgbToHex())}}if(Browser.opera||(Browser.ie&&isNaN(parseFloat(a)))){if(D.test(/^(height|width)$/)){var j=(D=="width")?["left","right"]:["top","bottom"],f=0;j.each(function(z){f+=this.getStyle("border-"+z+"-width").toInt()+this.getStyle("padding-"+z).toInt()},this);return this["offset"+D.capitalize()]-f+"px"}if(Browser.opera&&String(a).indexOf("px")!=-1){return a}if(D.test(/(border(.+)Width|margin|padding)/)){return"0px"}}return a},setStyles:function(b){for(var a in b){this.setStyle(a,b[a])}return this},getStyles:function(){var a={};Array.flatten(arguments).each(function(b){a[b]=this.getStyle(b)},this);return a}});Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"};Element.Styles=new Hash(Element.Styles);Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(D){var C=Element.ShortStyles;var j=Element.Styles;["margin","padding"].each(function(B){var z=B+D;C[B][z]=j[z]="@px"});var b="border"+D;C.border[b]=j[b]="@px @ rgb(@, @, @)";var f=b+"Width",a=b+"Style",g=b+"Color";C[b]={};C.borderWidth[f]=C[b][f]=j[f]="@px";C.borderStyle[a]=C[b][a]=j[a]="@";C.borderColor[g]=C[b][g]=j[g]="rgb(@, @, @)"})})();(function(){Element.Properties.events={set:function(a){this.addEvents(a)}};[Element,Window,Document].invoke("implement",{addEvent:function(B,a){var H=this.retrieve("events",{});if(!H[B]){H[B]={keys:[],values:[]}}if(H[B].keys.contains(a)){return this}H[B].keys.push(a);var b=B,F=Element.Events[B],D=a,G=this;if(F){if(F.onAdd){F.onAdd.call(this,a)}if(F.condition){D=function(j){if(F.condition.call(this,j)){return a.call(this,j)}return true}}b=F.base||b}var C=function(){return a.call(G)};var E=Element.NativeEvents[b];if(E){if(E==2){C=function(j){j=new Event(j,G.getWindow());if(D.call(G,j)===false){j.stop()}}}this.addListener(b,C)}H[B].values.push(C);return this},removeEvent:function(a,b){var z=this.retrieve("events");if(!z||!z[a]){return this}var u=z[a];var B=u.keys.indexOf(b);if(B==-1){return this}var C=u.values[B];delete u.keys[B];delete u.values[B];var D=Element.Events[a];if(D){if(D.onRemove){D.onRemove.call(this,b)}a=D.base||a}return(Element.NativeEvents[a])?this.removeListener(a,C):this},addEvents:function(b){for(var a in b){this.addEvent(a,b[a])}return this},removeEvents:function(l){var a;if(typeOf(l)=="object"){for(a in l){this.removeEvent(a,l[a])}return this}var b=this.retrieve("events");if(!b){return this}if(!l){for(a in b){this.removeEvents(a)}this.eliminate("events")}else{if(b[l]){b[l].keys.each(function(j){this.removeEvent(l,j)},this);delete b[l]}}return this},fireEvent:function(a,o,p){var b=this.retrieve("events");if(!b||!b[a]){return this}o=Array.from(o);b[a].keys.each(function(j){if(p){j.delay(p,this,o)}else{j.apply(this,o)}},this);return this},cloneEvents:function(a,b){a=document.id(a);var o=a.retrieve("events");if(!o){return this}if(!b){for(var p in o){this.cloneEvents(a,p)}}else{if(o[b]){o[b].keys.each(function(j){this.addEvent(b,j)},this)}}return this}});try{if(typeof HTMLElement!="undefined"){HTMLElement.prototype.fireEvent=Element.prototype.fireEvent}}catch(f){}Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};var g=function(b){var a=b.relatedTarget;if(a==null){return true}if(!a){return false}return(a!=this&&a.prefix!="xul"&&typeOf(this)!="document"&&!this.contains(a))};Element.Events={mouseenter:{base:"mouseover",condition:g},mouseleave:{base:"mouseout",condition:g},mousewheel:{base:(Browser.firefox)?"DOMMouseScroll":"mousewheel"}};Element.Events=new Hash(Element.Events)})();(function(){Element.implement({scrollTo:function(b,a){if(p(this)){this.getWindow().scrollTo(b,a)}else{this.scrollLeft=b;this.scrollTop=a}return this},getSize:function(){if(p(this)){return this.getWindow().getSize()}return{x:this.offsetWidth,y:this.offsetHeight}},getScrollSize:function(){if(p(this)){return this.getWindow().getScrollSize()}return{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){if(p(this)){return this.getWindow().getScroll()}return{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){var a=this.parentNode,b={x:0,y:0};while(a&&!p(a)){b.x+=a.scrollLeft;b.y+=a.scrollTop;a=a.parentNode}return b},getOffsetParent:function(){var a=this;if(p(a)){return null}if(!Browser.ie){return a.offsetParent}while((a=a.parentNode)){if(B(a,"position")!="static"||p(a)){return a}}return null},getOffsets:function(){if(this.getBoundingClientRect&&!Browser.Platform.ios){var o=this.getBoundingClientRect(),a=document.id(this.getDocument().documentElement),F=a.getScroll(),f=this.getScrolls(),j=(B(this,"position")=="fixed");return{x:o.left.toInt()+f.x+((j)?0:F.x)-a.clientLeft,y:o.top.toInt()+f.y+((j)?0:F.y)-a.clientTop}}var b=this,g={x:0,y:0};if(p(this)){return g}while(b&&!p(b)){g.x+=b.offsetLeft;g.y+=b.offsetTop;if(Browser.firefox){if(!u(b)){g.x+=C(b);g.y+=D(b)}var l=b.parentNode;if(l&&B(l,"overflow")!="visible"){g.x+=C(l);g.y+=D(l)}}else{if(b!=this&&Browser.safari){g.x+=C(b);g.y+=D(b)}}b=b.offsetParent}if(Browser.firefox&&!u(this)){g.x-=C(this);g.y-=D(this)}return g},getPosition:function(g){if(p(this)){return{x:0,y:0}}var j=this.getOffsets(),b=this.getScrolls();var f={x:j.x-b.x,y:j.y-b.y};if(g&&(g=document.id(g))){var a=g.getPosition();return{x:f.x-a.x-C(g),y:f.y-a.y-D(g)}}return f},getCoordinates:function(a){if(p(this)){return this.getWindow().getCoordinates()}var f=this.getPosition(a),b=this.getSize();var g={left:f.x,top:f.y,width:b.x,height:b.y};g.right=g.left+g.width;g.bottom=g.top+g.height;return g},computePosition:function(a){return{left:a.x-z(this,"margin-left"),top:a.y-z(this,"margin-top")}},setPosition:function(a){return this.setStyles(this.computePosition(a))}});[Document,Window].invoke("implement",{getSize:function(){var a=r(this);return{x:a.clientWidth,y:a.clientHeight}},getScroll:function(){var a=this.getWindow(),b=r(this);return{x:a.pageXOffset||b.scrollLeft,y:a.pageYOffset||b.scrollTop}},getScrollSize:function(){var a=r(this),b=this.getSize(),f=this.getDocument().body;return{x:Math.max(a.scrollWidth,f.scrollWidth,b.x),y:Math.max(a.scrollHeight,f.scrollHeight,b.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var a=this.getSize();return{top:0,left:0,bottom:a.y,right:a.x,height:a.y,width:a.x}}});var B=Element.getComputedStyle;function z(b,a){return B(b,a).toInt()||0}function u(a){return B(a,"-moz-box-sizing")=="border-box"}function D(a){return z(a,"border-top-width")}function C(a){return z(a,"border-left-width")}function p(a){return(/^(?:body|html)$/i).test(a.tagName)}function r(b){var a=b.getDocument();return(!a.compatMode||a.compatMode=="CSS1Compat")?a.html:a.body}})();Element.alias({position:"setPosition"});[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}});(function(){var u=this.Fx=new Class({Implements:[Chain,Events,Options],options:{fps:50,unit:false,duration:500,link:"ignore"},initialize:function(a){this.subject=this.subject||this;this.setOptions(a)},getTransition:function(){return function(a){return -(Math.cos(Math.PI*a)-1)/2}},step:function(){var b=Date.now();if(b<this.time+this.options.duration){var a=this.transition((b-this.time)/this.options.duration);this.set(this.compute(this.from,this.to,a))}else{this.set(this.compute(this.from,this.to,1));this.complete()}},set:function(a){return a},compute:function(a,b,f){return u.compute(a,b,f)},check:function(){if(!this.timer){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},start:function(a,b){if(!this.check(a,b)){return this}var f=this.options.duration;this.options.duration=u.Durations[f]||f.toInt();this.from=a;this.to=b;this.time=0;this.transition=this.getTransition();this.startTimer();this.onStart();return this},complete:function(){if(this.stopTimer()){this.onComplete()}return this},cancel:function(){if(this.stopTimer()){this.onCancel()}return this},onStart:function(){this.fireEvent("start",this.subject)},onComplete:function(){this.fireEvent("complete",this.subject);if(!this.callChain()){this.fireEvent("chainComplete",this.subject)}},onCancel:function(){this.fireEvent("cancel",this.subject).clearChain()},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer){return false}this.time=Date.now()-this.time;this.timer=p(this);return true},startTimer:function(){if(this.timer){return false}this.time=Date.now()-this.time;this.timer=o(this);return true}});u.compute=function(a,b,f){return(b-a)*f+a};u.Durations={"short":250,normal:500,"long":1000};var z={},B={};var r=function(){for(var a=this.length;a--;){if(this[a]){this[a].step()}}};var o=function(f){var a=f.options.fps,b=z[a]||(z[a]=[]);b.push(f);if(!B[a]){B[a]=r.periodical(Math.round(1000/a),b)}return true};var p=function(f){var a=f.options.fps,b=z[a]||[];b.erase(f);if(!b.length&&B[a]){B[a]=clearInterval(B[a])}return false}})();Fx.CSS=new Class({Extends:Fx,prepare:function(p,o,j){j=Array.from(j);if(j[1]==null){j[1]=j[0];j[0]=p.getStyle(o)}var l=j.map(this.parse);return{from:l[0],to:l[1]}},parse:function(b){b=Function.from(b)();b=(typeof b=="string")?b.split(" "):Array.from(b);return b.map(function(g){g=String(g);var a=false;Object.each(Fx.CSS.Parsers,function(f,o){if(a){return}var p=f.parse(g);if(p||p===0){a={value:p,parser:f}}});a=a||{value:g,parser:Fx.CSS.Parsers.String};return a})},compute:function(o,p,j){var l=[];(Math.min(o.length,p.length)).times(function(a){l.push({value:o[a].parser.compute(o[a].value,p[a].value,j),parser:o[a].parser})});l.$family=Function.from("fx:css:value");return l},serve:function(l,g){if(typeOf(l)!="fx:css:value"){l=this.parse(l)}var j=[];l.each(function(a){j=j.concat(a.parser.serve(a.value,g))});return j},render:function(l,o,p,j){l.setStyle(o,this.serve(p,j))},search:function(g){if(Fx.CSS.Cache[g]){return Fx.CSS.Cache[g]}var f={};Array.each(document.styleSheets,function(a,b){var j=a.href;if(j&&j.contains("://")&&!j.contains(document.domain)){return}var p=a.rules||a.cssRules;Array.each(p,function(o,l){if(!o.style){return}var u=(o.selectorText)?o.selectorText.replace(/^\w+/,function(r){return r.toLowerCase()}):null;if(!u||!u.test("^"+g+"$")){return}Element.Styles.each(function(B,r){if(!o.style[r]||Element.ShortStyles[r]){return}B=String(o.style[r]);f[r]=(B.test(/^rgb/))?B.rgbToHex():B})})});return Fx.CSS.Cache[g]=f}});Fx.CSS.Cache={};Fx.CSS.Parsers={Color:{parse:function(b){if(b.match(/^#[0-9a-f]{3,6}$/i)){return b.hexToRgb(true)}return((b=b.match(/(\d+),\s*(\d+),\s*(\d+)/)))?[b[1],b[2],b[3]]:false},compute:function(l,g,j){return l.map(function(a,b){return Math.round(Fx.compute(l[b],g[b],j))})},serve:function(b){return b.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(f,g){return(g)?f+g:f}},String:{parse:Function.from(false),compute:function(f,g){return g},serve:function(b){return b}}};Fx.CSS.Parsers=new Hash(Fx.CSS.Parsers);Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(f,g){this.element=this.subject=document.id(f);this.parent(g)},set:function(f,g){if(arguments.length==1){g=f;f=this.property||this.options.property}this.render(this.element,f,g,this.options.unit);return this},start:function(u,p,r){if(!this.check(u,p,r)){return this}var l=Array.flatten(arguments);this.property=this.options.property||l.shift();var o=this.prepare(this.element,this.property,l);return this.parent(o.from,o.to)}});Element.Properties.tween={set:function(b){this.get("tween").cancel().setOptions(b);return this},get:function(){var b=this.retrieve("tween");if(!b){b=new Fx.Tween(this,{link:"cancel"});this.store("tween",b)}return b}};Element.implement({tween:function(j,l,g){this.get("tween").start(arguments);return this},fade:function(u){var p=this.get("tween"),r="opacity",o;u=[u,"toggle"].pick();switch(u){case"in":p.start(r,1);break;case"out":p.start(r,0);break;case"show":p.set(r,1);break;case"hide":p.set(r,0);break;case"toggle":var l=this.retrieve("fade:flag",this.get("opacity")==1);p.start(r,(l)?0:1);this.store("fade:flag",!l);o=true;break;default:p.start(r,arguments)}if(!o){this.eliminate("fade:flag")}return this},highlight:function(l,j){if(!j){j=this.retrieve("highlight:original",this.getStyle("background-color"));j=(j=="transparent")?"#fff":j}var g=this.get("tween");g.start("background-color",l||"#ffff88",j).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));g.callChain()}.bind(this));return this}});Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(f,g){this.element=this.subject=document.id(f);this.parent(g)},set:function(g){if(typeof g=="string"){g=this.search(g)}for(var f in g){this.render(this.element,f,g[f],this.options.unit)}return this},compute:function(p,r,u){var o={};for(var l in p){o[l]=this.parent(p[l],r[l],u)}return o},start:function(l){if(!this.check(l)){return this}if(typeof l=="string"){l=this.search(l)}var p={},r={};for(var u in l){var o=this.prepare(this.element,u,l[u]);p[u]=o.from;r[u]=o.to}return this.parent(p,r)}});Element.Properties.morph={set:function(b){this.get("morph").cancel().setOptions(b);return this},get:function(){var b=this.retrieve("morph");if(!b){b=new Fx.Morph(this,{link:"cancel"});this.store("morph",b)}return b}};Element.implement({morph:function(b){this.get("morph").start(b);return this}});Fx.implement({getTransition:function(){var g=this.options.transition||Fx.Transitions.Sine.easeInOut;if(typeof g=="string"){var f=g.split(":");g=Fx.Transitions;g=g[f[0]]||g[f[0].capitalize()];if(f[1]){g=g["ease"+f[1].capitalize()+(f[2]?f[2].capitalize():"")]}}return g}});Fx.Transition=function(f,g){g=Array.from(g);return Object.append(f,{easeIn:function(a){return f(a,g)},easeOut:function(a){return 1-f(1-a,g)},easeInOut:function(a){return(a<=0.5)?f(2*a,g)/2:(2-f(2*(1-a),g))/2}})};Fx.Transitions={linear:function(b){return b}};Fx.Transitions=new Hash(Fx.Transitions);Fx.Transitions.extend=function(g){for(var f in g){Fx.Transitions[f]=new Fx.Transition(g[f])}};Fx.Transitions.extend({Pow:function(f,g){return Math.pow(f,g&&g[0]||6)},Expo:function(b){return Math.pow(2,8*(b-1))},Circ:function(b){return 1-Math.sin(Math.acos(b))},Sine:function(b){return 1-Math.sin((1-b)*Math.PI/2)},Back:function(f,g){g=g&&g[0]||1.618;return Math.pow(f,2)*((g+1)*f-g)},Bounce:function(a){var b;for(var o=0,p=1;1;o+=p,p/=2){if(a>=(7-4*o)/11){b=p*p-Math.pow((11-6*o-11*a)/4,2);break}}return b},Elastic:function(f,g){return Math.pow(2,10*--f)*Math.cos(20*f*Math.PI*(g&&g[0]||1)/3)}});["Quad","Cubic","Quart","Quint"].each(function(f,g){Fx.Transitions[f]=new Fx.Transition(function(a){return Math.pow(a,[g+2])})});(function(){var j=("onprogress" in new Browser.Request);var l=this.Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:true,format:false,method:"post",link:"ignore",isSuccess:null,emulation:true,urlEncoded:true,encoding:"utf-8",evalScripts:false,evalResponse:false,timeout:0,noCache:false},initialize:function(a){this.xhr=new Browser.Request();this.setOptions(a);this.headers=this.options.headers},onStateChange:function(){var a=this.xhr;if(a.readyState!=4||!this.running){return}this.running=false;this.status=0;Function.attempt(function(){var b=a.status;this.status=(b==1223)?204:b}.bind(this));a.onreadystatechange=function(){};clearTimeout(this.timer);this.response={text:this.xhr.responseText||"",xml:this.xhr.responseXML};if(this.options.isSuccess.call(this,this.status)){this.success(this.response.text,this.response.xml)}else{this.failure()}},isSuccess:function(){var a=this.status;return(a>=200&&a<300)},isRunning:function(){return !!this.running},processScripts:function(a){if(this.options.evalResponse||(/(ecma|java)script/).test(this.getHeader("Content-type"))){return Browser.exec(a)}return a.stripScripts(this.options.evalScripts)},success:function(a,b){this.onSuccess(this.processScripts(a),b)},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure()},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},loadstart:function(a){this.fireEvent("loadstart",[a,this.xhr])},progress:function(a){this.fireEvent("progress",[a,this.xhr])},timeout:function(){this.fireEvent("timeout",this.xhr)},setHeader:function(b,a){this.headers[b]=a;return this},getHeader:function(a){return Function.attempt(function(){return this.xhr.getResponseHeader(a)}.bind(this))},check:function(){if(!this.running){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},send:function(a){if(!this.check(a)){return this}this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.running=true;var K=typeOf(a);if(K=="string"||K=="element"){a={data:a}}var G=this.options;a=Object.append({data:G.data,url:G.url,method:G.method},a);var b=a.data,I=String(a.url),J=a.method.toLowerCase();switch(typeOf(b)){case"element":b=document.id(b).toQueryString();break;case"object":case"hash":b=Object.toQueryString(b)}if(this.options.format){var F="format="+this.options.format;b=(b)?F+"&"+b:F}if(this.options.emulation&&!["get","post"].contains(J)){var M="_method="+J;b=(b)?M+"&"+b:M;J="post"}if(this.options.urlEncoded&&["post","put"].contains(J)){var H=(this.options.encoding)?"; charset="+this.options.encoding:"";this.headers["Content-type"]="application/x-www-form-urlencoded"+H}if(!I){I=document.location.pathname}var E=I.lastIndexOf("/");if(E>-1&&(E=I.indexOf("#"))>-1){I=I.substr(0,E)}if(this.options.noCache){I+=(I.contains("?")?"&":"?")+String.uniqueID()}if(b&&J=="get"){I+=(I.contains("?")?"&":"?")+b;b=null}var f=this.xhr;if(j){f.onloadstart=this.loadstart.bind(this);f.onprogress=this.progress.bind(this)}f.open(J.toUpperCase(),I,this.options.async,this.options.user,this.options.password);if(this.options.user&&"withCredentials" in f){f.withCredentials=true}f.onreadystatechange=this.onStateChange.bind(this);Object.each(this.headers,function(p,r){try{f.setRequestHeader(r,p)}catch(o){this.fireEvent("exception",[r,p])}},this);this.fireEvent("request");f.send(b);if(!this.options.async){this.onStateChange()}if(this.options.timeout){this.timer=this.timeout.delay(this.options.timeout,this)}return this},cancel:function(){if(!this.running){return this}this.running=false;var a=this.xhr;a.abort();clearTimeout(this.timer);a.onreadystatechange=a.onprogress=a.onloadstart=function(){};this.xhr=new Browser.Request();this.fireEvent("cancel");return this}});var g={};["get","post","put","delete","GET","POST","PUT","DELETE"].each(function(a){g[a]=function(b){return this.send({data:b,method:a})}});l.implement(g);Element.Properties.send={set:function(b){var a=this.get("send").cancel();a.setOptions(b);return this},get:function(){var a=this.retrieve("send");if(!a){a=new l({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")});this.store("send",a)}return a}};Element.implement({send:function(b){var a=this.get("send");a.send({data:this,url:b||a.options.url});return this}})})();Request.HTML=new Class({Extends:Request,options:{update:false,append:false,evalScripts:true,filter:false,headers:{Accept:"text/html, application/xml, text/xml, */*"}},success:function(p){var r=this.options,l=this.response;l.html=p.stripScripts(function(a){l.javascript=a});var u=l.html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(u){l.html=u[1]}var o=new Element("div").set("html",l.html);l.tree=o.childNodes;l.elements=o.getElements("*");if(r.filter){l.tree=l.elements.filter(r.filter)}if(r.update){document.id(r.update).empty().set("html",l.html)}else{if(r.append){document.id(r.append).adopt(o.getChildren())}}if(r.evalScripts){Browser.exec(l.javascript)}this.onSuccess(l.tree,l.elements,l.html,l.javascript)}});Element.Properties.load={set:function(g){var f=this.get("load").cancel();f.setOptions(g);return this},get:function(){var b=this.retrieve("load");if(!b){b=new Request.HTML({data:this,link:"cancel",update:this,method:"get"});this.store("load",b)}return b}};Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Type.isObject,url:Type.isString}));return this}});if(!this.JSON){this.JSON={}}JSON=new Hash({stringify:JSON.stringify,parse:JSON.parse});Object.append(JSON,{$specialChars:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},$replaceChars:function(b){return JSON.$specialChars[b]||"\\u00"+Math.floor(b.charCodeAt()/16).toString(16)+(b.charCodeAt()%16).toString(16)},encode:function(f){switch(typeOf(f)){case"string":return'"'+f.replace(/[\x00-\x1f\\"]/g,JSON.$replaceChars)+'"';case"array":return"["+String(f.map(JSON.encode).clean())+"]";case"object":case"hash":var g=[];Object.each(f,function(a,b){var l=JSON.encode(a);if(l){g.push(JSON.encode(b)+":"+l)}});return"{"+g+"}";case"number":case"boolean":return String(f);case"null":return"null"}return null},decode:function(string,secure){if(typeOf(string)!="string"||!string.length){return null}if(secure&&!(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(string.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))){return null}return eval("("+string+")")}});Request.JSON=new Class({Extends:Request,options:{secure:true},initialize:function(b){this.parent(b);Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(l){var g=this.options.secure;var j=this.response.json=Function.attempt(function(){return JSON.decode(l,g)});if(j==null){this.onFailure()}else{this.onSuccess(j,l)}}});var Cookie=new Class({Implements:Options,options:{path:"/",domain:false,duration:false,secure:false,document:document,encode:true},initialize:function(f,g){this.key=f;this.setOptions(g)},write:function(f){if(this.options.encode){f=encodeURIComponent(f)}if(this.options.domain){f+="; domain="+this.options.domain}if(this.options.path){f+="; path="+this.options.path}if(this.options.duration){var g=new Date();g.setTime(g.getTime()+this.options.duration*24*60*60*1000);f+="; expires="+g.toGMTString()}if(this.options.secure){f+="; secure"}this.options.document.cookie=this.key+"="+f;return this},read:function(){var b=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return(b)?decodeURIComponent(b[1]):null},dispose:function(){new Cookie(this.key,Object.merge({},this.options,{duration:-1})).write("");return this}});Cookie.write=function(g,l,j){return new Cookie(g,j).write(l)};Cookie.read=function(b){return new Cookie(b).read()};Cookie.dispose=function(f,g){return new Cookie(f,g).dispose()};(function(D,N){var G,I,J=[],M,O,E=true;try{E=D.frameElement!=null}catch(F){}var H=function(){clearTimeout(O);if(G){return}Browser.loaded=G=true;N.removeListener("DOMContentLoaded",H).removeListener("readystatechange",P);N.fireEvent("domready");D.fireEvent("domready")};var P=function(){for(var a=J.length;a--;){if(J[a]()){H();return true}}return false};var Q=function(){clearTimeout(O);if(!P()){O=setTimeout(Q,10)}};N.addListener("DOMContentLoaded",H);var K=N.createElement("div");if(K.doScroll&&!E){J.push(function(){try{K.doScroll();return true}catch(a){}return false});M=true}if(N.readyState){J.push(function(){var a=N.readyState;return(a=="loaded"||a=="complete")})}if("onreadystatechange" in N){N.addListener("readystatechange",P)}else{M=true}if(M){Q()}Element.Events.domready={onAdd:function(a){if(G){a.call(this)}}};Element.Events.load={base:"load",onAdd:function(a){if(I&&this==D){a.call(this)}},condition:function(){if(this==D){H();delete Element.Events.load}return true}};D.addEvent("load",function(){I=true})})(window,document);(function(){var id=0;var Swiff=this.Swiff=new Class({Implements:Options,options:{id:null,height:1,width:1,container:null,properties:{},params:{quality:"high",allowScriptAccess:"always",wMode:"window",swLiveConnect:true},callBacks:{},vars:{}},toElement:function(){return this.object},initialize:function(path,options){this.instance="Swiff_"+id++;this.setOptions(options);options=this.options;var id=this.id=options.id||this.instance;var container=document.id(options.container);Swiff.CallBacks[this.instance]={};var params=options.params,vars=options.vars,callBacks=options.callBacks;var properties=Object.append({height:options.height,width:options.width},options.properties);var self=this;for(var callBack in callBacks){Swiff.CallBacks[this.instance][callBack]=(function(option){return function(){return option.apply(self.object,arguments)}})(callBacks[callBack]);vars[callBack]="Swiff.CallBacks."+this.instance+"."+callBack}params.flashVars=Object.toQueryString(vars);if(Browser.ie){properties.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000";params.movie=path}else{properties.type="application/x-shockwave-flash"}properties.data=path;var build='<object id="'+id+'"';for(var property in properties){build+=" "+property+'="'+properties[property]+'"'}build+=">";for(var param in params){if(params[param]){build+='<param name="'+param+'" value="'+params[param]+'" />'}}build+="</object>";this.object=((container)?container.empty():new Element("div")).set("html",build).firstChild},replaces:function(element){element=document.id(element,true);element.parentNode.replaceChild(this.toElement(),element);return this},inject:function(element){document.id(element,true).appendChild(this.toElement());return this},remote:function(){return Swiff.remote.apply(Swiff,[this.toElement()].extend(arguments))}});Swiff.CallBacks={};Swiff.remote=function(obj,fn){var rs=obj.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(rs)}})();MooTools.More={version:"1.3.0.1",build:"6dce99bed2792dffcbbbb4ddc15a1fb9a41994b5"};Events.Pseudos=function(r,B,z){var o="monitorEvents:";var p=function(a){return{store:a.store?function(f,b){a.store(o+f,b)}:function(f,b){(a.$monitorEvents||(a.$monitorEvents={}))[f]=b},retrieve:a.retrieve?function(f,b){return a.retrieve(o+f,b)}:function(f,b){if(!a.$monitorEvents){return b}return a.$monitorEvents[f]||b}}};var u=function(b){if(b.indexOf(":")==-1){return null}var f=Slick.parse(b).expressions[0][0],a=f.pseudos;return(r&&r[a[0].key])?{event:f.tag,value:a[0].value,pseudo:a[0].key,original:b}:null};return{addEvent:function(j,a,b){var f=u(j);if(!f){return B.call(this,j,a,b)}var J=p(this),I=J.retrieve(j,[]),l=Array.from(r[f.pseudo]),H=l[1];var K=this;var M=function(){l[0].call(K,f,a,arguments,H)};I.include({event:a,monitor:M});J.store(j,I);var g=f.event;if(H&&H[g]){g=H[g].base}B.call(this,j,a,b);return B.call(this,g,M,b)},removeEvent:function(E,F){var l=u(E);if(!l){return z.call(this,E,F)}var g=p(this),a=g.retrieve(E),b=Array.from(r[l.pseudo]),f=b[1];if(!a){return this}var j=l.event;if(f&&f[j]){j=f[j].base}z.call(this,E,F);a.each(function(D,C){if(!F||D.event==F){z.call(this,j,D.monitor)}delete a[C]},this);g.store(E,a);return this}}};(function(){var f={once:function(b,a,l){a.apply(this,l);this.removeEvent(b.original,a)}};Events.definePseudo=function(b,a){f[b]=a};var g=Events.prototype;Events.implement(Events.Pseudos(f,g.addEvent,g.removeEvent))})();Class.refactor=function(f,g){Object.each(g,function(a,b){var l=f.prototype[b];if(l&&l.$origin){l=l.$origin}if(l&&typeof a=="function"){f.implement(b,function(){var j=this.previous;this.previous=l;var p=a.apply(this,arguments);this.previous=j;return p})}else{f.implement(b,a)}});return f};Class.Mutators.Binds=function(b){return b};Class.Mutators.initialize=function(b){return function(){Array.from(this.Binds).each(function(a){var g=this[a];if(g){this[a]=g.bind(this)}},this);return b.apply(this,arguments)}};Class.Occlude=new Class({occlude:function(l,g){g=document.id(g||this.element);var j=g.retrieve(l||this.property);if(j&&this.occluded!=null){return this.occluded=j}this.occluded=false;g.store(l||this.property,this);return this.occluded}});(function(){var b={wait:function(a){return this.chain(function(){this.callChain.delay(a==null?500:a,this)}.bind(this))}};Chain.implement(b);if(this.Fx){Fx.implement(b);["Css","Tween","Elements"].each(function(a){if(Fx[a]){Fx[a].implement(b)}})}if(this.Element&&this.Fx){Element.implement({chains:function(a){Array.from(a||["tween","morph","reveal"]).each(function(g){g=this.get(g);if(!g){return}g.setOptions({link:"chain"})},this);return this},pauseFx:function(g,a){this.chains(a).get(a||"tween").wait(g);return this}})}})();Array.implement({min:function(){return Math.min.apply(null,this)},max:function(){return Math.max.apply(null,this)},average:function(){return this.length?this.sum()/this.length:0},sum:function(){var g=0,f=this.length;if(f){while(f--){g+=this[f]}}return g},unique:function(){return[].combine(this)},shuffle:function(){for(var g=this.length;g&&--g;){var j=this[g],l=Math.floor(Math.random()*(g+1));this[g]=this[l];this[l]=j}return this},reduce:function(u,r){var p;for(var l=0,o=this.length;l<o;l++){if(l in this){r=r===p?this[l]:u.call(null,r,this[l],l,this)}}return r},reduceRight:function(j,p){var l=this.length,o;while(l--){if(l in this){p=p===o?this[l]:j.call(null,p,this[l],l,this)}}return p}});(function(){var b=function(a){return a!=null};Object.extend({getFromPath:function(l,p){var u=p.split(".");for(var r=0,a=u.length;r<a;r++){if(l.hasOwnProperty(u[r])){l=l[u[r]]}else{return null}}return l},cleanValues:function(a,g){g=g||b;for(key in a){if(!g(a[key])){delete a[key]}}return a},erase:function(a,g){if(a.hasOwnProperty(g)){delete a[g]}return a},run:function(g){var a=Array.slice(arguments,1);for(key in g){if(g[key].apply){g[key].apply(g,a)}}return g}})})();(function(){var o=null,r={},u={};var z=function(a){if(instanceOf(a,p.Set)){return a}else{return r[a]}};var p=this.Locale={define:function(j,g,b,a){var f;if(instanceOf(j,p.Set)){f=j.name;if(f){r[f]=j}}else{f=j;if(!r[f]){r[f]=new p.Set(f)}j=r[f]}if(g){j.define(g,b,a)}if(g=="cascade"){return p.inherit(f,b)}if(!o){o=j}return j},use:function(a){a=z(a);if(a){o=a;this.fireEvent("change",a);this.fireEvent("langChange",a.name)}return this},getCurrent:function(){return o},get:function(a,b){return(o)?o.get(a,b):""},inherit:function(f,b,a){f=z(f);if(f){f.inherit(b,a)}return this},list:function(){return Object.keys(r)}};Object.append(p,new Events);p.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(a){this.name=a||""},define:function(a,f,b){var g=this.sets[a];if(!g){g={}}if(f){if(typeOf(f)=="object"){g=Object.merge(g,f)}else{g[f]=b}}this.sets[a]=g;return this},get:function(I,J,K){var M=Object.getFromPath(this.sets,I);if(M!=null){var j=typeOf(M);if(j=="function"){M=M.apply(null,Array.from(J))}else{if(j=="object"){M=Object.clone(M)}}return M}var b=I.indexOf("."),a=b<0?I:I.substr(0,b),H=(this.inherits.sets[a]||[]).combine(this.inherits.locales).include("en-US");if(!K){K=[]}for(var g=0,l=H.length;g<l;g++){if(K.contains(H[g])){continue}K.include(H[g]);var f=r[H[g]];if(!f){continue}M=f.get(I,J,K);if(M!=null){return M}}return""},inherit:function(b,a){b=Array.from(b);if(a&&!this.inherits.sets[a]){this.inherits.sets[a]=[]}var f=b.length;while(f--){(a?this.inherits.sets[a]:this.inherits.locales).unshift(b[f])}return this}});var B=MooTools.lang={};Object.append(B,p,{setLanguage:p.use,getCurrentLanguage:function(){var a=p.getCurrent();return(a)?a.name:null},set:function(){p.define.apply(this,arguments);return this},get:function(a,b,f){if(b){a+="."+b}return p.get(a,f)}})})();Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",ordinal:function(b){return(b>3&&b<21)?"th":["th","st","nd","rd","th"][Math.min(b%10,4)]},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"});(function(){var G=this.Date;G.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"].each(function(a){G.Methods[a.toLowerCase()]=a});var O=function(a,b,f){if(!f){f="0"}return new Array(b-String(a).length+1).join(f)+a};G.implement({set:function(a,b){a=a.toLowerCase();var f=G.Methods;if(f[a]){this["set"+f[a]](b)}return this}.overloadSetter(),get:function(a){a=a.toLowerCase();var b=G.Methods;if(b[a]){return this["get"+b[a]]()}return null},clone:function(){return new G(this.get("time"))},increment:function(f,a){f=f||"day";a=a!=null?a:1;switch(f){case"year":return this.increment("month",a*12);case"month":var b=this.get("date");this.set("date",1).set("mo",this.get("mo")+a);return this.set("date",b.min(this.get("lastdayofmonth")));case"week":return this.increment("day",a*7);case"day":return this.set("date",this.get("date")+a)}if(!G.units[f]){throw new Error(f+" is not a supported interval")}return this.set("time",this.get("time")+a*G.units[f]())},decrement:function(b,a){return this.increment(b,-1*(a!=null?a:1))},isLeapYear:function(){return G.isLeapYear(this.get("year"))},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0})},diff:function(a,b){if(typeOf(a)=="string"){a=G.parse(a)}return((a-this)/G.units[b||"day"](3,3)).round()},getLastDayOfMonth:function(){return G.daysInMonth(this.get("mo"),this.get("year"))},getDayOfYear:function(){return(G.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-G.UTC(this.get("year"),0,1))/G.units.day()},getWeek:function(){return(this.get("dayofyear")/7).ceil()},getOrdinal:function(a){return G.getMsg("ordinal",a||this.get("date"))},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},getGMTOffset:function(){var a=this.get("timezoneOffset");return((a>0)?"-":"+")+O((a.abs()/60).floor(),2)+O(a%60,2)},setAMPM:function(b){b=b.toUpperCase();var a=this.get("hr");if(a>11&&b=="AM"){return this.decrement("hour",12)}else{if(a<12&&b=="PM"){return this.increment("hour",12)}}return this},getAMPM:function(){return(this.get("hr")<12)?"AM":"PM"},parse:function(a){this.set("time",G.parse(a));return this},isValid:function(a){return !isNaN((a||this).valueOf())},format:function(b){if(!this.isValid()){return"invalid date"}b=b||"%x %X";b=Q[b.toLowerCase()]||b;var a=this;return b.replace(/%([a-z%])/gi,function(f,g){switch(g){case"a":return G.getMsg("days_abbr")[a.get("day")];case"A":return G.getMsg("days")[a.get("day")];case"b":return G.getMsg("months_abbr")[a.get("month")];case"B":return G.getMsg("months")[a.get("month")];case"c":return a.format("%a %b %d %H:%m:%S %Y");case"d":return O(a.get("date"),2);case"e":return O(a.get("date"),2," ");case"H":return O(a.get("hr"),2);case"I":return O((a.get("hr")%12)||12,2);case"j":return O(a.get("dayofyear"),3);case"k":return O(a.get("hr"),2," ");case"l":return O((a.get("hr")%12)||12,2," ");case"L":return O(a.get("ms"),3);case"m":return O((a.get("mo")+1),2);case"M":return O(a.get("min"),2);case"o":return a.get("ordinal");case"p":return G.getMsg(a.get("ampm"));case"s":return Math.round(a/1000);case"S":return O(a.get("seconds"),2);case"U":return O(a.get("week"),2);case"w":return a.get("day");case"x":return a.format(G.getMsg("shortDate"));case"X":return a.format(G.getMsg("shortTime"));case"y":return a.get("year").toString().substr(2);case"Y":return a.get("year");case"T":return a.get("GMTOffset");case"z":return a.get("GMTOffset");case"Z":return a.get("Timezone")}return g})},toISOString:function(){return this.format("iso8601")}});G.alias("toJSON","toISOString");G.alias("compare","diff");G.alias("strftime","format");var Q={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S",iso8601:"%Y-%m-%dT%H:%M:%S%T",rfc822:"%a, %d %b %Y %H:%M:%S %Z","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M"};var K=[];var N=G.parse;var F=function(f,a,g){var j=-1;var b=G.getMsg(f+"s");switch(typeOf(a)){case"object":j=b[a.get(f)];break;case"number":j=b[a];if(!j){throw new Error("Invalid "+f+" index: "+a)}break;case"string":var l=b.filter(function(o){return this.test(o)},new RegExp("^"+a,"i"));if(!l.length){throw new Error("Invalid "+f+" string")}if(l.length>1){throw new Error("Ambiguous "+f)}j=l[0]}return(g)?b.indexOf(j):j};G.extend({getMsg:function(a,b){return Locale.get("Date."+a,b)},units:{ms:Function.from(1),second:Function.from(1000),minute:Function.from(60000),hour:Function.from(3600000),day:Function.from(86400000),week:Function.from(608400000),month:function(b,f){var a=new G;return G.daysInMonth(b!=null?b:a.get("mo"),f!=null?f:a.get("year"))*86400000},year:function(a){a=a||new G().get("year");return G.isLeapYear(a)?31622400000:31536000000}},daysInMonth:function(a,b){return[31,G.isLeapYear(b)?29:28,31,30,31,30,31,31,30,31,30,31][a]},isLeapYear:function(a){return((a%4===0)&&(a%100!==0))||(a%400===0)},parse:function(a){var b=typeOf(a);if(b=="number"){return new G(a)}if(b!="string"){return a}a=a.clean();if(!a.length){return null}var f;K.some(function(g){var j=g.re.exec(a);return(j)?(f=g.handler(j)):false});return f||new G(N(a))},parseDay:function(b,a){return F("day",b,a)},parseMonth:function(a,b){return F("month",a,b)},parseUTC:function(b){var f=new G(b);var a=G.UTC(f.get("year"),f.get("mo"),f.get("date"),f.get("hr"),f.get("min"),f.get("sec"),f.get("ms"));return new G(a)},orderIndex:function(a){return G.getMsg("dateOrder").indexOf(a)+1},defineFormat:function(b,a){Q[b]=a},defineFormats:function(b){for(var a in b){G.defineFormat(a,b[a])}},parsePatterns:K,defineParser:function(a){K.push((a.re&&a.handler)?a:I(a))},defineParsers:function(){Array.flatten(arguments).each(G.defineParser)},define2DigitYearStart:function(a){J=a%100;H=a-J}});var H=1900;var J=70;var T=function(a){return new RegExp("(?:"+G.getMsg(a).map(function(b){return b.substr(0,3)}).join("|")+")[a-z]*")};var S=function(a){switch(a){case"x":return((G.orderIndex("month")==1)?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%T?"}return null};var U={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,T:/Z|[+-]\d{2}(?::?\d{2})?/};U.m=U.I;U.S=U.M;var P;var R=function(a){P=a;U.a=U.A=T("days");U.b=U.B=T("months");K.each(function(b,f){if(b.format){K[f]=I(b.format)}})};var I=function(a){if(!P){return{format:a}}var f=[];var b=(a.source||a).replace(/%([a-z])/gi,function(g,j){return S(j)||g}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function(j,l){var g=U[l];if(!g){return l}f.push(l);return"("+g.source+")"}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:a,re:new RegExp("^"+b+"$","i"),handler:function(o){o=o.slice(1).associate(f);var l=new G().clearTime(),g=o.y||o.Y;if(g!=null){M.call(l,"y",g)}if("d" in o){M.call(l,"d",1)}if("m" in o||"b" in o||"B" in o){M.call(l,"m",1)}for(var j in o){M.call(l,j,o[j])}return l}}};var M=function(f,b){if(!b){return this}switch(f){case"a":case"A":return this.set("day",G.parseDay(b,true));case"b":case"B":return this.set("mo",G.parseMonth(b,true));case"d":return this.set("date",b);case"H":case"I":return this.set("hr",b);case"m":return this.set("mo",b-1);case"M":return this.set("min",b);case"p":return this.set("ampm",b.replace(/\./g,""));case"S":return this.set("sec",b);case"s":return this.set("ms",("0."+b)*1000);case"w":return this.set("day",b);case"Y":return this.set("year",b);case"y":b=+b;if(b<100){b+=H+(b<J?100:0)}return this.set("year",b);case"T":if(b=="Z"){b="+00"}var a=b.match(/([+-])(\d{2}):?(\d{2})?/);a=(a[1]+"1")*(a[2]*60+(+a[3]||0))+this.getTimezoneOffset();return this.set("time",this-a*60000)}return this};G.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %T %Y");Locale.addEvent("change",function(a){if(Locale.get("Date")){R(a)}}).fireEvent("change",Locale.getCurrent())})();Date.implement({timeDiffInWords:function(b){return Date.distanceOfTimeInWords(this,b||new Date)},timeDiff:function(D,p){if(D==null){D=new Date}var u=((D-this)/1000).toInt();if(!u){return"0s"}var r={s:60,m:60,h:24,d:365,y:0};var z,B=[];for(var C in r){if(!u){break}if((z=r[C])){B.unshift((u%z)+C);u=(u/z).toInt()}else{B.unshift(u+C)}}return B.join(p||":")}});Date.alias("timeAgoInWords","timeDiffInWords");Date.extend({distanceOfTimeInWords:function(f,g){return Date.getTimePhrase(((g-f)/1000).toInt())},getTimePhrase:function(r){var z=(r<0)?"Until":"Ago";if(r<0){r*=-1}var o={minute:60,hour:60,day:24,week:7,month:52/12,year:12,eon:Infinity};var u="lessThanMinute";for(var B in o){var p=o[B];if(r<1.5*p){if(r>0.75*p){u=B}break}r/=p;u=B+"s"}r=r.round();return Date.getMsg(u+z,r).substitute({delta:r})}});Date.defineParsers({re:/^(?:tod|tom|yes)/i,handler:function(g){var f=new Date().clearTime();switch(g[0]){case"tom":return f.increment();case"yes":return f.decrement();default:return f}}},{re:/^(next|last) ([a-z]+)$/i,handler:function(r){var p=new Date().clearTime();var l=p.getDay();var u=Date.parseDay(r[2],true);var o=u-l;if(u<=l){o+=7}if(r[1]=="last"){o-=7}return p.set("date",p.getDate()+o)}});Locale.define("en-US","Number",{decimal:".",group:",",currency:{prefix:"$ "}});Number.implement({format:function(V){var I=this;if(!V){V={}}var T=function(a){if(V[a]!=null){return V[a]}return Locale.get("Number."+a)};var N=I<0,K=T("decimal"),U=T("precision"),H=T("group"),Q=T("decimals");if(N){var O=Locale.get("Number.negative")||{};if(O.prefix==null&&O.suffix==null){O.prefix="-"}Object.each(O,function(a,b){V[b]=(b=="prefix"||b=="suffix")?(T(b)+a):a});I=-I}var R=T("prefix"),W=T("suffix");if(Q>0&&Q<=20){I=I.toFixed(Q)}if(U>=1&&U<=21){I=I.toPrecision(U)}I+="";if(T("scientific")===false&&I.indexOf("e")>-1){var G=I.split("e"),J,S=+G[1];I=G[0].replace(".","");if(S<0){S=-S-1;J=G[0].indexOf(".");if(J>-1){S-=J-1}while(S--){I="0"+I}I="0."+I}else{J=G[0].lastIndexOf(".");if(J>-1){S-=G[0].length-J-1}while(S--){I+="0"}}}if(K!="."){I=I.replace(".",K)}if(H){J=I.lastIndexOf(K);J=(J>-1)?J:I.length;var P=I.substring(J),M=J;while(M--){if((J-M-1)%3==0&&M!=(J-1)){P=H+P}P=I.charAt(M)+P}I=P}if(R){I=R+I}if(W){I+=W}return I},formatCurrency:function(){var b=Locale.get("Number.currency")||{};if(b.scientific==null){b.scientific=false}if(b.decimals==null){b.decimals=2}return this.format(b)},formatPercentage:function(){var b=Locale.get("Number.percentage")||{};if(b.suffix==null){b.suffix="%"}if(b.decimals==null){b.decimals=2}return this.format(b)}});(function(){var p={a:/[àáâãäåăą]/g,A:/[ÀÁÂÃÄÅĂĄ]/g,c:/[ćčç]/g,C:/[ĆČÇ]/g,d:/[ďđ]/g,D:/[ĎÐ]/g,e:/[èéêëěę]/g,E:/[ÈÉÊËĚĘ]/g,g:/[ğ]/g,G:/[Ğ]/g,i:/[ìíîï]/g,I:/[ÌÍÎÏ]/g,l:/[ĺľł]/g,L:/[ĹĽŁ]/g,n:/[ñňń]/g,N:/[ÑŇŃ]/g,o:/[òóôõöøő]/g,O:/[ÒÓÔÕÖØ]/g,r:/[řŕ]/g,R:/[ŘŔ]/g,s:/[ššş]/g,S:/[ŠŞŚ]/g,t:/[ťţ]/g,T:/[ŤŢ]/g,ue:/[ü]/g,UE:/[Ü]/g,u:/[ùúûůµ]/g,U:/[ÙÚÛŮ]/g,y:/[ÿý]/g,Y:/[ŸÝ]/g,z:/[žźż]/g,Z:/[ŽŹŻ]/g,th:/[þ]/g,TH:/[Þ]/g,dh:/[ð]/g,DH:/[Ð]/g,ss:/[ß]/g,oe:/[œ]/g,OE:/[Œ]/g,ae:/[æ]/g,AE:/[Æ]/g},j={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"&raquo;":/[\uFFFD]/g};var l=function(a,f){var b=a;for(key in f){b=b.replace(f[key],key)}return b};var o=function(b,a){b=b||"";var f=a?"<"+b+"(?!\\w)[^>]*>([\\s\\S]*?)</"+b+"(?!\\w)>":"</?"+b+"([^>]+)?>";reg=new RegExp(f,"gi");return reg};String.implement({standardize:function(){return l(this,p)},repeat:function(a){return new Array(a+1).join(this)},pad:function(b,f,g){if(this.length>=b){return this}var a=(f==null?" ":""+f).repeat(b-this.length).substr(0,b-this.length);if(!g||g=="right"){return this+a}if(g=="left"){return a+this}return a.substr(0,(a.length/2).floor())+this+a.substr(0,(a.length/2).ceil())},getTags:function(b,a){return this.match(o(b,a))||[]},stripTags:function(b,a){return this.replace(o(b,a),"")},tidy:function(){return l(this,j)}})})();String.implement({parseQueryString:function(o,l){if(o==null){o=true}if(l==null){l=true}var p=this.split(/[&;]/),j={};if(!p.length){return j}p.each(function(f){var b=f.indexOf("="),u=f.substr(b+1),a=b<0?[""]:f.substr(0,b).match(/([^\]\[]+|(\B)(?=\]))/g),g=j;if(l){u=decodeURIComponent(u)}a.each(function(C,r){if(o){C=decodeURIComponent(C)}var D=g[C];if(r<a.length-1){g=g[C]=D||{}}else{if(typeOf(D)=="array"){D.push(u)}else{g[C]=D!=null?[D,u]:u}}})});return j},cleanQueryString:function(b){return this.split("&").filter(function(l){var a=l.indexOf("="),p=a<0?"":l.substr(0,a),o=l.substr(a+1);return b?b.call(null,p,o):(o||o===0)}).join("&")}});(function(){var f=function(){return this.get("value")};var g=this.URI=new Class({Implements:Options,options:{},regex:/^(?:(\w+):)?(?:\/\/(?:(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)?(\.\.?$|(?:[^?#\/]*\/)*)([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,parts:["scheme","user","password","host","port","directory","file","query","fragment"],schemes:{http:80,https:443,ftp:21,rtsp:554,mms:1755,file:0},initialize:function(b,l){this.setOptions(l);var a=this.options.base||g.base;if(!b){b=a}if(b&&b.parsed){this.parsed=Object.clone(b.parsed)}else{this.set("value",b.href||b.toString(),a?new g(a):false)}},parse:function(a,b){var l=a.match(this.regex);if(!l){return false}l.shift();return this.merge(l.associate(this.parts),b)},merge:function(a,b){if((!a||!a.scheme)&&(!b||!b.scheme)){return false}if(b){this.parts.every(function(l){if(a[l]){return false}a[l]=b[l]||"";return true})}a.port=a.port||this.schemes[a.scheme.toLowerCase()];a.directory=a.directory?this.parseDirectory(a.directory,b?b.directory:""):"/";return a},parseDirectory:function(b,a){b=(b.substr(0,1)=="/"?"":(a||"/"))+b;if(!b.test(g.regs.directoryDot)){return b}var l=[];b.replace(g.regs.endSlash,"").split("/").each(function(j){if(j==".."&&l.length>0){l.pop()}else{if(j!="."){l.push(j)}}});return l.join("/")+"/"},combine:function(a){return a.value||a.scheme+"://"+(a.user?a.user+(a.password?":"+a.password:"")+"@":"")+(a.host||"")+(a.port&&a.port!=this.schemes[a.scheme]?":"+a.port:"")+(a.directory||"/")+(a.file||"")+(a.query?"?"+a.query:"")+(a.fragment?"#"+a.fragment:"")},set:function(o,a,b){if(o=="value"){var p=a.match(g.regs.scheme);if(p){p=p[1]}if(p&&this.schemes[p.toLowerCase()]==null){this.parsed={scheme:p,value:a}}else{this.parsed=this.parse(a,(b||this).parsed)||(p?{scheme:p,value:a}:{value:a})}}else{if(o=="data"){this.setData(a)}else{this.parsed[o]=a}}return this},get:function(b,a){switch(b){case"value":return this.combine(this.parsed,a?a.parsed:false);case"data":return this.getData()}return this.parsed[b]||""},go:function(){document.location.href=this.toString()},toURI:function(){return this},getData:function(b,o){var p=this.get(o||"query");if(!(p||p===0)){return b?null:{}}var a=p.parseQueryString();return b?a[b]:a},setData:function(p,a,o){if(typeof p=="string"){var b=this.getData();b[arguments[0]]=arguments[1];p=b}else{if(a){p=Object.merge(this.getData(),p)}}return this.set(o||"query",Object.toQueryString(p))},clearData:function(a){return this.set(a||"query","")},toString:f,valueOf:f});g.regs={endSlash:/\/$/,scheme:/^(\w+):/,directoryDot:/\.\/|\.$/};g.base=new g(Array.from(document.getElements("base[href]",true)).getLast(),{base:document.location});String.implement({toURI:function(a){return new g(this,a)}})})();URI=Class.refactor(URI,{combine:function(z,B){if(!B||z.scheme!=B.scheme||z.host!=B.host||z.port!=B.port){return this.previous.apply(this,arguments)}var u=z.file+(z.query?"?"+z.query:"")+(z.fragment?"#"+z.fragment:"");if(!B.directory){return(z.directory||(z.file?"":"./"))+u}var C=B.directory.split("/"),D=z.directory.split("/"),F="",E;var r=0;for(E=0;E<C.length&&E<D.length&&C[E]==D[E];E++){}for(r=0;r<C.length-E-1;r++){F+="../"}for(r=E;r<D.length-1;r++){F+=D[r]+"/"}return(F||(z.file?"":"./"))+u},toAbsolute:function(b){b=new URI(b);if(b){b.set("directory","").set("file","")}return this.toRelative(b)},toRelative:function(b){return this.get("value",new URI(b))}});(function(){if(this.Hash){return}var b=this.Hash=new Type("Hash",function(a){if(typeOf(a)=="hash"){a=Object.clone(a.getClean())}for(var g in a){this[g]=a[g]}return this});this.$H=function(a){return new b(a)};b.implement({forEach:function(a,g){Object.forEach(this,a,g)},getClean:function(){var g={};for(var a in this){if(this.hasOwnProperty(a)){g[a]=this[a]}}return g},getLength:function(){var g=0;for(var a in this){if(this.hasOwnProperty(a)){g++}}return g}});b.alias("each","forEach");b.implement({has:Object.prototype.hasOwnProperty,keyOf:function(a){return Object.keyOf(this,a)},hasValue:function(a){return Object.contains(this,a)},extend:function(a){b.each(a||{},function(j,l){b.set(this,l,j)},this);return this},combine:function(a){b.each(a||{},function(j,l){b.include(this,l,j)},this);return this},erase:function(a){if(this.hasOwnProperty(a)){delete this[a]}return this},get:function(a){return(this.hasOwnProperty(a))?this[a]:null},set:function(a,g){if(!this[a]||this.hasOwnProperty(a)){this[a]=g}return this},empty:function(){b.each(this,function(g,a){delete this[a]},this);return this},include:function(a,g){if(this[a]==undefined){this[a]=g}return this},map:function(a,g){return new b(Object.map(this,a,g))},filter:function(a,g){return new b(Object.filter(this,a,g))},every:function(a,g){return Object.every(this,a,g)},some:function(a,g){return Object.some(this,a,g)},getKeys:function(){return Object.keys(this)},getValues:function(){return Object.values(this)},toQueryString:function(a){return Object.toQueryString(this,a)}});b.alias({indexOf:"keyOf",contains:"hasValue"})})();Hash.implement({getFromPath:function(b){return Object.getFromPath(this,b)},cleanValues:function(b){return new Hash(Object.cleanValues(this,b))},run:function(){Object.run(arguments)}});Element.implement({tidy:function(){this.set("value",this.get("value").tidy())},getTextInRange:function(f,g){return this.get("value").substring(f,g)},getSelectedText:function(){if(this.setSelectionRange){return this.getTextInRange(this.getSelectionStart(),this.getSelectionEnd())}return document.selection.createRange().text},getSelectedRange:function(){if(this.selectionStart!=null){return{start:this.selectionStart,end:this.selectionEnd}}var p={start:0,end:0};var o=this.getDocument().selection.createRange();if(!o||o.parentElement()!=this){return p}var u=o.duplicate();if(this.type=="text"){p.start=0-u.moveStart("character",-100000);p.end=p.start+o.text.length}else{var l=this.get("value");var r=l.length;u.moveToElementText(this);u.setEndPoint("StartToEnd",o);if(u.text.length){r-=l.match(/[\n\r]*$/)[0].length}p.end=r-u.text.length;u.setEndPoint("StartToStart",o);p.start=r-u.text.length}return p},getSelectionStart:function(){return this.getSelectedRange().start},getSelectionEnd:function(){return this.getSelectedRange().end},setCaretPosition:function(b){if(b=="end"){b=this.get("value").length}this.selectRange(b,b);return this},getCaretPosition:function(){return this.getSelectedRange().start},selectRange:function(p,o){if(this.setSelectionRange){this.focus();this.setSelectionRange(p,o)}else{var u=this.get("value");var r=u.substr(p,o-p).replace(/\r/g,"").length;p=u.substr(0,p).replace(/\r/g,"").length;var l=this.createTextRange();l.collapse(true);l.moveEnd("character",p+r);l.moveStart("character",p);l.select()}return this},insertAtCursor:function(j,l){var o=this.getSelectedRange();var p=this.get("value");this.set("value",p.substring(0,o.start)+j+p.substring(o.end,p.length));if(l!==false){this.selectRange(o.start,o.start+j.length)}else{this.setCaretPosition(o.start+j.length)}return this},insertAroundCursor:function(p,u){p=Object.append({before:"",defaultMiddle:"",after:""},p);var C=this.getSelectedText()||p.defaultMiddle;var D=this.getSelectedRange();var r=this.get("value");if(D.start==D.end){this.set("value",r.substring(0,D.start)+p.before+C+p.after+r.substring(D.end,r.length));this.selectRange(D.start+p.before.length,D.end+p.before.length+C.length)}else{var B=r.substring(D.start,D.end);this.set("value",r.substring(0,D.start)+p.before+B+p.after+r.substring(D.end,r.length));var z=D.start+p.before.length;if(u!==false){this.selectRange(z,z+B.length)}else{this.setCaretPosition(z+r.length)}}return this}});Elements.from=function(p,r){if(r||r==null){p=p.stripScripts()}var l,u=p.match(/^\s*<(t[dhr]|tbody|tfoot|thead)/i);if(u){l=new Element("table");var o=u[1].toLowerCase();if(["td","th","tr"].contains(o)){l=new Element("tbody").inject(l);if(o!="tr"){l=new Element("tr").inject(l)}}}return(l||new Element("div")).set("html",p).getChildren()};(function(){var f={once:function(b,a,l){a.apply(this,l);this.removeEvent(b.original,a)}};Event.definePseudo=function(b,a,l){f[b]=[a,l]};var g=Element.prototype;[Element,Window,Document].invoke("implement",Events.Pseudos(f,g.addEvent,g.removeEvent))})();(function(){var g="$moo:keys-pressed",f="$moo:keys-keyup";Event.definePseudo("keys",function(z,b,B){var D=B[0],a=[],C=this.retrieve(g,[]);a.append(z.value.replace("++",function(){a.push("+");return""}).split("+"));C.include(D.key);if(a.every(function(j){return C.contains(j)})){b.apply(this,B)}this.store(g,C);if(!this.retrieve(f)){var u=function(j){(function(){C=this.retrieve(g,[]).erase(j.key);this.store(g,C)}).delay(0,this)};this.store(f,u).addEvent("keyup",u)}});Object.append(Event.Keys,{shift:16,control:17,alt:18,capslock:20,pageup:33,pagedown:34,end:35,home:36,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":Browser.firefox?109:189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,"+":107})})();Event.definePseudo("relay",function(C,B,r,D){var z=r[0];var u=D?D.condition:null;for(var E=z.target;E&&E!=this;E=E.parentNode){var F=document.id(E);if(Slick.match(E,C.value)&&(!u||u.call(F,z))){if(F){B.call(F,z,F)}return}}},{mouseenter:{base:"mouseover",condition:Element.Events.mouseenter.condition},mouseleave:{base:"mouseout",condition:Element.Events.mouseleave.condition}});(function(){var g=function(b,l){var a=[];Object.each(l,function(j){Object.each(j,function(p){b.each(function(o){a.push(o+"-"+p+(o=="border"?"-width":""))})})});return a};var f=function(a,b){var l=0;Object.each(b,function(p,j){if(j.test(a)){l=l+p.toInt()}});return l};Element.implement({measure:function(C){var z=function(j){return !!(!j||j.offsetHeight||j.offsetWidth)};if(z(this)){return C.apply(this)}var D=this.getParent(),u=[],b=[];while(!z(D)&&D!=document.body){b.push(D.expose());D=D.getParent()}var a=this.expose();var B=C.apply(this);a();b.each(function(j){j()});return B},expose:function(){if(this.getStyle("display")!="none"){return function(){}}var a=this.style.cssText;this.setStyles({display:"block",position:"absolute",visibility:"hidden"});return function(){this.style.cssText=a}.bind(this)},getDimensions:function(r){r=Object.merge({computeSize:false},r);var u={x:0,y:0};var a=function(j,l){return(l.computeSize)?j.getComputedSize(l):j.getSize()};var p=this.getParent("body");if(p&&this.getStyle("display")=="none"){u=this.measure(function(){return a(this,r)})}else{if(p){try{u=a(this,r)}catch(b){}}}return Object.append(u,(u.x||u.x===0)?{width:u.x,height:u.y}:{x:u.width,y:u.height})},getComputedSize:function(l){if(l&&l.plains){l.planes=l.plains}l=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},l);var a={},b={width:0,height:0};if(l.mode=="vertical"){delete b.width;delete l.planes.width}else{if(l.mode=="horizontal"){delete b.height;delete l.planes.height}}g(l.styles,l.planes).each(function(j){a[j]=this.getStyle(j).toInt()},this);Object.each(l.planes,function(u,j){var r=j.capitalize();a[j]=this.getStyle(j).toInt();b["total"+r]=a[j];u.each(function(o){var p=f(o,a);b["computed"+o.capitalize()]=p;b["total"+r]+=p})},this);return Object.append(b,a)}})})();(function(){var j=false,g=false;var l=function(){var a=new Element("div").setStyles({position:"fixed",top:0,right:0}).inject(document.body);j=(a.offsetTop===0);a.dispose();g=true};Element.implement({pin:function(D,F){if(!g){l()}if(this.getStyle("display")=="none"){return this}var J,I=window.getScroll();if(D!==false){J=this.getPosition(j?document.body:this.getOffsetParent());if(!this.retrieve("pin:_pinned")){var E={top:J.y-I.y,left:J.x-I.x};if(j&&!F){this.setStyle("position","fixed").setStyles(E)}else{var f=this.getOffsetParent(),a=this.getPosition(f),b=this.getStyles("left","top");if(f&&b.left=="auto"||b.top=="auto"){this.setPosition(a)}if(this.getStyle("position")=="static"){this.setStyle("position","absolute")}a={x:b.left.toInt()-I.x,y:b.top.toInt()-I.y};var G=function(){if(!this.retrieve("pin:_pinned")){return}var o=window.getScroll();this.setStyles({left:a.x+o.x,top:a.y+o.y})}.bind(this);this.store("pin:_scrollFixer",G);window.addEvent("scroll",G)}this.store("pin:_pinned",true)}}else{if(!this.retrieve("pin:_pinned")){return this}var f=this.getParent(),H=(f.getComputedStyle("position")!="static"?f:f.getOffsetParent());J=this.getPosition(H);this.store("pin:_pinned",false);var G=this.retrieve("pin:_scrollFixer");if(!G){this.setStyles({position:"absolute",top:J.y+I.y,left:J.x+I.x})}else{this.store("pin:_scrollFixer",null);window.removeEvent("scroll",G)}this.removeClass("isPinned")}return this},unpin:function(){return this.pin(false)},togglepin:function(){return this.pin(!this.retrieve("pin:_pinned"))}})})();(function(){var b=Element.prototype.position;Element.implement({position:function(V){if(V&&(V.x!=null||V.y!=null)){return b?b.apply(this,arguments):this}Object.each(V||{},function(f,g){if(f==null){delete V[g]}});V=Object.merge({relativeTo:document.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},V);var K={x:0,y:0},Y=false;var aa=this.measure(function(){return document.id(this.getOffsetParent())});if(aa&&aa!=this.getDocument().body){K=aa.measure(function(){return this.getPosition()});Y=aa!=document.id(V.relativeTo);V.offset.x=V.offset.x-K.x;V.offset.y=V.offset.y-K.y}var J=function(g){if(typeOf(g)!="string"){return g}g=g.toLowerCase();var f={};if(g.test("left")){f.x="left"}else{if(g.test("right")){f.x="right"}else{f.x="center"}}if(g.test("upper")||g.test("top")){f.y="top"}else{if(g.test("bottom")){f.y="bottom"}else{f.y="center"}}return f};V.edge=J(V.edge);V.position=J(V.position);if(!V.edge){if(V.position.x=="center"&&V.position.y=="center"){V.edge={x:"center",y:"center"}}else{V.edge={x:"left",y:"top"}}}this.setStyle("position","absolute");var W=document.id(V.relativeTo)||document.body,Z=W==document.body?window.getScroll():W.getPosition(),T=Z.y,U=Z.x;var Q=this.getDimensions({computeSize:true,styles:["padding","border","margin"]});var O={},P=V.offset.y,M=V.offset.x,a=window.getSize();switch(V.position.x){case"left":O.x=U+M;break;case"right":O.x=U+M+W.offsetWidth;break;default:O.x=U+((W==document.body?a.x:W.offsetWidth)/2)+M;break}switch(V.position.y){case"top":O.y=T+P;break;case"bottom":O.y=T+P+W.offsetHeight;break;default:O.y=T+((W==document.body?a.y:W.offsetHeight)/2)+P;break}if(V.edge){var ab={};switch(V.edge.x){case"left":ab.x=0;break;case"right":ab.x=-Q.x-Q.computedRight-Q.computedLeft;break;default:ab.x=-(Q.totalWidth/2);break}switch(V.edge.y){case"top":ab.y=0;break;case"bottom":ab.y=-Q.y-Q.computedTop-Q.computedBottom;break;default:ab.y=-(Q.totalHeight/2);break}O.x+=ab.x;O.y+=ab.y}O={left:((O.x>=0||Y||V.allowNegative)?O.x:0).toInt(),top:((O.y>=0||Y||V.allowNegative)?O.y:0).toInt()};var S={left:"x",top:"y"};["minimum","maximum"].each(function(f){["left","top"].each(function(g){var j=V[f]?V[f][S[g]]:null;if(j!=null&&((f=="minimum")?O[g]<j:O[g]>j)){O[g]=j}})});if(W.getStyle("position")=="fixed"||V.relFixedPosition){var R=window.getScroll();O.top+=R.y;O.left+=R.x}if(V.ignoreScroll){var N=W.getScroll();O.top-=N.y;O.left-=N.x}if(V.ignoreMargins){O.left+=(V.edge.x=="right"?Q["margin-right"]:V.edge.x=="center"?-Q["margin-left"]+((Q["margin-right"]+Q["margin-left"])/2):-Q["margin-left"]);O.top+=(V.edge.y=="bottom"?Q["margin-bottom"]:V.edge.y=="center"?-Q["margin-top"]+((Q["margin-bottom"]+Q["margin-top"])/2):-Q["margin-top"])}O.left=Math.ceil(O.left);O.top=Math.ceil(O.top);if(V.returnPos){return O}else{this.setStyles(O)}return this}})})();Element.implement({isDisplayed:function(){return this.getStyle("display")!="none"},isVisible:function(){var g=this.offsetWidth,f=this.offsetHeight;return(g==0&&f==0)?false:(g>0&&f>0)?true:this.style.display!="none"},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){var f;try{f=this.getStyle("display")}catch(g){}if(f=="none"){return this}return this.store("element:_originalDisplay",f||"").setStyle("display","none")},show:function(b){if(!b&&this.isDisplayed()){return this}b=b||this.retrieve("element:_originalDisplay")||"block";return this.setStyle("display",(b=="none")?"block":b)},swapClass:function(g,f){return this.removeClass(g).addClass(f)}});Document.implement({clearSelection:function(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var b=window.getSelection();if(b&&b.removeAllRanges){b.removeAllRanges()}}}}});var IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:false,zIndex:null,margin:0,offset:{x:0,y:0},browsers:((Browser.ie&&Browser.version==6)||(Browser.firefox&&Browser.version<3&&Browser.Platform.mac))},property:"IframeShim",initialize:function(f,g){this.element=document.id(f);if(this.occlude()){return this.occluded}this.setOptions(g);this.makeShim();return this},makeShim:function(){if(this.options.browsers){var l=this.element.getStyle("zIndex").toInt();if(!l){l=1;var g=this.element.getStyle("position");if(g=="static"||!g){this.element.setStyle("position","relative")}this.element.setStyle("zIndex",l)}l=((this.options.zIndex!=null||this.options.zIndex===0)&&l>this.options.zIndex)?this.options.zIndex:l-1;if(l<0){l=1}this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:l,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":this.options.className}).store("IframeShim",this);var j=(function(){this.shim.inject(this.element,"after");this[this.options.display?"show":"hide"]();this.fireEvent("inject")}).bind(this);if(!IframeShim.ready){window.addEvent("load",j)}else{j()}}else{this.position=this.hide=this.show=this.dispose=Function.from(this)}},position:function(){if(!IframeShim.ready||!this.shim){return this}var b=this.element.measure(function(){return this.getSize()});if(this.options.margin!=undefined){b.x=b.x-(this.options.margin*2);b.y=b.y-(this.options.margin*2);this.options.offset.x+=this.options.margin;this.options.offset.y+=this.options.margin}this.shim.set({width:b.x,height:b.y}).position({relativeTo:this.element,offset:this.options.offset});return this},hide:function(){if(this.shim){this.shim.setStyle("display","none")}return this},show:function(){if(this.shim){this.shim.setStyle("display","block")}return this.position()},dispose:function(){if(this.shim){this.shim.dispose()}return this},destroy:function(){if(this.shim){this.shim.destroy()}return this}});window.addEvent("load",function(){IframeShim.ready=true});var Mask=new Class({Implements:[Options,Events],Binds:["position"],options:{style:{},"class":"mask",maskMargins:false,useIframeShim:true,iframeShimOptions:{}},initialize:function(f,g){this.target=document.id(f)||document.id(document.body);this.target.store("mask",this);this.setOptions(g);this.render();this.inject()},render:function(){this.element=new Element("div",{"class":this.options["class"],id:this.options.id||"mask-"+String.uniqueID(),styles:Object.merge(this.options.style,{display:"none"}),events:{click:function(){this.fireEvent("click");if(this.options.hideOnClick){this.hide()}}.bind(this)}});this.hidden=true},toElement:function(){return this.element},inject:function(f,g){g=g||(this.options.inject?this.options.inject.where:"")||this.target==document.body?"inside":"after";f=f||(this.options.inject?this.options.inject.target:"")||this.target;this.element.inject(f,g);if(this.options.useIframeShim){this.shim=new IframeShim(this.element,this.options.iframeShimOptions);this.addEvents({show:this.shim.show.bind(this.shim),hide:this.shim.hide.bind(this.shim),destroy:this.shim.destroy.bind(this.shim)})}},position:function(){this.resize(this.options.width,this.options.height);this.element.position({relativeTo:this.target,position:"topLeft",ignoreMargins:!this.options.maskMargins,ignoreScroll:this.target==document.body});return this},resize:function(o,p){var l={styles:["padding","border"]};if(this.options.maskMargins){l.styles.push("margin")}var r=this.target.getComputedSize(l);if(this.target==document.body){var u=window.getScrollSize();if(r.totalHeight<u.y){r.totalHeight=u.y}if(r.totalWidth<u.x){r.totalWidth=u.x}}this.element.setStyles({width:Array.pick([o,r.totalWidth,r.x]),height:Array.pick([p,r.totalHeight,r.y])});return this},show:function(){if(!this.hidden){return this}window.addEvent("resize",this.position);this.position();this.showMask.apply(this,arguments);return this},showMask:function(){this.element.setStyle("display","block");this.hidden=false;this.fireEvent("show")},hide:function(){if(this.hidden){return this}window.removeEvent("resize",this.position);this.hideMask.apply(this,arguments);if(this.options.destroyOnHide){return this.destroy()}return this},hideMask:function(){this.element.setStyle("display","none");this.hidden=true;this.fireEvent("hide")},toggle:function(){this[this.hidden?"show":"hide"]()},destroy:function(){this.hide();this.element.destroy();this.fireEvent("destroy");this.target.eliminate("mask")}});Element.Properties.mask={set:function(f){var g=this.retrieve("mask");if(g){g.destroy()}return this.eliminate("mask").store("mask:options",f)},get:function(){var b=this.retrieve("mask");if(!b){b=new Mask(this,this.retrieve("mask:options"));this.store("mask",b)}return b}};Element.implement({mask:function(b){if(b){this.set("mask",b)}this.get("mask").show();return this},unmask:function(){this.get("mask").hide();return this}});var Spinner=new Class({Extends:Mask,Implements:Chain,options:{"class":"spinner",containerPosition:{},content:{"class":"spinner-content"},messageContainer:{"class":"spinner-msg"},img:{"class":"spinner-img"},fxOptions:{link:"chain"}},initialize:function(l,j){this.target=document.id(l)||document.id(document.body);this.target.store("spinner",this);this.setOptions(j);this.render();this.inject();var g=function(){this.active=false}.bind(this);this.addEvents({hide:g,show:g})},render:function(){this.parent();this.element.set("id",this.options.id||"spinner-"+String.uniqueID());this.content=document.id(this.options.content)||new Element("div",this.options.content);this.content.inject(this.element);if(this.options.message){this.msg=document.id(this.options.message)||new Element("p",this.options.messageContainer).appendText(this.options.message);this.msg.inject(this.content)}if(this.options.img){this.img=document.id(this.options.img)||new Element("div",this.options.img);this.img.inject(this.content)}this.element.set("tween",this.options.fxOptions)},show:function(b){if(this.active){return this.chain(this.show.bind(this))}if(!this.hidden){this.callChain.delay(20,this);return this}this.active=true;return this.parent(b)},showMask:function(g){var f=function(){this.content.position(Object.merge({relativeTo:this.element},this.options.containerPosition))}.bind(this);if(g){this.parent();f()}else{if(!this.options.style.opacity){this.options.style.opacity=this.element.getStyle("opacity").toFloat()}this.element.setStyles({display:"block",opacity:0}).tween("opacity",this.options.style.opacity);f();this.hidden=false;this.fireEvent("show");this.callChain()}},hide:function(b){if(this.active){return this.chain(this.hide.bind(this))}if(this.hidden){this.callChain.delay(20,this);return this}this.active=true;return this.parent(b)},hideMask:function(b){if(b){return this.parent()}this.element.tween("opacity",0).get("tween").chain(function(){this.element.setStyle("display","none");this.hidden=true;this.fireEvent("hide");this.callChain()}.bind(this))},destroy:function(){this.content.destroy();this.parent();this.target.eliminate("spinner")}});Request=Class.refactor(Request,{options:{useSpinner:false,spinnerOptions:{},spinnerTarget:false},initialize:function(b){this._send=this.send;this.send=function(a){var g=this.getSpinner();if(g){g.chain(this._send.pass(a,this)).show()}else{this._send(a)}return this};this.previous(b)},getSpinner:function(){if(!this.spinner){var f=document.id(this.options.spinnerTarget)||document.id(this.options.update);if(this.options.useSpinner&&f){f.set("spinner",this.options.spinnerOptions);var g=this.spinner=f.get("spinner");["complete","exception","cancel"].each(function(a){this.addEvent(a,g.hide.bind(g))},this)}}return this.spinner}});Element.Properties.spinner={set:function(g){var f=this.retrieve("spinner");if(f){f.destroy()}return this.eliminate("spinner").store("spinner:options",g)},get:function(){var b=this.retrieve("spinner");if(!b){b=new Spinner(this,this.retrieve("spinner:options"));this.store("spinner",b)}return b}};Element.implement({spin:function(b){if(b){this.set("spinner",b)}this.get("spinner").show();return this},unspin:function(){this.get("spinner").hide();return this}});if(!window.Form){window.Form={}}(function(){Form.Request=new Class({Binds:["onSubmit","onFormValidate"],Implements:[Options,Events,Class.Occlude],options:{requestOptions:{evalScripts:true,useSpinner:true,emulation:false,link:"ignore"},sendButtonClicked:true,extraData:{},resetForm:true},property:"form.request",initialize:function(g,l,j){this.element=document.id(g);if(this.occlude()){return this.occluded}this.update=document.id(l);this.setOptions(j);this.makeRequest();if(this.options.resetForm){this.request.addEvent("success",function(){Function.attempt(function(){this.element.reset()}.bind(this));if(window.OverText){OverText.update()}}.bind(this))}this.attach()},toElement:function(){return this.element},makeRequest:function(){this.request=new Request.HTML(Object.merge({update:this.update,emulation:false,spinnerTarget:this.element,method:this.element.get("method")||"post"},this.options.requestOptions)).addEvents({success:function(j,o,p,l){["complete","success"].each(function(a){this.fireEvent(a,[this.update,j,o,p,l])},this)}.bind(this),failure:function(){this.fireEvent("complete",arguments).fireEvent("failure",arguments)}.bind(this),exception:function(){this.fireEvent("failure",arguments)}.bind(this)})},attach:function(g){g=g!=null?g:true;method=g?"addEvent":"removeEvent";this.element[method]("click:relay(button, input[type=submit])",this.saveClickedButton.bind(this));var f=this.element.retrieve("validator");if(f){f[method]("onFormValidate",this.onFormValidate)}else{this.element[method]("submit",this.onSubmit)}},detach:function(){this.attach(false);return this},enable:function(){this.attach();return this},disable:function(){this.detach();return this},onFormValidate:function(j,l,o){if(!o){return}var p=this.element.retrieve("validator");if(j||(p&&!p.options.stopOnFailure)){if(o&&o.stop){o.stop()}this.send()}},onSubmit:function(f){var g=this.element.retrieve("validator");if(g){this.element.removeEvent("submit",this.onSubmit);g.addEvent("onFormValidate",this.onFormValidate);this.element.validate();return}if(f){f.stop()}this.send()},saveClickedButton:function(g,f){if(!this.options.sendButtonClicked){return}if(!f.get("name")){return}this.options.extraData[f.get("name")]=f.get("value")||true;this.clickedCleaner=function(){delete this.options.extraData[f.get("name")];this.clickedCleaner=function(){}}.bind(this)},clickedCleaner:function(){},send:function(){var f=this.element.toQueryString().trim();var g=Object.toQueryString(this.options.extraData);if(f){f+="&"+g}else{f=g}this.fireEvent("send",[this.element,f.parseQueryString()]);this.request.send({data:f,url:this.element.get("action")});this.clickedCleaner();return this}});Element.Properties.formRequest={set:function(){var j=Array.link(arguments,{options:Type.isObject,update:Type.isElement,updateId:Type.isString});var l=j.update||j.updateId;var g=this.retrieve("form.request");if(l){if(g){g.update=document.id(l)}this.store("form.request:update",l)}if(j.options){if(g){g.setOptions(j.options)}this.store("form.request:options",j.options)}return this},get:function(){var g=Array.link(arguments,{options:Type.isObject,update:Type.isElement,updateId:Type.isString});var f=g.update||g.updateId;if(g.options||f||!this.retrieve("form.request")){if(g.options||!this.retrieve("form.request:options")){this.set("form.request",g.options)}if(f){this.set("form.request",f)}this.store("form.request",new Form.Request(this,this.retrieve("form.request:update"),this.retrieve("form.request:options")))}return this.retrieve("form.request")}};Element.implement({formUpdate:function(f,g){this.get("formRequest",f,g).send();return this}})})();Fx.Reveal=new Class({Extends:Fx.Morph,options:{link:"cancel",styles:["padding","border","margin"],transitionOpacity:!Browser.ie6,mode:"vertical",display:function(){return this.element.get("tag")!="tr"?"block":"table-row"},opacity:1,hideInputs:Browser.ie?"select, input, textarea, object, embed":null},dissolve:function(){if(!this.hiding&&!this.showing){if(this.element.getStyle("display")!="none"){this.hiding=true;this.showing=false;this.hidden=true;this.cssText=this.element.style.cssText;var l=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode});if(this.options.transitionOpacity){l.opacity=this.options.opacity}var g={};Object.each(l,function(a,b){g[b]=[a,0]});this.element.setStyles({display:Function.from(this.options.display).call(this),overflow:"hidden"});var j=this.options.hideInputs?this.element.getElements(this.options.hideInputs):null;if(j){j.setStyle("visibility","hidden")}this.$chain.unshift(function(){if(this.hidden){this.hiding=false;this.element.style.cssText=this.cssText;this.element.setStyle("display","none");if(j){j.setStyle("visibility","visible")}}this.fireEvent("hide",this.element);this.callChain()}.bind(this));this.start(g)}else{this.callChain.delay(10,this);this.fireEvent("complete",this.element);this.fireEvent("hide",this.element)}}else{if(this.options.link=="chain"){this.chain(this.dissolve.bind(this))}else{if(this.options.link=="cancel"&&!this.hiding){this.cancel();this.dissolve()}}}return this},reveal:function(){if(!this.showing&&!this.hiding){if(this.element.getStyle("display")=="none"){this.hiding=false;this.showing=true;this.hidden=false;this.cssText=this.element.style.cssText;var l;this.element.measure(function(){l=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode})}.bind(this));if(this.options.heightOverride!=null){l.height=this.options.heightOverride.toInt()}if(this.options.widthOverride!=null){l.width=this.options.widthOverride.toInt()}if(this.options.transitionOpacity){this.element.setStyle("opacity",0);l.opacity=this.options.opacity}var g={height:0,display:Function.from(this.options.display).call(this)};Object.each(l,function(a,b){g[b]=0});g.overflow="hidden";this.element.setStyles(g);var j=this.options.hideInputs?this.element.getElements(this.options.hideInputs):null;if(j){j.setStyle("visibility","hidden")}this.$chain.unshift(function(){this.element.style.cssText=this.cssText;this.element.setStyle("display",Function.from(this.options.display).call(this));if(!this.hidden){this.showing=false}if(j){j.setStyle("visibility","visible")}this.callChain();this.fireEvent("show",this.element)}.bind(this));this.start(l)}else{this.callChain();this.fireEvent("complete",this.element);this.fireEvent("show",this.element)}}else{if(this.options.link=="chain"){this.chain(this.reveal.bind(this))}else{if(this.options.link=="cancel"&&!this.showing){this.cancel();this.reveal()}}}return this},toggle:function(){if(this.element.getStyle("display")=="none"){this.reveal()}else{this.dissolve()}return this},cancel:function(){this.parent.apply(this,arguments);this.element.style.cssText=this.cssText;this.hiding=false;this.showing=false;return this}});Element.Properties.reveal={set:function(b){this.get("reveal").cancel().setOptions(b);return this},get:function(){var b=this.retrieve("reveal");if(!b){b=new Fx.Reveal(this);this.store("reveal",b)}return b}};Element.Properties.dissolve=Element.Properties.reveal;Element.implement({reveal:function(b){this.get("reveal").setOptions(b).reveal();return this},dissolve:function(b){this.get("reveal").setOptions(b).dissolve();return this},nix:function(g){var f=Array.link(arguments,{destroy:Type.isBoolean,options:Type.isObject});this.get("reveal").setOptions(g).dissolve().chain(function(){this[f.destroy?"destroy":"dispose"]()}.bind(this));return this},wink:function(){var f=Array.link(arguments,{duration:Type.isNumber,options:Type.isObject});var g=this.get("reveal").setOptions(f.options);g.reveal().chain(function(){(function(){g.dissolve()}).delay(f.duration||2000)})}});Form.Request.Append=new Class({Extends:Form.Request,options:{useReveal:true,revealOptions:{},inject:"bottom"},makeRequest:function(){this.request=new Request.HTML(Object.merge({url:this.element.get("action"),method:this.element.get("method")||"post",spinnerTarget:this.element},this.options.requestOptions,{evalScripts:false})).addEvents({success:function(p,D,u,r){var C;var B=Elements.from(u);if(B.length==1){C=B[0]}else{C=new Element("div",{styles:{display:"none"}}).adopt(B)}C.inject(this.update,this.options.inject);if(this.options.requestOptions.evalScripts){Browser.exec(r)}this.fireEvent("beforeEffect",C);var z=function(){this.fireEvent("success",[C,this.update,p,D,u,r])}.bind(this);if(this.options.useReveal){C.set("reveal",this.options.revealOptions).get("reveal").chain(z);C.reveal()}else{z()}}.bind(this),failure:function(b){this.fireEvent("failure",b)}.bind(this)})}});Locale.define("en-US","FormValidator",{required:"This field is required.",minLength:"Please enter at least {minLength} characters (you entered {length} characters).",maxLength:"Please enter no more than {maxLength} characters (you entered {length} characters).",integer:"Please enter an integer in this field. Numbers with decimals (e.g. 1.25) are not permitted.",numeric:'Please enter only numeric values in this field (i.e. "1" or "1.1" or "-1" or "-1.1").',digits:"Please use numbers and punctuation only in this field (for example, a phone number with dashes or dots is permitted).",alpha:"Please use only letters (a-z) within this field. No spaces or other characters are allowed.",alphanum:"Please use only letters (a-z) or numbers (0-9) in this field. No spaces or other characters are allowed.",dateSuchAs:"Please enter a valid date such as {date}",dateInFormatMDY:'Please enter a valid date such as MM/DD/YYYY (i.e. "12/31/1999")',email:'Please enter a valid email address. For example "fred@domain.com".',url:"Please enter a valid URL such as http://www.google.com.",currencyDollar:"Please enter a valid $ amount. For example $100.00 .",oneRequired:"Please enter something for at least one of these inputs.",errorPrefix:"Error: ",warningPrefix:"Warning: ",noSpace:"There can be no spaces in this input.",reqChkByNode:"No items are selected.",requiredChk:"This field is required.",reqChkByName:"Please select a {label}.",match:"This field needs to match the {matchName} field",startDate:"the start date",endDate:"the end date",currendDate:"the current date",afterDate:"The date should be the same or after {label}.",beforeDate:"The date should be the same or before {label}.",startMonth:"Please select a start month",sameMonth:"These two dates must be in the same month - you must change one or the other.",creditcard:"The credit card number entered is invalid. Please check the number and try again. {length} digits entered."});if(!window.Form){window.Form={}}var InputValidator=new Class({Implements:[Options],options:{errorMsg:"Validation failed.",test:function(b){return true}},initialize:function(f,g){this.setOptions(g);this.className=f},test:function(f,g){if(document.id(f)){return this.options.test(document.id(f),g||this.getProps(f))}else{return false}},getError:function(l,j){var g=this.options.errorMsg;if(typeOf(g)=="function"){g=g(document.id(l),j||this.getProps(l))}return g},getProps:function(b){if(!document.id(b)){return{}}return b.get("validatorProps")}});Element.Properties.validatorProps={set:function(b){return this.eliminate("$moo:validatorProps").store("$moo:validatorProps",b)},get:function(j){if(j){this.set(j)}if(this.retrieve("$moo:validatorProps")){return this.retrieve("$moo:validatorProps")}if(this.getProperty("$moo:validatorProps")){try{this.store("$moo:validatorProps",JSON.decode(this.getProperty("$moo:validatorProps")))}catch(l){return{}}}else{var g=this.get("class").split(" ").filter(function(a){return a.test(":")});if(!g.length){this.store("$moo:validatorProps",{})}else{j={};g.each(function(f){var b=f.split(":");if(b[1]){try{j[b[0]]=JSON.decode(b[1])}catch(a){}}});this.store("$moo:validatorProps",j)}}return this.retrieve("$moo:validatorProps")}};Form.Validator=new Class({Implements:[Options,Events],Binds:["onSubmit"],options:{fieldSelectors:"input, select, textarea",ignoreHidden:true,ignoreDisabled:true,useTitles:false,evaluateOnSubmit:true,evaluateFieldsOnBlur:true,evaluateFieldsOnChange:true,serial:true,stopOnFailure:true,warningPrefix:function(){return Form.Validator.getMsg("warningPrefix")||"Warning: "},errorPrefix:function(){return Form.Validator.getMsg("errorPrefix")||"Error: "}},initialize:function(f,g){this.setOptions(g);this.element=document.id(f);this.element.store("validator",this);this.warningPrefix=Function.from(this.options.warningPrefix)();this.errorPrefix=Function.from(this.options.errorPrefix)();if(this.options.evaluateOnSubmit){this.element.addEvent("submit",this.onSubmit)}if(this.options.evaluateFieldsOnBlur||this.options.evaluateFieldsOnChange){this.watchFields(this.getFields())}},toElement:function(){return this.element},getFields:function(){return(this.fields=this.element.getElements(this.options.fieldSelectors))},watchFields:function(b){b.each(function(a){if(this.options.evaluateFieldsOnBlur){a.addEvent("blur",this.validationMonitor.pass([a,false],this))}if(this.options.evaluateFieldsOnChange){a.addEvent("change",this.validationMonitor.pass([a,true],this))}},this)},validationMonitor:function(){clearTimeout(this.timer);this.timer=this.validateField.delay(50,this,arguments)},onSubmit:function(b){if(!this.validate(b)&&b){b.preventDefault()}else{this.reset()}},reset:function(){this.getFields().each(this.resetField,this);return this},validate:function(f){var g=this.getFields().map(function(a){return this.validateField(a,true)},this).every(function(a){return a});this.fireEvent("formValidate",[g,this.element,f]);if(this.options.stopOnFailure&&!g&&f){f.preventDefault()}return g},validateField:function(u,H){if(this.paused){return true}u=document.id(u);var E=!u.hasClass("validation-failed");var C,z;if(this.options.serial&&!H){C=this.element.getElement(".validation-failed");z=this.element.getElement(".warning")}if(u&&(!C||H||u.hasClass("validation-failed")||(C&&!this.options.serial))){var F=u.className.split(" ").some(function(a){return this.getValidator(a)},this);var B=[];u.className.split(" ").each(function(a){if(a&&!this.test(a,u)){B.include(a)}},this);E=B.length===0;if(F&&!u.hasClass("warnOnly")){if(E){u.addClass("validation-passed").removeClass("validation-failed");this.fireEvent("elementPass",u)}else{u.addClass("validation-failed").removeClass("validation-passed");this.fireEvent("elementFail",[u,B])}}if(!z){var D=u.className.split(" ").some(function(a){if(a.test("^warn-")||u.hasClass("warnOnly")){return this.getValidator(a.replace(/^warn-/,""))}else{return null}},this);u.removeClass("warning");var G=u.className.split(" ").map(function(a){if(a.test("^warn-")||u.hasClass("warnOnly")){return this.test(a.replace(/^warn-/,""),u,true)}else{return null}},this)}}return E},test:function(l,r,p){r=document.id(r);if((this.options.ignoreHidden&&!r.isVisible())||(this.options.ignoreDisabled&&r.get("disabled"))){return true}var o=this.getValidator(l);p=p!=null?p:false;if(r.hasClass("warnOnly")){p=true}var u=r.hasClass("ignoreValidation")||(o?o.test(r):true);if(o){this.fireEvent("elementValidate",[u,r,l,p])}if(p){return true}return u},resetField:function(b){b=document.id(b);if(b){b.className.split(" ").each(function(a){if(a.test("^warn-")){a=a.replace(/^warn-/,"")}b.removeClass("validation-failed");b.removeClass("warning");b.removeClass("validation-passed")},this)}return this},stop:function(){this.paused=true;return this},start:function(){this.paused=false;return this},ignoreField:function(g,f){g=document.id(g);if(g){this.enforceField(g);if(f){g.addClass("warnOnly")}else{g.addClass("ignoreValidation")}}return this},enforceField:function(b){b=document.id(b);if(b){b.removeClass("warnOnly").removeClass("ignoreValidation")}return this}});Form.Validator.getMsg=function(b){return Locale.get("FormValidator."+b)};Form.Validator.adders={validators:{},add:function(f,g){this.validators[f]=new InputValidator(f,g);if(!this.initialize){this.implement({validators:this.validators})}},addAllThese:function(b){Array.from(b).each(function(a){this.add(a[0],a[1])},this)},getValidator:function(b){return this.validators[b.split(":")[0]]}};Object.append(Form.Validator,Form.Validator.adders);Form.Validator.implement(Form.Validator.adders);Form.Validator.add("IsEmpty",{errorMsg:false,test:function(b){if(b.type=="select-one"||b.type=="select"){return !(b.selectedIndex>=0&&b.options[b.selectedIndex].value!="")}else{return((b.get("value")==null)||(b.get("value").length==0))}}});Form.Validator.addAllThese([["required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(b){return !Form.Validator.getValidator("IsEmpty").test(b)}}],["minLength",{errorMsg:function(g,f){if(typeOf(f.minLength)!="null"){return Form.Validator.getMsg("minLength").substitute({minLength:f.minLength,length:g.get("value").length})}else{return""}},test:function(g,f){if(typeOf(f.minLength)!="null"){return(g.get("value").length>=(f.minLength||0))}else{return true}}}],["maxLength",{errorMsg:function(g,f){if(typeOf(f.maxLength)!="null"){return Form.Validator.getMsg("maxLength").substitute({maxLength:f.maxLength,length:g.get("value").length})}else{return""}},test:function(g,f){return(g.get("value").length<=(f.maxLength||10000))}}],["validate-integer",{errorMsg:Form.Validator.getMsg.pass("integer"),test:function(b){return Form.Validator.getValidator("IsEmpty").test(b)||(/^(-?[1-9]\d*|0)$/).test(b.get("value"))}}],["validate-numeric",{errorMsg:Form.Validator.getMsg.pass("numeric"),test:function(b){return Form.Validator.getValidator("IsEmpty").test(b)||(/^-?(?:0$0(?=\d*\.)|[1-9]|0)\d*(\.\d+)?$/).test(b.get("value"))}}],["validate-digits",{errorMsg:Form.Validator.getMsg.pass("digits"),test:function(b){return Form.Validator.getValidator("IsEmpty").test(b)||(/^[\d() .:\-\+#]+$/.test(b.get("value")))}}],["validate-alpha",{errorMsg:Form.Validator.getMsg.pass("alpha"),test:function(b){return Form.Validator.getValidator("IsEmpty").test(b)||(/^[a-zA-Z]+$/).test(b.get("value"))}}],["validate-alphanum",{errorMsg:Form.Validator.getMsg.pass("alphanum"),test:function(b){return Form.Validator.getValidator("IsEmpty").test(b)||!(/\W/).test(b.get("value"))}}],["validate-date",{errorMsg:function(j,g){if(Date.parse){var l=g.dateFormat||"%x";return Form.Validator.getMsg("dateSuchAs").substitute({date:new Date().format(l)})}else{return Form.Validator.getMsg("dateInFormatMDY")}},test:function(r,o){if(Form.Validator.getValidator("IsEmpty").test(r)){return true}var p;if(Date.parse){var u=o.dateFormat||"%x";p=Date.parse(r.get("value"));var z=p.format(u);if(z!="invalid date"){r.set("value",z)}return !isNaN(p)}else{var B=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!B.test(r.get("value"))){return false}p=new Date(r.get("value").replace(B,"$1/$2/$3"));return(parseInt(RegExp.$1,10)==(1+p.getMonth()))&&(parseInt(RegExp.$2,10)==p.getDate())&&(parseInt(RegExp.$3,10)==p.getFullYear())}}}],["validate-email",{errorMsg:Form.Validator.getMsg.pass("email"),test:function(b){return Form.Validator.getValidator("IsEmpty").test(b)||(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i).test(b.get("value"))}}],["validate-url",{errorMsg:Form.Validator.getMsg.pass("url"),test:function(b){return Form.Validator.getValidator("IsEmpty").test(b)||(/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i).test(b.get("value"))}}],["validate-currency-dollar",{errorMsg:Form.Validator.getMsg.pass("currencyDollar"),test:function(b){return Form.Validator.getValidator("IsEmpty").test(b)||(/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/).test(b.get("value"))}}],["validate-one-required",{errorMsg:Form.Validator.getMsg.pass("oneRequired"),test:function(j,g){var l=document.id(g["validate-one-required"])||j.getParent(g["validate-one-required"]);return l.getElements("input").some(function(a){if(["checkbox","radio"].contains(a.get("type"))){return a.get("checked")}return a.get("value")})}}]]);Element.Properties.validator={set:function(g){var f=this.retrieve("validator");if(f){f.setOptions(g)}return this.store("$moo:validator:options",g)},get:function(b){if(b||!this.retrieve("validator")){if(b||!this.retrieve("$moo:validator:options")){this.set("validator",b)}this.store("validator",new Form.Validator(this,this.retrieve("$moo:validator:options")))}return this.retrieve("validator")}};Element.implement({validate:function(b){if(b){this.set("validator",b)}return this.get("validator",b).validate()}});var FormValidator=Form.Validator;Form.Validator.Inline=new Class({Extends:Form.Validator,options:{showError:function(b){if(b.reveal){b.reveal()}else{b.setStyle("display","block")}},hideError:function(b){if(b.dissolve){b.dissolve()}else{b.setStyle("display","none")}},scrollToErrorsOnSubmit:true,scrollToErrorsOnBlur:false,scrollToErrorsOnChange:false,scrollFxOptions:{transition:"quad:out",offset:{y:-20}}},initialize:function(f,g){this.parent(f,g);this.addEvent("onElementValidate",function(B,a,b,z){var r=this.getValidator(b);if(!B&&r.getError(a)){if(z){a.addClass("warning")}var u=this.makeAdvice(b,a,r.getError(a),z);this.insertAdvice(u,a);this.showAdvice(b,a)}else{this.hideAdvice(b,a)}})},makeAdvice:function(B,u,C,D){var z=(D)?this.warningPrefix:this.errorPrefix;z+=(this.options.useTitles)?u.title||C:C;var r=(D)?"warning-advice":"validation-advice";var p=this.getAdvice(B,u);if(p){p=p.set("html",z)}else{p=new Element("div",{html:z,styles:{display:"none"},id:"advice-"+B.split(":")[0]+"-"+this.getFieldId(u)}).addClass(r)}u.store("$moo:advice-"+B,p);return p},getFieldId:function(b){return b.id?b.id:b.id="input_"+b.name},showAdvice:function(g,l){var j=this.getAdvice(g,l);if(j&&!l.retrieve("$moo:"+this.getPropName(g))&&(j.getStyle("display")=="none"||j.getStyle("visiblity")=="hidden"||j.getStyle("opacity")==0)){l.store("$moo:"+this.getPropName(g),true);this.options.showError(j);this.fireEvent("showAdvice",[l,j,g])}},hideAdvice:function(g,l){var j=this.getAdvice(g,l);if(j&&l.retrieve("$moo:"+this.getPropName(g))){l.store("$moo:"+this.getPropName(g),false);this.options.hideError(j);this.fireEvent("hideAdvice",[l,j,g])}},getPropName:function(b){return"advice"+b},resetField:function(b){b=document.id(b);if(!b){return this}this.parent(b);b.className.split(" ").each(function(a){this.hideAdvice(a,b)},this);return this},getAllAdviceMessages:function(o,p){var j=[];if(o.hasClass("ignoreValidation")&&!p){return j}var l=o.className.split(" ").some(function(f){var b=f.test("^warn-")||o.hasClass("warnOnly");if(b){f=f.replace(/^warn-/,"")}var a=this.getValidator(f);if(!a){return}j.push({message:a.getError(o),warnOnly:b,passed:a.test(),validator:a})},this);return j},getAdvice:function(g,f){return f.retrieve("$moo:advice-"+g)},insertAdvice:function(j,l){var g=l.get("validatorProps");if(!g.msgPos||!document.id(g.msgPos)){if(l.type&&l.type.toLowerCase()=="radio"){l.getParent().adopt(j)}else{j.inject(document.id(l),"after")}}else{document.id(g.msgPos).grab(j)}},validateField:function(D,u,p){var r=this.parent(D,u);if(((this.options.scrollToErrorsOnSubmit&&p==null)||p)&&!r){var C=document.id(this).getElement(".validation-failed");var B=document.id(this).getParent();while(B!=document.body&&B.getScrollSize().y==B.getSize().y){B=B.getParent()}var z=B.retrieve("$moo:fvScroller");if(!z&&window.Fx&&Fx.Scroll){z=new Fx.Scroll(B,this.options.scrollFxOptions);B.store("$moo:fvScroller",z)}if(C){if(z){z.toElement(C)}else{B.scrollTo(B.getScroll().x,C.getPosition(B).y-20)}}}return r},watchFields:function(b){b.each(function(a){if(this.options.evaluateFieldsOnBlur){a.addEvent("blur",this.validationMonitor.pass([a,false,this.options.scrollToErrorsOnBlur],this))}if(this.options.evaluateFieldsOnChange){a.addEvent("change",this.validationMonitor.pass([a,true,this.options.scrollToErrorsOnChange],this))}},this)}});Form.Validator.addAllThese([["validate-enforce-oncheck",{test:function(j,g){var l=j.getParent("form").retrieve("validator");if(!l){return true}(g.toEnforce||document.id(g.enforceChildrenOf).getElements("input, select, textarea")).map(function(a){if(j.checked){l.enforceField(a)}else{l.ignoreField(a);l.resetField(a)}});return true}}],["validate-ignore-oncheck",{test:function(j,g){var l=j.getParent("form").retrieve("validator");if(!l){return true}(g.toIgnore||document.id(g.ignoreChildrenOf).getElements("input, select, textarea")).each(function(a){if(j.checked){l.ignoreField(a);l.resetField(a)}else{l.enforceField(a)}});return true}}],["validate-nospace",{errorMsg:function(){return Form.Validator.getMsg("noSpace")},test:function(g,f){return !g.get("value").test(/\s/)}}],["validate-toggle-oncheck",{test:function(j,p){var o=j.getParent("form").retrieve("validator");if(!o){return true}var l=p.toToggle||document.id(p.toToggleChildrenOf).getElements("input, select, textarea");if(!j.checked){l.each(function(a){o.ignoreField(a);o.resetField(a)})}else{l.each(function(a){o.enforceField(a)})}return true}}],["validate-reqchk-bynode",{errorMsg:function(){return Form.Validator.getMsg("reqChkByNode")},test:function(g,f){return(document.id(f.nodeId).getElements(f.selector||"input[type=checkbox], input[type=radio]")).some(function(a){return a.checked})}}],["validate-required-check",{errorMsg:function(g,f){return f.useTitle?g.get("title"):Form.Validator.getMsg("requiredChk")},test:function(g,f){return !!g.checked}}],["validate-reqchk-byname",{errorMsg:function(g,f){return Form.Validator.getMsg("reqChkByName").substitute({label:f.label||g.get("type")})},test:function(l,r){var u=r.groupName||l.get("name");var o=$$(document.getElementsByName(u)).some(function(b,a){return b.checked});var p=l.getParent("form").retrieve("validator");if(o&&p){p.resetField(l)}return o}}],["validate-match",{errorMsg:function(g,f){return Form.Validator.getMsg("match").substitute({matchName:f.matchName||document.id(f.matchInput).get("name")})},test:function(j,p){var o=j.get("value");var l=document.id(p.matchInput)&&document.id(p.matchInput).get("value");return o&&l?o==l:true}}],["validate-after-date",{errorMsg:function(g,f){return Form.Validator.getMsg("afterDate").substitute({label:f.afterLabel||(f.afterElement?Form.Validator.getMsg("startDate"):Form.Validator.getMsg("currentDate"))})},test:function(j,p){var o=document.id(p.afterElement)?Date.parse(document.id(p.afterElement).get("value")):new Date();var l=Date.parse(j.get("value"));return l&&o?l>=o:true}}],["validate-before-date",{errorMsg:function(g,f){return Form.Validator.getMsg("beforeDate").substitute({label:f.beforeLabel||(f.beforeElement?Form.Validator.getMsg("endDate"):Form.Validator.getMsg("currentDate"))})},test:function(j,p){var o=Date.parse(j.get("value"));var l=document.id(p.beforeElement)?Date.parse(document.id(p.beforeElement).get("value")):new Date();return l&&o?l>=o:true}}],["validate-custom-required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(g,f){return g.get("value")!=f.emptyValue}}],["validate-same-month",{errorMsg:function(l,j){var p=document.id(j.sameMonthAs)&&document.id(j.sameMonthAs).get("value");var o=l.get("value");if(o!=""){return Form.Validator.getMsg(p?"sameMonth":"startMonth")}},test:function(l,j){var o=Date.parse(l.get("value"));var p=Date.parse(document.id(j.sameMonthAs)&&document.id(j.sameMonthAs).get("value"));return o&&p?o.format("%B")==p.format("%B"):true}}],["validate-cc-num",{errorMsg:function(g){var f=g.get("value").replace(/[^0-9]/g,"");return Form.Validator.getMsg("creditcard").substitute({length:f.length})},test:function(C){if(Form.Validator.getValidator("IsEmpty").test(C)){return true}var D=C.get("value");D=D.replace(/[^0-9]/g,"");var u=false;if(D.test(/^4[0-9]{12}([0-9]{3})?$/)){u="Visa"}else{if(D.test(/^5[1-5]([0-9]{14})$/)){u="Master Card"}else{if(D.test(/^3[47][0-9]{13}$/)){u="American Express"}else{if(D.test(/^6011[0-9]{12}$/)){u="Discover"}}}}if(u){var B=0;var z=0;for(var p=D.length-1;p>=0;--p){z=D.charAt(p).toInt();if(z==0){continue}if((D.length-p)%2==0){z+=z}if(z>9){z=z.toString().charAt(0).toInt()+z.toString().charAt(1).toInt()}B+=z}if((B%10)==0){return true}}var r="";while(D!=""){r+=" "+D.substr(0,4);D=D.substr(4)}C.getParent("form").retrieve("validator").ignoreField(C);C.set("value",r.clean());C.getParent("form").retrieve("validator").enforceField(C);return false}}]]);var OverText=new Class({Implements:[Options,Events,Class.Occlude],Binds:["reposition","assert","focus","hide"],options:{element:"label",positionOptions:{position:"upperLeft",edge:"upperLeft",offset:{x:4,y:2}},poll:false,pollInterval:250,wrap:false},property:"OverText",initialize:function(f,g){this.element=document.id(f);if(this.occlude()){return this.occluded}this.setOptions(g);this.attach(this.element);OverText.instances.push(this);if(this.options.poll){this.poll()}return this},toElement:function(){return this.element},attach:function(){var b=this.options.textOverride||this.element.get("alt")||this.element.get("title");if(!b){return}this.text=new Element(this.options.element,{"class":"overTxtLabel",styles:{lineHeight:"normal",position:"absolute",cursor:"text"},html:b,events:{click:this.hide.pass(this.options.element=="label",this)}}).inject(this.element,"after");if(this.options.element=="label"){if(!this.element.get("id")){this.element.set("id","input_"+new Date().getTime())}this.text.set("for",this.element.get("id"))}if(this.options.wrap){this.textHolder=new Element("div",{styles:{lineHeight:"normal",position:"relative"},"class":"overTxtWrapper"}).adopt(this.text).inject(this.element,"before")}return this.enable()},destroy:function(){this.element.eliminate("OverTextDiv").eliminate("OverText");this.disable();if(this.text){this.text.destroy()}if(this.textHolder){this.textHolder.destroy()}return this},disable:function(){this.element.removeEvents({focus:this.focus,blur:this.assert,change:this.assert});window.removeEvent("resize",this.reposition);this.hide(true,true);return this},enable:function(){this.element.addEvents({focus:this.focus,blur:this.assert,change:this.assert});window.addEvent("resize",this.reposition);this.assert(true);this.reposition();return this},wrap:function(){if(this.options.element=="label"){if(!this.element.get("id")){this.element.set("id","input_"+new Date().getTime())}this.text.set("for",this.element.get("id"))}},startPolling:function(){this.pollingPaused=false;return this.poll()},poll:function(g){if(this.poller&&!g){return this}var f=function(){if(!this.pollingPaused){this.assert(true)}}.bind(this);if(g){clearInterval(this.poller)}else{this.poller=f.periodical(this.options.pollInterval,this)}return this},stopPolling:function(){this.pollingPaused=true;return this.poll(true)},focus:function(){if(this.text&&(!this.text.isDisplayed()||this.element.get("disabled"))){return}this.hide()},hide:function(l,j){if(this.text&&(this.text.isDisplayed()&&(!this.element.get("disabled")||j))){this.text.hide();this.fireEvent("textHide",[this.text,this.element]);this.pollingPaused=true;if(!l){try{this.element.fireEvent("focus");this.element.focus()}catch(g){}}}return this},show:function(){if(this.text&&!this.text.isDisplayed()){this.text.show();this.reposition();this.fireEvent("textShow",[this.text,this.element]);this.pollingPaused=false}return this},assert:function(b){this[this.test()?"show":"hide"](b)},test:function(){var b=this.element.get("value");return !b},reposition:function(){this.assert(true);if(!this.element.isVisible()){return this.stopPolling().hide()}if(this.text&&this.test()){this.text.position(Object.merge(this.options.positionOptions,{relativeTo:this.element}))}return this}});OverText.instances=[];Object.append(OverText,{each:function(b){return OverText.instances.map(function(g,a){if(g.element&&g.text){return b.apply(OverText,[g,a])}return null})},update:function(){return OverText.each(function(b){return b.reposition()})},hideAll:function(){return OverText.each(function(b){return b.hide(true,true)})},showAll:function(){return OverText.each(function(b){return b.show()})}});if(window.Fx&&Fx.Reveal){Fx.Reveal.implement({hideInputs:Browser.ie?"select, input, textarea, object, embed, .overTxtLabel":false})}Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(f,g){this.elements=this.subject=$$(f);this.parent(g)},compute:function(z,p,H){var E={};for(var D in z){var G=z[D],C=p[D],B=E[D]={};for(var F in G){B[F]=this.parent(G[F],C[F],H)}}return E},set:function(j){for(var p in j){if(!this.elements[p]){continue}var l=j[p];for(var o in l){this.render(this.elements[p],o,l[o],this.options.unit)}}return this},start:function(E){if(!this.check(E)){return this}var p={},H={};for(var D in E){if(!this.elements[D]){continue}var B=E[D],G=p[D]={},z=H[D]={};for(var F in B){var C=this.prepare(this.elements[D],F,B[F]);G[F]=C.from;z[F]=C.to}}return this.parent(p,H)}});Fx.Accordion=new Class({Extends:Fx.Elements,options:{fixedHeight:false,fixedWidth:false,display:0,show:false,height:true,width:false,opacity:true,alwaysHide:false,trigger:"click",initialDisplayFx:true,returnHeightToAuto:true},initialize:function(){var o=function(a){return a!=null};var p=Array.link(arguments,{container:Type.isElement,options:Type.isObject,togglers:o,elements:o});this.parent(p.elements,p.options);this.togglers=$$(p.togglers);this.previous=-1;this.internalChain=new Chain();if(this.options.alwaysHide){this.options.wait=true}if(this.options.show||this.options.show===0){this.options.display=false;this.previous=this.options.show}if(this.options.start){this.options.display=false;this.options.show=false}this.effects={};if(this.options.opacity){this.effects.opacity="fullOpacity"}if(this.options.width){this.effects.width=this.options.fixedWidth?"fullWidth":"offsetWidth"}if(this.options.height){this.effects.height=this.options.fixedHeight?"fullHeight":"scrollHeight"}for(var j=0,l=this.togglers.length;j<l;j++){this.addSection(this.togglers[j],this.elements[j])}this.elements.each(function(a,b){if(this.options.show===b){this.fireEvent("active",[this.togglers[b],a])}else{for(var f in this.effects){a.setStyle(f,0)}}},this);if(this.options.display||this.options.display===0||this.options.initialDisplayFx===false){this.display(this.options.display,this.options.initialDisplayFx)}if(this.options.fixedHeight!==false){this.options.returnHeightToAuto=false}this.addEvent("complete",this.internalChain.callChain.bind(this.internalChain))},addSection:function(u,B){u=document.id(u);B=document.id(B);this.togglers.include(u);this.elements.include(B);var r=this.togglers.contains(u);var p=this.togglers.indexOf(u);var o=this.display.pass(p,this);u.store("accordion:display",o).addEvent(this.options.trigger,o);if(this.options.height){B.setStyles({"padding-top":0,"border-top":"none","padding-bottom":0,"border-bottom":"none"})}if(this.options.width){B.setStyles({"padding-left":0,"border-left":"none","padding-right":0,"border-right":"none"})}B.fullOpacity=1;if(this.options.fixedWidth){B.fullWidth=this.options.fixedWidth}if(this.options.fixedHeight){B.fullHeight=this.options.fixedHeight}B.setStyle("overflow","hidden");if(!r){for(var z in this.effects){B.setStyle(z,0)}}return this},removeSection:function(p,l){var o=this.togglers.indexOf(p);var u=this.elements[o];var r=function(){this.togglers.erase(p);this.elements.erase(u);this.detach(p)}.bind(this);if(this.now==o||l!=null){this.display(l!=null?l:(o-1>=0?o-1:0)).chain(r)}else{r()}return this},detach:function(f){var g=function(a){a.removeEvent(this.options.trigger,a.retrieve("accordion:display"))}.bind(this);if(!f){this.togglers.each(g)}else{g(f)}return this},display:function(o,l){if(!this.check(o,l)){return this}l=l!=null?l:true;o=(typeOf(o)=="element")?this.elements.indexOf(o):o;if(o==this.previous&&!this.options.alwaysHide){return this}if(this.options.returnHeightToAuto){var r=this.elements[this.previous];if(r&&!this.selfHidden){for(var u in this.effects){r.setStyle(u,r[this.effects[u]])}}}if((this.timer&&this.options.wait)||(o===this.previous&&!this.options.alwaysHide)){return this}this.previous=o;var p={};this.elements.each(function(f,g){p[g]={};var a;if(g!=o){a=true}else{if(this.options.alwaysHide&&((f.offsetHeight>0&&this.options.height)||f.offsetWidth>0&&this.options.width)){a=true;this.selfHidden=true}}this.fireEvent(a?"background":"active",[this.togglers[g],f]);for(var b in this.effects){p[g][b]=a?0:f[this.effects[b]]}},this);this.internalChain.clearChain();this.internalChain.chain(function(){if(this.options.returnHeightToAuto&&!this.selfHidden){var a=this.elements[o];if(a){a.setStyle("height","auto")}}}.bind(this));return l?this.start(p):this.set(p)}});var Accordion=new Class({Extends:Fx.Accordion,initialize:function(){this.parent.apply(this,arguments);var b=Array.link(arguments,{container:Type.isElement});this.container=b.container},addSection:function(u,l,p){u=document.id(u);l=document.id(l);var r=this.togglers.contains(u);var o=this.togglers.length;if(o&&(!r||p)){p=p!=null?p:o-1;u.inject(this.togglers[p],"before");l.inject(u,"after")}else{if(this.container&&!r){u.inject(this.container);l.inject(this.container)}}return this.parent.apply(this,arguments)}});Fx.Move=new Class({Extends:Fx.Morph,options:{relativeTo:document.body,position:"center",edge:false,offset:{x:0,y:0}},start:function(j){var g=this.element,l=g.getStyles("top","left");if(l.top=="auto"||l.left=="auto"){g.setPosition(g.getPosition(g.getOffsetParent()))}return this.parent(g.position(Object.merge(this.options,j,{returnPos:true})))}});Element.Properties.move={set:function(b){this.get("move").cancel().setOptions(b);return this},get:function(){var b=this.retrieve("move");if(!b){b=new Fx.Move(this,{link:"cancel"});this.store("move",b)}return b}};Element.implement({move:function(b){this.get("move").start(b);return this}});(function(){Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(p,a){this.element=this.subject=document.id(p);this.parent(a);if(typeOf(this.element)!="element"){this.element=document.id(this.element.getDocument().body)}if(this.options.wheelStops){var o=this.element,l=this.cancel.pass(false,this);this.addEvent("start",function(){o.addEvent("mousewheel",l)},true);this.addEvent("complete",function(){o.removeEvent("mousewheel",l)},true)}},set:function(){var a=Array.flatten(arguments);if(Browser.firefox){a=[Math.round(a[0]),Math.round(a[1])]}this.element.scrollTo(a[0]+this.options.offset.x,a[1]+this.options.offset.y)},compute:function(j,l,a){return[0,1].map(function(f){return Fx.compute(j[f],l[f],a)})},start:function(B,C){if(!this.check(B,C)){return this}var u=this.element,r=u.getScrollSize(),a=u.getScroll(),z=u.getSize();values={x:B,y:C};for(var D in values){if(!values[D]&&values[D]!==0){values[D]=a[D]}if(typeOf(values[D])!="number"){values[D]=r[D]-z[D]}values[D]+=this.options.offset[D]}return this.parent([a.x,a.y],[values.x,values.y])},toTop:function(){return this.start(false,0)},toLeft:function(){return this.start(0,false)},toRight:function(){return this.start("right",false)},toBottom:function(){return this.start(false,"bottom")},toElement:function(j){var l=document.id(j).getPosition(this.element),a=b(this.element)?{x:0,y:0}:this.element.getScroll();return this.start(l.x+a.x,l.y+a.y)},scrollIntoView:function(E,B,D){B=B?Array.from(B):["x","y"];E=document.id(E);var a={},C=E.getPosition(this.element),H=E.getSize(),z=this.element.getScroll(),G=this.element.getSize(),F={x:C.x+H.x,y:C.y+H.y};["x","y"].each(function(f){if(B.contains(f)){if(F[f]>z[f]+G[f]){a[f]=F[f]-G[f]}if(C[f]<z[f]){a[f]=C[f]}}if(a[f]==null){a[f]=z[f]}if(D&&D[f]){a[f]=a[f]+D[f]}},this);if(a.x!=z.x||a.y!=z.y){this.start(a.x,a.y)}return this},scrollToCenter:function(z,u,E){u=u?Array.from(u):["x","y"];z=document.id(z);var C={},D=z.getPosition(this.element),B=z.getSize(),a=this.element.getScroll(),F=this.element.getSize();["x","y"].each(function(f){if(u.contains(f)){C[f]=D[f]-(F[f]-B[f])/2}if(C[f]==null){C[f]=a[f]}if(E&&E[f]){C[f]=C[f]+E[f]}},this);if(C.x!=a.x||C.y!=a.y){this.start(C.x,C.y)}return this}});function b(a){return(/^(?:body|html)$/i).test(a.tagName)}})();Fx.Slide=new Class({Extends:Fx,options:{mode:"vertical",wrapper:false,hideOverflow:true,resetHeight:false},initialize:function(j,l){this.addEvent("complete",function(){this.open=(this.wrapper["offset"+this.layout.capitalize()]!=0);if(this.open&&this.options.resetHeight){this.wrapper.setStyle("height","")}},true);this.element=this.subject=document.id(j);this.parent(l);var o=this.element.retrieve("wrapper");var p=this.element.getStyles("margin","position","overflow");if(this.options.hideOverflow){p=Object.append(p,{overflow:"hidden"})}if(this.options.wrapper){o=document.id(this.options.wrapper).setStyles(p)}this.wrapper=o||new Element("div",{styles:p}).wraps(this.element);this.element.store("wrapper",this.wrapper).setStyle("margin",0);this.now=[];this.open=true},vertical:function(){this.margin="margin-top";this.layout="height";this.offset=this.element.offsetHeight},horizontal:function(){this.margin="margin-left";this.layout="width";this.offset=this.element.offsetWidth},set:function(b){this.element.setStyle(this.margin,b[0]);this.wrapper.setStyle(this.layout,b[1]);return this},compute:function(l,g,j){return[0,1].map(function(a){return Fx.compute(l[a],g[a],j)})},start:function(p,z){if(!this.check(p,z)){return this}this[z||this.options.mode]();var B=this.element.getStyle(this.margin).toInt();var C=this.wrapper.getStyle(this.layout).toInt();var u=[[B,C],[0,this.offset]];var D=[[B,C],[-this.offset,0]];var r;switch(p){case"in":r=u;break;case"out":r=D;break;case"toggle":r=(C==0)?u:D}return this.parent(r[0],r[1])},slideIn:function(b){return this.start("in",b)},slideOut:function(b){return this.start("out",b)},hide:function(b){this[b||this.options.mode]();this.open=false;return this.set([-this.offset,0])},show:function(b){this[b||this.options.mode]();this.open=true;return this.set([0,this.offset])},toggle:function(b){return this.start("toggle",b)}});Element.Properties.slide={set:function(b){this.get("slide").cancel().setOptions(b);return this},get:function(){var b=this.retrieve("slide");if(!b){b=new Fx.Slide(this,{link:"cancel"});this.store("slide",b)}return b}};Element.implement({slide:function(r,p){r=r||"toggle";var l=this.get("slide"),o;switch(r){case"hide":l.hide(p);break;case"show":l.show(p);break;case"toggle":var u=this.retrieve("slide:flag",l.open);l[u?"slideOut":"slideIn"](p);this.store("slide:flag",!u);o=true;break;default:l.start(r,p)}if(!o){this.eliminate("slide:flag")}return this}});var SmoothScroll=Fx.SmoothScroll=new Class({Extends:Fx.Scroll,initialize:function(u,r){r=r||document;this.doc=r.getDocument();this.parent(this.doc,u);var p=r.getWindow(),o=p.location.href.match(/^[^#]*/)[0]+"#",l=$$(this.options.links||this.doc.links);l.each(function(b){if(b.href.indexOf(o)!=0){return}var a=b.href.substr(o.length);if(a){this.useLink(b,a)}},this)},useLink:function(f,g){f.addEvent("click",function(a){var b=document.id(g)||this.doc.getElement("a[name="+g+"]");if(!b){return}a.preventDefault();this.toElement(b).chain(function(){this.fireEvent("scrolledTo",[f,b])}.bind(this))}.bind(this));return this}});Fx.Sort=new Class({Extends:Fx.Elements,options:{mode:"vertical"},initialize:function(f,g){this.parent(f,g);this.elements.each(function(a){if(a.getStyle("position")=="static"){a.setStyle("position","relative")}});this.setDefaultOrder()},setDefaultOrder:function(){this.currentOrder=this.elements.map(function(f,g){return g})},sort:function(){if(!this.check(arguments)){return this}var D=Array.flatten(arguments);var u=0,H=0,F={},z={},E=this.options.mode=="vertical";var C=this.elements.map(function(j,g){var l=j.getComputedSize({styles:["border","padding","margin"]});var f;if(E){f={top:u,margin:l["margin-top"],height:l.totalHeight};u+=f.height-l["margin-top"]}else{f={left:H,margin:l["margin-left"],width:l.totalWidth};H+=f.width}var a=E?"top":"left";z[g]={};var b=j.getStyle(a).toInt();z[g][a]=b||0;return f},this);this.set(z);D=D.map(function(a){return a.toInt()});if(D.length!=this.elements.length){this.currentOrder.each(function(a){if(!D.contains(a)){D.push(a)}});if(D.length>this.elements.length){D.splice(this.elements.length-1,D.length-this.elements.length)}}var G=u=H=0;D.each(function(f,a){var b={};if(E){b.top=u-C[f].top-G;u+=C[f].height}else{b.left=H-C[f].left;H+=C[f].width}G=G+C[f].margin;F[f]=b},this);var B={};Array.clone(D).sort().each(function(a){B[a]=F[a]});this.start(B);this.currentOrder=D;return this},rearrangeDOM:function(j){j=j||this.currentOrder;var g=this.elements[0].getParent();var l=[];this.elements.setStyle("opacity",0);j.each(function(a){l.push(this.elements[a].inject(g).setStyles({top:0,left:0}))},this);this.elements.setStyle("opacity",1);this.elements=$$(l);this.setDefaultOrder();return this},getDefaultOrder:function(){return this.elements.map(function(f,g){return g})},forward:function(){return this.sort(this.getDefaultOrder())},backward:function(){return this.sort(this.getDefaultOrder().reverse())},reverse:function(){return this.sort(this.currentOrder.reverse())},sortByElements:function(b){return this.sort(b.map(function(a){return this.elements.indexOf(a)},this))},swap:function(l,g){if(typeOf(l)=="element"){l=this.elements.indexOf(l)}if(typeOf(g)=="element"){g=this.elements.indexOf(g)}var j=Array.clone(this.currentOrder);j[this.currentOrder.indexOf(l)]=g;j[this.currentOrder.indexOf(g)]=l;return this.sort(j)}});var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:false,style:true,limit:false,handle:false,invert:false,preventDefault:false,stopPropagation:false,modifiers:{x:"left",y:"top"}},initialize:function(){var f=Array.link(arguments,{options:Type.isObject,element:function(a){return a!=null}});this.element=document.id(f.element);this.document=this.element.getDocument();this.setOptions(f.options||{});var g=typeOf(this.options.handle);this.handles=((g=="array"||g=="collection")?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.selection=(Browser.ie)?"selectstart":"mousedown";if(Browser.ie&&!Drag.ondragstartFixed){document.ondragstart=Function.from(false);Drag.ondragstartFixed=true}this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.from(false)};this.attach()},attach:function(){this.handles.addEvent("mousedown",this.bound.start);return this},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);return this},start:function(I){var J=this.options;if(I.rightClick){return}if(J.preventDefault){I.preventDefault()}if(J.stopPropagation){I.stopPropagation()}this.mouse.start=I.page;this.fireEvent("beforeStart",this.element);var G=J.limit;this.limit={x:[],y:[]};var z=this.element.getStyles("left","right","top","bottom");this._invert={x:J.modifiers.x=="left"&&z.left=="auto"&&!isNaN(z.right.toInt())&&(J.modifiers.x="right"),y:J.modifiers.y=="top"&&z.top=="auto"&&!isNaN(z.bottom.toInt())&&(J.modifiers.y="bottom")};var E,C;for(E in J.modifiers){if(!J.modifiers[E]){continue}var H=this.element.getStyle(J.modifiers[E]);if(H&&!H.match(/px$/)){if(!C){C=this.element.getCoordinates(this.element.getOffsetParent())}H=C[J.modifiers[E]]}if(J.style){this.value.now[E]=(H||0).toInt()}else{this.value.now[E]=this.element[J.modifiers[E]]}if(J.invert){this.value.now[E]*=-1}if(this._invert[E]){this.value.now[E]*=-1}this.mouse.pos[E]=I.page[E]-this.value.now[E];if(G&&G[E]){var F=2;while(F--){var D=G[E][F];if(D||D===0){this.limit[E][F]=(typeof D=="function")?D():D}}}}if(typeOf(this.options.grid)=="number"){this.options.grid={x:this.options.grid,y:this.options.grid}}var B={mousemove:this.bound.check,mouseup:this.bound.cancel};B[this.selection]=this.bound.eventStop;this.document.addEvents(B)},check:function(g){if(this.options.preventDefault){g.preventDefault()}var f=Math.round(Math.sqrt(Math.pow(g.page.x-this.mouse.start.x,2)+Math.pow(g.page.y-this.mouse.start.y,2)));if(f>this.options.snap){this.cancel();this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop});this.fireEvent("start",[this.element,g]).fireEvent("snap",this.element)}},drag:function(g){var j=this.options;if(j.preventDefault){g.preventDefault()}this.mouse.now=g.page;for(var l in j.modifiers){if(!j.modifiers[l]){continue}this.value.now[l]=this.mouse.now[l]-this.mouse.pos[l];if(j.invert){this.value.now[l]*=-1}if(this._invert[l]){this.value.now[l]*=-1}if(j.limit&&this.limit[l]){if((this.limit[l][1]||this.limit[l][1]===0)&&(this.value.now[l]>this.limit[l][1])){this.value.now[l]=this.limit[l][1]}else{if((this.limit[l][0]||this.limit[l][0]===0)&&(this.value.now[l]<this.limit[l][0])){this.value.now[l]=this.limit[l][0]}}}if(j.grid[l]){this.value.now[l]-=((this.value.now[l]-(this.limit[l][0]||0))%j.grid[l])}if(j.style){this.element.setStyle(j.modifiers[l],this.value.now[l]+j.unit)}else{this.element[j.modifiers[l]]=this.value.now[l]}}this.fireEvent("drag",[this.element,g])},cancel:function(b){this.document.removeEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});if(b){this.document.removeEvent(this.selection,this.bound.eventStop);this.fireEvent("cancel",this.element)}},stop:function(f){var g={mousemove:this.bound.drag,mouseup:this.bound.stop};g[this.selection]=this.bound.eventStop;this.document.removeEvents(g);if(f){this.fireEvent("complete",[this.element,f])}}});Element.implement({makeResizable:function(g){var f=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},g));this.store("resizer",f);return f.addEvent("drag",function(){this.fireEvent("resize",f)}.bind(this))}});Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:false,precalculate:false,includeMargins:true,checkDroppables:true},initialize:function(l,o){this.parent(l,o);l=this.element;this.droppables=$$(this.options.droppables);this.container=document.id(this.options.container);if(this.container&&typeOf(this.container)!="element"){this.container=document.id(this.container.getDocument().body)}if(this.options.style){if(this.options.modifiers.x=="left"&&this.options.modifiers.y=="top"){var p,u=l.getOffsetParent();var r=l.getStyles("left","top");if(u&&(r.left=="auto"||r.top=="auto")){l.setPosition(l.getPosition(u))}}if(l.getStyle("position")=="static"){l.setStyle("position","absolute")}}this.addEvent("start",this.checkDroppables,true);this.overed=null},start:function(b){if(this.container){this.options.limit=this.calculateLimit()}if(this.options.precalculate){this.positions=this.droppables.map(function(a){return a.getCoordinates()})}this.parent(b)},calculateLimit:function(){var U=this.element,O=this.container,P=document.id(U.getOffsetParent())||document.body,K=O.getCoordinates(P),Q={},S={},R={},M={},I={};["top","right","bottom","left"].each(function(a){Q[a]=U.getStyle("margin-"+a).toInt();S[a]=U.getStyle("border-"+a).toInt();R[a]=O.getStyle("margin-"+a).toInt();M[a]=O.getStyle("border-"+a).toInt();I[a]=P.getStyle("padding-"+a).toInt()},this);var N=U.offsetWidth+Q.left+Q.right,V=U.offsetHeight+Q.top+Q.bottom,H=0,J=0,W=K.right-M.right-N,T=K.bottom-M.bottom-V;if(this.options.includeMargins){H+=Q.left;J+=Q.top}else{W+=Q.right;T+=Q.bottom}if(U.getStyle("position")=="relative"){var G=U.getCoordinates(P);G.left-=U.getStyle("left").toInt();G.top-=U.getStyle("top").toInt();H-=G.left;J-=G.top;if(O.getStyle("position")!="relative"){H+=M.left;J+=M.top}W+=Q.left-G.left;T+=Q.top-G.top;if(O!=P){H+=R.left+I.left;J+=((Browser.ie6||Browser.ie7)?0:R.top)+I.top}}else{H-=Q.left;J-=Q.top;if(O!=P){H+=K.left+M.left;J+=K.top+M.top}}return{x:[H,W],y:[J,T]}},checkDroppables:function(){var b=this.droppables.filter(function(j,l){j=this.positions?this.positions[l]:j.getCoordinates();var a=this.mouse.now;return(a.x>j.left&&a.x<j.right&&a.y<j.bottom&&a.y>j.top)},this).getLast();if(this.overed!=b){if(this.overed){this.fireEvent("leave",[this.element,this.overed])}if(b){this.fireEvent("enter",[this.element,b])}this.overed=b}},drag:function(b){this.parent(b);if(this.options.checkDroppables&&this.droppables.length){this.checkDroppables()}},stop:function(b){this.checkDroppables();this.fireEvent("drop",[this.element,this.overed,b]);this.overed=null;return this.parent(b)}});Element.implement({makeDraggable:function(g){var f=new Drag.Move(this,g);this.store("dragger",f);return f}});var Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(b){if(this.options.snap){b=this.toPosition(this.step)}this.knob.setStyle(this.property,b)},initialStep:0,snap:false,offset:0,range:false,wheel:false,steps:100,mode:"horizontal"},initialize:function(u,r,z){this.setOptions(z);this.element=document.id(u);this.knob=document.id(r);this.previousChange=this.previousEnd=this.step=-1;var D,p={},B={x:false,y:false};switch(this.options.mode){case"vertical":this.axis="y";this.property="top";D="offsetHeight";break;case"horizontal":this.axis="x";this.property="left";D="offsetWidth"}this.full=this.element.measure(function(){this.half=this.knob[D]/2;return this.element[D]-this.knob[D]+(this.options.offset*2)}.bind(this));this.setRange(this.options.range);this.knob.setStyle("position","relative").setStyle(this.property,-this.options.offset);B[this.axis]=this.property;p[this.axis]=[-this.options.offset,this.full-this.options.offset];var C={snap:0,limit:p,modifiers:B,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:(function(){this.isDragging=true}).bind(this),onCancel:function(){this.isDragging=false}.bind(this),onComplete:function(){this.isDragging=false;this.draggedKnob();this.end()}.bind(this)};if(this.options.snap){C.grid=Math.ceil(this.stepWidth);C.limit[this.axis][1]=this.full}this.drag=new Drag(this.knob,C);this.attach();if(this.options.initialStep!=null){this.set(this.options.initialStep)}},attach:function(){this.element.addEvent("mousedown",this.clickedElement);if(this.options.wheel){this.element.addEvent("mousewheel",this.scrolledElement)}this.drag.attach();return this},detach:function(){this.element.removeEvent("mousedown",this.clickedElement);this.element.removeEvent("mousewheel",this.scrolledElement);this.drag.detach();return this},set:function(b){if(!((this.range>0)^(b<this.min))){b=this.min}if(!((this.range>0)^(b>this.max))){b=this.max}this.step=Math.round(b);this.checkStep();this.fireEvent("tick",this.toPosition(this.step));this.end();return this},setRange:function(g,f){this.min=Array.pick([g[0],0]);this.max=Array.pick([g[1],this.options.steps]);this.range=this.max-this.min;this.steps=this.options.steps||this.full;this.stepSize=Math.abs(this.range)/this.steps;this.stepWidth=this.stepSize*this.full/Math.abs(this.range);this.set(Array.pick([f,this.step]).floor(this.min).max(this.max));return this},clickedElement:function(l){if(this.isDragging||l.target==this.knob){return}var g=this.range<0?-1:1;var j=l.page[this.axis]-this.element.getPosition()[this.axis]-this.half;j=j.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+g*this.toStep(j));this.checkStep();this.fireEvent("tick",j);this.end()},scrolledElement:function(g){var f=(this.options.mode=="horizontal")?(g.wheel<0):(g.wheel>0);this.set(f?this.step-this.stepSize:this.step+this.stepSize);g.stop()},draggedKnob:function(){var f=this.range<0?-1:1;var g=this.drag.value.now[this.axis];g=g.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+f*this.toStep(g));this.checkStep()},checkStep:function(){if(this.previousChange!=this.step){this.previousChange=this.step;this.fireEvent("change",this.step)}},end:function(){if(this.previousEnd!==this.step){this.previousEnd=this.step;this.fireEvent("complete",this.step+"")}},toStep:function(g){var f=(g+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?Math.round(f-=f%this.stepSize):f},toPosition:function(b){return(this.full*Math.abs(this.min-b))/(this.steps*this.stepSize)-this.options.offset}});var Sortables=new Class({Implements:[Events,Options],options:{snap:4,opacity:1,clone:false,revert:false,handle:false,constrain:false,preventDefault:false},initialize:function(g,f){this.setOptions(f);this.elements=[];this.lists=[];this.idle=true;this.addLists($$(document.id(g)||g));if(!this.options.clone){this.options.revert=false}if(this.options.revert){this.effect=new Fx.Morph(null,Object.merge({duration:250,link:"cancel"},this.options.revert))}},attach:function(){this.addLists(this.lists);return this},detach:function(){this.lists=this.removeLists(this.lists);return this},addItems:function(){Array.flatten(arguments).each(function(g){this.elements.push(g);var f=g.retrieve("sortables:start",function(a){this.start.call(this,a,g)}.bind(this));(this.options.handle?g.getElement(this.options.handle)||g:g).addEvent("mousedown",f)},this);return this},addLists:function(){Array.flatten(arguments).each(function(b){this.lists.push(b);this.addItems(b.getChildren())},this);return this},removeItems:function(){return $$(Array.flatten(arguments).map(function(g){this.elements.erase(g);var f=g.retrieve("sortables:start");(this.options.handle?g.getElement(this.options.handle)||g:g).removeEvent("mousedown",f);return g},this))},removeLists:function(){return $$(Array.flatten(arguments).map(function(b){this.lists.erase(b);this.removeItems(b.getChildren());return b},this))},getClone:function(g,j){if(!this.options.clone){return new Element(j.tagName).inject(document.body)}if(typeOf(this.options.clone)=="function"){return this.options.clone.call(this,g,j,this.list)}var l=j.clone(true).setStyles({margin:0,position:"absolute",visibility:"hidden",width:j.getStyle("width")});if(l.get("html").test("radio")){l.getElements("input[type=radio]").each(function(b,a){b.set("name","clone_"+a);if(b.get("checked")){j.getElements("input[type=radio]")[a].set("checked",true)}})}return l.inject(this.list).setPosition(j.getPosition(j.getOffsetParent()))},getDroppables:function(){var b=this.list.getChildren().erase(this.clone).erase(this.element);if(!this.options.constrain){b.append(this.lists).erase(this.list)}return b},insert:function(l,g){var j="inside";if(this.lists.contains(g)){this.list=g;this.drag.droppables=this.getDroppables()}else{j=this.element.getAllPrevious().contains(g)?"before":"after"}this.element.inject(g,j);this.fireEvent("sort",[this.element,this.clone])},start:function(f,g){if(!this.idle||f.rightClick||["button","input"].contains(f.target.get("tag"))){return}this.idle=false;this.element=g;this.opacity=g.get("opacity");this.list=g.getParent();this.clone=this.getClone(f,g);this.drag=new Drag.Move(this.clone,{preventDefault:this.options.preventDefault,snap:this.options.snap,container:this.options.constrain&&this.element.getParent(),droppables:this.getDroppables(),onSnap:function(){f.stop();this.clone.setStyle("visibility","visible");this.element.set("opacity",this.options.opacity||0);this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.reset.bind(this),onComplete:this.end.bind(this)});this.clone.inject(this.element,"before");this.drag.start(f)},end:function(){this.drag.detach();this.element.set("opacity",this.opacity);if(this.effect){var g=this.element.getStyles("width","height");var f=this.clone.computePosition(this.element.getPosition(this.clone.getOffsetParent()));this.effect.element=this.clone;this.effect.start({top:f.top,left:f.left,width:g.width,height:g.height,opacity:0.25}).chain(this.reset.bind(this))}else{this.reset()}},reset:function(){this.idle=true;this.clone.destroy();this.fireEvent("complete",this.element)},serialize:function(){var l=Array.link(arguments,{modifier:Type.isFunction,index:function(a){return a!=null}});var g=this.lists.map(function(a){return a.getChildren().map(l.modifier||function(b){return b.get("id")},this)},this);var j=l.index;if(this.lists.length==1){j=0}return(j||j===0)&&j>=0&&j<this.lists.length?g[j]:g}});Request.JSONP=new Class({Implements:[Chain,Events,Options],options:{onRequest:function(b){if(this.options.log&&window.console&&console.log){console.log("JSONP retrieving script with url:"+b)}},onError:function(b){if(this.options.log&&window.console&&console.warn){console.warn("JSONP "+b+" will fail in Internet Explorer, which enforces a 2083 bytes length limit on URIs")}},url:"",callbackKey:"callback",injectScript:document.head,data:"",link:"ignore",timeout:0,log:false},initialize:function(b){this.setOptions(b)},send:function(B){if(!Request.prototype.check.call(this,B)){return this}this.running=true;var z=typeOf(B);if(z=="string"||z=="element"){B={data:B}}B=Object.merge(this.options,B||{});var u=B.data;switch(typeOf(u)){case"element":u=document.id(u).toQueryString();break;case"object":case"hash":u=Object.toQueryString(u)}var o=this.index=Request.JSONP.counter++;var r=B.url+(B.url.test("\\?")?"&":"?")+(B.callbackKey)+"=Request.JSONP.request_map.request_"+o+(u?"&"+u:"");if(r.length>2083){this.fireEvent("error",r)}var p=this.getScript(r).inject(B.injectScript);this.fireEvent("request",[p.get("src"),p]);Request.JSONP.request_map["request_"+o]=function(){this.success(arguments,o)}.bind(this);if(B.timeout){(function(){if(this.running){this.fireEvent("timeout",[p.get("src"),p]).fireEvent("failure").cancel()}}).delay(B.timeout,this)}return this},getScript:function(b){return this.script=new Element("script",{type:"text/javascript",src:b})},success:function(f,g){if(!this.running){return false}this.clear().fireEvent("complete",f).fireEvent("success",f).callChain()},cancel:function(){return this.running?this.clear().fireEvent("cancel"):this},isRunning:function(){return !!this.running},clear:function(){if(this.script){this.script.destroy()}this.running=false;return this}});Request.JSONP.counter=0;Request.JSONP.request_map={};Request.Queue=new Class({Implements:[Options,Events],Binds:["attach","request","complete","cancel","success","failure","exception"],options:{stopOnFailure:true,autoAdvance:true,concurrent:1,requests:{}},initialize:function(g){if(g){var f=g.requests;delete g.requests}this.setOptions(g);this.requests={};this.queue=[];this.reqBinders={};if(f){this.addRequests(f)}},addRequest:function(g,f){this.requests[g]=f;this.attach(g,f);return this},addRequests:function(b){Object.each(b,function(g,a){this.addRequest(a,g)},this);return this},getName:function(b){return Object.keyOf(this.requests,b)},attach:function(g,f){if(f._groupSend){return this}["request","complete","cancel","success","failure","exception"].each(function(a){if(!this.reqBinders[g]){this.reqBinders[g]={}}this.reqBinders[g][a]=function(){this["on"+a.capitalize()].apply(this,[g,f].append(arguments))}.bind(this);f.addEvent(a,this.reqBinders[g][a])},this);f._groupSend=f.send;f.send=function(a){this.send(g,a);return f}.bind(this);return this},removeRequest:function(f){var g=typeOf(f)=="object"?this.getName(f):f;if(!g&&typeOf(g)!="string"){return this}f=this.requests[g];if(!f){return this}["request","complete","cancel","success","failure","exception"].each(function(a){f.removeEvent(a,this.reqBinders[g][a])},this);f.send=f._groupSend;delete f._groupSend;return this},getRunning:function(){return Object.filter(this.requests,function(b){return b.running})},isRunning:function(){return !!(Object.keys(this.getRunning()).length)},send:function(g,j){var l=function(){this.requests[g]._groupSend(j);this.queue.erase(l)}.bind(this);l.name=g;if(Object.keys(this.getRunning()).length>=this.options.concurrent||(this.error&&this.options.stopOnFailure)){this.queue.push(l)}else{l()}return this},hasNext:function(b){return(!b)?!!this.queue.length:!!this.queue.filter(function(a){return a.name==b}).length},resume:function(){this.error=false;(this.options.concurrent-Object.keys(this.getRunning()).length).times(this.runNext,this);return this},runNext:function(g){if(!this.queue.length){return this}if(!g){this.queue[0]()}else{var f;this.queue.each(function(a){if(!f&&a.name==g){f=true;a()}})}return this},runAll:function(){this.queue.each(function(b){b()});return this},clear:function(b){if(!b){this.queue.empty()}else{this.queue=this.queue.map(function(a){if(a.name!=b){return a}else{return false}}).filter(function(a){return a})}return this},cancel:function(b){this.requests[b].cancel();return this},onRequest:function(){this.fireEvent("request",arguments)},onComplete:function(){this.fireEvent("complete",arguments);if(!this.queue.length){this.fireEvent("end")}},onCancel:function(){if(this.options.autoAdvance&&!this.error){this.runNext()}this.fireEvent("cancel",arguments)},onSuccess:function(){if(this.options.autoAdvance&&!this.error){this.runNext()}this.fireEvent("success",arguments)},onFailure:function(){this.error=true;if(!this.options.stopOnFailure&&this.options.autoAdvance){this.runNext()}this.fireEvent("failure",arguments)},onException:function(){this.error=true;if(!this.options.stopOnFailure&&this.options.autoAdvance){this.runNext()}this.fireEvent("exception",arguments)}});Request.implement({options:{initialDelay:5000,delay:5000,limit:60000},startTimer:function(f){var g=function(){if(!this.running){this.send({data:f})}};this.lastDelay=this.options.initialDelay;this.timer=g.delay(this.lastDelay,this);this.completeCheck=function(a){clearTimeout(this.timer);this.lastDelay=(a)?this.options.delay:(this.lastDelay+this.options.delay).min(this.options.limit);this.timer=g.delay(this.lastDelay,this)};return this.addEvent("complete",this.completeCheck)},stopTimer:function(){clearTimeout(this.timer);return this.removeEvent("complete",this.completeCheck)}});var Asset={javascript:function(r,l){l=Object.append({document:document},l);if(l.onLoad){l.onload=l.onLoad;delete l.onLoad}var o=new Element("script",{src:r,type:"text/javascript"});var u=l.onload||function(){},p=l.document;delete l.onload;delete l.document;return o.addEvents({load:u,readystatechange:function(){if(["loaded","complete"].contains(this.readyState)){u.call(this)}}}).set(l).inject(p.head)},css:function(g,j){j=j||{};var l=j.onload||j.onLoad;if(l){j.events=j.events||{};j.events.load=l;delete j.onload;delete j.onLoad}return new Element("link",Object.merge({rel:"stylesheet",media:"screen",type:"text/css",href:g},j)).inject(document.head)},image:function(p,j){j=Object.merge({onload:function(){},onabort:function(){},onerror:function(){}},j);var o=new Image();var l=document.id(o)||new Element("img");["load","abort","error"].each(function(b){var g="on"+b;var a=b.capitalize();if(j["on"+a]){j[g]=j["on"+a];delete j["on"+a]}var f=j[g];delete j[g];o[g]=function(){if(!o){return}if(!l.parentNode){l.width=o.width;l.height=o.height}o=o.onload=o.onabort=o.onerror=null;f.delay(1,l,l);l.fireEvent(b,l,1)}});o.src=l.src=p;if(o&&o.complete){o.onload.delay(1)}return l.set(j)},images:function(l,g){g=Object.merge({onComplete:function(){},onProgress:function(){},onError:function(){},properties:{}},g);l=Array.from(l);var j=0;return new Elements(l.map(function(a,b){return Asset.image(a,Object.append(g.properties,{onload:function(){j++;g.onProgress.call(this,j,b,a);if(j==l.length){g.onComplete()}},onerror:function(){j++;g.onError.call(this,j,b,a);if(j==l.length){g.onComplete()}}}))}))}};(function(){var b=this.Color=new Type("Color",function(l,j){if(arguments.length>=3){j="rgb";l=Array.slice(arguments,0,3)}else{if(typeof l=="string"){if(l.match(/rgb/)){l=l.rgbToHex().hexToRgb(true)}else{if(l.match(/hsb/)){l=l.hsbToRgb()}else{l=l.hexToRgb(true)}}}}j=j||"rgb";switch(j){case"hsb":var a=l;l=l.hsbToRgb();l.hsb=a;break;case"hex":l=l.hexToRgb(true);break}l.rgb=l.slice(0,3);l.hsb=l.hsb||l.rgbToHsb();l.hex=l.rgbToHex();return Object.append(l,this)});b.implement({mix:function(){var a=Array.slice(arguments);var j=(typeOf(a.getLast())=="number")?a.pop():50;var l=this.slice();a.each(function(g){g=new b(g);for(var f=0;f<3;f++){l[f]=Math.round((l[f]/100*(100-j))+(g[f]/100*j))}});return new b(l,"rgb")},invert:function(){return new b(this.map(function(a){return 255-a}))},setHue:function(a){return new b([a,this.hsb[1],this.hsb[2]],"hsb")},setSaturation:function(a){return new b([this.hsb[0],a,this.hsb[2]],"hsb")},setBrightness:function(a){return new b([this.hsb[0],this.hsb[1],a],"hsb")}});Array.implement({rgbToHsb:function(){var K=this[0],J=this[1],M=this[2],F=0;var O=Math.max(K,J,M),H=Math.min(K,J,M);var E=O-H;var a=O/255,G=(O!=0)?E/O:0;if(G!=0){var I=(O-K)/E;var N=(O-J)/E;var D=(O-M)/E;if(K==O){F=D-N}else{if(J==O){F=2+I-D}else{F=4+N-I}}F/=6;if(F<0){F++}}return[Math.round(F*360),Math.round(G*100),Math.round(a*100)]},hsbToRgb:function(){var p=Math.round(this[2]/100*255);if(this[1]==0){return[p,p,p]}else{var a=this[0]%360;var B=a%60;var z=Math.round((this[2]*(100-this[1]))/10000*255);var f=Math.round((this[2]*(6000-this[1]*B))/600000*255);var u=Math.round((this[2]*(6000-this[1]*(60-B)))/600000*255);switch(Math.floor(a/60)){case 0:return[p,u,z];case 1:return[f,p,z];case 2:return[z,p,u];case 3:return[z,f,p];case 4:return[u,z,p];case 5:return[p,z,f]}}return false}});String.implement({rgbToHsb:function(){var a=this.match(/\d{1,3}/g);return(a)?a.rgbToHsb():null},hsbToRgb:function(){var a=this.match(/\d{1,3}/g);return(a)?a.hsbToRgb():null}})})();var $RGB=function(g,l,b){return new Color([g,l,b],"rgb")};var $HSB=function(j,l,b){return new Color([j,l,b],"hsb")};var $HEX=function(b){return new Color(b,"hex")};(function(){this.Group=new Class({initialize:function(){this.instances=Array.flatten(arguments);this.events={};this.checker={}},addEvent:function(f,g){this.checker[f]=this.checker[f]||{};this.events[f]=this.events[f]||[];if(this.events[f].contains(g)){return false}else{this.events[f].push(g)}this.instances.each(function(b,a){b.addEvent(f,this.check.pass([f,b,a],this))},this);return this},check:function(p,l,j){this.checker[p][j]=true;var o=this.instances.every(function(b,a){return this.checker[p][a]||false},this);if(!o){return}this.checker[p]={};this.events[p].each(function(a){a.call(this,this.instances,l)},this)}})})();Hash.Cookie=new Class({Extends:Cookie,options:{autoSave:true},initialize:function(f,g){this.parent(f,g);this.load()},save:function(){var b=JSON.encode(this.hash);if(!b||b.length>4096){return false}if(b=="{}"){this.dispose()}else{this.write(b)}return true},load:function(){this.hash=new Hash(JSON.decode(this.read(),true));return this}});Hash.each(Hash.prototype,function(f,g){if(typeof f=="function"){Hash.Cookie.implement(g,function(){var a=f.apply(this.hash,arguments);if(this.options.autoSave){this.save()}return a})}});var HtmlTable=new Class({Implements:[Options,Events,Class.Occlude],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[],headers:[],footers:[]},property:"HtmlTable",initialize:function(){var b=Array.link(arguments,{options:Type.isObject,table:Type.isElement});this.setOptions(b.options);this.element=b.table||new Element("table",this.options.properties);if(this.occlude()){return this.occluded}this.build()},build:function(){this.element.store("HtmlTable",this);this.body=document.id(this.element.tBodies[0])||new Element("tbody").inject(this.element);$$(this.body.rows);if(this.options.headers.length){this.setHeaders(this.options.headers)}else{this.thead=document.id(this.element.tHead)}if(this.thead){this.head=document.id(this.thead.rows[0])}if(this.options.footers.length){this.setFooters(this.options.footers)}this.tfoot=document.id(this.element.tFoot);if(this.tfoot){this.foot=document.id(this.tfoot.rows[0])}this.options.rows.each(function(b){this.push(b)},this);["adopt","inject","wraps","grab","replaces","dispose"].each(function(b){this[b]=this.element[b].bind(this.element)},this)},toElement:function(){return this.element},empty:function(){this.body.empty();return this},set:function(o,l){var p=(o=="headers")?"tHead":"tFoot";this[p.toLowerCase()]=(document.id(this.element[p])||new Element(p.toLowerCase()).inject(this.element,"top")).empty();var j=this.push(l,{},this[p.toLowerCase()],o=="headers"?"th":"td");if(o=="headers"){this.head=document.id(this.thead.rows[0])}else{this.foot=document.id(this.thead.rows[0])}return j},setHeaders:function(b){this.set("headers",b);return this},setFooters:function(b){this.set("footers",b);return this},push:function(p,l,r,o){if(typeOf(p)=="element"&&p.get("tag")=="tr"){p.inject(r||this.body);return{tr:p,tds:p.getChildren("td")}}var u=p.map(function(f){var b=new Element(o||"td",f?f.properties:{}),g=(f?f.content:"")||f,a=document.id(g);if(typeOf(g)!="string"&&a){b.adopt(a)}else{b.set("html",g)}return b});return{tr:new Element("tr",l).inject(r||this.body).adopt(u),tds:u}}});HtmlTable=Class.refactor(HtmlTable,{options:{classZebra:"table-tr-odd",zebra:true},initialize:function(){this.previous.apply(this,arguments);if(this.occluded){return this.occluded}if(this.options.zebra){this.updateZebras()}},updateZebras:function(){Array.each(this.body.rows,this.zebra,this)},zebra:function(f,g){return f[((g%2)?"remove":"add")+"Class"](this.options.classZebra)},push:function(){var b=this.previous.apply(this,arguments);if(this.options.zebra){this.updateZebras()}return b}});HtmlTable=Class.refactor(HtmlTable,{options:{sortIndex:0,sortReverse:false,parsers:[],defaultParser:"string",classSortable:"table-sortable",classHeadSort:"table-th-sort",classHeadSortRev:"table-th-sort-rev",classNoSort:"table-th-nosort",classGroupHead:"table-tr-group-head",classGroup:"table-tr-group",classCellSort:"table-td-sort",classSortSpan:"table-th-sort-span",sortable:false},initialize:function(){this.previous.apply(this,arguments);if(this.occluded){return this.occluded}this.sorted={index:null,dir:1};this.bound={headClick:this.headClick.bind(this)};this.sortSpans=new Elements();if(this.options.sortable){this.enableSort();if(this.options.sortIndex!=null){this.sort(this.options.sortIndex,this.options.sortReverse)}}},attachSorts:function(b){this.element.removeEvents("click:relay(th)");this.element[b!==false?"addEvent":"removeEvent"]("click:relay(th)",this.bound.headClick)},setHeaders:function(){this.previous.apply(this,arguments);if(this.sortEnabled){this.detectParsers()}},detectParsers:function(l){if(!this.head){return}var j=this.options.parsers,g=this.body.rows;this.parsers=$$(this.head.cells).map(function(u,b){if(!l&&(u.hasClass(this.options.classNoSort)||u.retrieve("htmltable-parser"))){return u.retrieve("htmltable-parser")}var a=new Element("div");Array.each(u.childNodes,function(o){a.adopt(o)});a.inject(u);var z=new Element("span",{html:"&#160;","class":this.options.classSortSpan}).inject(a,"top");this.sortSpans.push(z);var f=j[b],B;switch(typeOf(f)){case"function":f={convert:f};B=true;break;case"string":f=f;B=true;break}if(!B){Object.some(HtmlTable.Parsers,function(r){var H=r.match;if(!H){return false}for(var G=0,F=g.length;G<F;G++){var o=document.id(g[G].cells[b]);var p=o?o.get("html").clean():"";if(p&&H.test(p)){f=r;return true}}})}if(!f){f=this.options.defaultParser}u.store("htmltable-parser",f);return f},this)},headClick:function(l,g){if(!this.head||g.hasClass(this.options.classNoSort)){return}var j=Array.indexOf(this.head.cells,g);this.sort(j);return false},sort:function(V,S,T){if(!this.head){return}var j=this.options.classCellSort;var Q=this.options.classGroup,J=this.options.classGroupHead;if(!T){if(V!=null){if(this.sorted.index==V){this.sorted.reverse=!(this.sorted.reverse)}else{if(this.sorted.index!=null){this.sorted.reverse=false;this.head.cells[this.sorted.index].removeClass(this.options.classHeadSort).removeClass(this.options.classHeadSortRev)}else{this.sorted.reverse=true}this.sorted.index=V}}else{V=this.sorted.index}if(S!=null){this.sorted.reverse=S}var Y=document.id(this.head.cells[V]);if(Y){Y.addClass(this.options.classHeadSort);if(this.sorted.reverse){Y.addClass(this.options.classHeadSortRev)}else{Y.removeClass(this.options.classHeadSortRev)}}this.body.getElements("td").removeClass(this.options.classCellSort)}var Z=this.parsers[V];if(typeOf(Z)=="string"){Z=HtmlTable.Parsers[Z]}if(!Z){return}if(!Browser.ie){var aa=this.body.getParent();this.body.dispose()}var K=Array.map(this.body.rows,function(a,f){var b=Z.convert.call(document.id(a.cells[V]));return{position:f,value:b,toString:function(){return b.toString()}}},this);K.reverse(true);K.sort(function(a,b){if(a.value===b.value){return 0}return a.value>b.value?1:-1});if(!this.sorted.reverse){K.reverse(true)}var P=K.length,O=this.body;var R,M,ab,U;while(P){var N=K[--P];M=N.position;var W=O.rows[M];if(W.disabled){continue}if(!T){if(U===N.value){W.removeClass(J).addClass(Q)}else{U=N.value;W.removeClass(Q).addClass(J)}if(this.options.zebra){this.zebra(W,P)}W.cells[V].addClass(j)}O.appendChild(W);for(R=0;R<P;R++){if(K[R].position>M){K[R].position--}}}K=null;if(aa){aa.grab(O)}return this.fireEvent("sort",[O,V])},reSort:function(){if(this.sortEnabled){this.sort.call(this,this.sorted.index,this.sorted.reverse)}return this},enableSort:function(){this.element.addClass(this.options.classSortable);this.attachSorts(true);this.detectParsers();this.sortEnabled=true;return this},disableSort:function(){this.element.removeClass(this.options.classSortable);this.attachSorts(false);this.sortSpans.each(function(b){b.destroy()});this.sortSpans.empty();this.sortEnabled=false;return this}});HtmlTable.Parsers={date:{match:/^\d{2}[-\/ ]\d{2}[-\/ ]\d{2,4}$/,convert:function(){var b=Date.parse(this.get("text").stripTags());return(typeOf(b)=="date")?b.format("db"):""},type:"date"},"input-checked":{match:/ type="(radio|checkbox)" /,convert:function(){return this.getElement("input").checked}},"input-value":{match:/<input/,convert:function(){return this.getElement("input").value}},number:{match:/^\d+[^\d.,]*$/,convert:function(){return this.get("text").stripTags().toInt()},number:true},numberLax:{match:/^[^\d]+\d+$/,convert:function(){return this.get("text").replace(/[^-?^0-9]/,"").stripTags().toInt()},number:true},"float":{match:/^[\d]+\.[\d]+/,convert:function(){return this.get("text").replace(/[^-?^\d.]/,"").stripTags().toFloat()},number:true},floatLax:{match:/^[^\d]+[\d]+\.[\d]+$/,convert:function(){return this.get("text").replace(/[^-?^\d.]/,"").stripTags()},number:true},string:{match:null,convert:function(){return this.get("text").stripTags()}},title:{match:null,convert:function(){return this.title}}};HtmlTable.Parsers=new Hash(HtmlTable.Parsers);HtmlTable.defineParsers=function(b){HtmlTable.Parsers=Object.append(HtmlTable.Parsers,b)};(function(){var o=this.Keyboard=new Class({Extends:Events,Implements:[Options],options:{defaultEventType:"keydown",active:false,manager:null,events:{},nonParsedEvents:["activate","deactivate","onactivate","ondeactivate","changed","onchanged"]},initialize:function(a){if(a&&a.manager){this.manager=a.manager;delete a.manager}this.setOptions(a);this.setup()},setup:function(){this.addEvents(this.options.events);if(o.manager&&!this.manager){o.manager.manage(this)}if(this.options.active){this.activate()}},handle:function(b,f){if(b.preventKeyboardPropagation){return}var a=!!this.manager;if(a&&this.activeKB){this.activeKB.handle(b,f);if(b.preventKeyboardPropagation){return}}this.fireEvent(f,b);if(!a&&this.activeKB){this.activeKB.handle(b,f)}},addEvent:function(b,f,a){return this.parent(o.parse(b,this.options.defaultEventType,this.options.nonParsedEvents),f,a)},removeEvent:function(b,a){return this.parent(o.parse(b,this.options.defaultEventType,this.options.nonParsedEvents),a)},toggleActive:function(){return this[this.isActive()?"deactivate":"activate"]()},activate:function(a){if(a){if(a.isActive()){return this}if(this.activeKB&&a!=this.activeKB){this.previous=this.activeKB;this.previous.fireEvent("deactivate")}this.activeKB=a.fireEvent("activate");o.manager.fireEvent("changed")}else{if(this.manager){this.manager.activate(this)}}return this},isActive:function(){return this.manager?(this.manager.activeKB==this):(o.manager==this)},deactivate:function(a){if(a){if(a===this.activeKB){this.activeKB=null;a.fireEvent("deactivate");o.manager.fireEvent("changed")}}else{if(this.manager){this.manager.deactivate(this)}}return this},relinquish:function(){if(this.isActive()&&this.manager&&this.manager.previous){this.manager.activate(this.manager.previous)}},manage:function(a){if(a.manager&&a.manager!=o.manager&&this!=o.manager){a.manager.drop(a)}this.instances.push(a);a.manager=this;if(!this.activeKB){this.activate(a)}},_disable:function(a){if(this.activeKB==a){this.activeKB=null}},drop:function(a){this._disable(a);this.instances.erase(a);o.manager.manage(a);if(this.activeKB==a&&this.previous&&this.instances.contains(this.previous)){this.activate(this.previous)}},instances:[],trace:function(){o.trace(this)},each:function(a){o.each(this,a)}});var l={};var u=["shift","control","alt","meta"];var p=/^(?:shift|control|ctrl|alt|meta)$/;o.parse=function(g,B,j){if(j&&j.contains(g.toLowerCase())){return g}g=g.toLowerCase().replace(/^(keyup|keydown):/,function(z,D){B=D;return""});if(!l[g]){var a,b={};g.split("+").each(function(z){if(p.test(z)){b[z]=true}else{a=z}});b.control=b.control||b.ctrl;var f=[];u.each(function(z){if(b[z]){f.push(z)}});if(a){f.push(a)}l[g]=f.join("+")}return B+":keys("+l[g]+")"};o.each=function(a,f){var b=a||o.manager;while(b){f.run(b);b=b.activeKB}};o.stop=function(a){a.preventKeyboardPropagation=true};o.manager=new o({active:true});o.trace=function(a){a=a||o.manager;var b=window.console&&console.log;if(b){console.log("the following items have focus: ")}o.each(a,function(f){if(b){console.log(document.id(f.widget)||f.wiget||f)}})};var r=function(b){var a=[];u.each(function(f){if(b[f]){a.push(f)}});if(!p.test(b.key)){a.push(b.key)}o.manager.handle(b,b.type+":keys("+a.join("+")+")")};document.addEvents({keyup:r,keydown:r})})();Keyboard.prototype.options.nonParsedEvents.combine(["rebound","onrebound"]);Keyboard.implement({addShortcut:function(f,g){this.shortcuts=this.shortcuts||[];this.shortcutIndex=this.shortcutIndex||{};g.getKeyboard=Function.from(this);g.name=f;this.shortcutIndex[f]=g;this.shortcuts.push(g);if(g.keys){this.addEvent(g.keys,g.handler)}return this},addShortcuts:function(f){for(var g in f){this.addShortcut(g,f[g])}return this},removeShortcut:function(f){var g=this.getShortcut(f);if(g&&g.keys){this.removeEvent(g.keys,g.handler);delete this.shortcutIndex[f];this.shortcuts.erase(g)}return this},removeShortcuts:function(b){b.each(this.removeShortcut,this);return this},getShortcuts:function(){return this.shortcuts||[]},getShortcut:function(b){return(this.shortcutIndex||{})[b]}});Keyboard.rebind=function(f,g){Array.from(g).each(function(a){a.getKeyboard().removeEvent(a.keys,a.handler);a.getKeyboard().addEvent(f,a.handler);a.keys=f;a.getKeyboard().fireEvent("rebound")})};Keyboard.getActiveShortcuts=function(g){var j=[],l=[];Keyboard.each(g,[].push.bind(j));j.each(function(a){l.extend(a.getShortcuts())});return l};Keyboard.getShortcut=function(u,l,r){r=r||{};var o=r.many?[]:null,p=r.many?function(b){var a=b.getShortcut(u);if(a){o.push(a)}}:function(a){if(!o){o=a.getShortcut(u)}};Keyboard.each(l,p);return o};Keyboard.getShortcuts=function(f,g){return Keyboard.getShortcut(f,g,{many:true})};HtmlTable=Class.refactor(HtmlTable,{options:{useKeyboard:true,classRowSelected:"table-tr-selected",classRowHovered:"table-tr-hovered",classSelectable:"table-selectable",shiftForMultiSelect:true,allowMultiSelect:true,selectable:false},initialize:function(){this.previous.apply(this,arguments);if(this.occluded){return this.occluded}this._selectedRows=new Elements();this._bound={mouseleave:this._mouseleave.bind(this),clickRow:this._clickRow.bind(this)};if(this.options.selectable){this.enableSelect()}},enableSelect:function(){this._selectEnabled=true;this._attachSelects();this.element.addClass(this.options.classSelectable)},disableSelect:function(){this._selectEnabled=false;this._attachSelects(false);this.element.removeClass(this.options.classSelectable)},push:function(){var b=this.previous.apply(this,arguments);this._updateSelects();return b},isSelected:function(b){return this._selectedRows.contains(b)},toggleRow:function(b){return this[(this.isSelected(b)?"de":"")+"selectRow"](b)},selectRow:function(f,g){if(this.isSelected(f)||(!g&&!this.body.getChildren().contains(f))){return}if(!this.options.allowMultiSelect){this.selectNone()}if(!this.isSelected(f)){this._selectedRows.push(f);f.addClass(this.options.classRowSelected);this.fireEvent("rowFocus",[f,this._selectedRows])}this._focused=f;document.clearSelection();return this},deselectRow:function(f,g){if(!this.isSelected(f)||(!g&&!this.body.getChildren().contains(f))){return}this._selectedRows=new Elements(Array.from(this._selectedRows).erase(f));f.removeClass(this.options.classRowSelected);this.fireEvent("rowUnfocus",[f,this._selectedRows]);return this},selectAll:function(b){if(!b&&!this.options.allowMultiSelect){return}this.selectRange(0,this.body.rows.length,b);return this},selectNone:function(){return this.selectAll(true)},selectRange:function(p,u,r){if(!this.options.allowMultiSelect&&!r){return}var D=r?"deselectRow":"selectRow",z=Array.clone(this.body.rows);if(typeOf(p)=="element"){p=z.indexOf(p)}if(typeOf(u)=="element"){u=z.indexOf(u)}u=u<z.length-1?u:z.length-1;if(u<p){var B=p;p=u;u=B}for(var C=p;C<=u;C++){this[D](z[C],true)}return this},deselectRange:function(f,g){this.selectRange(f,g,true)},_enterRow:function(b){if(this._hovered){this._hovered=this._leaveRow(this._hovered)}this._hovered=b.addClass(this.options.classRowHovered)},_leaveRow:function(b){b.removeClass(this.options.classRowHovered)},_updateSelects:function(){Array.each(this.body.rows,function(g){var f=g.retrieve("binders");if((f&&this._selectEnabled)||(!f&&!this._selectEnabled)){return}if(!f){f={mouseenter:this._enterRow.pass([g],this),mouseleave:this._leaveRow.pass([g],this)};g.store("binders",f).addEvents(f)}else{g.removeEvents(f)}},this)},_shiftFocus:function(g,j){if(!this._focused){return this.selectRow(this.body.rows[0],j)}var l=this._getRowByOffset(g);if(l===null||this._focused==this.body.rows[l]){return this}this.toggleRow(this.body.rows[l],j)},_clickRow:function(j,g){var l=(j.shift||j.meta||j.control)&&this.options.shiftForMultiSelect;if(!l&&!(j.rightClick&&this.isSelected(g)&&this.options.allowMultiSelect)){this.selectNone()}if(j.rightClick){this.selectRow(g)}else{this.toggleRow(g)}if(j.shift){this.selectRange(this._rangeStart||this.body.rows[0],g,this._rangeStart?!this.isSelected(g):true);this._focused=g}this._rangeStart=g},_getRowByOffset:function(l){if(!this._focused){return 0}var g=Array.clone(this.body.rows),j=g.indexOf(this._focused)+l;if(j<0){j=null}if(j>=g.length){j=null}return j},_attachSelects:function(B){B=B!=null?B:true;var D=B?"addEvents":"removeEvents";this.element[D]({mouseleave:this._bound.mouseleave});this.body[D]({"click:relay(tr)":this._bound.clickRow,"contextmenu:relay(tr)":this._bound.clickRow});if(this.options.useKeyboard||this.keyboard){if(!this.keyboard){var u,z;var C=function(a){var b=function(f){clearTimeout(u);f.preventDefault();var g=this.body.rows[this._getRowByOffset(a)];if(f.shift&&g&&this.isSelected(g)){this.deselectRow(this._focused);this._focused=g}else{if(g&&(!this.options.allowMultiSelect||!f.shift)){this.selectNone()}this._shiftFocus(a,f)}if(z){u=b.delay(100,this,f)}else{u=(function(){z=true;b(f)}).delay(400)}}.bind(this);return b}.bind(this);var p=function(){clearTimeout(u);z=false};this.keyboard=new Keyboard({events:{"keydown:shift+up":C(-1),"keydown:shift+down":C(1),"keyup:shift+up":p,"keyup:shift+down":p,"keyup:up":p,"keyup:down":p},active:true});var r="";if(this.options.allowMultiSelect&&this.options.shiftForMultiSelect&&this.options.useKeyboard){r=" (Shift multi-selects)."}this.keyboard.addShortcuts({"Select Previous Row":{keys:"up",shortcut:"up arrow",handler:C(-1),description:"Select the previous row in the table."+r},"Select Next Row":{keys:"down",shortcut:"down arrow",handler:C(1),description:"Select the next row in the table."+r}})}this.keyboard[B?"activate":"deactivate"]()}this._updateSelects()},_mouseleave:function(){if(this._hovered){this._leaveRow(this._hovered)}}});var Scroller=new Class({Implements:[Events,Options],options:{area:20,velocity:1,onChange:function(g,f){this.element.scrollTo(g,f)},fps:50},initialize:function(f,g){this.setOptions(g);this.element=document.id(f);this.docBody=document.id(this.element.getDocument().body);this.listener=(typeOf(this.element)!="element")?this.docBody:this.element;this.timer=null;this.bound={attach:this.attach.bind(this),detach:this.detach.bind(this),getCoords:this.getCoords.bind(this)}},start:function(){this.listener.addEvents({mouseenter:this.bound.attach,mouseleave:this.bound.detach});return this},stop:function(){this.listener.removeEvents({mouseenter:this.bound.attach,mouseleave:this.bound.detach});this.detach();this.timer=clearInterval(this.timer);return this},attach:function(){this.listener.addEvent("mousemove",this.bound.getCoords)},detach:function(){this.listener.removeEvent("mousemove",this.bound.getCoords);this.timer=clearInterval(this.timer)},getCoords:function(b){this.page=(this.listener.get("tag")=="body")?b.client:b.page;if(!this.timer){this.timer=this.scroll.periodical(Math.round(1000/this.options.fps),this)}},scroll:function(){var D=this.element.getSize(),z=this.element.getScroll(),E=this.element!=this.docBody?this.element.getOffsets():{x:0,y:0},C=this.element.getScrollSize(),F={x:0,y:0},B=this.options.area.top||this.options.area,r=this.options.area.bottom||this.options.area;for(var u in this.page){if(this.page[u]<(B+E[u])&&z[u]!=0){F[u]=(this.page[u]-B-E[u])*this.options.velocity}else{if(this.page[u]+r>(D[u]+E[u])&&z[u]+D[u]!=C[u]){F[u]=(this.page[u]-D[u]+r-E[u])*this.options.velocity}}F[u]=F[u].round()}if(F.y||F.x){this.fireEvent("change",[z.x+F.x,z.y+F.y])}}});(function(){var b=function(g,a){return(g)?(typeOf(g)=="function"?g(a):a.get(g)):""};this.Tips=new Class({Implements:[Events,Options],options:{onShow:function(){this.tip.setStyle("display","block")},onHide:function(){this.tip.setStyle("display","none")},title:"title",text:function(a){return a.get("rel")||a.get("href")},showDelay:100,hideDelay:100,className:"tip-wrap",offset:{x:16,y:16},windowPadding:{x:0,y:0},fixed:false},initialize:function(){var a=Array.link(arguments,{options:Type.isObject,elements:function(g){return g!=null}});this.setOptions(a.options);if(a.elements){this.attach(a.elements)}this.container=new Element("div",{"class":"tip"})},toElement:function(){if(this.tip){return this.tip}this.tip=new Element("div",{"class":this.options.className,styles:{position:"absolute",top:0,left:0}}).adopt(new Element("div",{"class":"tip-top"}),this.container,new Element("div",{"class":"tip-bottom"}));return this.tip},attach:function(a){$$(a).each(function(r){var o=b(this.options.title,r),p=b(this.options.text,r);r.set("title","").store("tip:native",o).retrieve("tip:title",o);r.retrieve("tip:text",p);this.fireEvent("attach",[r]);var u=["enter","leave"];if(!this.options.fixed){u.push("move")}u.each(function(f){var g=r.retrieve("tip:"+f);if(!g){g=function(j){this["element"+f.capitalize()].apply(this,[j,r])}.bind(this)}r.store("tip:"+f,g).addEvent("mouse"+f,g)},this)},this);return this},detach:function(a){$$(a).each(function(j){["enter","leave","move"].each(function(f){j.removeEvent("mouse"+f,j.retrieve("tip:"+f)).eliminate("tip:"+f)});this.fireEvent("detach",[j]);if(this.options.title=="title"){var l=j.retrieve("tip:native");if(l){j.set("title",l)}}},this);return this},elementEnter:function(g,a){this.container.empty();["title","text"].each(function(f){var l=a.retrieve("tip:"+f);if(l){this.fill(new Element("div",{"class":"tip-"+f}).inject(this.container),l)}},this);clearTimeout(this.timer);this.timer=(function(){this.show(a);this.position((this.options.fixed)?{page:a.getPosition()}:g)}).delay(this.options.showDelay,this)},elementLeave:function(g,a){clearTimeout(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this,a);this.fireForParent(g,a)},fireForParent:function(g,a){a=a.getParent();if(!a||a==document.body){return}if(a.retrieve("tip:enter")){a.fireEvent("mouseenter",g)}else{this.fireForParent(g,a)}},elementMove:function(g,a){this.position(g)},position:function(u){if(!this.tip){document.id(this)}var D=window.getSize(),a=window.getScroll(),F={x:this.tip.offsetWidth,y:this.tip.offsetHeight},C={x:"left",y:"top"},z={y:false,x2:false,y2:false,x:false},E={};for(var B in C){E[C[B]]=u.page[B]+this.options.offset[B];if(E[C[B]]<0){z[B]=true}if((E[C[B]]+F[B]-a[B])>D[B]-this.options.windowPadding[B]){E[C[B]]=u.page[B]-this.options.offset[B]-F[B];z[B+"2"]=true}}this.fireEvent("bound",z);this.tip.setStyles(E)},fill:function(a,g){if(typeof g=="string"){a.set("html",g)}else{a.adopt(g)}},show:function(a){if(!this.tip){document.id(this)}if(!this.tip.getParent()){this.tip.inject(document.body)}this.fireEvent("show",[this.tip,a])},hide:function(a){if(!this.tip){document.id(this)}this.fireEvent("hide",[this.tip,a])}})})();(function(){var b={json:JSON.decode};Locale.Set.defineParser=function(a,g){b[a]=g};Locale.Set.from=function(g,a){if(instanceOf(g,Locale.Set)){return g}if(!a&&typeOf(g)=="string"){a="json"}if(b[a]){g=b[a](g)}locale=new Locale.Set;locale.sets=g.sets||{};if(g.inherits){locale.inherits.locales=Array.from(g.inherits.locales);locale.inherits.sets=g.inherits.sets||{}}return locale}})();Locale.define("de-DE","Date",{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],months_abbr:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],days_abbr:["So.","Mo.","Di.","Mi.","Do.","Fr.","Sa."],dateOrder:["date","month","year"],shortDate:"%d.%m.%Y",shortTime:"%H:%M",AM:"vormittags",PM:"nachmittags",ordinal:".",lessThanMinuteAgo:"vor weniger als einer Minute",minuteAgo:"vor einer Minute",minutesAgo:"vor {delta} Minuten",hourAgo:"vor einer Stunde",hoursAgo:"vor {delta} Stunden",dayAgo:"vor einem Tag",daysAgo:"vor {delta} Tagen",weekAgo:"vor einer Woche",weeksAgo:"vor {delta} Wochen",monthAgo:"vor einem Monat",monthsAgo:"vor {delta} Monaten",yearAgo:"vor einem Jahr",yearsAgo:"vor {delta} Jahren",lessThanMinuteUntil:"in weniger als einer Minute",minuteUntil:"in einer Minute",minutesUntil:"in {delta} Minuten",hourUntil:"in ca. einer Stunde",hoursUntil:"in ca. {delta} Stunden",dayUntil:"in einem Tag",daysUntil:"in {delta} Tagen",weekUntil:"in einer Woche",weeksUntil:"in {delta} Wochen",monthUntil:"in einem Monat",monthsUntil:"in {delta} Monaten",yearUntil:"in einem Jahr",yearsUntil:"in {delta} Jahren"});Locale.define("de-CH").inherit("de-DE","Date");Locale.define("de-CH","FormValidator",{required:"Dieses Feld ist obligatorisch.",minLength:"Geben Sie bitte mindestens {minLength} Zeichen ein (Sie haben {length} Zeichen eingegeben).",maxLength:"Bitte geben Sie nicht mehr als {maxLength} Zeichen ein (Sie haben {length} Zeichen eingegeben).",integer:"Geben Sie bitte eine ganze Zahl ein. Dezimalzahlen (z.B. 1.25) sind nicht erlaubt.",numeric:"Geben Sie bitte nur Zahlenwerte in dieses Eingabefeld ein (z.B. &quot;1&quot;, &quot;1.1&quot;, &quot;-1&quot; oder &quot;-1.1&quot;).",digits:"Benutzen Sie bitte nur Zahlen und Satzzeichen in diesem Eingabefeld (erlaubt ist z.B. eine Telefonnummer mit Bindestrichen und Punkten).",alpha:"Benutzen Sie bitte nur Buchstaben (a-z) in diesem Feld. Leerzeichen und andere Zeichen sind nicht erlaubt.",alphanum:"Benutzen Sie bitte nur Buchstaben (a-z) und Zahlen (0-9) in diesem Eingabefeld. Leerzeichen und andere Zeichen sind nicht erlaubt.",dateSuchAs:"Geben Sie bitte ein g&uuml;ltiges Datum ein. Wie zum Beispiel {date}",dateInFormatMDY:"Geben Sie bitte ein g&uuml;ltiges Datum ein. Wie zum Beispiel TT.MM.JJJJ (z.B. &quot;31.12.1999&quot;)",email:"Geben Sie bitte eine g&uuml;ltige E-Mail Adresse ein. Wie zum Beispiel &quot;maria@bernasconi.ch&quot;.",url:"Geben Sie bitte eine g&uuml;ltige URL ein. Wie zum Beispiel http://www.google.ch.",currencyDollar:"Geben Sie bitte einen g&uuml;ltigen Betrag in Schweizer Franken ein. Wie zum Beispiel 100.00 CHF .",oneRequired:"Machen Sie f&uuml;r mindestens eines der Eingabefelder einen Eintrag.",errorPrefix:"Fehler: ",warningPrefix:"Warnung: ",noSpace:"In diesem Eingabefeld darf kein Leerzeichen sein.",reqChkByNode:"Es wurden keine Elemente gew&auml;hlt.",requiredChk:"Dieses Feld ist obligatorisch.",reqChkByName:"Bitte w&auml;hlen Sie ein {label}.",match:"Dieses Eingabefeld muss mit dem Feld {matchName} &uuml;bereinstimmen.",startDate:"Das Anfangsdatum",endDate:"Das Enddatum",currendDate:"Das aktuelle Datum",afterDate:"Das Datum sollte zur gleichen Zeit oder sp&auml;ter sein {label}.",beforeDate:"Das Datum sollte zur gleichen Zeit oder fr&uuml;her sein {label}.",startMonth:"W&auml;hlen Sie bitte einen Anfangsmonat",sameMonth:"Diese zwei Datumsangaben m&uuml;ssen im selben Monat sein - Sie m&uuml;ssen eine von beiden ver&auml;ndern.",creditcard:"Die eingegebene Kreditkartennummer ist ung&uuml;ltig. Bitte &uuml;berpr&uuml;fen Sie diese und versuchen Sie es erneut. {length} Zahlen eingegeben."});Locale.define("de-DE","FormValidator",{required:"Dieses Eingabefeld muss ausgef&uuml;llt werden.",minLength:"Geben Sie bitte mindestens {minLength} Zeichen ein (Sie haben nur {length} Zeichen eingegeben).",maxLength:"Geben Sie bitte nicht mehr als {maxLength} Zeichen ein (Sie haben {length} Zeichen eingegeben).",integer:"Geben Sie in diesem Eingabefeld bitte eine ganze Zahl ein. Dezimalzahlen (z.B. &quot;1.25&quot;) sind nicht erlaubt.",numeric:"Geben Sie in diesem Eingabefeld bitte nur Zahlenwerte (z.B. &quot;1&quot;, &quot;1.1&quot;, &quot;-1&quot; oder &quot;-1.1&quot;) ein.",digits:"Geben Sie in diesem Eingabefeld bitte nur Zahlen und Satzzeichen ein (z.B. eine Telefonnummer mit Bindestrichen und Punkten ist erlaubt).",alpha:"Geben Sie in diesem Eingabefeld bitte nur Buchstaben (a-z) ein. Leerzeichen und andere Zeichen sind nicht erlaubt.",alphanum:"Geben Sie in diesem Eingabefeld bitte nur Buchstaben (a-z) und Zahlen (0-9) ein. Leerzeichen oder andere Zeichen sind nicht erlaubt.",dateSuchAs:"Geben Sie bitte ein g&uuml;ltiges Datum ein (z.B. &quot;{date}&quot;).",dateInFormatMDY:"Geben Sie bitte ein g&uuml;ltiges Datum im Format TT.MM.JJJJ ein (z.B. &quot;31.12.1999&quot;).",email:"Geben Sie bitte eine g&uuml;ltige E-Mail-Adresse ein (z.B. &quot;max@mustermann.de&quot;).",url:"Geben Sie bitte eine g&uuml;ltige URL ein (z.B. &quot;http://www.google.de&quot;).",currencyDollar:"Geben Sie bitte einen g&uuml;ltigen Betrag in EURO ein (z.B. 100.00&#8364;).",oneRequired:"Bitte f&uuml;llen Sie mindestens ein Eingabefeld aus.",errorPrefix:"Fehler: ",warningPrefix:"Warnung: ",noSpace:"Es darf kein Leerzeichen in diesem Eingabefeld sein.",reqChkByNode:"Es wurden keine Elemente gew&auml;hlt.",requiredChk:"Dieses Feld muss ausgef&uuml;llt werden.",reqChkByName:"Bitte w&auml;hlen Sie ein {label}.",match:"Dieses Eingabefeld muss mit dem {matchName} Eingabefeld &uuml;bereinstimmen.",startDate:"Das Anfangsdatum",endDate:"Das Enddatum",currendDate:"Das aktuelle Datum",afterDate:"Das Datum sollte zur gleichen Zeit oder sp&auml;ter sein als {label}.",beforeDate:"Das Datum sollte zur gleichen Zeit oder fr&uuml;her sein als {label}.",startMonth:"W&auml;hlen Sie bitte einen Anfangsmonat",sameMonth:"Diese zwei Datumsangaben m&uuml;ssen im selben Monat sein - Sie m&uuml;ssen eines von beiden ver&auml;ndern.",creditcard:"Die eingegebene Kreditkartennummer ist ung&uuml;ltig. Bitte &uuml;berpr&uuml;fen Sie diese und versuchen Sie es erneut. {length} Zahlen eingegeben."});Locale.define("EU","Number",{decimal:",",group:".",currency:{prefix:"€ "}});Locale.define("de-DE").inherit("EU","Number");Locale.define("en-GB","Date",{dateOrder:["date","month","year"],shortDate:"%d/%m/%Y",shortTime:"%H:%M"}).inherit("en-US","Date");var MUI=MochaUI=new Hash({version:"0.9.7",options:new Hash({theme:"default",advancedEffects:false,standardEffects:true}),path:{source:fno.omfPath+"mochaui/scripts/source/",themes:fno.omfPath+"mochaui/themes/",plugins:fno.omfPath+"mochaui/plugins/"},themePath:function(){return MUI.path.themes+MUI.options.theme+"/"},files:new Hash()});MUI.files[MUI.path.source+"Core/Core.js"]="loaded";MUI.extend({Windows:{instances:new Hash()},ieSupport:"excanvas",updateContent:function(C){var C=$extend({element:null,childElement:null,method:null,data:null,title:null,content:null,loadMethod:null,url:null,scrollbars:null,padding:null,require:{},onContentLoaded:$empty},C);C.require=$extend({css:[],images:[],js:[],onload:null},C.require);var p={};if(!C.element){return}var B=C.element;if(MUI.Windows.instances.get(B.id)){p.recipient="window"}else{p.recipient="panel"}var u=B.retrieve("instance");if(C.title){u.titleEl.set("html",C.title)}var z=u.contentEl;p.contentContainer=C.childElement!=null?C.childElement:u.contentEl;var D=u.contentWrapperEl;if(!C.loadMethod){if(!u.options.loadMethod){if(!C.url){C.loadMethod="html"}else{C.loadMethod="xhr"}}else{C.loadMethod=u.options.loadMethod}}var r=C.scrollbars||u.options.scrollbars;if(p.contentContainer==u.contentEl){D.setStyles({overflow:r!=false&&C.loadMethod!="iframe"?"auto":"hidden"})}if(C.padding!=null){z.setStyles({"padding-top":C.padding.top,"padding-bottom":C.padding.bottom,"padding-left":C.padding.left,"padding-right":C.padding.right})}if(p.contentContainer==z){z.empty().show();z.getAllNext(".column").destroy();z.getAllNext(".columnHandle").destroy()}p.onContentLoaded=function(){if(C.require.js.length||typeof C.require.onload=="function"){new MUI.Require({js:C.require.js,onload:function(){if(Browser.Engine.presto){C.require.onload.delay(100)}else{C.require.onload()}(C.onContentLoaded&&C.onContentLoaded!=$empty)?C.onContentLoaded():u.fireEvent("contentLoaded",B)}.bind(this)})}else{(C.onContentLoaded&&C.onContentLoaded!=$empty)?C.onContentLoaded():u.fireEvent("contentLoaded",B)}};if(C.require.css.length||C.require.images.length){new MUI.Require({css:C.require.css,images:C.require.images,onload:function(){this.loadSelect(u,C,p)}.bind(this)})}else{this.loadSelect(u,C,p)}},loadSelect:function(j,l,g){switch(l.loadMethod){case"xhr":this.updateContentXHR(j,l,g);break;case"iframe":this.updateContentIframe(j,l,g);break;case"json":this.updateContentJSON(j,l,g);break;case"html":default:this.updateContentHTML(j,l,g);break}},updateContentJSON:function(o,u,l){var p=o.contentEl;var r=l.contentContainer;new Request({url:u.url,update:r,method:u.method!=null?u.method:"get",data:u.data!=null?new Hash(u.data).toQueryString():"",evalScripts:false,evalResponse:false,headers:{"Content-Type":"application/json"},onRequest:function(){if(l.recipient=="window"&&r==p){o.showSpinner()}else{if(l.recipient=="panel"&&r==p&&$("spinner")){$("spinner").show()}}}.bind(this),onFailure:function(){if(r==p){r.set("html","<p><strong>Error Loading XMLHttpRequest</strong></p>");if(recipient=="window"){o.hideSpinner()}else{if(recipient=="panel"&&$("spinner")){$("spinner").hide()}}}if(r==p){r.set("html","<p><strong>Error Loading XMLHttpRequest</strong></p>");if(l.recipient=="window"){o.hideSpinner()}else{if(l.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}}.bind(this),onException:function(){}.bind(this),onSuccess:function(a){if(r==p){if(r==p){if(l.recipient=="window"){o.hideSpinner()}else{if(l.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}var a=JSON.decode(a);o.fireEvent("loaded",$A([u.element,a,o]))}}.bind(this),onComplete:function(){}.bind(this)}).get()},updateContentXHR:function(r,B,o){var p=r.contentEl;var u=o.contentContainer;var z=o.onContentLoaded;new Request.HTML({url:B.url,update:u,method:B.method!=null?B.method:"get",data:B.data!=null?new Hash(B.data).toQueryString():"",evalScripts:r.options.evalScripts,evalResponse:r.options.evalResponse,onRequest:function(){if(o.recipient=="window"&&u==p){r.showSpinner()}else{if(o.recipient=="panel"&&u==p&&$("spinner")){$("spinner").show()}}}.bind(this),onFailure:function(f){if(u==p){var a=new RegExp("<title>[\n\rs]*(.*)[\n\rs]*</title>","gmi");var b=a.exec(f.responseText);if(!b){b="Unknown"}u.set("html","<h3>Error: "+b[1]+"</h3>");if(o.recipient=="window"){r.hideSpinner()}else{if(o.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}}.bind(this),onSuccess:function(){p.addClass("pad");if(u==p){if(o.recipient=="window"){r.hideSpinner()}else{if(o.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}Browser.Engine.trident4?z.delay(750):z()}.bind(this),onComplete:function(){}.bind(this)}).send()},updateContentIframe:function(u,C,p){var r=u.contentEl;var z=p.contentContainer;var D=u.contentWrapperEl;var B=p.onContentLoaded;if(u.options.contentURL==""||z!=r){return}r.removeClass("pad");r.setStyle("padding","0px");u.iframeEl=new Element("iframe",{id:u.options.id+"_iframe",name:u.options.id+"_iframe","class":"mochaIframe",src:C.url,marginwidth:0,marginheight:0,frameBorder:0,scrolling:"auto",styles:{height:D.offsetHeight-D.getStyle("border-top").toInt()-D.getStyle("border-bottom").toInt(),width:u.panelEl?D.offsetWidth-D.getStyle("border-left").toInt()-D.getStyle("border-right").toInt():"100%"}}).injectInside(r);u.iframeEl.addEvent("load",function(a){if(p.recipient=="window"){u.hideSpinner()}else{if(p.recipient=="panel"&&z==r&&$("spinner")){$("spinner").hide()}}Browser.Engine.trident4?B.delay(50):B()}.bind(this));if(p.recipient=="window"){u.showSpinner()}else{if(p.recipient=="panel"&&z==r&&$("spinner")){$("spinner").show()}}},updateContentHTML:function(u,C,p){var r=u.contentEl;var z=p.contentContainer;var B=p.onContentLoaded;var D=new Array("element","textnode","whitespace","collection");r.addClass("pad");if(D.contains($type(C.content))){C.content.inject(z)}else{z.set("html",C.content)}if(z==r){if(p.recipient=="window"){u.hideSpinner()}else{if(p.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}Browser.Engine.trident4?B.delay(50):B()},reloadIframe:function(b){Browser.Engine.gecko?$(b).src=$(b).src:top.frames[b].location.reload(true)},roundedRect:function(u,C,B,E,D,a,F,z){u.fillStyle="rgba("+F.join(",")+","+z+")";u.beginPath();u.moveTo(C,B+a);u.lineTo(C,B+D-a);u.quadraticCurveTo(C,B+D,C+a,B+D);u.lineTo(C+E-a,B+D);u.quadraticCurveTo(C+E,B+D,C+E,B+D-a);u.lineTo(C+E,B+a);u.quadraticCurveTo(C+E,B,C+E-a,B);u.lineTo(C+a,B);u.quadraticCurveTo(C,B,C,B+a);u.fill()},triangle:function(u,B,C,D,a,r,z){u.beginPath();u.moveTo(B+D,C);u.lineTo(B,C+a);u.lineTo(B+D,C+a);u.closePath();u.fillStyle="rgba("+r.join(",")+","+z+")";u.fill()},circle:function(u,a,B,p,r,z){u.beginPath();u.arc(a,B,p,0,Math.PI*2,true);u.fillStyle="rgba("+r.join(",")+","+z+")";u.fill()},notification:function(b){new MUI.Window({loadMethod:"html",closeAfter:1500,type:"notification",addClass:"notification",content:b,width:220,height:40,y:53,padding:{top:10,right:12,bottom:10,left:12},shadowBlur:5})},toggleAdvancedEffects:function(b){if(MUI.options.advancedEffects==false){MUI.options.advancedEffects=true;if(b){this.toggleAdvancedEffectsLink=new Element("div",{"class":"check",id:"toggleAdvancedEffects_check"}).inject(b)}}else{MUI.options.advancedEffects=false;if(this.toggleAdvancedEffectsLink){this.toggleAdvancedEffectsLink.destroy()}}},toggleStandardEffects:function(b){if(MUI.options.standardEffects==false){MUI.options.standardEffects=true;if(b){this.toggleStandardEffectsLink=new Element("div",{"class":"check",id:"toggleStandardEffects_check"}).inject(b)}}else{MUI.options.standardEffects=false;if(this.toggleStandardEffectsLink){this.toggleStandardEffectsLink.destroy()}}},underlayInitialize:function(){var j,g;try{j=(parent.window===window)?parent.getCoordinates():window.getCoordinates()}catch(l){j=window.getCoordinates()}g=new Element("div",{id:"windowUnderlay",styles:{height:j&&j.height,opacity:0.01,display:"none"}}).inject(document.body)},setUnderlaySize:function(){var g;try{g=(parent.window===window)?parent.getCoordinates():window.getCoordinates()}catch(f){g=window.getCoordinates()}$("windowUnderlay").setStyle("height",g&&g.height)}});function fixPNG(u){if(Browser.Engine.trident4&&document.body.filters){var o=(u.id)?"id='"+u.id+"' ":"";var z=(u.className)?"class='"+u.className+"' ":"";var r=(u.title)?"title='"+u.title+"' ":"title='"+u.alt+"' ";var B="display:inline-block;"+u.style.cssText;var p="<span "+o+z+r+' style="width:'+u.width+"px; height:"+u.height+"px;"+B+";filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+u.src+"', sizingMethod='scale');\"></span>";u.outerHTML=p}}document.addEvent("mousedown",function(b){MUI.blurAll.delay(50)});window.addEvent("domready",function(){MUI.underlayInitialize()});window.addEvent("resize",function(){if($("windowUnderlay")){MUI.setUnderlaySize()}else{MUI.underlayInitialize()}});Element.implement({hide:function(){this.setStyle("display","none");return this},show:function(){this.setStyle("display","block");return this}});Element.implement({shake:function(r,E){r=r||3;E=E||500;E=(E/50).toInt()-1;var B=this.getParent();if(B!=$(document.body)&&B.getStyle("position")=="static"){B.setStyle("position","relative")}var z=this.getStyle("position");if(z=="static"){this.setStyle("position","relative");z="relative"}if(Browser.Engine.trident){B.setStyle("height",B.getStyle("height"))}var F=this.getPosition(B);if(z=="relative"&&!Browser.Engine.presto){F.x-=B.getStyle("paddingLeft").toInt();F.y-=B.getStyle("paddingTop").toInt()}var u=this.retrieve("morph");if(u){u.cancel();var D=u.options}var u=this.get("morph",{duration:50,link:"chain"});for(var C=0;C<E;C++){u.start({top:F.y+$random(-r,r),left:F.x+$random(-r,r)})}u.start({top:F.y,left:F.x}).chain(function(){if(D){this.set("morph",D)}}.bind(this));return this}});String.implement({parseQueryString:function(){var f=this.split(/[&;]/);var g={};if(f.length){f.each(function(a){var b=a.split("=");if(b.length&&b.length==2){g[decodeURIComponent(b[0])]=decodeURIComponent(b[1])}})}return g}});Request.HTML.implement({processHTML:function(l){var g=l.match(/<body[^>]*>([\s\S]*?)<\/body>/i);l=(g)?g[1]:l;var j=new Element("div");return j.set("html",l)}});MUI.getCSSRule=function(j){for(var p=0;p<document.styleSheets.length;p++){var o=document.styleSheets[p];var l=o.cssRules?o.cssRules:o.rules;for(i=0;i<l.length;i++){if(l[i].selectorText==j){return l[i]}}}return false};if(location.protocol=="file:"){Request.implement({isSuccess:function(b){return(b==0||(b>=200)&&(b<300))}});Browser.Request=function(){return $try(function(){return new ActiveXObject("MSXML2.XMLHTTP")},function(){return new XMLHttpRequest()})}}MUI.Require=new Class({Implements:[Options],options:{css:[],images:[],js:[],onload:$empty},initialize:function(g){this.setOptions(g);var g=this.options;this.assetsToLoad=g.css.length+g.images.length+g.js.length;this.assetsLoaded=0;var f=0;if(g.css.length){g.css.each(function(a){this.getAsset(a,function(){if(f==g.css.length-1){if(this.assetsLoaded==this.assetsToLoad-1){this.requireOnload()}else{this.assetsLoaded++;this.requireContinue.delay(50,this)}}else{f++;this.assetsLoaded++}}.bind(this))}.bind(this))}else{if(!g.js.length&&!g.images.length){this.options.onload();return true}else{this.requireContinue.delay(50,this)}}},requireOnload:function(){this.assetsLoaded++;if(this.assetsLoaded==this.assetsToLoad){this.options.onload();return true}},requireContinue:function(){var b=this.options;if(b.images.length){b.images.each(function(a){this.getAsset(a,this.requireOnload.bind(this))}.bind(this))}if(b.js.length){b.js.each(function(a){this.getAsset(a,this.requireOnload.bind(this))}.bind(this))}},getAsset:function(l,u){if(MUI.files[l]=="loaded"){if(typeof u=="function"){u()}return true}else{if(MUI.files[l]=="loading"){var r=0;var o=(function(){r++;if(MUI.files[l]=="loading"&&r<"100"){return}$clear(o);if(typeof u=="function"){u()}}).periodical(50)}else{MUI.files[l]="loading";properties={onload:u!="undefined"?u:$empty};var p=properties.onload;properties.onload=function(){MUI.files[l]="loaded";if(p){p()}}.bind(this);switch(l.match(/(\.\w+)($|\?.*$)/)[1]){case".js":return Asset.javascript(l,properties);case".css":return Asset.css(l,properties);case".jpg":case".png":case".gif":return Asset.image(l,properties)}alert('The required file "'+l+'" could not be loaded')}}}});$extend(Asset,{javascript:function(u,B){B=$extend({onload:$empty,document:document,check:$lambda(true)},B);if($(B.id)){B.onload();return $(B.id)}var p=new Element("script",{src:u,type:"text/javascript"});var z=B.onload.bind(p),r=B.check,D=B.document;delete B.onload;delete B.check;delete B.document;if(!Browser.Engine.webkit419&&!Browser.Engine.presto){p.addEvents({load:z,readystatechange:function(){if(Browser.Engine.trident&&["loaded","complete"].contains(this.readyState)){z()}}}).setProperties(B)}else{var C=(function(){if(!$try(r)){return}$clear(C);Browser.Engine.presto?z.delay(500):z()}).periodical(50)}return p.inject(D.head)},css:function(f,g){g=$extend({id:null,media:"screen",onload:$empty},g);new Request({method:"get",url:f,onComplete:function(b){var a=new Element("link",{id:g.id,rel:"stylesheet",media:g.media,type:"text/css",href:f}).inject(document.head);g.onload()}.bind(this),onFailure:function(a){},onSuccess:function(){}.bind(this)}).send()}});MUI.extend({newWindowsFromHTML:function(b){new MUI.Require({js:[MUI.path.plugins+"mochaui/Window/Windows-from-html.js"],onload:function(){new MUI.newWindowsFromHTML(b)}})},newWindowsFromJSON:function(b){new MUI.Require({js:[MUI.path.plugins+"mochaui/Window/Windows-from-json.js"],onload:function(){new MUI.newWindowsFromJSON(b)}})},arrangeCascade:function(){new MUI.Require({js:[MUI.path.plugins+"mochaui/Window/Arrange-cascade.js"],onload:function(){new MUI.arrangeCascade()}})},arrangeTile:function(){new MUI.Require({js:[MUI.path.plugins+"mochaui/Window/Arrange-tile.js"],onload:function(){new MUI.arrangeTile()}})},saveWorkspace:function(){new MUI.Require({js:[MUI.path.plugins+"mochaui/Layout/Workspaces.js"],onload:function(){new MUI.saveWorkspace()}})},loadWorkspace:function(){new MUI.Require({js:[MUI.path.plugins+"mochaui/Layout/Workspaces.js"],onload:function(){new MUI.loadWorkspace()}})},Themes:{init:function(b){new MUI.Require({js:[MUI.path.plugins+"mochaui/Utilities/Themes.js"],onload:function(){MUI.Themes.init(b)}})}}});if(Browser.Engine.webkit){}MUI.files[MUI.path.source+"Layout/Layout.js"]="loaded";MUI.extend({Columns:{instances:new Hash(),columnIDCount:0},Panels:{instances:new Hash(),panelIDCount:0}});MUI.Desktop={options:{desktop:"desktop",desktopHeader:"desktopHeader",desktopFooter:"desktopFooter",desktopNavBar:"desktopNavbar",pageWrapper:"pageWrapper",page:"page",desktopFooter:"desktopFooterWrapper"},initialize:function(){this.desktop=$(this.options.desktop);this.desktopHeader=$(this.options.desktopHeader);this.desktopNavBar=$(this.options.desktopNavBar);this.pageWrapper=$(this.options.pageWrapper);this.page=$(this.options.page);this.desktopFooter=$(this.options.desktopFooter);if(this.desktop){($$("body")).setStyles({overflow:"hidden",height:"100%",margin:0});($$("html")).setStyles({overflow:"hidden",height:"100%"})}if(!MUI.Dock){this.setDesktopSize()}this.menuInitialize();window.addEvent("resize",function(b){this.onBrowserResize()}.bind(this));if(MUI.myChain){MUI.myChain.callChain()}},menuInitialize:function(){if(Browser.Engine.trident4&&this.desktopNavBar){this.desktopNavBar.getElements("li").each(function(b){b.addEvent("mouseenter",function(){this.addClass("ieHover")});b.addEvent("mouseleave",function(){this.removeClass("ieHover")})})}},onBrowserResize:function(){this.setDesktopSize();setTimeout(function(){MUI.Windows.instances.each(function(l){if(l.isMaximized){if(l.iframeEl){l.iframeEl.setStyle("visibility","hidden")}var o=document.getCoordinates();var j=l.contentBorderEl.getStyle("border-top").toInt()+l.contentBorderEl.getStyle("border-bottom").toInt();var p=l.toolbarWrapperEl?l.toolbarWrapperEl.getStyle("height").toInt()+l.toolbarWrapperEl.getStyle("border-top").toInt():0;l.contentWrapperEl.setStyles({height:o.height-l.options.headerHeight-l.options.footerHeight-j-p,width:o.width});l.drawWindow();if(l.iframeEl){l.iframeEl.setStyles({height:l.contentWrapperEl.getStyle("height")});l.iframeEl.setStyle("visibility","visible")}}}.bind(this))}.bind(this),100)},setDesktopSize:function(){var o=window.getCoordinates();var j=$(MUI.options.dockWrapper);if(this.desktop){this.desktop.setStyle("height",o.height)}if(this.pageWrapper){var l=MUI.dockVisible?j.offsetHeight:0;var p=o.height;p-=this.pageWrapper.getStyle("border-top").toInt();p-=this.pageWrapper.getStyle("border-bottom").toInt();if(this.desktopHeader){p-=this.desktopHeader.offsetHeight}if(this.desktopFooter){p-=this.desktopFooter.offsetHeight}p-=l;if(p<0){p=0}this.pageWrapper.setStyle("height",p)}if(MUI.Columns.instances.getKeys().length>0){MUI.Desktop.resizePanels()}},resizePanels:function(){MUI.panelHeight();MUI.rWidth()},maximizeWindow:function(C){var B=MUI.Windows.instances.get(C.id);var u=B.options;var F=B.windowDrag;if(C!=$(C)||B.isMaximized){return}if(B.isCollapsed){MUI.collapseToggle(C)}B.isMaximized=true;if(B.options.restrict){F.detach();if(u.resizable){B.detachResizable()}B.titleBarEl.setStyle("cursor","default")}if(u.container!=this.desktop){this.desktop.grab(C);if(this.options.restrict){F.container=this.desktop}}B.oldTop=C.getStyle("top");B.oldLeft=C.getStyle("left");var E=B.contentWrapperEl;E.oldWidth=E.getStyle("width");E.oldHeight=E.getStyle("height");if(B.iframeEl){if(!Browser.Engine.trident){B.iframeEl.setStyle("visibility","hidden")}else{B.iframeEl.hide()}}var G=document.getCoordinates();var u=B.options;var D=u.shadowBlur;var z=u.shadowOffset;var H=G.height-u.headerHeight-u.footerHeight;H-=B.contentBorderEl.getStyle("border-top").toInt();H-=B.contentBorderEl.getStyle("border-bottom").toInt();H-=(B.toolbarWrapperEl?B.toolbarWrapperEl.getStyle("height").toInt()+B.toolbarWrapperEl.getStyle("border-top").toInt():0);MUI.resizeWindow(C,{width:G.width,height:H,top:z.y-D,left:z.x-D});B.fireEvent("onMaximize",C);if(B.maximizeButtonEl){B.maximizeButtonEl.setProperty("title","Restore")}MUI.focusWindow(C)},restoreWindow:function(o){var l=o.retrieve("instance");if(o!=$(o)||!l.isMaximized){return}var j=l.options;l.isMaximized=false;if(j.restrict){l.windowDrag.attach();if(j.resizable){l.reattachResizable()}l.titleBarEl.setStyle("cursor","move")}if(l.iframeEl){if(!Browser.Engine.trident){l.iframeEl.setStyle("visibility","hidden")}else{l.iframeEl.hide()}}var p=l.contentWrapperEl;MUI.resizeWindow(o,{width:p.oldWidth,height:p.oldHeight,top:l.oldTop,left:l.oldLeft});l.fireEvent("onRestore",o);if(l.maximizeButtonEl){l.maximizeButtonEl.setProperty("title","Maximize")}}};MUI.Column=new Class({Implements:[Events,Options],options:{id:null,container:null,placement:null,width:null,resizeLimit:[],sortable:true,isCollapsed:false,onResize:$empty,onCollapse:$empty,onExpand:$empty},initialize:function(p){this.setOptions(p);$extend(this,{timestamp:$time(),isCollapsed:false,oldWidth:0});if(this.options.id==null){this.options.id="column"+(++MUI.Columns.columnIDCount)}var p=this.options;var D=MUI.Columns.instances;var B=D.get(p.id);if(p.container==null){p.container=MUI.Desktop.pageWrapper}else{$(p.container).setStyle("overflow","hidden")}if(typeof this.options.container=="string"){this.options.container=$(this.options.container)}if(B){var u=B}if(this.columnEl){return}else{D.set(p.id,this)}if($(p.container).getElement(".pad")!=null){$(p.container).getElement(".pad").hide()}if($(p.container).getElement(".mochaContent")!=null){$(p.container).getElement(".mochaContent").hide()}this.columnEl=new Element("div",{id:this.options.id,"class":"column expanded",styles:{width:p.placement=="main"?null:p.width}}).inject($(p.container));this.columnEl.store("instance",this);var C=this.columnEl.getParent();var r=C.getStyle("height").toInt();this.columnEl.setStyle("height",r);if(this.options.sortable){if(!this.options.container.retrieve("sortables")){var z=new Sortables(this.columnEl,{opacity:1,handle:".panel-header",constrain:false,revert:false,onSort:function(){$$(".column").each(function(a){a.getChildren(".panelWrapper").each(function(b){b.getElement(".panel").removeClass("bottomPanel")});if(a.getChildren(".panelWrapper").getLast()){a.getChildren(".panelWrapper").getLast().getElement(".panel").addClass("bottomPanel")}a.getChildren(".panelWrapper").each(function(b){var f=b.getElement(".panel");var j=b.getParent().id;u=MUI.Panels.instances.get(f.id);u.options.column=j;if(u){var g=f.getParent().getNext(".expanded");if(g){g=g.getElement(".panel")}u.partner=g}});MUI.panelHeight()}.bind(this))}.bind(this)});this.options.container.store("sortables",z)}else{this.options.container.retrieve("sortables").addLists(this.columnEl)}}if(p.placement=="main"){this.columnEl.addClass("rWidth")}switch(this.options.placement){case"left":this.handleEl=new Element("div",{id:this.options.id+"_handle","class":"columnHandle"}).inject(this.columnEl,"after");this.handleIconEl=new Element("div",{id:p.id+"_handle_icon","class":"handleIcon"}).inject(this.handleEl);addResizeRight(this.columnEl,p.resizeLimit[0],p.resizeLimit[1]);break;case"right":this.handleEl=new Element("div",{id:this.options.id+"_handle","class":"columnHandle"}).inject(this.columnEl,"before");this.handleIconEl=new Element("div",{id:p.id+"_handle_icon","class":"handleIcon"}).inject(this.handleEl);addResizeLeft(this.columnEl,p.resizeLimit[0],p.resizeLimit[1]);break}if(this.options.isCollapsed&&this.options.placement!="main"){this.columnToggle()}if(this.handleEl!=null){this.handleEl.addEvent("dblclick",function(){this.columnToggle()}.bind(this))}MUI.rWidth()},columnCollapse:function(){var b=this.columnEl;this.oldWidth=b.getStyle("width").toInt();this.resize.detach();this.handleEl.removeEvents("dblclick");this.handleEl.addEvent("click",function(){this.columnExpand()}.bind(this));this.handleEl.setStyle("cursor","pointer").addClass("detached");b.setStyle("width",0);this.isCollapsed=true;b.addClass("collapsed");b.removeClass("expanded");MUI.rWidth();this.fireEvent("onCollapse");return true},columnExpand:function(){var b=this.columnEl;b.setStyle("width",this.oldWidth);this.isCollapsed=false;b.addClass("expanded");b.removeClass("collapsed");this.handleEl.removeEvents("click");this.handleEl.addEvent("dblclick",function(){this.columnCollapse()}.bind(this));this.resize.attach();this.handleEl.setStyle("cursor",Browser.Engine.webkit?"col-resize":"e-resize").addClass("attached");MUI.rWidth();this.fireEvent("onExpand");return true},columnToggle:function(){if(this.isCollapsed==false){this.columnCollapse()}else{this.columnExpand()}}});MUI.Column.implement(new Options,new Events);MUI.Panel=new Class({Implements:[Events,Options],options:{id:null,title:"New Panel",column:null,require:{css:[],images:[],js:[],onload:null},loadMethod:null,contentURL:null,method:"get",data:null,evalScripts:true,evalResponse:false,content:"",tabsURL:null,tabsData:null,tabsOnload:$empty,header:true,headerToolbox:false,headerToolboxURL:"pages/lipsum.html",headerToolboxOnload:$empty,footer:false,footerRenderer:$empty,height:125,addClass:"",scrollbars:true,padding:{top:0,right:0,bottom:0,left:0},collapsible:true,onBeforeBuild:$empty,onContentLoaded:$empty,onResize:$empty,onCollapse:$empty,onExpand:$empty},initialize:function(o){this.setOptions(o);$extend(this,{timestamp:$time(),isCollapsed:false,oldHeight:0,partner:null});if(this.options.id==null){this.options.id="panel"+(++MUI.Panels.panelIDCount)}var r=MUI.Panels.instances;var B=r.get(this.options.id);var o=this.options;if(B){var p=B}if(this.panelEl){return}else{r.set(this.options.id,this)}this.fireEvent("onBeforeBuild");if(o.loadMethod=="iframe"){o.padding={top:0,right:0,bottom:0,left:0}}this.showHandle=true;if($(o.column).getChildren().length==0){this.showHandle=false}this.panelWrapperEl=new Element("div",{id:this.options.id+"_wrapper","class":"panelWrapper expanded"}).inject($(o.column));this.panelEl=new Element("div",{id:this.options.id,"class":"panel expanded",styles:{height:o.height}}).inject(this.panelWrapperEl);this.panelEl.store("instance",this);this.panelEl.addClass(o.addClass);this.contentEl=new Element("div",{id:o.id+"_pad","class":"pad"}).inject(this.panelEl);this.contentWrapperEl=this.panelEl;this.contentEl.setStyles({"padding-top":o.padding.top,"padding-bottom":o.padding.bottom,"padding-left":o.padding.left,"padding-right":o.padding.right});this.panelHeaderEl=new Element("div",{id:this.options.id+"_header","class":"panel-header",styles:{display:o.header?"block":"none"}}).inject(this.panelEl,"before");var z=MUI.Columns.instances;var u=z.get(this.options.column);if(this.options.collapsible){this.collapseToggleInit()}if(this.options.headerToolbox){this.panelHeaderToolboxEl=new Element("div",{id:o.id+"_headerToolbox","class":"panel-header-toolbox"}).inject(this.panelHeaderEl)}this.panelHeaderContentEl=new Element("div",{id:o.id+"_headerContent","class":"panel-headerContent"}).inject(this.panelHeaderEl);if(u.options.sortable){this.panelHeaderEl.setStyle("cursor","move");u.options.container.retrieve("sortables").addItems(this.panelWrapperEl);if(this.panelHeaderToolboxEl){this.panelHeaderToolboxEl.addEvent("mousedown",function(a){a=new Event(a).stop();a.target.focus()});this.panelHeaderToolboxEl.setStyle("cursor","default")}}this.titleEl=new Element("h2",{id:o.id+"_title"}).inject(this.panelHeaderContentEl);this.handleEl=new Element("div",{id:o.id+"_handle","class":"horizontalHandle",styles:{display:this.showHandle==true?"block":"none"}}).inject(this.panelEl,"after");if(o.footer){this.panelFooterEl=new Element("div",{id:this.options.id+"_footer","class":"panel-footer"}).inject(this.panelEl,"after");if(o.footerRenderer){o.footerRenderer({owner:this,footer:this.panelFooterEl})}}this.handleIconEl=new Element("div",{id:o.id+"_handle_icon","class":"handleIcon"}).inject(this.handleEl);addResizeBottom(o.id);if(o.require.css.length||o.require.images.length){new MUI.Require({css:o.require.css,images:o.require.images,onload:function(){this.newPanel()}.bind(this)})}else{this.newPanel()}if(this.options.collapsible&&this.options.collapsed){this.collapseToggleEl.fireEvent("click")}},newPanel:function(){options=this.options;if(this.options.headerToolbox){MUI.updateContent({element:this.panelEl,childElement:this.panelHeaderToolboxEl,loadMethod:"xhr",url:options.headerToolboxURL,onContentLoaded:options.headerToolboxOnload})}if(options.tabsURL==null){this.titleEl.set("html",options.title)}else{this.panelHeaderContentEl.addClass("tabs");MUI.updateContent({element:this.panelEl,childElement:this.panelHeaderContentEl,loadMethod:"xhr",url:options.tabsURL,data:options.tabsData,onContentLoaded:options.tabsOnload})}MUI.updateContent({element:this.panelEl,content:options.content,method:options.method,data:options.data,url:options.contentURL,onContentLoaded:null,require:{js:options.require.js,onload:options.require.onload}});$(options.column).getChildren(".panelWrapper").each(function(b){b.getElement(".panel").removeClass("bottomPanel")});$(options.column).getChildren(".panelWrapper").getLast().getElement(".panel").addClass("bottomPanel");MUI.panelHeight(options.column,this.panelEl,"new")},collapseToggleInit:function(b){var b=this.options;this.panelHeaderCollapseBoxEl=new Element("div",{id:b.id+"_headerCollapseBox","class":"toolbox"}).inject(this.panelHeaderEl);if(b.headerToolbox){this.panelHeaderCollapseBoxEl.addClass("divider")}this.collapseToggleEl=new Element("div",{id:b.id+"_collapseToggle","class":"panel-collapse icon16",styles:{width:16,height:16},title:"Collapse Panel"}).inject(this.panelHeaderCollapseBoxEl);this.collapseToggleEl.addEvent("click",function(p){var a=this.panelEl;var z=this.panelWrapperEl;var B=MUI.Panels.instances;var r=[];z.getAllPrevious(".panelWrapper").each(function(f){var g=B.get(f.getElement(".panel").id);if(g.isCollapsed==false){r.push(f.getElement(".panel").id)}});z.getAllNext(".panelWrapper").each(function(f){var g=B.get(f.getElement(".panel").id);if(g.isCollapsed==false){r.push(f.getElement(".panel").id)}});if(this.isCollapsed==false){var u=MUI.Columns.instances.get($(b.column).id);if(r.length==0&&u.options.placement!="main"){var u=MUI.Columns.instances.get($(b.column).id);u.collapse();return}else{if(r.length==0&&u.options.placement=="main"){return}}if(b.footer){this.panelFooterEl.addClass("hidden")}this.oldHeight=a.getStyle("height").toInt();if(this.oldHeight<10){this.oldHeight=20}this.contentEl.setStyle("position","absolute");a.setStyle("height",0);this.isCollapsed=true;z.addClass("collapsed");z.removeClass("expanded");MUI.panelHeight(b.column,a,"collapsing");MUI.panelHeight();this.collapseToggleEl.removeClass("panel-collapsed");this.collapseToggleEl.addClass("panel-expand");this.collapseToggleEl.setProperty("title","Expand Panel");this.fireEvent("onCollapse")}else{if(b.footer){this.panelFooterEl.removeClass("hidden")}this.contentEl.setStyle("position",null);a.setStyle("height",this.oldHeight);this.isCollapsed=false;z.addClass("expanded");z.removeClass("collapsed");MUI.panelHeight(this.options.column,a,"expanding");MUI.panelHeight();this.collapseToggleEl.removeClass("panel-expand");this.collapseToggleEl.addClass("panel-collapsed");this.collapseToggleEl.setProperty("title","Collapse Panel");this.fireEvent("onExpand")}}.bind(this))}});MUI.Panel.implement(new Options,new Events);MUI.extend({panelHeight:function(j,l,g){if(j!=null){MUI.panelHeight2($(j),l,g)}else{$$(".column").each(function(a){MUI.panelHeight2(a)}.bind(this))}},panelHeight2:function(H,D,G){var M=MUI.Panels.instances;var C=H.getParent();var E=C.getStyle("height").toInt();if(Browser.Engine.trident4&&C==MUI.Desktop.pageWrapper){E-=1}H.setStyle("height",E);var F=[];H.getChildren(".panelWrapper").each(function(a){F.push(a.getElement(".panel"))}.bind(this));var O=[];H.getChildren(".expanded").each(function(a){O.push(a.getElement(".panel"))}.bind(this));var J=[];var I;var N=0;this.panelsTotalHeight=0;this.height=0;F.each(function(a){instance=M.get(a.id);if(a.getParent().hasClass("expanded")&&a.getParent().getNext(".expanded")){instance.partner=a.getParent().getNext(".expanded").getElement(".panel");instance.resize.attach();instance.handleEl.setStyles({display:"block",cursor:Browser.Engine.webkit?"row-resize":"n-resize"}).removeClass("detached")}else{instance.resize.detach();instance.handleEl.setStyles({display:"none",cursor:null}).addClass("detached")}if(a.getParent().getNext(".panelWrapper")==null){instance.handleEl.hide()}}.bind(this));H.getChildren().each(function(a){a.getChildren().each(function(b){if(b.hasClass("panel")){var f=M.get(b.id);anyNextSiblingsExpanded=function(j){var g;j.getParent().getAllNext(".panelWrapper").each(function(o){var l=M.get(o.getElement(".panel").id);if(l.isCollapsed==false){g=true}}.bind(this));return g}.bind(this);anyExpandingNextSiblingsExpanded=function(j){var g;D.getParent().getAllNext(".panelWrapper").each(function(o){var l=M.get(o.getElement(".panel").id);if(l.isCollapsed==false){g=true}}.bind(this));return g}.bind(this);anyNextContainsChanging=function(j){var l=[];j.getParent().getAllNext(".panelWrapper").each(function(o){l.push(o.getElement(".panel"))}.bind(this));var g=l.contains(D);return g}.bind(this);nextExpandedChanging=function(j){var g;if(j.getParent().getNext(".expanded")){if(j.getParent().getNext(".expanded").getElement(".panel")==D){g=true}}return g};if(G=="new"){if(!f.isCollapsed&&b!=D){J.push(b);this.panelsTotalHeight+=b.offsetHeight.toInt()}}else{if(G==null||G=="collapsing"){if(!f.isCollapsed&&(!anyNextContainsChanging(b)||!anyNextSiblingsExpanded(b))){J.push(b);this.panelsTotalHeight+=b.offsetHeight.toInt()}}else{if(G=="expanding"&&!f.isCollapsed&&b!=D){if(!anyNextContainsChanging(b)||(!anyExpandingNextSiblingsExpanded(b)&&nextExpandedChanging(b))){J.push(b);this.panelsTotalHeight+=b.offsetHeight.toInt()}}}}if(b.style.height){this.height+=b.getStyle("height").toInt()}}else{this.height+=b.offsetHeight.toInt()}}.bind(this))}.bind(this));var K=H.offsetHeight.toInt()-this.height;this.height=0;H.getChildren().each(function(a){this.height+=a.offsetHeight.toInt()}.bind(this));var K=H.offsetHeight.toInt()-this.height;J.each(function(f){var a=this.panelsTotalHeight/f.offsetHeight.toInt();var b=f.getStyle("height").toInt()+(K/a);if(b<1){b=0}f.setStyle("height",b);if(!$defined(G)){M[f.id].fireEvent("onResize")}}.bind(this));this.height=0;H.getChildren().each(function(a){a.getChildren().each(function(b){this.height+=b.offsetHeight.toInt();if(b.hasClass("panel")&&b.getStyle("height").toInt()>N){I=b;N=b.getStyle("height").toInt()}}.bind(this))}.bind(this));var K=H.offsetHeight.toInt()-this.height;if(K!=0&&N>0){I.setStyle("height",I.getStyle("height").toInt()+K);if(I.getStyle("height")<1){I.setStyle("height",0)}}C.getChildren(".columnHandle").each(function(a){var b=a.getParent();if(b.getStyle("height").toInt()<1){return}var f=b.getStyle("height").toInt()-a.getStyle("border-top").toInt()-a.getStyle("border-bottom").toInt();if(Browser.Engine.trident4&&b==MUI.Desktop.pageWrapper){f-=1}a.setStyle("height",f)});O.each(function(a){MUI.resizeChildren(a)}.bind(this))},resizeChildren:function(j){var o=MUI.Panels.instances;var l=o.get(j.id);var p=l.contentWrapperEl;if(l.iframeEl){if(!Browser.Engine.trident){l.iframeEl.setStyles({height:p.getStyle("height"),width:p.offsetWidth-p.getStyle("border-left").toInt()-p.getStyle("border-right").toInt()})}else{l.iframeEl.setStyles({height:p.getStyle("height"),width:p.offsetWidth-p.getStyle("border-left").toInt()-p.getStyle("border-right").toInt()-1});l.iframeEl.setStyles({width:p.offsetWidth-p.getStyle("border-left").toInt()-p.getStyle("border-right").toInt()})}}},rWidth:function(b){if(b==null){var b=MUI.Desktop.desktop}b.getElements(".rWidth").each(function(p){var a=p.offsetWidth.toInt();a-=p.getStyle("border-left").toInt();a-=p.getStyle("border-right").toInt();var r=p.getParent();this.width=0;r.getChildren().each(function(f){if(f.hasClass("mocha")!=true){this.width+=f.offsetWidth.toInt()}}.bind(this));var u=r.offsetWidth.toInt()-this.width;var o=a+u;if(o<1){o=0}p.setStyle("width",o);p.getChildren(".panel").each(function(f){f.setStyle("width",o-f.getStyle("border-left").toInt()-f.getStyle("border-right").toInt());MUI.resizeChildren(f)}.bind(this))})}});function addResizeRight(z,B,o){if(!$(z)){return}z=$(z);var r=MUI.Columns.instances;var p=r.get(z.id);var u=z.getNext(".columnHandle");u.setStyle("cursor",Browser.Engine.webkit?"col-resize":"e-resize");if(!B){B=50}if(!o){o=250}if(Browser.Engine.trident){u.addEvents({mousedown:function(){u.setCapture()},mouseup:function(){u.releaseCapture()}})}p.resize=z.makeResizable({handle:u,modifiers:{x:"width",y:false},limit:{x:[B,o]},onStart:function(){z.getElements("iframe").setStyle("visibility","hidden");z.getNext(".column").getElements("iframe").setStyle("visibility","hidden")}.bind(this),onDrag:function(){if(Browser.Engine.gecko){$$(".panel").each(function(a){if(a.getElements(".mochaIframe").length==0){a.hide()}})}MUI.rWidth(z.getParent());if(Browser.Engine.gecko){$$(".panel").show()}if(Browser.Engine.trident4){z.getChildren().each(function(a){var b=$(z).getStyle("width").toInt();b-=a.getStyle("border-right").toInt();b-=a.getStyle("border-left").toInt();b-=a.getStyle("padding-right").toInt();b-=a.getStyle("padding-left").toInt();a.setStyle("width",b)}.bind(this))}}.bind(this),onComplete:function(){MUI.rWidth(z.getParent());var a=z.getNext(".column");z.getElements("iframe").setStyle("visibility","visible");a.getElements("iframe").setStyle("visibility","visible");p.fireEvent("onResize");r[a.id].fireEvent("onResize")}.bind(this)})}function addResizeLeft(B,C,p){if(!$(B)){return}B=$(B);var D=MUI.Columns.instances;var u=D.get(B.id);var r=B.getPrevious(".columnHandle");r.setStyle("cursor",Browser.Engine.webkit?"col-resize":"e-resize");var z=B.getPrevious(".column");if(!C){C=50}if(!p){p=250}if(Browser.Engine.trident){r.addEvents({mousedown:function(){r.setCapture()},mouseup:function(){r.releaseCapture()}})}u.resize=B.makeResizable({handle:r,modifiers:{x:"width",y:false},invert:true,limit:{x:[C,p]},onStart:function(){$(B).getElements("iframe").setStyle("visibility","hidden");z.getElements("iframe").setStyle("visibility","hidden")}.bind(this),onDrag:function(){MUI.rWidth(B.getParent())}.bind(this),onComplete:function(){MUI.rWidth(B.getParent());$(B).getElements("iframe").setStyle("visibility","visible");z.getElements("iframe").setStyle("visibility","visible");u.fireEvent("onResize");D[z.id].fireEvent("onResize")}.bind(this)})}function addResizeBottom(j){if(!$(j)){return}var j=$(j);var o=MUI.Panels.instances;var l=o.get(j.id);var p=l.handleEl;p.setStyle("cursor",Browser.Engine.webkit?"row-resize":"n-resize");partner=l.partner;min=0;max=function(){return j.getStyle("height").toInt()+partner.getStyle("height").toInt()}.bind(this);if(Browser.Engine.trident){p.addEvents({mousedown:function(){p.setCapture()},mouseup:function(){p.releaseCapture()}})}l.resize=j.makeResizable({handle:p,modifiers:{x:false,y:"height"},limit:{y:[min,max]},invert:false,onBeforeStart:function(){partner=l.partner;this.originalHeight=j.getStyle("height").toInt();this.partnerOriginalHeight=partner.getStyle("height").toInt()}.bind(this),onStart:function(){if(l.iframeEl){if(!Browser.Engine.trident){l.iframeEl.setStyle("visibility","hidden");partner.getElements("iframe").setStyle("visibility","hidden")}else{l.iframeEl.hide();partner.getElements("iframe").hide()}}}.bind(this),onDrag:function(){partnerHeight=partnerOriginalHeight;partnerHeight+=(this.originalHeight-j.getStyle("height").toInt());partner.setStyle("height",partnerHeight);MUI.resizeChildren(j,j.getStyle("height").toInt());MUI.resizeChildren(partner,partnerHeight);j.getChildren(".column").each(function(a){MUI.panelHeight(a)});partner.getChildren(".column").each(function(a){MUI.panelHeight(a)})}.bind(this),onComplete:function(){partnerHeight=partnerOriginalHeight;partnerHeight+=(this.originalHeight-j.getStyle("height").toInt());partner.setStyle("height",partnerHeight);MUI.resizeChildren(j,j.getStyle("height").toInt());MUI.resizeChildren(partner,partnerHeight);j.getChildren(".column").each(function(b){MUI.panelHeight(b)});partner.getChildren(".column").each(function(b){MUI.panelHeight(b)});if(l.iframeEl){if(!Browser.Engine.trident){l.iframeEl.setStyle("visibility","visible");partner.getElements("iframe").setStyle("visibility","visible")}else{l.iframeEl.show();partner.getElements("iframe").show();var a=l.iframeEl.getStyle("width").toInt();l.iframeEl.setStyle("width",a-1);MUI.rWidth();l.iframeEl.setStyle("width",a)}}l.fireEvent("onResize");o[partner.id].fireEvent("onResize")}.bind(this)})}MUI.Column.implement({hide:function(){this.columnCollapse();this.handleEl.removeEvents("click")},show:function(){this.columnExpand()},expand:function(){this.columnExpand()},collapse:function(){this.columnCollapse()}});MUI.Panel.implement({destroy:function(){MUI.closePanel(this.options.id)},isOpen:function(){return this.panelWrapperEl.hasClass("expanded")},toggle:function(){if(this.isOpen()){this.collapse()}else{this.expand()}},collapse:function(){var z=this.options;var r=this.panelEl;var o=this.panelWrapperEl;var p=MUI.Panels.instances;var u=[];o.getAllPrevious(".panelWrapper").each(function(a){var b=p.get(a.getElement(".panel").id);if(b.isCollapsed==false){u.push(a.getElement(".panel").id)}});o.getAllNext(".panelWrapper").each(function(a){var b=p.get(a.getElement(".panel").id);if(b.isCollapsed==false){u.push(a.getElement(".panel").id)}});var B=MUI.Columns.instances.get($(z.column).id);if(u.length==0&&B.options.placement!="main"){var B=MUI.Columns.instances.get($(z.column).id);B.columnToggle();return}else{if(u.length==0&&B.options.placement=="main"){return}}if(z.footer){this.panelFooterEl.addClass("hidden")}this.oldHeight=r.getStyle("height").toInt();if(this.oldHeight<10){this.oldHeight=20}this.contentEl.setStyle("position","absolute");r.setStyle("height",0);this.isCollapsed=true;o.addClass("collapsed");o.removeClass("expanded");MUI.panelHeight(z.column,r,"collapsing");MUI.panelHeight();this.collapseToggleEl.removeClass("panel-collapsed");this.collapseToggleEl.addClass("panel-expand");this.collapseToggleEl.setProperty("title","Expand Panel");this.fireEvent("onCollapse")},expand:function(){var u=this.options;var o=this.panelEl;var l=this.panelWrapperEl;var p=MUI.Panels.instances;var r=[];l.getAllPrevious(".panelWrapper").each(function(b){var a=p.get(b.getElement(".panel").id);if(a.isCollapsed==false){r.push(b.getElement(".panel").id)}});l.getAllNext(".panelWrapper").each(function(b){var a=p.get(b.getElement(".panel").id);if(a.isCollapsed==false){r.push(b.getElement(".panel").id)}});if(u.footer){this.panelFooterEl.removeClass("hidden")}this.contentEl.setStyle("position",null);o.setStyle("height",this.oldHeight);this.isCollapsed=false;l.addClass("expanded");l.removeClass("collapsed");MUI.panelHeight(this.options.column,o,"expanding");MUI.panelHeight();this.collapseToggleEl.removeClass("panel-expand");this.collapseToggleEl.addClass("panel-collapsed");this.collapseToggleEl.setProperty("title","Collapse Panel");this.fireEvent("onExpand")}});MUI.extend({closeColumn:function(l){l=$(l);if(l==null){return}var p=MUI.Columns.instances;var o=p.get(l.id);if(o==null||o.isClosing){return}o.isClosing=true;var u=$(l).getElements(".panel");u.each(function(a){MUI.closePanel(a.id)}.bind(this));if(Browser.Engine.trident){l.dispose();if(o.handleEl!=null){o.handleEl.dispose()}}else{l.destroy();if(o.handleEl!=null){o.handleEl.destroy()}}if(MUI.Desktop){MUI.Desktop.resizePanels()}var r=o.options.container.retrieve("sortables");if(r){r.removeLists(l)}p.erase(o.options.id);return true},closePanel:function(D){D=$(D);if(D==null){return}var u=MUI.Panels.instances;var r=u.get(D.id);if(D!=$(D)||r.isClosing){return}var C=r.options.column;r.isClosing=true;var B=MUI.Columns.instances;var z=B.get(C);if(z.options.sortable){z.options.container.retrieve("sortables").removeItems(r.panelWrapperEl)}r.panelWrapperEl.destroy();if(MUI.Desktop){MUI.Desktop.resizePanels()}var p=$(C).getElements(".panelWrapper");p.each(function(a){a.getElement(".panel").removeClass("bottomPanel")});if(p.length>0){p.getLast().getElement(".panel").addClass("bottomPanel")}u.erase(r.options.id);return true}});MUI.files[MUI.path.source+"Layout/Dock.js"]="loaded";MUI.options.extend({dockWrapper:"dockWrapper",dockVisible:"true",dock:"dock"});MUI.extend({minimizeAll:function(){$$(".mocha").each(function(f){var g=f.retrieve("instance");if(!g.isMinimized&&g.options.minimizable==true){MUI.Dock.minimizeWindow(f)}}.bind(this))}});MUI.Dock={options:{useControls:true,dockPosition:"bottom",dockVisible:true,trueButtonColor:[70,245,70],enabledButtonColor:[115,153,191],disabledButtonColor:[170,170,170]},initialize:function(b){if(!MUI.Desktop){return}MUI.dockVisible=this.options.dockVisible;this.dockWrapper=$(MUI.options.dockWrapper);this.dock=$(MUI.options.dock);this.autoHideEvent=null;this.dockAutoHide=false;if(!this.dockWrapper){return}if(!this.options.useControls){if($("dockPlacement")){$("dockPlacement").setStyle("cursor","default")}if($("dockAutoHide")){$("dockAutoHide").setStyle("cursor","default")}}this.dockWrapper.setStyles({display:"block",position:"absolute",top:null,bottom:MUI.Desktop.desktopFooter?MUI.Desktop.desktopFooter.offsetHeight:0,left:0});if(this.options.useControls){this.initializeDockControls()}if($("dockLinkCheck")){this.sidebarCheck=new Element("div",{"class":"check",id:"dock_check"}).inject($("dockLinkCheck"))}this.dockSortables=new Sortables("#dockSort",{opacity:1,constrain:true,clone:false,revert:false});if(!(MUI.dockVisible)){this.dockWrapper.hide()}MUI.Desktop.setDesktopSize();if(MUI.myChain){MUI.myChain.callChain()}},initializeDockControls:function(){this.setDockColors();if(this.options.useControls){var g=new Element("canvas",{id:"dockCanvas",width:"15",height:"18"}).inject(this.dock);if(Browser.Engine.trident&&MUI.ieSupport=="excanvas"&&typeof G_vmlCanvasManager!="undefined"){G_vmlCanvasManager.initElement(g)}}var j=$("dockPlacement");var l=$("dockAutoHide");j.setProperty("title","Position Dock Top");j.addEvent("click",function(){this.moveDock()}.bind(this));l.setProperty("title","Turn Auto Hide On");l.addEvent("click",function(a){if(this.dockWrapper.getProperty("dockPosition")=="top"){return false}var b=$("dockCanvas").getContext("2d");this.dockAutoHide=!this.dockAutoHide;if(this.dockAutoHide){$("dockAutoHide").setProperty("title","Turn Auto Hide Off");MUI.circle(b,5,14,3,this.options.trueButtonColor,1);this.autoHideEvent=function(p){if(!this.dockAutoHide){return}if(!MUI.Desktop.desktopFooter){var f=this.dockWrapper.offsetHeight;if(f<25){f=25}}else{if(MUI.Desktop.desktopFooter){var f=this.dockWrapper.offsetHeight+MUI.Desktop.desktopFooter.offsetHeight;if(f<25){f=25}}}if(!MUI.Desktop.desktopFooter&&p.client.y>(document.getCoordinates().height-f)){if(!MUI.dockVisible){this.dockWrapper.show();MUI.dockVisible=true;MUI.Desktop.setDesktopSize()}}else{if(MUI.Desktop.desktopFooter&&p.client.y>(document.getCoordinates().height-f)){if(!MUI.dockVisible){this.dockWrapper.show();MUI.dockVisible=true;MUI.Desktop.setDesktopSize()}}else{if(MUI.dockVisible){this.dockWrapper.hide();MUI.dockVisible=false;MUI.Desktop.setDesktopSize()}}}}.bind(this);document.addEvent("mousemove",this.autoHideEvent)}else{$("dockAutoHide").setProperty("title","Turn Auto Hide On");MUI.circle(b,5,14,3,this.options.enabledButtonColor,1);document.removeEvent("mousemove",this.autoHideEvent)}}.bind(this));this.renderDockControls();if(this.options.dockPosition=="top"){this.moveDock()}},setDockColors:function(){var l=MUI.getCSSRule(".dockButtonEnabled");if(l&&l.style.backgroundColor){this.options.enabledButtonColor=new Color(l.style.backgroundColor)}var j=MUI.getCSSRule(".dockButtonDisabled");if(j&&j.style.backgroundColor){this.options.disabledButtonColor=new Color(j.style.backgroundColor)}var g=MUI.getCSSRule(".dockButtonTrue");if(g&&g.style.backgroundColor){this.options.trueButtonColor=new Color(g.style.backgroundColor)}},renderDockControls:function(){var b=$("dockCanvas").getContext("2d");b.clearRect(0,0,100,100);MUI.circle(b,5,4,3,this.options.enabledButtonColor,1);if(this.dockWrapper.getProperty("dockPosition")=="top"){MUI.circle(b,5,14,3,this.options.disabledButtonColor,1)}else{if(this.dockAutoHide){MUI.circle(b,5,14,3,this.options.trueButtonColor,1)}else{MUI.circle(b,5,14,3,this.options.enabledButtonColor,1)}}},moveDock:function(){var b=$("dockCanvas").getContext("2d");if(this.dockWrapper.getStyle("position")!="relative"){this.dockWrapper.setStyles({position:"relative",bottom:null});this.dockWrapper.addClass("top");MUI.Desktop.setDesktopSize();this.dockWrapper.setProperty("dockPosition","top");b.clearRect(0,0,100,100);MUI.circle(b,5,4,3,this.options.enabledButtonColor,1);MUI.circle(b,5,14,3,this.options.disabledButtonColor,1);$("dockPlacement").setProperty("title","Position Dock Bottom");$("dockAutoHide").setProperty("title","Auto Hide Disabled in Top Dock Position");this.dockAutoHide=false}else{this.dockWrapper.setStyles({position:"absolute",bottom:MUI.Desktop.desktopFooter?MUI.Desktop.desktopFooter.offsetHeight:0});this.dockWrapper.removeClass("top");MUI.Desktop.setDesktopSize();this.dockWrapper.setProperty("dockPosition","bottom");b.clearRect(0,0,100,100);MUI.circle(b,5,4,3,this.options.enabledButtonColor,1);MUI.circle(b,5,14,3,this.options.enabledButtonColor,1);$("dockPlacement").setProperty("title","Position Dock Top");$("dockAutoHide").setProperty("title","Turn Auto Hide On")}},createDockTab:function(p){var o=p.retrieve("instance");var r=new Element("div",{id:o.options.id+"_dockTab","class":"dockTab",title:l}).inject($("dockClear"),"before");r.addEvent("mousedown",function(a){new Event(a).stop();this.timeDown=$time()});r.addEvent("mouseup",function(a){this.timeUp=$time();if((this.timeUp-this.timeDown)<275){if(MUI.Windows.windowsVisible==false){MUI.toggleWindowVisibility();if(o.isMinimized==true){MUI.Dock.restoreMinimized.delay(25,MUI.Dock,p)}else{MUI.focusWindow(p)}return}if(o.isMinimized==true){MUI.Dock.restoreMinimized.delay(25,MUI.Dock,p)}else{if(o.windowEl.hasClass("isFocused")&&o.options.minimizable==true){MUI.Dock.minimizeWindow(p)}else{MUI.focusWindow(p)}var b=document.getCoordinates();if(p.getStyle("left").toInt()>b.width||p.getStyle("top").toInt()>b.height){MUI.centerWindow(p)}}}});this.dockSortables.addItems(r);var l=o.titleEl.innerHTML;var u=new Element("div",{id:o.options.id+"_dockTabText","class":"dockText"}).set("html",l.substring(0,19)+(l.length>19?"...":"")).inject($(r));if(o.options.icon!=false){}MUI.Desktop.setDesktopSize()},makeActiveTab:function(){var l=MUI.getWindowWithHighestZindex();var j=l.retrieve("instance");$$(".dockTab").removeClass("activeDockTab");if(j.isMinimized!=true){j.windowEl.addClass("isFocused");var g=$(j.options.id+"_dockTab");if(g!=null){g.addClass("activeDockTab")}}else{j.windowEl.removeClass("isFocused")}},minimizeWindow:function(l){if(l!=$(l)){return}var j=l.retrieve("instance");j.isMinimized=true;if(j.iframeEl){if(!Browser.Engine.trident){j.iframeEl.setStyle("visibility","hidden")}else{j.iframeEl.hide()}}j.contentBorderEl.setStyle("visibility","hidden");if(j.toolbarWrapperEl){j.toolbarWrapperEl.hide()}l.setStyle("visibility","hidden");if(Browser.Platform.mac&&Browser.Engine.gecko){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var g=new Number(RegExp.$1);if(g<3){j.contentWrapperEl.setStyle("overflow","hidden")}}}MUI.Desktop.setDesktopSize();setTimeout(function(){l.setStyle("zIndex",1);l.removeClass("isFocused");this.makeActiveTab()}.bind(this),100);j.fireEvent("onMinimize",l)},restoreMinimized:function(f){var g=f.retrieve("instance");if(g.isMinimized==false){return}if(MUI.Windows.windowsVisible==false){MUI.toggleWindowVisibility()}MUI.Desktop.setDesktopSize();if(g.options.scrollbars==true&&!g.iframeEl){g.contentWrapperEl.setStyle("overflow","auto")}if(g.isCollapsed){MUI.collapseToggle(f)}f.setStyle("visibility","visible");g.contentBorderEl.setStyle("visibility","visible");if(g.toolbarWrapperEl){g.toolbarWrapperEl.show()}if(g.iframeEl){if(!Browser.Engine.trident){g.iframeEl.setStyle("visibility","visible")}else{g.iframeEl.show()}}g.isMinimized=false;MUI.focusWindow(f);g.fireEvent("onRestore",f)},toggle:function(){if(!MochaUI.dockVisible){this.dockWrapper.show();MUI.dockVisible=true;MUI.Desktop.setDesktopSize()}else{this.dockWrapper.hide();MUI.dockVisible=false;MUI.Desktop.setDesktopSize()}}};MUI.files[MUI.path.source+"Window/Window.js"]="loading";MUI.extend({Windows:{instances:new Hash(),indexLevel:100,windowIDCount:0,windowsVisible:true,focusingWindow:false}});MUI.Windows.windowOptions={id:null,title:"New Window",icon:false,type:"window",require:{css:[],images:[],js:[],onload:null},loadMethod:null,method:"get",contentURL:null,data:null,closeAfter:false,evalScripts:true,evalResponse:false,content:"Window content",toolbar:false,toolbarPosition:"top",toolbarHeight:29,toolbarURL:"pages/lipsum.html",toolbarData:null,toolbarContent:"",toolbarOnload:$empty,toolbar2:false,toolbar2Position:"bottom",toolbar2Height:29,toolbar2URL:"pages/lipsum.html",toolbar2Data:null,toolbar2Content:"",toolbar2Onload:$empty,container:null,restrict:true,shape:"box",collapsible:true,minimizable:true,maximizable:true,closable:true,storeOnClose:false,modalOverlayClose:true,draggable:null,draggableGrid:false,draggableLimit:false,draggableSnap:false,resizable:null,resizeLimit:{x:[250,2500],y:[125,2000]},addClass:"",width:300,height:125,headerHeight:25,footerHeight:25,cornerRadius:8,x:null,y:null,scrollbars:true,padding:{top:10,right:12,bottom:10,left:12},shadowBlur:5,shadowOffset:{x:0,y:1},controlsOffset:{right:6,top:6},useCanvas:true,useCanvasControls:true,useSpinner:true,headerStartColor:[250,250,250],headerStopColor:[229,229,229],bodyBgColor:[229,229,229],minimizeBgColor:[255,255,255],minimizeColor:[0,0,0],maximizeBgColor:[255,255,255],maximizeColor:[0,0,0],closeBgColor:[255,255,255],closeColor:[0,0,0],resizableColor:[254,254,254],onBeforeBuild:$empty,onContentLoaded:$empty,onFocus:$empty,onBlur:$empty,onResize:$empty,onMinimize:$empty,onMaximize:$empty,onRestore:$empty,onClose:$empty,onCloseComplete:$empty};MUI.Windows.windowOptionsOriginal=$merge(MUI.Windows.windowOptions);MUI.Window=new Class({Implements:[Events,Options],options:MUI.Windows.windowOptions,initialize:function(b){this.setOptions(b);var b=this.options;$extend(this,{mochaControlsWidth:0,minimizebuttonX:0,maximizebuttonX:0,closebuttonX:0,headerFooterShadow:b.headerHeight+b.footerHeight+(b.shadowBlur*2),oldTop:0,oldLeft:0,isMaximized:false,isMinimized:false,isCollapsed:false,timestamp:$time()});if(b.type!="window"){b.container=document.body;b.minimizable=false}if(!b.container){b.container=MUI.Desktop&&MUI.Desktop.desktop?MUI.Desktop.desktop:document.body}if(b.resizable==null){if(b.type!="window"||b.shape=="gauge"){b.resizable=false}else{b.resizable=true}}if(b.draggable==null){b.draggable=b.type!="window"?false:true}if(b.shape=="gauge"||b.type=="notification"){b.collapsible=false;b.maximizable=false;b.contentBgColor="transparent";b.scrollbars=false;b.footerHeight=0}if(b.type=="notification"){b.closable=false;b.headerHeight=0}if(MUI.Dock&&$(MUI.options.dock)){if(MUI.Dock.dock&&b.type!="modal"&&b.type!="modal2"){b.minimizable=b.minimizable}}else{b.minimizable=false}b.maximizable=MUI.Desktop&&MUI.Desktop.desktop&&b.maximizable&&b.type!="modal"&&b.type!="modal2";if(this.options.type=="modal2"){this.options.shadowBlur=0;this.options.shadowOffset={x:0,y:0};this.options.useSpinner=false;this.options.useCanvas=false;this.options.footerHeight=0;this.options.headerHeight=0}b.id=b.id||"win"+(++MUI.Windows.windowIDCount);this.windowEl=$(b.id);if(b.require.css.length||b.require.images.length){new MUI.Require({css:b.require.css,images:b.require.images,onload:function(){this.newWindow()}.bind(this)})}else{this.newWindow()}return this},saveValues:function(){var b=this.windowEl.getCoordinates();this.options.x=b.left.toInt();this.options.y=b.top.toInt()},newWindow:function(G){var J=MUI.Windows.instances;var M=MUI.Windows.instances.get(this.options.id);var I=this.options;if(M){var B=M}if(this.windowEl&&!this.isClosing){if(B.isMinimized){MUI.Dock.restoreMinimized(this.windowEl)}else{if(B.isCollapsed){MUI.collapseToggle(this.windowEl);setTimeout(MUI.focusWindow.pass(this.windowEl,this),10)}else{if(this.windowEl.hasClass("windowClosed")){if(B.check){B.check.show()}this.windowEl.removeClass("windowClosed");this.windowEl.setStyle("opacity",0);this.windowEl.addClass("mocha");if(MUI.Dock&&$(MUI.options.dock)&&B.options.type=="window"){var D=$(B.options.id+"_dockTab");if(D!=null){D.show()}MUI.Desktop.setDesktopSize()}B.displayNewWindow()}else{var C=document.getCoordinates();if(this.windowEl.getStyle("left").toInt()>C.width||this.windowEl.getStyle("top").toInt()>C.height){MUI.centerWindow(this.windowEl)}setTimeout(MUI.focusWindow.pass(this.windowEl,this),10);if(MUI.options.standardEffects==true){this.windowEl.shake()}}}}return}else{J.set(I.id,this)}this.isClosing=false;this.fireEvent("onBeforeBuild");MUI.Windows.indexLevel++;this.windowEl=new Element("div",{"class":"mocha",id:I.id,styles:{position:"absolute",width:I.width,height:I.height,display:"block",opacity:0,zIndex:MUI.Windows.indexLevel+=2}});this.windowEl.store("instance",this);this.windowEl.addClass(I.addClass);if(I.type=="modal2"){this.windowEl.addClass("modal2")}if(Browser.Engine.trident&&I.shape=="gauge"){this.windowEl.setStyle("backgroundImage","url(../images/spacer.gif)")}if((this.options.type=="modal"||I.type=="modal2")&&Browser.Platform.mac&&Browser.Engine.gecko){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var H=new Number(RegExp.$1);if(H<3){this.windowEl.setStyle("position","fixed")}}}if(I.loadMethod=="iframe"){I.padding={top:0,right:0,bottom:0,left:0}}this.insertWindowElements();this.titleEl.set("html",I.title);this.contentWrapperEl.setStyle("overflow","hidden");this.contentEl.setStyles({"padding-top":I.padding.top,"padding-bottom":I.padding.bottom,"padding-left":I.padding.left,"padding-right":I.padding.right});if(I.shape=="gauge"){if(I.useCanvasControls){this.canvasControlsEl.setStyle("visibility","hidden")}else{this.controlsEl.setStyle("visibility","hidden")}this.windowEl.addEvent("mouseover",function(){this.mouseover=true;var a=function(){if(this.mouseover!=false){if(I.useCanvasControls){this.canvasControlsEl.setStyle("visibility","visible")}else{this.controlsEl.setStyle("visibility","visible")}this.canvasHeaderEl.setStyle("visibility","visible");this.titleEl.show()}};a.delay(0,this)}.bind(this));this.windowEl.addEvent("mouseleave",function(){this.mouseover=false;if(this.options.useCanvasControls){this.canvasControlsEl.setStyle("visibility","hidden")}else{this.controlsEl.setStyle("visibility","hidden")}this.canvasHeaderEl.setStyle("visibility","hidden");this.titleEl.hide()}.bind(this))}this.windowEl.inject(I.container);this.setColors();if(I.type!="notification"){this.setMochaControlsWidth()}MUI.updateContent({element:this.windowEl,content:I.content,method:I.method,url:I.contentURL,data:I.data,onContentLoaded:null,require:{js:I.require.js,onload:I.require.onload}});if(this.options.toolbar==true){MUI.updateContent({element:this.windowEl,childElement:this.toolbarEl,content:I.toolbarContent,loadMethod:"xhr",method:I.method,url:I.toolbarURL,data:I.toolbarData,onContentLoaded:I.toolbarOnload})}if(this.options.toolbar2==true){MUI.updateContent({element:this.windowEl,childElement:this.toolbar2El,content:I.toolbar2Content,loadMethod:"xhr",method:I.method,url:I.toolbar2URL,data:I.toolbar2Data,onContentLoaded:I.toolbar2Onload})}this.drawWindow();this.attachDraggable();this.attachResizable();this.setupEvents();if(I.resizable){this.adjustHandles()}if(I.container==document.body||I.container==MUI.Desktop.desktop){var K=window.getSize()}else{var K=$(this.options.container).getSize()}var E,F;if(!I.y){if(MUI.Desktop&&MUI.Desktop.desktop){F=(K.y*0.5)-(this.windowEl.offsetHeight*0.5);if(F<-I.shadowBlur){F=-I.shadowBlur}}else{F=window.getScroll().y+(window.getSize().y*0.5)-(this.windowEl.offsetHeight*0.5);if(F<-I.shadowBlur){F=-I.shadowBlur}}}else{F=I.y-I.shadowBlur}if(this.options.x==null){E=(K.x*0.5)-(this.windowEl.offsetWidth*0.5);if(E<-I.shadowBlur){E=-I.shadowBlur}}else{E=I.x-I.shadowBlur}this.windowEl.setStyles({top:F,left:E});this.opacityMorph=new Fx.Morph(this.windowEl,{duration:350,transition:Fx.Transitions.Sine.easeInOut,onComplete:function(){if(Browser.Engine.trident){this.drawWindow()}}.bind(this)});this.displayNewWindow();this.morph=new Fx.Morph(this.windowEl,{duration:200});this.windowEl.store("morph",this.morph);this.resizeMorph=new Fx.Elements([this.contentWrapperEl,this.windowEl],{duration:400,transition:Fx.Transitions.Sine.easeInOut,onStart:function(){this.resizeAnimation=this.drawWindow.periodical(20,this)}.bind(this),onComplete:function(){$clear(this.resizeAnimation);this.drawWindow();if(this.iframeEl){this.iframeEl.setStyle("visibility","visible")}}.bind(this)});this.windowEl.store("resizeMorph",this.resizeMorph);if($(this.windowEl.id+"LinkCheck")){this.check=new Element("div",{"class":"check",id:this.options.id+"_check"}).inject(this.windowEl.id+"LinkCheck")}if(this.options.closeAfter!=false){MUI.closeWindow.delay(this.options.closeAfter,this,this.windowEl)}if(MUI.Dock&&$(MUI.options.dock)&&this.options.type=="window"){MUI.Dock.createDockTab(this.windowEl)}},displayNewWindow:function(){options=this.options;if(options.type=="modal"||options.type=="modal2"){MUI.currentModal=this.windowEl;if(Browser.Engine.trident4){$("modalFix").show()}$("modalOverlay").show();if(MUI.options.advancedEffects==false){$("modalOverlay").setStyle("opacity",0.6);this.windowEl.setStyles({zIndex:11000,opacity:1})}else{MUI.Modal.modalOverlayCloseMorph.cancel();MUI.Modal.modalOverlayOpenMorph.start({opacity:0.6});this.windowEl.setStyles({zIndex:11000});this.opacityMorph.start({opacity:1})}$$(".dockTab").removeClass("activeDockTab");$$(".mocha").removeClass("isFocused");this.windowEl.addClass("isFocused")}else{if(MUI.options.advancedEffects==false){this.windowEl.setStyle("opacity",1);setTimeout(MUI.focusWindow.pass(this.windowEl,this),10)}else{if(Browser.Engine.trident){this.drawWindow(false)}this.opacityMorph.start({opacity:1});setTimeout(MUI.focusWindow.pass(this.windowEl,this),10)}}},setupEvents:function(){var b=this.windowEl;if(this.closeButtonEl){this.closeButtonEl.addEvent("click",function(a){new Event(a).stop();MUI.closeWindow(b)}.bind(this))}if(this.options.type=="window"){b.addEvent("mousedown",function(a){if(Browser.Engine.trident){new Event(a).stop()}MUI.focusWindow(b);if(b.getStyle("top").toInt()<-this.options.shadowBlur){b.setStyle("top",-this.options.shadowBlur)}}.bind(this))}if(this.minimizeButtonEl){this.minimizeButtonEl.addEvent("click",function(a){new Event(a).stop();MUI.Dock.minimizeWindow(b)}.bind(this))}if(this.maximizeButtonEl){this.maximizeButtonEl.addEvent("click",function(a){new Event(a).stop();if(this.isMaximized){MUI.Desktop.restoreWindow(b)}else{MUI.Desktop.maximizeWindow(b)}}.bind(this))}if(this.options.collapsible==true){this.titleEl.addEvent("selectstart",function(a){a=new Event(a).stop()}.bind(this));if(Browser.Engine.trident){this.titleBarEl.addEvent("mousedown",function(a){this.titleEl.setCapture()}.bind(this));this.titleBarEl.addEvent("mouseup",function(a){this.titleEl.releaseCapture()}.bind(this))}this.titleBarEl.addEvent("dblclick",function(a){a=new Event(a).stop();MUI.collapseToggle(this.windowEl)}.bind(this))}},attachDraggable:function(){var b=this.windowEl;if(!this.options.draggable){return}this.windowDrag=new Drag.Move(b,{handle:this.titleBarEl,container:this.options.restrict==true?$(this.options.container):false,grid:this.options.draggableGrid,limit:this.options.draggableLimit,snap:this.options.draggableSnap,onStart:function(){if(this.options.type!="modal"&&this.options.type!="modal2"){MUI.focusWindow(b);$("windowUnderlay").show()}if(this.iframeEl){if(!Browser.Engine.trident){this.iframeEl.setStyle("visibility","hidden")}else{this.iframeEl.hide()}}}.bind(this),onComplete:function(){if(this.options.type!="modal"&&this.options.type!="modal2"){$("windowUnderlay").hide()}if(this.iframeEl){if(!Browser.Engine.trident){this.iframeEl.setStyle("visibility","visible")}else{this.iframeEl.show()}}this.saveValues()}.bind(this)})},attachResizable:function(){var b=this.windowEl;if(!this.options.resizable){return}this.resizable1=this.windowEl.makeResizable({handle:[this.n,this.ne,this.nw],limit:{y:[function(){return this.windowEl.getStyle("top").toInt()+this.windowEl.getStyle("height").toInt()-this.options.resizeLimit.y[1]}.bind(this),function(){return this.windowEl.getStyle("top").toInt()+this.windowEl.getStyle("height").toInt()-this.options.resizeLimit.y[0]}.bind(this)]},modifiers:{x:false,y:"top"},onStart:function(){this.resizeOnStart();this.coords=this.contentWrapperEl.getCoordinates();this.y2=this.coords.top.toInt()+this.contentWrapperEl.offsetHeight}.bind(this),onDrag:function(){this.coords=this.contentWrapperEl.getCoordinates();this.contentWrapperEl.setStyle("height",this.y2-this.coords.top.toInt());this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)});this.resizable2=this.contentWrapperEl.makeResizable({handle:[this.e,this.ne],limit:{x:[this.options.resizeLimit.x[0]-(this.options.shadowBlur*2),this.options.resizeLimit.x[1]-(this.options.shadowBlur*2)]},modifiers:{x:"width",y:false},onStart:function(){this.resizeOnStart()}.bind(this),onDrag:function(){this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)});this.resizable3=this.contentWrapperEl.makeResizable({container:this.options.restrict==true?$(this.options.container):false,handle:this.se,limit:{x:[this.options.resizeLimit.x[0]-(this.options.shadowBlur*2),this.options.resizeLimit.x[1]-(this.options.shadowBlur*2)],y:[this.options.resizeLimit.y[0]-this.headerFooterShadow,this.options.resizeLimit.y[1]-this.headerFooterShadow]},modifiers:{x:"width",y:"height"},onStart:function(){this.resizeOnStart()}.bind(this),onDrag:function(){this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)});this.resizable4=this.contentWrapperEl.makeResizable({handle:[this.s,this.sw],limit:{y:[this.options.resizeLimit.y[0]-this.headerFooterShadow,this.options.resizeLimit.y[1]-this.headerFooterShadow]},modifiers:{x:false,y:"height"},onStart:function(){this.resizeOnStart()}.bind(this),onDrag:function(){this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)});this.resizable5=this.windowEl.makeResizable({handle:[this.w,this.sw,this.nw],limit:{x:[function(){return this.windowEl.getStyle("left").toInt()+this.windowEl.getStyle("width").toInt()-this.options.resizeLimit.x[1]}.bind(this),function(){return this.windowEl.getStyle("left").toInt()+this.windowEl.getStyle("width").toInt()-this.options.resizeLimit.x[0]}.bind(this)]},modifiers:{x:"left",y:false},onStart:function(){this.resizeOnStart();this.coords=this.contentWrapperEl.getCoordinates();this.x2=this.coords.left.toInt()+this.contentWrapperEl.offsetWidth}.bind(this),onDrag:function(){this.coords=this.contentWrapperEl.getCoordinates();this.contentWrapperEl.setStyle("width",this.x2-this.coords.left.toInt());this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)})},resizeOnStart:function(){$("windowUnderlay").show();if(this.iframeEl){if(!Browser.Engine.trident){this.iframeEl.setStyle("visibility","hidden")}else{this.iframeEl.hide()}}},resizeOnDrag:function(){if(Browser.Engine.gecko){this.windowEl.getElements(".panel").each(function(b){b.store("oldOverflow",b.getStyle("overflow"));b.setStyle("overflow","visible")})}this.drawWindow();this.adjustHandles();if(Browser.Engine.gecko){this.windowEl.getElements(".panel").each(function(b){b.setStyle("overflow",b.retrieve("oldOverflow"))})}},resizeOnComplete:function(){$("windowUnderlay").hide();if(this.iframeEl){if(!Browser.Engine.trident){this.iframeEl.setStyle("visibility","visible")}else{this.iframeEl.show();this.iframeEl.setStyle("width","99%");this.iframeEl.setStyle("height",this.contentWrapperEl.offsetHeight);this.iframeEl.setStyle("width","100%");this.iframeEl.setStyle("height",this.contentWrapperEl.offsetHeight)}}if(this.contentWrapperEl.getChildren(".column")!=null){MUI.rWidth(this.contentWrapperEl);this.contentWrapperEl.getChildren(".column").each(function(b){MUI.panelHeight(b)})}this.fireEvent("onResize",this.windowEl)},adjustHandles:function(){var F=this.options.shadowBlur;var z=F*2;var J=this.options.shadowOffset;var E=F-J.y-1;var C=F+J.x-1;var I=F+J.y-1;var G=F-J.x-1;var D=this.windowEl.getCoordinates();var H=D.width-z+2;var B=D.height-z+2;this.n.setStyles({top:E,left:G+10,width:H-20});this.e.setStyles({top:E+10,right:C,height:B-30});this.s.setStyles({bottom:I,left:G+10,width:H-30});this.w.setStyles({top:E+10,left:G,height:B-20});this.ne.setStyles({top:E,right:C});this.se.setStyles({bottom:I,right:C});this.sw.setStyles({bottom:I,left:G});this.nw.setStyles({top:E,left:G})},detachResizable:function(){this.resizable1.detach();this.resizable2.detach();this.resizable3.detach();this.resizable4.detach();this.resizable5.detach();this.windowEl.getElements(".handle").hide()},reattachResizable:function(){this.resizable1.attach();this.resizable2.attach();this.resizable3.attach();this.resizable4.attach();this.resizable5.attach();this.windowEl.getElements(".handle").show()},insertWindowElements:function(){var z=this.options;var r=z.height;var u=z.width;var p=z.id;var o={};if(Browser.Engine.trident4){o.zIndexFixEl=new Element("iframe",{id:p+"_zIndexFix","class":"zIndexFix",scrolling:"no",marginWidth:0,marginHeight:0,src:"",styles:{position:"absolute"}}).inject(this.windowEl)}o.overlayEl=new Element("div",{id:p+"_overlay","class":"mochaOverlay",styles:{position:"absolute",top:0,left:0}}).inject(this.windowEl);o.titleBarEl=new Element("div",{id:p+"_titleBar","class":"mochaTitlebar",styles:{cursor:z.draggable?"move":"default"}}).inject(o.overlayEl,"top");o.titleEl=new Element("h3",{id:p+"_title","class":"mochaTitle"}).inject(o.titleBarEl);if(z.icon!=false){o.titleEl.setStyles({"padding-left":28,background:"url("+z.icon+") 5px 4px no-repeat"})}o.contentBorderEl=new Element("div",{id:p+"_contentBorder","class":"mochaContentBorder"}).inject(o.overlayEl);if(z.toolbar){o.toolbarWrapperEl=new Element("div",{id:p+"_toolbarWrapper","class":"mochaToolbarWrapper",styles:{height:z.toolbarHeight}}).inject(o.contentBorderEl,z.toolbarPosition=="bottom"?"after":"before");if(z.toolbarPosition=="bottom"){o.toolbarWrapperEl.addClass("bottom")}o.toolbarEl=new Element("div",{id:p+"_toolbar","class":"mochaToolbar",styles:{height:z.toolbarHeight}}).inject(o.toolbarWrapperEl)}if(z.toolbar2){o.toolbar2WrapperEl=new Element("div",{id:p+"_toolbar2Wrapper","class":"mochaToolbarWrapper",styles:{height:z.toolbar2Height}}).inject(o.contentBorderEl,z.toolbar2Position=="bottom"?"after":"before");if(z.toolbar2Position=="bottom"){o.toolbar2WrapperEl.addClass("bottom")}o.toolbar2El=new Element("div",{id:p+"_toolbar2","class":"mochaToolbar",styles:{height:z.toolbar2Height}}).inject(o.toolbar2WrapperEl)}o.contentWrapperEl=new Element("div",{id:p+"_contentWrapper","class":"mochaContentWrapper",styles:{width:u+"px",height:r+"px"}}).inject(o.contentBorderEl);if(this.options.shape=="gauge"){o.contentBorderEl.setStyle("borderWidth",0)}o.contentEl=new Element("div",{id:p+"_content","class":"mochaContent"}).inject(o.contentWrapperEl);if(this.options.useCanvas==true&&(Browser.Engine.trident!=true||(Browser.Engine.trident==true&&Browser.version>=9))){o.canvasEl=new Element("canvas",{id:p+"_canvas","class":"mochaCanvas",width:10,height:10}).inject(this.windowEl)}if(this.options.useCanvas==true&&Browser.Engine.trident&&Browser.version<9){o.canvasEl=new Element("canvas",{id:p+"_canvas","class":"mochaCanvas",width:50000,height:20000,styles:{position:"absolute",top:0,left:0}}).inject(this.windowEl);if(MUI.ieSupport=="excanvas"&&typeof G_vmlCanvasManager!="undefined"){G_vmlCanvasManager.initElement(o.canvasEl);o.canvasEl=this.windowEl.getElement(".mochaCanvas")}}o.controlsEl=new Element("div",{id:p+"_controls","class":"mochaControls"}).inject(o.overlayEl,"after");if(z.useCanvasControls==true){o.canvasControlsEl=new Element("canvas",{id:p+"_canvasControls","class":"mochaCanvasControls",width:14,height:14}).inject(this.windowEl);if(Browser.Engine.trident&&MUI.ieSupport=="excanvas"&&typeof G_vmlCanvasManager!="undefined"){G_vmlCanvasManager.initElement(o.canvasControlsEl);o.canvasControlsEl=this.windowEl.getElement(".mochaCanvasControls")}}if(z.closable){o.closeButtonEl=new Element("div",{id:p+"_closeButton","class":"mochaCloseButton mochaWindowButton",title:"Close"}).inject(o.controlsEl)}if(z.maximizable){o.maximizeButtonEl=new Element("div",{id:p+"_maximizeButton","class":"mochaMaximizeButton mochaWindowButton",title:"Maximize"}).inject(o.controlsEl)}if(z.minimizable){o.minimizeButtonEl=new Element("div",{id:p+"_minimizeButton","class":"mochaMinimizeButton mochaWindowButton",title:"Minimize"}).inject(o.controlsEl)}if(z.useSpinner==true&&z.shape!="gauge"&&z.type!="notification"){o.spinnerEl=new Element("div",{id:p+"_spinner","class":"mochaSpinner",width:16,height:16}).inject(this.windowEl,"bottom")}if(this.options.shape=="gauge"){o.canvasHeaderEl=new Element("canvas",{id:p+"_canvasHeader","class":"mochaCanvasHeader",width:this.options.width,height:26}).inject(this.windowEl,"bottom");if(Browser.Engine.trident&&MUI.ieSupport=="excanvas"&&typeof G_vmlCanvasManager!="undefined"){G_vmlCanvasManager.initElement(o.canvasHeaderEl);o.canvasHeaderEl=this.windowEl.getElement(".mochaCanvasHeader")}}if(Browser.Engine.trident){o.overlayEl.setStyle("zIndex",2)}if(Browser.Platform.mac&&Browser.Engine.gecko){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var B=new Number(RegExp.$1);if(B<3){o.overlayEl.setStyle("overflow","auto")}}}if(z.resizable){o.n=new Element("div",{id:p+"_resizeHandle_n","class":"handle",styles:{top:0,left:10,cursor:"n-resize"}}).inject(o.overlayEl,"after");o.ne=new Element("div",{id:p+"_resizeHandle_ne","class":"handle corner",styles:{top:0,right:0,cursor:"ne-resize"}}).inject(o.overlayEl,"after");o.e=new Element("div",{id:p+"_resizeHandle_e","class":"handle",styles:{top:10,right:0,cursor:"e-resize"}}).inject(o.overlayEl,"after");o.se=new Element("div",{id:p+"_resizeHandle_se","class":"handle cornerSE",styles:{bottom:0,right:0,cursor:"se-resize"}}).inject(o.overlayEl,"after");o.s=new Element("div",{id:p+"_resizeHandle_s","class":"handle",styles:{bottom:0,left:10,cursor:"s-resize"}}).inject(o.overlayEl,"after");o.sw=new Element("div",{id:p+"_resizeHandle_sw","class":"handle corner",styles:{bottom:0,left:0,cursor:"sw-resize"}}).inject(o.overlayEl,"after");o.w=new Element("div",{id:p+"_resizeHandle_w","class":"handle",styles:{top:10,left:0,cursor:"w-resize"}}).inject(o.overlayEl,"after");o.nw=new Element("div",{id:p+"_resizeHandle_nw","class":"handle corner",styles:{top:0,left:0,cursor:"nw-resize"}}).inject(o.overlayEl,"after")}$extend(this,o)},setColors:function(){if(this.options.useCanvas==true){var p=/\?(.*?)\)/;if(this.titleBarEl.getStyle("backgroundImage")!="none"){var o=this.titleBarEl.getStyle("backgroundImage");o=o.match(p)[1];o=o.parseQueryString();var l=o.from;var j=o.to.replace(/\"/,"");this.options.headerStartColor=new Color(l);this.options.headerStopColor=new Color(j);this.titleBarEl.addClass("replaced")}else{if(this.titleBarEl.getStyle("background-color")!==""&&this.titleBarEl.getStyle("background-color")!=="transparent"){this.options.headerStartColor=new Color(this.titleBarEl.getStyle("background-color")).mix("#fff",20);this.options.headerStopColor=new Color(this.titleBarEl.getStyle("background-color")).mix("#000",20);this.titleBarEl.addClass("replaced")}}if(this.windowEl.getStyle("background-color")!==""&&this.windowEl.getStyle("background-color")!=="transparent"){this.options.bodyBgColor=new Color(this.windowEl.getStyle("background-color"));this.windowEl.addClass("replaced")}if(this.options.resizable&&this.se.getStyle("background-color")!==""&&this.se.getStyle("background-color")!=="transparent"){this.options.resizableColor=new Color(this.se.getStyle("background-color"));this.se.addClass("replaced")}}if(this.options.useCanvasControls==true){if(this.minimizeButtonEl){if(this.minimizeButtonEl.getStyle("color")!==""&&this.minimizeButtonEl.getStyle("color")!=="transparent"){this.options.minimizeColor=new Color(this.minimizeButtonEl.getStyle("color"))}if(this.minimizeButtonEl.getStyle("background-color")!==""&&this.minimizeButtonEl.getStyle("background-color")!=="transparent"){this.options.minimizeBgColor=new Color(this.minimizeButtonEl.getStyle("background-color"));this.minimizeButtonEl.addClass("replaced")}}if(this.maximizeButtonEl){if(this.maximizeButtonEl.getStyle("color")!==""&&this.maximizeButtonEl.getStyle("color")!=="transparent"){this.options.maximizeColor=new Color(this.maximizeButtonEl.getStyle("color"))}if(this.maximizeButtonEl.getStyle("background-color")!==""&&this.maximizeButtonEl.getStyle("background-color")!=="transparent"){this.options.maximizeBgColor=new Color(this.maximizeButtonEl.getStyle("background-color"));this.maximizeButtonEl.addClass("replaced")}}if(this.closeButtonEl){if(this.closeButtonEl.getStyle("color")!==""&&this.closeButtonEl.getStyle("color")!=="transparent"){this.options.closeColor=new Color(this.closeButtonEl.getStyle("color"))}if(this.closeButtonEl.getStyle("background-color")!==""&&this.closeButtonEl.getStyle("background-color")!=="transparent"){this.options.closeBgColor=new Color(this.closeButtonEl.getStyle("background-color"));this.closeButtonEl.addClass("replaced")}}}},drawWindow:function(M){if(this.drawingWindow==true){return}this.drawingWindow=true;if(this.isCollapsed){this.drawWindowCollapsed(M);return}var F=this.windowEl;var E=this.options;var J=E.shadowBlur;var C=J*2;var K=this.options.shadowOffset;this.overlayEl.setStyles({width:this.contentWrapperEl.offsetWidth});if(this.iframeEl){this.iframeEl.setStyle("height",this.contentWrapperEl.offsetHeight)}var I=this.contentBorderEl.getStyle("border-top").toInt()+this.contentBorderEl.getStyle("border-bottom").toInt();var G=this.toolbarWrapperEl?this.toolbarWrapperEl.getStyle("height").toInt()+this.toolbarWrapperEl.getStyle("border-top").toInt():0;var H=this.toolbar2WrapperEl?this.toolbar2WrapperEl.getStyle("height").toInt()+this.toolbar2WrapperEl.getStyle("border-top").toInt():0;this.headerFooterShadow=E.headerHeight+E.footerHeight+C;var D=this.contentWrapperEl.getStyle("height").toInt()+this.headerFooterShadow+G+H+I;var N=this.contentWrapperEl.getStyle("width").toInt()+C;this.windowEl.setStyles({height:D,width:N});this.overlayEl.setStyles({height:D,top:J-K.y,left:J-K.x});if(this.options.useCanvas==true){if(Browser.Engine.trident){this.canvasEl.height=20000;this.canvasEl.width=50000}this.canvasEl.height=D;this.canvasEl.width=N}if(Browser.Engine.trident4){this.zIndexFixEl.setStyles({width:N,height:D})}this.titleBarEl.setStyles({width:N-C,height:E.headerHeight});if(E.useSpinner==true&&E.shape!="gauge"&&E.type!="notification"){this.spinnerEl.setStyles({left:J-K.x+3,bottom:J+K.y+4})}if(this.options.useCanvas!=false){var O=this.canvasEl.getContext("2d");O.clearRect(0,0,N,D);switch(E.shape){case"box":this.drawBox(O,N,D,J,K,M);break;case"gauge":this.drawGauge(O,N,D,J,K,M);break}if(E.resizable){MUI.triangle(O,N-(J+K.x+17),D-(J+K.y+18),11,11,E.resizableColor,1)}if(Browser.Engine.trident){MUI.triangle(O,0,0,10,10,E.resizableColor,0)}}if(E.type!="notification"&&E.useCanvasControls==true){this.drawControls(N,D,M)}if(MUI.Desktop&&this.contentWrapperEl.getChildren(".column").length!=0){MUI.rWidth(this.contentWrapperEl);this.contentWrapperEl.getChildren(".column").each(function(a){MUI.panelHeight(a)})}this.drawingWindow=false;return this},drawWindowCollapsed:function(H){var E=this.windowEl;var J=this.options;var G=J.shadowBlur;var D=G*2;var z=J.shadowOffset;var F=J.headerHeight+D+2;var C=F;var I=this.contentWrapperEl.getStyle("width").toInt()+D;this.windowEl.setStyle("height",C);this.overlayEl.setStyles({height:C,top:G-z.y,left:G-z.x});if(Browser.Engine.trident4){this.zIndexFixEl.setStyles({width:I,height:C})}this.windowEl.setStyle("width",I);this.overlayEl.setStyle("width",I);this.titleBarEl.setStyles({width:I-D,height:J.headerHeight});if(this.options.useCanvas!=false){this.canvasEl.height=C;this.canvasEl.width=I;var B=this.canvasEl.getContext("2d");B.clearRect(0,0,I,C);this.drawBoxCollapsed(B,I,C,G,z,H);if(J.useCanvasControls==true){this.drawControls(I,C,H)}if(Browser.Engine.trident){MUI.triangle(B,0,0,10,10,J.resizableColor,0)}}this.drawingWindow=false;return this},drawControls:function(F,B,E){var z=this.options;var C=z.shadowBlur;var D=z.shadowOffset;var r=z.controlsOffset;this.controlsEl.setStyles({right:C+D.x+r.right,top:C-D.y+r.top});this.canvasControlsEl.setStyles({right:C+D.x+r.right,top:C-D.y+r.top});this.closebuttonX=z.closable?this.mochaControlsWidth-7:this.mochaControlsWidth+12;this.maximizebuttonX=this.closebuttonX-(z.maximizable?19:0);this.minimizebuttonX=this.maximizebuttonX-(z.minimizable?19:0);var u=this.canvasControlsEl.getContext("2d");u.clearRect(0,0,100,100);if(this.options.closable){this.closebutton(u,this.closebuttonX,7,z.closeBgColor,1,z.closeColor,1)}if(this.options.maximizable){this.maximizebutton(u,this.maximizebuttonX,7,z.maximizeBgColor,1,z.maximizeColor,1)}if(this.options.minimizable){this.minimizebutton(u,this.minimizebuttonX,7,z.minimizeBgColor,1,z.minimizeColor,1)}if(Browser.Engine.trident){MUI.circle(u,0,0,3,this.options.resizableColor,0)}},drawBox:function(B,I,C,G,z,H){var J=this.options;var D=G*2;var F=this.options.cornerRadius;if(H!=false){for(var E=0;E<=G;E++){MUI.roundedRect(B,z.x+E,z.y+E,I-(E*2)-z.x,C-(E*2)-z.y,F+(G-E),[0,0,0],E==G?0.29:0.065+(E*0.01))}}this.bodyRoundedRect(B,G-z.x,G-z.y,I-D,C-D,F,J.bodyBgColor);if(this.options.type!="notification"){this.topRoundedRect(B,G-z.x,G-z.y,I-D,J.headerHeight,F,J.headerStartColor,J.headerStopColor)}},drawBoxCollapsed:function(B,I,C,G,z,H){var J=this.options;var D=G*2;var F=J.cornerRadius;if(H!=false){for(var E=0;E<=G;E++){MUI.roundedRect(B,z.x+E,z.y+E,I-(E*2)-z.x,C-(E*2)-z.y,F+(G-E),[0,0,0],E==G?0.3:0.06+(E*0.01))}}this.topRoundedRect2(B,G-z.x,G-z.y,I-D,J.headerHeight+2,F,J.headerStartColor,J.headerStopColor)},drawGauge:function(B,H,C,F,z,G){var u=this.options;var E=(H*0.5)-(F)+16;if(G!=false){for(var D=0;D<=F;D++){MUI.circle(B,H*0.5+z.x,(C+u.headerHeight)*0.5+z.x,(H*0.5)-(D*2)-z.x,[0,0,0],D==F?0.75:0.075+(D*0.04))}}MUI.circle(B,H*0.5-z.x,(C+u.headerHeight)*0.5-z.y,(H*0.5)-F,u.bodyBgColor,1);this.canvasHeaderEl.setStyles({top:F-z.y,left:F-z.x});var B=this.canvasHeaderEl.getContext("2d");B.clearRect(0,0,H,100);B.beginPath();B.lineWidth=24;B.lineCap="round";B.moveTo(13,13);B.lineTo(H-(F*2)-13,13);B.strokeStyle="rgba(0, 0, 0, .65)";B.stroke()},bodyRoundedRect:function(B,C,D,u,p,r,z){B.fillStyle="rgba("+z.join(",")+", 1)";B.beginPath();B.moveTo(C,D+r);B.lineTo(C,D+p-r);B.quadraticCurveTo(C,D+p,C+r,D+p);B.lineTo(C+u-r,D+p);B.quadraticCurveTo(C+u,D+p,C+u,D+p-r);B.lineTo(C+u,D+r);B.quadraticCurveTo(C+u,D,C+u-r,D);B.lineTo(C+r,D);B.quadraticCurveTo(C,D,C,D+r);B.fill()},topRoundedRect:function(u,B,C,H,z,D,F,E){var G=u.createLinearGradient(0,0,0,z);G.addColorStop(0,"rgb("+F.join(",")+")");G.addColorStop(1,"rgb("+E.join(",")+")");u.fillStyle=G;u.beginPath();u.moveTo(B,C);u.lineTo(B,C+z);u.lineTo(B+H,C+z);u.lineTo(B+H,C+D);u.quadraticCurveTo(B+H,C,B+H-D,C);u.lineTo(B+D,C);u.quadraticCurveTo(B,C,B,C+D);u.fill()},topRoundedRect2:function(u,B,C,H,z,D,F,E){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){u.fillStyle="rgba("+E.join(",")+", 1)"}else{var G=u.createLinearGradient(0,this.options.shadowBlur-1,0,z+this.options.shadowBlur+3);G.addColorStop(0,"rgb("+F.join(",")+")");G.addColorStop(1,"rgb("+E.join(",")+")");u.fillStyle=G}u.beginPath();u.moveTo(B,C+D);u.lineTo(B,C+z-D);u.quadraticCurveTo(B,C+z,B+D,C+z);u.lineTo(B+H-D,C+z);u.quadraticCurveTo(B+H,C+z,B+H,C+z-D);u.lineTo(B+H,C+D);u.quadraticCurveTo(B+H,C,B+H-D,C);u.lineTo(B+D,C);u.quadraticCurveTo(B,C,B,C+D);u.fill()},maximizebutton:function(u,B,C,a,D,r,z){u.beginPath();u.arc(B,C,7,0,Math.PI*2,true);u.fillStyle="rgba("+a.join(",")+","+D+")";u.fill();u.strokeStyle="rgba("+r.join(",")+","+z+")";u.lineWidth=2;u.beginPath();u.moveTo(B,C-3.5);u.lineTo(B,C+3.5);u.moveTo(B-3.5,C);u.lineTo(B+3.5,C);u.stroke()},closebutton:function(u,B,C,a,D,r,z){u.beginPath();u.arc(B,C,7,0,Math.PI*2,true);u.fillStyle="rgba("+a.join(",")+","+D+")";u.fill();u.strokeStyle="rgba("+r.join(",")+","+z+")";u.lineWidth=2;u.beginPath();u.moveTo(B-3,C-3);u.lineTo(B+3,C+3);u.moveTo(B+3,C-3);u.lineTo(B-3,C+3);u.stroke()},minimizebutton:function(u,B,C,a,D,r,z){u.beginPath();u.arc(B,C,7,0,Math.PI*2,true);u.fillStyle="rgba("+a.join(",")+","+D+")";u.fill();u.strokeStyle="rgba("+r.join(",")+","+z+")";u.lineWidth=2;u.beginPath();u.moveTo(B-3.5,C);u.lineTo(B+3.5,C);u.stroke()},setMochaControlsWidth:function(){this.mochaControlsWidth=0;var b=this.options;if(b.minimizable){this.mochaControlsWidth+=(this.minimizeButtonEl.getStyle("margin-left").toInt()+this.minimizeButtonEl.getStyle("width").toInt())}if(b.maximizable){this.mochaControlsWidth+=(this.maximizeButtonEl.getStyle("margin-left").toInt()+this.maximizeButtonEl.getStyle("width").toInt())}if(b.closable){this.mochaControlsWidth+=(this.closeButtonEl.getStyle("margin-left").toInt()+this.closeButtonEl.getStyle("width").toInt())}this.controlsEl.setStyle("width",this.mochaControlsWidth);if(b.useCanvasControls==true){this.canvasControlsEl.setProperty("width",this.mochaControlsWidth)}},hideSpinner:function(){if(this.spinnerEl){this.spinnerEl.hide()}return this},showSpinner:function(){if(this.spinnerEl){this.spinnerEl.show()}return this},close:function(){if(!this.isClosing){MUI.closeWindow(this.windowEl)}return this},minimize:function(){MUI.Dock.minimizeWindow(this.windowEl);return this},maximize:function(){if(this.isMinimized){MUI.Dock.restoreMinimized(this.windowEl)}MUI.Desktop.maximizeWindow(this.windowEl);return this},restore:function(){if(this.isMinimized){MUI.Dock.restoreMinimized(this.windowEl)}else{if(this.isMaximized){MUI.Desktop.restoreWindow(this.windowEl)}}return this},resize:function(b){MUI.resizeWindow(this.windowEl,b);return this},center:function(){MUI.centerWindow(this.windowEl);return this},hide:function(){this.windowEl.setStyle("display","none");return this},show:function(){this.windowEl.setStyle("display","block");return this}});MUI.extend({closeWindow:function(l){var j=l.retrieve("instance");if(l!=$(l)||j.isClosing){return}j.isClosing=true;j.fireEvent("onClose",l);if(j.options.storeOnClose){this.storeOnClose(j,l);return}if(j.check){j.check.destroy()}if((j.options.type=="modal"||j.options.type=="modal2")&&Browser.Engine.trident4){$("modalFix").hide()}if(MUI.options.advancedEffects==false){if(j.options.type=="modal"||j.options.type=="modal2"){$("modalOverlay").setStyle("opacity",0)}MUI.closingJobs(l);return true}else{if(Browser.Engine.trident){j.drawWindow(false)}if(j.options.type=="modal"||j.options.type=="modal2"){MUI.Modal.modalOverlayCloseMorph.start({opacity:0})}var g=new Fx.Morph(l,{duration:120,onComplete:function(){MUI.closingJobs(l);return true}.bind(this)});g.start({opacity:0.4})}},closingJobs:function(p){var r=MUI.Windows.instances;var o=r.get(p.id);p.setStyle("visibility","hidden");if(Browser.Engine.trident){p.dispose()}else{p.destroy()}o.fireEvent("onCloseComplete");if(o.options.type!="notification"){var u=this.getWindowWithHighestZindex();this.focusWindow(u)}r.erase(o.options.id);if(this.loadingWorkspace==true){this.windowUnload()}if(MUI.Dock&&$(MUI.options.dock)&&o.options.type=="window"){var l=$(o.options.id+"_dockTab");if(l!=null){MUI.Dock.dockSortables.removeItems(l).destroy()}MUI.Desktop.setDesktopSize()}},storeOnClose:function(l,o){if(l.check){l.check.hide()}o.setStyles({zIndex:-1});o.addClass("windowClosed");o.removeClass("mocha");if(MUI.Dock&&$(MUI.options.dock)&&l.options.type=="window"){var p=$(l.options.id+"_dockTab");if(p!=null){p.hide()}MUI.Desktop.setDesktopSize()}l.fireEvent("onCloseComplete");if(l.options.type!="notification"){var j=this.getWindowWithHighestZindex();this.focusWindow(j)}l.isClosing=false},closeAll:function(){$$(".mocha").each(function(b){this.closeWindow(b)}.bind(this))},collapseToggle:function(l){var j=l.retrieve("instance");var g=l.getElements(".handle");if(j.isMaximized==true){return}if(j.isCollapsed==false){j.isCollapsed=true;g.hide();if(j.iframeEl){j.iframeEl.setStyle("visibility","hidden")}j.contentBorderEl.setStyles({visibility:"hidden",position:"absolute",top:-10000,left:-10000});if(j.toolbarWrapperEl){j.toolbarWrapperEl.setStyles({visibility:"hidden",position:"absolute",top:-10000,left:-10000})}j.drawWindowCollapsed()}else{j.isCollapsed=false;j.drawWindow();j.contentBorderEl.setStyles({visibility:"visible",position:null,top:null,left:null});if(j.toolbarWrapperEl){j.toolbarWrapperEl.setStyles({visibility:"visible",position:null,top:null,left:null})}if(j.iframeEl){j.iframeEl.setStyle("visibility","visible")}g.show()}},toggleWindowVisibility:function(){MUI.Windows.instances.each(function(g){if(g.options.type=="modal"||g.options.type=="modal2"||g.isMinimized==true){return}var f=$(g.options.id);if(f.getStyle("visibility")=="visible"){if(g.iframe){g.iframeEl.setStyle("visibility","hidden")}if(g.toolbarEl){g.toolbarWrapperEl.setStyle("visibility","hidden")}g.contentBorderEl.setStyle("visibility","hidden");f.setStyle("visibility","hidden");MUI.Windows.windowsVisible=false}else{f.setStyle("visibility","visible");g.contentBorderEl.setStyle("visibility","visible");if(g.iframe){g.iframeEl.setStyle("visibility","visible")}if(g.toolbarEl){g.toolbarWrapperEl.setStyle("visibility","visible")}MUI.Windows.windowsVisible=true}}.bind(this))},focusWindow:function(p,u){MUI.Windows.focusingWindow=true;var l=function(){MUI.Windows.focusingWindow=false};l.delay(170,this);if($$(".mocha").length==0){return}if(p!=$(p)||p.hasClass("isFocused")){return}var r=MUI.Windows.instances;var o=r.get(p.id);if(o.options.type=="notification"){p.setStyle("zIndex",11001);return}MUI.Windows.indexLevel+=2;p.setStyle("zIndex",MUI.Windows.indexLevel);$("windowUnderlay").setStyle("zIndex",MUI.Windows.indexLevel-1).inject($(p),"after");r.each(function(a){if(a.windowEl.hasClass("isFocused")){a.fireEvent("onBlur",a.windowEl)}a.windowEl.removeClass("isFocused")});if(MUI.Dock&&$(MUI.options.dock)&&o.options.type=="window"){MUI.Dock.makeActiveTab()}p.addClass("isFocused");if(u!=false){o.fireEvent("onFocus",p)}},getWindowWithHighestZindex:function(){this.highestZindex=0;$$(".mocha").each(function(b){this.zIndex=b.getStyle("zIndex");if(this.zIndex>=this.highestZindex){this.highestZindex=this.zIndex}}.bind(this));$$(".mocha").each(function(b){if(b.getStyle("zIndex")==this.highestZindex){this.windowWithHighestZindex=b}}.bind(this));return this.windowWithHighestZindex},blurAll:function(){if(MUI.Windows.focusingWindow==false){$$(".mocha").each(function(f){var g=f.retrieve("instance");if(g.options.type!="modal"&&g.options.type!="modal2"){f.removeClass("isFocused")}});$$(".dockTab").removeClass("activeDockTab")}},centerWindow:function(r){if(!r){MUI.Windows.instances.each(function(a){if(a.windowEl.hasClass("isFocused")){r=a.windowEl}})}var p=r.retrieve("instance");var o=p.options;var z=o.container.getCoordinates();var B=window.getScroll().y+(window.getSize().y*0.5)-(r.offsetHeight*0.5);if(B<-p.options.shadowBlur){B=-p.options.shadowBlur}var u=(z.width*0.5)-(r.offsetWidth*0.5);if(u<-p.options.shadowBlur){u=-p.options.shadowBlur}if(MUI.options.advancedEffects==true){p.morph.start({top:B,left:u})}else{r.setStyles({top:B,left:u})}},resizeWindow:function(C,u){var B=C.retrieve("instance");$extend({width:null,height:null,top:null,left:null,centered:true},u);var F=C.getStyle("width").toInt();var z=C.getStyle("height").toInt();var E=C.getStyle("top").toInt();var G=C.getStyle("left").toInt();if(u.centered){var D=typeof(u.top)!="undefined"?u.top:E-((u.height-z)*0.5);var H=typeof(u.left)!="undefined"?u.left:G-((u.width-F)*0.5)}else{var D=typeof(u.top)!="undefined"?u.top:E;var H=typeof(u.left)!="undefined"?u.left:G}if(MUI.options.advancedEffects==false){C.setStyles({top:D,left:H});B.contentWrapperEl.setStyles({height:u.height,width:u.width});B.drawWindow();if(B.iframeEl){if(!Browser.Engine.trident){B.iframeEl.setStyle("visibility","visible")}else{B.iframeEl.show()}}}else{C.retrieve("resizeMorph").start({"0":{height:u.height,width:u.width},"1":{top:D,left:H}})}return B},dynamicResize:function(o){var l=o.retrieve("instance");var p=l.contentWrapperEl;var j=l.contentEl;p.setStyles({height:j.offsetHeight,width:j.offsetWidth});l.drawWindow()}});document.addEvent("keydown",function(b){if(b.key=="q"&&b.control&&b.alt){MUI.toggleWindowVisibility()}});MUI.files[MUI.path.source+"Window/Modal.js"]="loaded";MUI.Modal=new Class({Extends:MUI.Window,options:{type:"modal"},initialize:function(b){if(!$("modalOverlay")){this.modalInitialize();window.addEvent("resize",function(){this.setModalSize()}.bind(this))}this.parent(b)},modalInitialize:function(){var g=new Element("div",{id:"modalOverlay",styles:{height:document.getCoordinates().height,opacity:0.6}}).inject(document.body);g.setStyles({position:Browser.Engine.trident4?"absolute":"fixed"});g.addEvent("click",function(a){var b=MUI.Windows.instances.get(MUI.currentModal.id);if(b.options.modalOverlayClose==true){MUI.closeWindow(MUI.currentModal)}});if(Browser.Engine.trident4){var f=new Element("iframe",{id:"modalFix",scrolling:"no",marginWidth:0,marginHeight:0,src:"",styles:{height:document.getCoordinates().height}}).inject(document.body)}MUI.Modal.modalOverlayOpenMorph=new Fx.Morph($("modalOverlay"),{duration:150});MUI.Modal.modalOverlayCloseMorph=new Fx.Morph($("modalOverlay"),{duration:150,onComplete:function(){$("modalOverlay").hide();if(Browser.Engine.trident4){$("modalFix").hide()}}.bind(this)})},setModalSize:function(){$("modalOverlay").setStyle("height",document.getCoordinates().height);if(Browser.Engine.trident4){$("modalFix").setStyle("height",document.getCoordinates().height)}}});MUI.extend({initializeTabs:function(g,f){$(g).setStyle("list-style","none");$(g).getElements("li").each(function(a){var b=a.getFirst("a").addEvent("click",function(l){l.preventDefault()});a.addEvent("click",function(l){MUI.updateContent({element:$(f),url:b.get("href")});MUI.selected(this,g)})})},selected:function(f,g){$(g).getChildren().each(function(a){a.removeClass("selected")});f.addClass("selected")}});var omApplication=new Class({Implements:[Events,Options],getOptions:function(){return{hideAuxMenu:true,auxMenuOpacity:0}},initialize:function(g,f){this.setOptions(this.getOptions(),f);this.path=null;this.liveSite=null;this.loader=new Element("div",{id:"loader"});this.loader_inner=new Element("div",{id:"loader_inner"});this.loader.appendChild(this.loader_inner);document.getElement("body").insertBefore(this.loader,document.getElement("body").firstChild);$("loader").hide();this.queue=new Roar({position:"upperRight"})},showOverlay:function(b){formManager.showOverlay(b)},hideOverlay:function(b){formManager.hideOverlay(b)},loadModule:function(l,p,j){var o=new Request.HTML({url:p.url,update:$(l),onComplete:j,evalResponse:false,evalScripts:true}).get(p.data)},unloadModule:function(b){$(b).empty()},call:function(j,l){var g=new Request.JSON({url:j,onComplete:function(a){l(a)}}).send()},gaq:function(j,p,o,l){if(window._gaq){_gaq.push(["_trackEvent",j,p,o,l])}},alert:function(b){giscloud.log.push("alert",{msg:b});alert(b)},showMessage:function(b){giscloud.log.push("roar_message",{mid:currentMapID,msg:b});this.queue.alert("",b)},showConfirm:function(b){giscloud.log.push("roar_confirm",{mid:currentMapID,msg:b});this.queue.alert("","<span class='roarmessage confirm' >"+b+"</span>")},showError:function(b){giscloud.log.push("roar_error",{mid:currentMapID,msg:b});this.queue.alert("","<span class='roarmessage error'>Error: "+b+"</span>")},showLoader:function(b){if(b){this.loader_inner.set("html",b)}else{this.loader_inner.set("html","Please wait...")}this.loader.show()},hideLoader:function(b){this.loader.hide()},showLoaderWithOverlay:function(b){formManager.showOverlay();this.showLoader(b)},hide:function(b){var b=$(b);if(b){b.setStyle("display","none")}},show:function(b){var b=$(b);if(b){b.setStyle("display","block")}},setSelectValue:function(g,l){g=$(g);if(!g){return}if(!g.options){return}for(var j=0;j<g.options.length;j++){if(g.options[j].value==l){g.options.selectedIndex=j;g.value=l;return}}},getFormValues:function(g){if(typeof(g)=="string"){g=$(g)}if(!g){return null}var f={};g.getElements("input, select, textarea").each(function(b){if(!b.name||b.disabled){return}var a=(b.tagName.toLowerCase()=="select")?Element.getSelected(b).map(function(l){return l.value}):((b.type=="radio"||b.type=="checkbox")&&!b.checked)?null:b.value;$splat(a).each(function(l){if(l){f[b.name]=l}})});return f},clearFormValues:function(g){if(typeof(g)=="string"){g=$(g)}if(!g){return null}var f={};g.getElements("input, select, textarea").each(function(a){if(!a.name||a.disabled||a.type=="radio"){return}if(a.tagName.toLowerCase()=="input"||a.tagName.toLowerCase()=="textarea"){a.value=""}})},console:function(b){if(console&&console.log){console.log(b)}},external:function(C,B,z,p){var u=false,D="GET";var r=function(a){if(!u){om.hideLoader()}if(z){z(a,p)}};if(!u){om.showLoader()}return jQuery.ajax({url:C,type:D,cache:false,dataType:"jsonp",data:B}).success(r).error(function(b,f,g){if(typeof r=="function"){r()}if(!u){om.hideLoader()}var a=JSON.decode(b.responseText);if(a){om.showError(a.msg)}})},kcall:function(G,z,B,J){var H=(J&&J.secure),I=(J&&J.method)?J.method:"POST",F;var G=H?G:(fno.liveSite+G);var C;if(z){C=z.__NOLOADER;delete z.__NOLOADER}if(G){var E=G.split("/");om.gaq(E[0],E[1],E[2])}var D=function(a){if(!C){om.hideLoader()}if(H&&gcRpc&&jQuery.isArray(a)){a=a[0]}if(B){B(a,J)}};if(!C){om.showLoader()}if(H){F=new jQuery.Deferred();if(gcRpc){gcRpc.rest(I,"application/x-www-form-urlencoded; charset=UTF-8",G,z,null,null,function(j,g,a,b,f){if(typeof D=="function"){D(j,g,a,b,f)}F.resolve(j,g,a,b,f)},function(l,j,a,f,g){var b=JSON.decode(l.responseText);if(typeof D=="function"){D(l,j,a,f,g)}if(!C){om.hideLoader()}if(b){om.showError(b.msg)}F.reject(l,j,a,f,g)});return F}}else{return jQuery.ajax({url:G,type:I,cache:false,dataType:"json",data:z}).success(D).error(function(g,f,a){if(typeof D=="function"){D()}if(!C){om.hideLoader()}var b=JSON.decode(g.responseText);if(b){om.showError(b.msg)}})}},showRestResponse:function(g){if(g&&g.status!=204){var f=JSON.decode(g.responseText);if(f){om.showError(f.msg)}}},rest:function(N,S,G,F){try{var J=F&&F.noloader;var R=F&&F.method?F.method:"GET";var Q=F&&!!F.secure;var P=F&&F.sessid;var I,E;var K=function(a){if(!J){om.hideLoader()}if(G){G(a,F)}};var M=K;if(!J){om.showLoader()}om.gaq("rest",N);if(typeof S!=="object"||S===null){S={}}S._nocache=Math.round(Math.random()*(new Date()).getTime());var S=R=="GET"?S:JSON.encode(S);if(Q){if(gcRpc){if(fno.gcAppAlternativeRestHost){N="/1/"+N}else{N="rest/1/"+N}if(N.substr(N.length-5)!=".json"){N+=".json"}if(P){N+="?api_sessid="+P}var O=new jQuery.Deferred();gcRpc.rest(R,"application/json",N,S,null,null,function(){var a=Array.prototype.slice.apply(arguments);O.resolve.apply(O,arguments);if(M&&M.apply){M.apply(null,a)}},function(){var a=Array.prototype.slice.apply(arguments);if(a.length===1){if(a[0].message&&a[0].message.length&&a[0].message.length===5){O.reject({code:a[0].message[3],message:a[0].message[4]})}}else{O.reject.apply(O,arguments)}if(!J){om.hideLoader()}});return O}}else{I=fno.liveSite+"rest/1/"+N;if(I.substr(I.length-5)!=".json"){N+=".json"}if(!J){om.showLoader()}return jQuery.ajax({url:I,type:R,cache:false,dataType:"json",contentType:"application/json",data:S}).success(M).error(function(f,g,a){if(!J){om.hideLoader()}var b=JSON.decode(f.responseText);if(b){om.showError(b.msg)}})}}catch(H){console.error(H)}}});Element.Properties.red={set:function(g){var f=g;if(typeof(g)=="object"){(function(){this.set("html","")}).delay(g.time*1000,this);f=g.msg}this.set("html",'<span class="red">'+f+"</span>")}};Element.Properties.green={set:function(g){var f=g;if(typeof(g)=="object"){(function(){this.set("html","")}).delay(g.time*1000,this);f=g.msg}this.set("html",'<span class="green">'+f+"</span>")}};(function(b){b.fn.overlay=function(B,E,a){var z=this.find(".element_overlay");var D=this.find(".elementloader");var C=this.find(".gc-overlay-text");if(C){C.remove()}if(!B){if(D){D.remove()}if(z){z.remove()}return}if(z){z.remove()}z=b("<div/>").addClass("element_overlay").appendTo(this);var H={width:this.width(),height:this.height()};var H={x:H.width,y:H.height};z.css("width",H.x).css("height",H.y);if(E){if(D){D.remove()}var D=b("<div/>").addClass("elementloader").css("top",H.y/2-8).css("left",H.x/2-8).appendTo(this)}if(a){var G=b("<div/>").html(a).addClass("gc-overlay-text").appendTo(this);var F={x:G.width(),y:G.height()};G.css("top",H.y/2-F.y/2-30).css("left",H.x/2-F.x/2)}this.css("position","relative")}})(jQuery);Element.implement({e:function(b){return this.getElement(b)},overlay:function(C,F,z){var B=this.getElement(".element_overlay");var E=this.getElement(".elementloader");var D=this.getElement(".gc-overlay-text");if(D){D.dispose()}if(!C){if(E){E.dispose()}if(B){B.dispose()}return}if(B){B.dispose()}B=new Element("div");B.addClass("element_overlay");B.inject(this);var u=this.getComputedSize();var u={x:u.width,y:u.height};B.setStyles({width:u.x,height:u.y});if(F){if(E){E.dispose()}var E=new Element("div");E.addClass("elementloader");E.setStyle("top",u.y/2-8);E.setStyle("left",u.x/2-8);E.inject(this)}else{if(z){var H=new Element("div",{html:z});H.addClass("gc-overlay-text");H.inject(this);var G=H.getSize();H.setStyle("top",u.y/2-G.y/2-30);H.setStyle("left",u.x/2-G.x/2)}}this.setStyle("position","relative")},showLoader:function(o,l){if(this.getElement(".loader")){return}var p=(l&&l.style)?l.style:"5px auto;";var j=new Element("div",{style:"width:100%; text-align:center;"});j.addClass("loader");j.set("html","<div style='"+p+';\'><div class="loading" style="margin:0 auto;width:16px;height:16px" alt=\''+(o?o:"Loading...")+"'></div></div>");this.appendChild(j,"top")},hideLoader:function(){var b=this.getElement(".loader");if(b){b.dispose()}},hide:function(){this.setStyle("display","none")},show:function(){this.setStyle("display","block")},visibility:function(b){if(b){this.setStyle("visibility","visible")}else{this.setStyle("visibility","hidden")}},toggle:function(b){switch(b){case"normal":return this[this.isDisplayed()?"dissolve":"reveal"]();break;case"fade":if(this.setStyle("visibility")=="visible"){this.fade("out")}else{this.fade("in")}break;default:if(this.getStyle("display")=="block"){this.hide()}else{this.show()}}}});var ModalOverlay=new Class({Implements:[Events,Options],getOptions:function(){return{element:null,onClickDispose:false,container:document.body,zIndex:null}},initialize:function(g){this.setOptions(this.getOptions(),g);this.global=false;if(this.options.element){this.element=this.options.element}else{this.element=$("overlay");this.global=true}if(this.global&&this.element){if(document.overlay){return document.overlay}}var f="opacity:0.1; filter:alpha(Opacity=10);";if(this.options.alpha){f="opacity:"+this.options.alpha+"; filter:alpha(Opacity="+(g.alpha*10)+");"}if(this.options.color){f+="background-color:"+this.options.color+";"}if(this.options.zIndex){f+="z-index:"+this.options.zIndex+";"}this.overlay=new Element("div",{id:this.element,style:f});this.overlay.addClass("gc-overlay");if(this.global){document.overlay=this.overlay}this.overlay.setStyle("height",document.getScrollSize().y);this.options.container.insertBefore(this.overlay,this.options.container.firstChild);if(this.options.onClickDispose){this.overlay.addEvent("click",function(){this.close()})}window.addEvent("resize",this.update.bindWithEvent(this));return this.overlay},update:function(l){if(this.overlay){var j=window.getSize();var g=window.getScrollSize();this.overlay.setStyles({height:(j.y>g.y)?j.y:g.y,width:j.x})}},close:function(){if(this.global){document.overlay=null}this.dispose()}});var omModule=new Class({Implements:[Events,Options],options:{url:"",method:"GET"},initialize:function(b){this.setOptions(b)},call:function(B,z,D,u){var H=this.options.url;var E=B.__NOLOADER;delete B.__NOLOADER;var C=new Request.JSON({url:H,data:B,method:"post"});var F=function(a){if(!E){om.hideLoader()}if(D){D(a,u)}if(z){this.fireEvent(z,[a])}};var G=F.bind(this);om.gaq(B.module,B.task);C.addEvent("complete",G);if(!E){om.showLoader(B.__LOADERMSG)}C.send()}});var omFormat=new Class({initialize:function(){},round:function(l,j){var g=Math.pow(10,j);return Math.round(l*g)/g},htmlencode:function(b){if(typeof(b)!="string"){return b}return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")},bandwidth:function(l,j,g){if(l>=1099511627776){return this.round(l/1099511627776,g?j:0).toLocaleString()+" TB "+(g?"":this.bandwidth(l%1073741824))}else{if(l>=1073741824){return this.round(l/1073741824,g?j:0).toLocaleString()+" GB "+(g?"":this.bandwidth(l%1073741824))}else{if(l>=1048576){return this.round(l/1048576,g?j:0).toLocaleString()+" MB "+(g?"":this.bandwidth(l%1048576))}else{if(l>=1024){return this.round(l/1024,g?j:0).toLocaleString()+" kB "+(g?"":this.bandwidth(l%1024))}}}}return l+" bytes"},period:function(p,u){var D=parseInt(p/(24*3600));p-=D*24*3600;var r=parseInt(p/3600);p-=r*3600;var z=parseInt(p/60);p-=z*60;var B=parseInt(p);var C="";if(D>0&&(!u||u>=1)){C+=D+" d "}if(r>0&&(!u||u>=2)){C+=r+" h "}if(z>0&&(!u||u>=3)){C+=z+" min "}if(B>0&&(!u||u>=4||C=="")){C+=B+" s "}return C},price:function(G,D,z){var F=1.1;var B=F.toLocaleString();var H=G.toLocaleString();var E=0;var C=H.length;for(E=C-1;E>=0;E--){if(H[E]==B[1]){break}}while(H.substr(E+1).length<2){H+="0"}var p=H.substr(0,E+3);if(D){if(H.substr(E+1).length>6){H=H.substr(0,E+7)}p+='<span style="color:#bbb">'+H.substr(E+3)+"</span>"}return(z=="$")?"$"+p:p+" "+z}});var Format=new omFormat();function trim(b){if(typeof(string)!="string"){return b}s=b.replace(/^(\s)*/,"");s=s.replace(/(\s)*$/,"");return s}function get_sef(g){var f=new String(g);f=f.replace(/[^a-zA-Z 0-9]/gi,"");f=f.replace(/[ ]/gi,"-");f=f.replace(/[-]+/gi,"-");f=f.replace(/^(-)*/,"");f=f.replace(/(-)*$/gi,"");f=f.toLowerCase();return f}Array.prototype.unique=function(o){function j(a,b){return a-b}var p=o?j:function(){};this.sort(p);for(var l=1;l<this.length;l++){if(this[l-1]==this[l]){this.splice(l,1);l--}}return this};function array_unique(r){var l=[];var a=r.length;for(var u=0;u<a;u++){for(var j=u+1;j<a;j++){if(r[u]===r[j]){j=++u}}l.push(r[u])}return l}Array.prototype.contains=function(l,j){for(var g=0;g<this.length;g++){if(this[g]==l){if(j){this.splice(g,1)}return true}}return false};Array.prototype.remove=function(f){for(var g=0;g<this.length;g++){if(this[g]==f){this.splice(g,1);g--}}};Array.prototype.compare=function(f){if(this.length!=f.length){return false}for(var g=0;g<f.length;g++){if(this[g].compare){if(!this[g].compare(f[g])){return false}}if(this[g]!==f[g]){return false}}return true};String.implement({truncate:function(o,p,l){var r=this.trim();if(r.length<1){return""}if(!$defined(o)){var o=100}else{o=o.toInt()}if(!$defined(p)){var p=" "}else{if(p==null){var p=false}}if(!$defined(l)){var l="..."}if(r.length>o){var u=0;r=r.slice(0,o);if(p){if((u=r.lastIndexOf(p))!=-1){r=r.substring(0,u)}else{r=r.substring(0,o)}}r+=l}return r}});function urlencode(b){return escape(b).replace(/\+/g,"%2B").replace(/%20/g,"+").replace(/\*/g,"%2A").replace(/\//g,"%2F").replace(/@/g,"%40")}if(!window.console){window.console=console=new Object();console.log=console.info=console.warn=console.debug=console.error=function(b){}}var om=null;window.addEvent("domready",function(){om=new omApplication()});var iframeshimCollection=new Array();var omFormManager=new Class({Implements:[Events,Options],getOptions:function(){return{buttons:null,dragable:true}},initialize:function(b){this.setOptions(this.getOptions(),b);this.isflashvisible=true;this.openforms=[];this.formsWithOverylay=0;this.startzIndex=500500;document.addEvent("keyup",this.onEscapeRelease.bind(this))},get:function(f){for(var g=0;g<this.openforms.length;g++){if(f==this.openforms[g].options.fid){return this.openforms[g]}}},onEscapeRelease:function(g){if(g.key=="esc"){var f=this.openforms[this.openforms.length-1];if(f&&f.state!="minimized"&&!f.options.noescape){this.close(f,{esc:true})}}},showOverlay:function(b){if(this.formsWithOverylay==0){this.hideFlashContent();this.mol=document.modalOverlay=new ModalOverlay(b);if(b&&b.closeOverlayClick){this.mol.addEvent("click",this.close.bind(this,b.form))}}this.formsWithOverylay++},hideOverlay:function(b){if((this.formsWithOverylay==1&&this.mol)||b){this.formsWithOverylay=0;if(this.mol){this.mol.dispose();delete this.mol}this.showFlashContent()}else{if(this.formsWithOverylay>0){this.formsWithOverylay--}}},hasOverlay:function(){return this.formsWithOverylay>0},showFlashContent:function(){if($("flashcontent")&&this.isflashvisible){$("flashcontent").visibility(true)}},hideFlashContent:function(){if(!flashnavigator.html5&&$("flashcontent")){$("flashcontent").visibility(false)}},hideAll:function(){for(var g=0;g<this.openforms.length;g++){var f=this.openforms[g];if(f.state!="minimized"){f.container.hide()}}},open:function(j,g){if(!j){return}if(!j.donthideall){this.hideAll()}var l={};if(j.fid){l.fid=j.fid}if(!l.fid&&j.url){l.url=j.url}giscloud.log.push("form_open",l);if(!j.fid){j.fid="fid_"+this.openforms.length}else{if(j.oneInstance){this.close(j.fid)}}if(!g){if(j.wizard){g=new omWizardForm(j)}else{g=new omForm(j)}}if(j.overlay&&!j.bootstrap){this.showOverlay({closeOverlayClick:j.closeOverlayClick,form:g})}if(j.dragable==null||j.dragable==undefined){j.dragable=true}if(!j.donotregister){this.openforms.push(g)}if(j.bootstrap){}else{g.container.setStyle("zIndex",this.startzIndex+this.openforms.length);g.container.store("form",g)}return g},fullpage:function(z){var D=jQuery,u=D("<div/>").addClass("gc-full-page-content"),p=D("<div/>").addClass("gc-full-page").append(u).appendTo(D("body")),C=new D.Deferred,r,B;z=z||{};r=z.id||giscloud.ui.id("full_page_");p.attr("id",r);if(z.opacity){p.css("opacity",z.opacity)}if(z["class"]){p.addClass(z["class"])}if(z.closeButton){B=D("<button/>",{"class":"gc-full-page-close-btn",title:gclang.Close}).html("&times;").click(function(){formManager.closeFullpage(r)}).appendTo(p)}u.loader("show");if(z.url){u.load(z.url,null,function(b,f,a){u.loader("hide");if(f==="success"){C.resolveWith(u,[b,f,a])}else{C.rejectWith(u,[b,f,a])}});return C.promise()}if(z.view){if(!giscloud||!giscloud.app||!giscloud.app.loadView){C.reject();throw"fullpage: no view handling method available."}return u.gcLoadView(z.view,z.data).always(function(){u.loader("hide")})}C.always(function(){u.loader("hide")});if(z.html){u.html(z.html)}return C.resolveWith(u).promise()},isFullpageOpen:function(b){return jQuery("#"+b).length>0},closeFullpage:function(o){var j=o?("#"+o):false,p=j?jQuery(j):jQuery(".gc-full-page"),l=p&&p.find(".gc-full-page-content");if(p&&p.length){if(l&&l.length){l.trigger("closing.fullpage")}p.remove()}},style:function(b){styleform=this.open({fid:"styleform",dragable:true,title:gclang.js.appearance,width:480,height:400+(Browser.Engine.trident&&Browser.Engine.version<6?40:0),url:fno.liveSite+"layer/styleform",buttons:[{html:gclang.ok,"class":"bluebutton",click:"gcstyleform.save();"},{html:gclang.back,click:"gcstyleform.close();"}]});styleform.fdata=b.data;styledata=b.data;icondiv=b.element;if(b.onClose){styleform.addEvent("close",b.onClose)}return styleform},reportForm:function(g){var l=g.type=="basic"?"basicform":"form";var j={fid:"reportform",overlay:true,shadow:true,title:gclang.Report,width:570,height:240,url:fno.liveSite+"reports/"+l,buttons:[{html:gclang.Close,click:"formManager.close('reportform');"}]};Object.append(j,g);this.formreport=formManager.open(j);return this.formreport},fileUpload:function(g){var j=g.uploaddir?g.uploaddir:"/";var l=formManager.open({dragable:true,fid:"uploadform",width:550,height:380,title:gclang.js.uploadnewto+" '"+j+"'",url:fno.liveSite+"modules_gc/upload/upload.php",data:{currentDir:"",upload_dir:g.uploaddir},buttons:[{click:"formManager.close('uploadform');",html:gclang.close}]});return l},fileRemoteUpload:function(g){var f=formManager.open({overlay:true,shadow:true,dragable:true,fid:"remoteuploadform",width:600,height:180,title:"Web to Cloud Upload",url:fno.liveSite+"modules_gc/upload/remoteupload.php",buttons:[{click:"formManager.close('remoteuploadform');",html:gclang.close}]});f.fdata={currentDir:"",upload_dir:g.uploaddir};return f},wmsInfo:function(f){var g=[];if(f.select){g.push({html:gclang.Select,"class":"bluebutton",click:"gcapp.wmsinfo.select()"})}g.push({html:gclang.Close,click:"gcapp.wmsinfoform.close()"});gcapp.wmsinfoform=formManager.open({fid:"wmsinfoform",overlay:false,dragable:true,title:"WMS Info Form",fdata:f,width:600,height:400,url:fno.liveSite+"datasource/form_wms_info",buttons:g});return gcapp.wmsinfoform},fileBrowser:function(B){var u=[{click:"formManager.close('filemanager');",html:gclang.close}];if(!B){B={}}var r={};r.currentDir="";r.selectmode=B.selectmode;r.createmode=B.createmode;r.multipleSelection=false;if(B.upload){r.upload=B.upload}if(B.open_upload_form){r.open_upload_form=B.open_upload_form}var p=gclang.js.source_browser;if(B.extensions){r.extensions=B.extensions}if(B.postgis){r.postgis=B.postgis}if(B.non_spatial){r.non_spatial=B.non_spatial}if(B.nofiles){r.nofiles=B.nofiles}if(B.wms){r.wms=B.wms}if(B.tms){r.tms=B.tms}if(B.mobile){r.mobile=B.mobile}if(B.arcmap){r.arcmap=B.arcmap}if(B.mapbox){r.mapbox=B.mapbox}if(B.datasources){r.datasources=B.datasources}if(B.tmsInclude){r.tmsInclude=B.tmsInclude}if(B.gcmap){r.gcmap=B.gcmap}if(B.skipform){r.skipform=B.skipform}if(B.multipleSelection&&!r.createmode){r.multipleSelection=B.multipleSelection}if(B.dir){r.dir=B.dir}if(B.absdir){r.absdir=B.absdir}if(B.no_file_browsing){r.no_file_browsing=B.no_file_browsing}if(B.selectmode){u=[{id:"gc-src-browser-select",click:"onSelectFiles();","class":"bluebutton",html:gclang.select},{id:"gc-src-browser-cancel",click:"formManager.close('filemanager');",html:gclang.cancel}]}if(B.showimages){r.showimages=B.showimages}var o=false;var z=this.open({overlay:o,dragable:true,fid:"filemanager",width:760,height:490,title:p,url:fno.liveSite+"assets/omf/omnifilemanager/omnifilemanager.php",data:r,buttons:u});z.form.setStyle("background-color","#f9f9f9");return z},showWindow:function(l){if(!l){l={}}var o=l.fid?l.fid:("__window"+Math.round(Math.random()*1000000));var p=l.buttons?l.buttons:[{click:"formManager.close('"+o+"');",html:gclang.close}];var j=this.open({overlay:l.overlay,dragable:true,fid:o,width:l.width||500,height:l.height||310,title:l.title||"",buttons:p});if(l.text){j.form.set("html",l.text)}return j},close:function(r,u){if(!r){return}var p;if(typeof(r)=="string"){p=null;for(var f=0;f<this.openforms.length;f++){if(r==this.openforms[f].options.fid){p=this.openforms[f];break}}}else{p=r}if(!p){var B=this.openforms.length+" \n";for(var z=0;z<this.openforms.length;z++){B+=z+" "+this.openforms[z].options.fid}return}if(p.iframe&&iframeshimCollection){iframeshimCollection.erase(p.iframe)}if(p.options.overlay){this.hideOverlay()}giscloud.log.push("form_close",{fid:p.options.fid});p.fireEvent("close",u);if(p.options.bootstrap){p.container.modal("hide")}else{p.container.dispose()}this.openforms.erase(p);delete p;this.showNextVisible()},showNextVisible:function(){var g=0;while(g<this.openforms.length){g++;var f=this.openforms[this.openforms.length-g];if(f.state!="minimized"){f.container.show();f.showLoader(false);return}}},isOpen:function(l){var j=0;while(j<this.openforms.length){j++;var g=this.openforms[this.openforms.length-j];if(g.options.fid==l){return true}}return false},closeAll:function(){if(!this.openforms){return}var b;while(b=this.openforms.pop()){if(!b.options.stayopen){b.close()}}this.openforms=[]},bringToFront:function(f){if(!f.options.donotregister){this.openforms.erase(f);this.openforms.push(f)}for(var g=0;g<this.openforms.length;g++){this.openforms[g].container.setStyle("zIndex",this.startzIndex+g)}},sendToBack:function(f){if(!f.options.donotregister){this.openforms.erase(f);this.openforms.unshift(f)}for(var g=0;g<this.openforms.length;g++){this.openforms[g].container.setStyle("zIndex",this.startzIndex+g)}}});var formManager=new omFormManager();var omForm=new Class({Implements:[Events,Options],options:{id:"form_container",onClickDispose:false,container:document.body,width:500,height:400,buttons:null,dragable:false,minimize:false,data:{nch:_nch}},fdata:{},insertIframeShim:function(l){var j=(this.options.width+2)+"px";var g=(this.options.height+2)+"px";if(l){this.iframe.setStyles({width:j,height:g});return}if(!this.iframe){this.iframe=new Element("iframe",{marginwidth:0,marginheight:0,frameBorder:0,style:"position:absolute;z-index:0;left:-1px;top:-1px;width:"+j+";height:"+g+";filter:alpha(opacity=0);"});this.iframe.inject(this.container);if(document.all&&iframeshimCollection){iframeshimCollection.push(this.iframe)}}},initialize:function(r){this.setOptions(this.options,r);this.options.dragable=true;if(r.bootstrap){this.container=giscloud.ui.modal(r);return}this.loader=null;this.container=new Element("div",{});this.insertIframeShim();this.options.rounded=(flashnavigator&&flashnavigator.html5);this.container2=new Element("div",{style:"bacground-color:gray"});this.container2.addClass("formcont gc-app");this.container2.inject(this.container);this.container.addClass(this.options.id);if(this.options.rounded){this.container2.addClass("formrounded")}this.container.owner=this;if(this.options.shadow){this.container.addClass("formshadow")}if(this.options.rounded){this.container.addClass("formrounded")}this.state="maximized";this.header=new Element("div",{id:"form_header",html:"<div class='form_header_title' >"+this.options.title+"</div>"});this.header.addClass("gc-theme-color");this.header.owner=this;this.header.setStyle("width",this.options.width-12);this.header.inject(this.container2);if(this.options.rounded){this.header.addClass("formrounded_up")}this.form=new Element("div",{id:"formmain"});this.form.addClass("formcontent");this.form.inject(this.container2);if(this.options.rounded&&!this.options.buttons){this.form.addClass("formrounded_down")}this.createFooter(r.footerForce);if(this.options.dragable){var o=document.getSize();var p=new Drag(this.container,{snap:0,handle:this.header,onSnap:function(a){a.addClass("dragging");if(Browser.Engine.trident){a.owner.form.setStyle("display","none");a.owner.footer.setStyle("display","none")}},onComplete:function(a){a.removeClass("dragging");if(Browser.Engine.trident){a.owner.form.setStyle("display","block");a.owner.footer.setStyle("display","block")}}});this.header.setStyle("cursor","move")}this.header.addEvent("mousedown",this.bringToFront.bind(this));if(this.options.buttons){for(var b=0;b<this.options.buttons.length;b++){var u=this.options.buttons[b];if(!u.onclick){u.onclick="return false;"}this.addButton(u)}}if(!this.options.noclosebutton){this.closebtcont=new Element("div",{id:"form_closebt"});this.closebtcont.addEvent("click",this.close.bind(this));this.closebtcont.inject(this.container2)}if(this.options.minimize){this.minusbtcont=new Element("div",{id:"form_minimizebt","class":"gc-icon-minimize"});this.minusbtcont.addEvent("click",this.toggleMinimizeToHeader.bind(this));this.minusbtcont.inject(this.container2)}this.resize(this.options.width,this.options.height);this.container.inject(document.body);if(this.options.url){this.load(this.options.url)}if(this.options.html){this.form.set("html",this.options.html)}document.modalForm=this;this.updateBindFunction=this.update.bindWithEvent(this);window.addEvent("resize",this.updateBindFunction);if(r.onClose){this.addEvent("close",r.onClose)}},scrollTo:function(g,f){if(!this.scrollFx){this.scrollFx=new Fx.Scroll(this.form,{wheelStops:true})}if(IsNumeric(g)&&IsNumeric(f)){this.scrollFx.set(g,f)}if(g=="top"){this.scrollFx.toTop()}else{if(g=="bottom"){this.scrollFx.toBottom()}}},setTitle:function(b){this.header.set("html",this.options.title=b)},addButton:function(aobj,where){if(!this.footer){return}aobj.href="javascript:;";this.save=new Element("a",aobj);if(aobj.click){function abind(ao){if(typeof ao.click==="string"){eval(ao.click)}else{if(typeof ao.click==="function"){ao.click()}}}this.save.addEvent("click",abind.bind(this,aobj))}this.save.addClass("button");this.save.inject(this.footer,where?where:"bottom")},createFooter:function(b){this.footer=null;if(!this.options.buttons&&!b){return}this.footer=new Element("div",{});this.footer.addClass("form_footer");this.footer.inject(this.container2)},enable:function(){if(this.overlay){this.overlay.hide();this.showLoader(false,this.overlay)}},disable:function(b){if(!this.overlay){this.overlay=new Element("div",{});this.overlay.addClass("overlay");this.overlay.setStyles({width:this.options.width,height:this.options.height-33,top:33});this.overlay.inject(this.container)}else{this.overlay.show()}if(b){this.showLoader(true,this.overlay)}},showLoader:function(p,o){o=o?o:this.container;if(!o||!o.getElement){return}var b=o.getElement(".form_loader");if(p){if(!b){b=new Element("div");b.addClass("form_loader");b.inject(o)}var l=o.getSize();b.setStyle("left",l.x/2-8);b.setStyle("top",l.y/2-40)}else{if(b){b.dispose()}b=null}},resize:function(o,u,l){this.options.width=o;this.options.height=u;if(l&&l.animated){var p=new Fx.Morph(this.container,{duration:"short",transition:Fx.Transitions.Sine.easeOut});this.updateIntID=this.update.periodical(1,this);var r=this;p.addEvent("complete",function(){clearInterval(r.updateIntID);r.update(o,u)});p.start({height:u+(this.options.buttons?30:0),width:o})}else{this.container.setStyles({width:o,height:u});this.header.setStyle("width",o-12);this.insertIframeShim(true);this.update(o,u);if(l&&l.url){this.resizeComplete(l.url)}}},update:function(r,B){var C=this.container.getSize(),z,E;if(r&&B){r=r;B=B}else{r=C.x;B=C.y}var u=(this.state=="minimized")?7:15;var D=2;this.form.setStyle("width",r-(u*2)-D);this.header.setStyle("width",r-12);var F=(this.header&&(this.state=="maximized"||this.state=="minimizedtoheader")?12:0)+(this.footer&&(this.state=="maximized"||this.state=="minimizedtoheader")?55:24);this.form.setStyle("height",B-(u*2)-F);if(this.footer){this.footer.setStyle("width",r-3)}this.move()},move:function(){var u=window.getSize();var r=window.getScrollSize();var l=u.y;var o;var p;if(this.state=="minimizedtoheader"){return}else{if(this.state=="minimized"){o=10;p=l-this.options.height-20}else{o=u.x/2-this.container.getStyle("width").toInt()/2;p=l/2-this.container.getStyle("height").toInt()/2-100;if(p<10){p=10}}}this.container.setStyle("left",o);this.container.setStyle("top",p)},load:function(j,g){if(!j){return}if(g&&g.width&&g.height){this.form.hide();if(this.footer){this.footer.hide()}this.resize(g.width,g.height,j);return}this.showLoader(true);if(this.footer){this.footer.hide()}this.form.hide();var l=new Request.HTML({url:j,update:this.form,onComplete:this.onLoadComplete.bindWithEvent(this),evalResponse:false,evalScripts:true}).get(this.options.data)},refresh:function(b){this.load(this.options.url)},onLoadComplete:function(p,l,o,j){this.showLoader(false);this.form.show();if(this.footer){this.footer.show()}this.fireEvent("contentcomplete",{target:this})},resizeComplete:function(b){if(b){this.load(b,null)}},minimize:function(){this.state="minimized";this.header.hide();if(this.footer){this.footer.hide()}this.closebtcont.hide();var g=this.form.getElement(".omf_form_maximize");var f=this.form.getElement(".omf_form_minimize");if(g){g.hide()}if(f){f.show()}this.safeWidth=this.options.width;this.safeHeight=this.options.height;this.form.setStyle("top",0);this.form.setStyle("padding","7px");this.resize(170,30);this.move();if(this.options.overlay){formManager.hideOverlay()}formManager.showNextVisible()},maximize:function(){if(this.state=="minimized"){formManager.hideAll();this.container.show();this.state="maximized";this.header.show();if(this.footer){this.footer.show()}this.closebtcont.show();var g=this.form.getElement(".omf_form_maximize");var f=this.form.getElement(".omf_form_minimize");if(g){g.show()}if(f){f.hide()}this.form.setStyle("padding","15px");this.resize(this.safeWidth,this.safeHeight)}else{if(this.state=="minimizedtoheader"){this.form.show();if(this.footer){this.footer.show()}this.resize(this.safeWidth,this.safeHeight);this.state="maximized"}}if(this.options.overlay){formManager.showOverlay({closeOverlayClick:this.options.closeOverlayClick,form:this})}this.fireEvent("maximize",{target:this})},toggleMinimizeToHeader:function(b){if(this.state=="minimizedtoheader"){this.maximize()}else{this.minimizeToHeader()}},minimizeToHeader:function(){this.state="minimizedtoheader";this.safeWidth=this.options.width;this.safeHeight=this.options.height;this.form.hide();if(this.footer){this.footer.hide()}var b=37;this.iframe.setStyle("height",b);this.container.setStyle("height",b);if(this.options.overlay){formManager.hideOverlay()}this.fireEvent("minimize",{target:this,headeronly:true})},close:function(){window.removeEvent("resize",this.updateBindFunction);formManager.close(this,this.fdata)},bringToFront:function(){formManager.bringToFront(this)},sendToBack:function(){formManager.sendToBack(this)}});var omWizardForm=new Class({Extends:omForm,initialize:function(b){b.footerForce=true;this.parent(b);this.footer.setStyle("margin-left","6px");this.options.currentStep=1;this.leftbtcont=new Element("div");this.leftbt=new Element("img",{src:fno.liveSite+"assets/omf/images/left.gif",id:"form_leftbt"});this.leftbtcont.addEvent("click",this.gotoPrevious.bindWithEvent(this));this.leftbt.inject(this.leftbtcont);this.leftbtcont.inject(this.footer);this.leftbt.setStyle("visibility","hidden");this.rightbtcont=new Element("div");this.rightbt=new Element("img",{src:fno.liveSite+"assets/omf/images/right.gif",id:"form_rightbt",title:"Next step"});this.rightbtcont.addEvent("click",this.gotoNext.bindWithEvent(this));this.rightbt.inject(this.rightbtcont);this.rightbtcont.inject(this.footer);if(this.h1){this.h1.setStyle("margin-left",40)}this.status=new Element("div",{id:"form_status"});this.status.inject(this.footer);formManager.open(this.options,this)},updateButtons:function(){var b=this.options.currentStep;if(b>1){this.leftbt.setStyle("visibility","visible")}else{this.leftbt.setStyle("visibility","hidden")}if(b>=this.options.steps){this.rightbt.set("title","Finish")}else{this.rightbt.set("title","Next step")}this.status.set("text","Step "+b+" of "+this.options.steps)},gotoStep:function(step){if(eval(this.options.stepFunction)(step)){this.options.currentStep=step;this.updateButtons()}},onLoadComplete:function(p,l,o,j){this.showLoader(false);this.footer.show();this.form.show()},gotoNext:function(step){if((this.options.currentStep)<=this.options.steps){if(eval(this.options.stepFunction)(this.options.currentStep+1)){this.options.currentStep++;this.updateButtons()}}},gotoPrevious:function(step){if(this.options.currentStep>0){if(eval(this.options.stepFunction)(this.options.currentStep-1)){this.options.currentStep--;this.updateButtons()}}}});function showIE6Warning(){var b={overlay:true,data:{},width:720,height:540,title:"Warning",url:fno.liveSite+"assets/themes/ie6/ie6warning.php"};ie6warningform=formManager.open(b)}var omniCombo=new Class({Implements:[Events,Options],options:{toggle:false,hover:false,side:"left",shadow:false,changetitle:true,iframe:false,disableMenu:false,usejQueryPositioning:false},initialize:function(o,u){this.setOptions(u);this.container=$(o);if(this.options.usejQueryPositioning){if(this.container.get("id")){this.container_id=this.container.get("id")}else{this.container.set("id","omnicombo_id"+Math.round(Math.random()*1000000));this.container_id=this.container.get("id")}}if(!this.container){return}if(this.container.className=="toggle"){this.options.toggle=true}this.box=this.container.getElement("div.combolabel");this.arrow=this.box.getElement(".arrow");this.popup=this.container.getElement("div.popup");this.popup.setStyle("top",this.box.getSize().y-2);var l=this.popup.getDimensions();if(this.options.iframe){this.insertIframeShim(l.x,l.y+20)}if(this.options.side=="right"){this.popup.setStyle("left",-(l.x-this.box.getSize().x));this.popup.addClass("right")}this.popup.setStyle("display","none");this.isopen=false;this.globalevent=false;this.lastValue=null;var p=this.container.getElement(".combolabel");if(this.options.hover){this.container.addEvent("mouseenter",this.open.bind(this));this.container.addEvent("mouseleave",this.globalCheck.bind(this))}else{this.container.addEvent("click",this.onclick.bind(this));this.container.addEvent("dblclick",this.ondblclick.bind(this))}this.box.addEvent("mouseenter",this.onLabelEnter.bind(this));this.box.addEvent("mouseleave",this.onLabelLeave.bind(this));this.popup.addEvent("mouseenter",this.onPopupEnter.bind(this));this.popup.addEvent("mouseleave",this.onPopupLeave.bind(this));var r=this;if(!this.options.disableMenu){this.container.getElements("div.popup ul li[class!=separator]").each(function(b,a){b.addEvent("mouseenter",this.onMenuEnter.bind(this));b.addEvent("mouseleave",this.onMenuLeave.bind(this));b.addEvent("click",function(f){r.onMenuClick(f,a)})},this)}},onLabelEnter:function(g){var f=$(g.target);f=f.hasClass("combolabel")?f:f.getParent();f.addClass("hover")},onLabelLeave:function(g){var f=$(g.target);f=f.hasClass("combolabel")?f:f.getParent();f.removeClass("hover");if(this.options.hover){this.globalCheck.delay(50,this)}},getParent:function(f,g){f=$(f);while(f&&!f.hasClass(g)){f=f.getParent()}return f},onPopupEnter:function(g){var f=this.getParent(g.target,"popup");f.addClass("hover")},onPopupLeave:function(g){var f=$(g.target);popup=f.hasClass("popup")?f:f.getParent(".popup");if(["form","input","textarea"].contains(f.get("tag"))){return}this.popup.removeClass("hover");if(this.options.hover){this.globalCheck.delay(50,this)}},onMenuEnter:function(g){var f=$(g.target);f=f.get("tag")!="li"?f.getParent("li"):f},onMenuLeave:function(g){var f=$(g.target);f=f.get("tag")!="li"?f.getParent("li"):f},onMenuClick:function(j,g){var l=$(j.target);l=l.get("tag")!="li"?l.getParent():l;this.lastValue=this.getValue();if(this.options.changetitle){this.setTitle(l.get("html"))}this.close();this.fireEvent("change",{target:this,element:l,value:this.getValue(),index:g});j.stopPropagation()},getValue:function(){var b=this.box.getElement("span").get("text");if(b){return b.toLowerCase()}},setValue:function(o){if(!o){return}var j=this.container.getElements("div.popup ul li[class!=separator]");for(var p=0;p<j.length;p++){var l=j[p].getElement("a").innerHTML;if(l.toLowerCase()==o){this.setTitle(l)}}},setSelectedIndex:function(g){var j=this.container.getElements("div.popup ul li[class!=separator]");if(!j||g<0||g>=j.length){return}var l=j[g];this.box.getElement("span").set("html",l.get("html"))},globalCheck:function(b){if(!this.popup.hasClass("hover")&&!this.box.hasClass("hover")){this.close()}},setGlobalCheck:function(){(function(){if(!this.globalevent){this.destroyBind=this.globalCheck.bind(this);document.addEvent("click",this.destroyBind);this.globalevent=true}}).delay(100,this)},removeGlobalCheck:function(){this.globalevent=false;if(this.destroyBind){document.removeEvent("click",this.destroyBind)}},onclick:function(g){var f=$(g.target);if(f.onclick){return}this.toggle(false)},ondblclick:function(){this.toggle(true)},open:function(){this.popup.show();if(this.iframe){this.iframe.show()}this.box.addClass("expanded");if(this.options.usejQueryPositioning){var g=jQuery("#"+this.container_id);var l=g.find(".combolabel");var j={my:"left top",at:"left bottom",collision:"none",offset:"0 -2",within:g};g.find("div.popup").position(jQuery.extend({of:g},j))}if(this.options.shadow){this.box.addClass("shadow");this.popup.addClass("shadow")}if(!this.options.toggle){this.setGlobalCheck()}if(!this.isopen){this.fireEvent("open",{target:this})}this.isopen=true},close:function(){this.popup.hide();if(this.iframe){this.iframe.hide()}this.box.removeClass("expanded");if(this.options.shadow){this.box.removeClass("shadow");this.popup.removeClass("shadow")}this.removeGlobalCheck();this.isopen=false},toggle:function(b){if(b&&!window.ie){return}if(this.isopen){this.close()}else{this.open()}},setTitle:function(f){var g=this.box.getElement("span");if(f.length>0){g.set("html",f)}else{g.set("html","&nbsp;")}},insertIframeShim:function(g,f){var g=(g+2)+"px";var f=(f+2)+"px";if(!this.iframe){this.iframe=new Element("iframe",{marginwidth:0,marginheight:0,frameBorder:0,style:"position:absolute;z-index:0;left:-1px;top:-1px;width:"+g+";height:"+f+";filter:alpha(opacity=0);"});this.iframe.inject(this.container,"top");this.iframe.hide();if(document.all&&iframeshimCollection){iframeshimCollection.push(this.iframe)}}}});var omniGrid=new Class({Implements:[Events,Options],getOptions:function(){return{width:400,height:200,defaultColumnWidth:100,autoFitLastColumn:true,showNoData:false,alternaterows:true,showHeader:true,sortHeader:false,resizeColumns:true,noredraw:false,smartRefresh:false,selectable:true,serverSort:true,sortOn:null,sortBy:"ASC",filterHide:true,filterHideCls:"hide",filterSelectedCls:"filter",filterInput:false,filterServer:false,query:null,query_on:null,bottomHtml:"",multipleSelection:true,editable:false,editondblclick:false,editToolbarContainer:null,crudRowButtons:null,outerBorder:true,accordion:false,accordionRenderer:null,autoSectionToggle:true,showtoggleicon:true,openAccordionOnDblClick:false,url:null,method:"get",rest:false,columnHeaderDropdown:false,pagination:false,smartPagination:false,page:1,perPageOptions:[10,20,50,100,200],perPage:10,disableLoader:false,dataProvider:null}},initialize:function(g,f){this.setOptions(this.getOptions(),f);this.container=$(g);if(!this.container){return}this.container.empty();if(this.options.outerBorder){this.options.outerBorder=2}this.draw();this.reset();this.loadData()},initRows:function(b){this.refreshDelayID=null;this.dragging=false;if(!b){this.selected=new Array()}if(this.options.accordion){this.elements=this.ulBody.getElements("li:nth-child(2n+1)")}else{this.elements=this.ulBody.getElements("li")}this.filtered=false;this.lastsection=null;if(this.options.alternaterows){this.altRow()}this.elements.each(function(g,a){g.addEvent("click",this.onRowClick.bind(this));g.addEvent("dblclick",this.onRowDblClick.bind(this));g.addEvent("mouseover",this.onRowMouseOver.bind(this));g.addEvent("mouseout",this.onRowMouseOut.bind(this))},this)},reset:function(){var b=this.options.noredraw;if(this.options.noredraw){this.refreshData();this.options.noredraw=false}else{this.renderData()}this.initRows(b);this.container.getElements(".th").each(function(j,l){var a=j.retrieve("dataType");if(a){j.getdate=function(p){function f(o){o=+o;if(o<50){o+=2000}else{if(o<100){o+=1900}}return o}var g;if(p.length>12){strtime=p.substring(p.lastIndexOf(" ")+1);strtime=strtime.substring(0,2)+strtime.substr(-2)}else{strtime="0000"}if(g=p.match(/(\d{2,4})-(\d{1,2})-(\d{1,2})/)){return(f(g[1])*10000)+(g[2]*100)+(+g[3])+strtime}if(g=p.match(/(\d{1,2})[\/-](\d{1,2})[\/-](\d{2,4})/)){return(f(g[3])*10000)+(g[2]*100)+(+g[1])+strtime}return 999999990000};j.findData=function(g){var f=g.getFirst();if(f){return j.findData(f)}else{return g.innerHTML.trim()}};j.compare=function(f,g){var r=f.getChildren()[l].innerHTML.trim();var u=g.getChildren()[l].innerHTML.trim();if(a=="number"){r=parseFloat(r);u=parseFloat(u);if(j.sortBy=="ASC"){return r-u}else{return u-r}}else{if(a=="string"){r=r.toUpperCase();u=u.toUpperCase();if(r==u){return 0}if(j.sortBy=="ASC"){if(r<u){return -1}}else{if(r>u){return -1}}return 1}else{if(a=="date"){r=parseFloat(j.getdate(r));u=parseFloat(j.getdate(u));if(j.sortBy=="ASC"){return r-u}else{return u-r}}else{if(a=="currency"){r=parseFloat(r.substr(1).replace(",",""));u=parseFloat(u.substr(1).replace(",",""));if(j.sortBy=="ASC"){return r-u}else{return u-r}}}}}}}},this)},edit:function(E){var N={},I;if(!this.options.editable){return}if(E.row>=0){I=E.row}else{var M=this.getSelectedIndices();if(!M||M.length==0){return}I=M[0]}this.finishEditing();var P=this.elements[I];var F=E.columnIndex?E.columnIndex:0;var O;if(E.dataIndex){for(;F<this.options.columnModel.length;F++){O=this.options.columnModel[F];if(O.hidden){continue}if(O.dataIndex==E.dataIndex){break}}}if(F==this.options.columnModel.length){return}O=this.options.columnModel[F];if(!O.editable){return}var Q=P.getElements("div.td")[F];var G=P.retrieve("newrow");var K,J;K=this.options.data[I];J=K[O.dataIndex];N={preventEdit:function(){this.doNotEdit=true},colmod:O,value:J,data:this.options.data[I]};this.fireEvent("beforeedit",N);if(N.doNotEdit){return}var R=Q.getStyle("width").toInt()-5;var H=15;Q.innerHTML="";var S=new Element("input",{style:"width: "+R+"px; height: "+H+"px;",maxlength:254,value:J});S.addClass("inline");S.addEvent("keyup",this.finishEditing.bind(this));S.addEvent("blur",this.finishEditing.bind(this));S.inject(Q);S.focus();this.inlineEditSafe={row:I,columnModel:O,td:Q,input:S,oldvalue:J,newrow:G};this.inlineeditmode=true;return this.inlineEditSafe},finishEditing:function(o){if(!this.inlineeditmode){return}if(o&&o.type=="keyup"&&o.key!="enter"&&o.key!="esc"){return}this.inlineeditmode=false;var r=this.inlineEditSafe.row;var u=this.options.data[r];var l=this.inlineEditSafe.columnModel;var p=this.inlineEditSafe.td;u[l.dataIndex]=(o&&o.type=="keyup"&&o.key=="enter")?this.inlineEditSafe.input.value:this.inlineEditSafe.oldvalue;p.innerHTML=l.labelFunction?l.labelFunction(u,r,l):u[l.dataIndex];if(p.innerHTML.length==0){p.innerHTML="&nbsp;"}if(o&&o.type=="keyup"&&o.key=="enter"&&this.inlineEditSafe.oldvalue!=p.innerHTML){this.inlineEditSafe.target=this;this.fireEvent("editcomplete",this.inlineEditSafe)}this.inlineEditSafe=null},newRowInsertClick:function(l){if(!this.newrowobj){return}this.finishEditing();if(this.options.editToolbarContainer){var u=$(this.options.editToolbarContainer);u.empty()}var o=this.newrowobj.rowelement;var p=this.newrowobj.row;var r=this.options.data[p];this.fireEvent("insertrow",{target:this,data:r,row:p,rowelement:o});this.newrowobj=null},toggle:function(b){if(b.getStyle("display")=="block"){b.setStyle("display","none")}else{b.setStyle("display","block")}},getSection:function(b){return this.ulBody.getElement(".section-"+b)},getLiParent:function(b){b=$(b);while(b&&!b.hasClass("td")){b=b.getParent()}if(b){return b.getParent()}},onRowMouseOver:function(f){var g=this.getLiParent(f.target);if(!g){return}if(!this.dragging){g.addClass("over")}this.fireEvent("mouseover",{target:this,row:g.retrieve("row"),element:g})},onRowMouseOut:function(f){var g=this.getLiParent(f.target);if(!g){return}if(!this.dragging){g.removeClass("over")}this.fireEvent("mouseout",{target:this,row:g.retrieve("row"),element:g})},onRowClick:function(C,F){var B=this.getLiParent(C.target);if(!B){return}if(this.options.selectable){var D=B.retrieve("row");var K=this.selected?this.selected.length:0;var J=false;if((!C.control&&!C.shift)||!this.options.multipleSelection){this.elements.each(function(a,b){a.removeClass("selected")},this);this.selected=new Array()}if(C.control){for(var H=0;H<K;H++){if(D==this.selected[H]){this.elements[D].removeClass("selected");this.selected.splice(H,1);J=true}}}if(C.shift&&this.options.multipleSelection){var G=0;if(this.selected.length>0){G=this.selected[K-1]}var E=D;startindex=Math.min(G,E);E=Math.max(G,E);for(var H=startindex;H<=E;H++){if(this.isHidden(H)){continue}this.elements[H].addClass("selected");this.selected.push(Number(H))}}if(!J){if(!this.isHidden(B.retrieve("row"))){B.addClass("selected");this.selected.push(Number(B.retrieve("row")))}}this.unique(this.selected,true)}if(this.options.accordion&&!this.options.openAccordionOnDblClick){this.accordianOpen(B)}if(!F){var I=B.retrieve("row"),M=this.getDataByRow(I);this.fireEvent("click",{indices:this.selected,target:this,row:I,rowdata:M,element:B})}},toggleIconClick:function(f){f.stopPropagation();var g=this.getLiParent(f.target);this.accordianOpen(g)},accordianOpen:function(j){var l=j.retrieve("row");var g=this.getSection(l);if(this.options.autoSectionToggle){if(this.lastsection){if(this.lastsection!=g){this.lastsection.setStyle("display","none");this.lastsection.getPrevious().getElement(".toggleicon").setStyle("background-position","0 0")}}}this.toggle(g);this.fireEvent("sectiontoggle",{section:g,row:l,element:j});if(this.options.showtoggleicon){j.getElement(".toggleicon").setStyle("background-position",g.getStyle("display")=="block"?"-16px 0":"0 0")}this.lastsection=g},onRowDblClick:function(r){var z=this.getLiParent(r.target);if(!z){return}var C=r.target;if(this.options.editable&&this.options.editondblclick&&C.hasClass("td")){var B=z.getChildren();for(var D=0;D<B.length;D++){if(B[D]==C){break}}var u=this.edit({columnIndex:D});if(u){u.input.selectRange(0,u.input.value.length)}}if(this.options.accordion&&this.options.openAccordionOnDblClick){this.accordianOpen(z)}var F=z.retrieve("row"),E=this.getDataByRow(F);this.fireEvent("dblclick",{row:F,rowdata:E,target:this,element:z})},onLoadData:function(b){this.__loading=false;if(!b){this.removeAll();this.hideLoader()}else{this.setData(b)}this.fireEvent("loaddata",{target:this,data:b,pkey:b?b.pkey:null});if(this.ulscroll){this.bDiv.scrollTo(this.ulscroll.x,this.ulscroll.y)}},unique:function(a,o){function r(b,f){return b-f}var p=o?r:function(){};a.sort(p);for(var u=1;u<a.length;u++){if(a[u-1]==a[u]){a.splice(u,1);u--}}return a},loadData:function(C){if(!this.options.url&&!this.options.dataProvider){return}var z={};if(this.options.pagination){z={page:this.options.page,perpage:this.options.perPage}}if(this.options.serverSort){if(this.options.rest){if(this.options.sortOn){z.order_by=this.options.sortOn+":"+this.options.sortBy}}else{z.sorton=this.options.sortOn;z.sortby=this.options.sortBy}}if(Browser.Engine.trident){z.dummyparam=Date.now()}if(this.options.filterInput){var D=this.container.getElement("input.cfilter");if(D){z.filter=D.value}}if(this.options.filterServer&&this.options.rest){z.query=this.options.query;z.query_on=this.options.query_on}if(!this.options.disableLoader){this.showLoader()}if(this.options.dataProvider){this.options.dataProvider.loadData(z)}else{var C=(C!=null)?C:this.options.url;var p={target:this,data:z,url:C};this.fireEvent("beforerequest",p);var u="";if(this.options.method=="get"){u=Hash.toQueryString(p.data)}var r=null;if(this.options.smartRefresh&&typeof(this.md5)=="function"){var r=this.md5(p.url+"&"+u)}if(p.url.indexOf("?")>0){p.url+="&"+u}else{p.url+="?"+u}if(this.options.smartRefresh){if(this.hashreq==r){this.ulscroll=this.bDiv.getScroll()}else{this.ulscroll=null;this.hashreq=r}}this.__loading=true;var B=new Request.JSON({url:p.url,method:this.options.method,data:p.data});B.addEvent("complete",this.onLoadData.bind(this));B.send()}},refresh:function(b){this.options.noredraw=b;this.loadData()},setData:function(p,j){if(!p){return}this.options.data=p.data;if(p.meta){this.options.data.meta=p.meta}this.fireEvent("beforerender",{target:this,data:p,cmu:this.options.columnModel});if(this.options.crudRowButtons){}if(j){if(this.options.columnModel!=j){this.options.columnModel=j;this.draw()}}if(!this.options.columnModel){this.setAutoColumnModel()}else{this.draw()}if(this.options.pagination){this.options.page=p.page*1;this.options.total=p.total;this.options.maxpage=Math.ceil(this.options.total/this.options.perPage);this.container.getElement("div.pDiv input").value=p.page;var o=(p.page*this.options.perPage)>p.total?p.total:(p.page*this.options.perPage);this.container.getElement("div.pDiv .pPageStat").set("html",((p.page-1)*this.options.perPage+1)+".."+o+" / "+p.total);this.pDiv2.getElement(".pcontrol span").set("html",this.options.maxpage);var l=this.container.getElement("div.pDiv");if(l&&this.options.smartPagination&&p.page==1&&this.options.maxpage==1){l.hide()}else{l.show()}}this.reset();this.hideLoader()},getData:function(){return this.options.data},getDataByRow:function(b){if(b>=0&&b<this.options.data.length){return this.options.data[b]}},setDataByRow:function(f,g){if(f>=0&&f<this.options.data.length){this.options.data[f]=g;this.reset()}},setDataByRowAndColumn:function(p,l,j){if(p>=0&&p<this.options.data.length&&l){var o=this.options.data[p];o[l]=j;this.reset()}},setScroll:function(j,l){var g=this.container.getElement(".bDiv");new Fx.Scroll(g).set(j,l)},addRow:function(g,f){if(f>=0){if(!this.options.data){this.options.data=[]}this.options.data.splice(f,0,g);this.reset()}},deleteRow:function(b){if(b>=0&&b<this.options.data.length){this.options.data.splice(b,1);this.reset()}},isHidden:function(b){return this.elements[b].hasClass(this.options.filterHideCls)},hideWhiteOverflow:function(f){if(this.container.getElement(".gBlock")){this.container.getElement(".gBlock").dispose()}var g=this.container.getElement("div.pDiv .pReload");if(g){g.removeClass("loading")}},overlayText:function(o){if(this.text_overlay){this.text_overlay.dispose();if(o=="hide"){return}}this.text_overlay=new Element("div",{style:"font-size:25px; font-family:Helvetica; font-weight:100; position: absolute; z-index: 999; opacity: 0.1; filter: alpha(opacity=50"});this.text_overlay.set("html",o);this.container.appendChild(this.text_overlay);var l=this.text_overlay.getSize();var j=this.container.getSize();var p=j.x/2-l.x/2;this.text_overlay.setStyles({top:j.y/2-l.y/2-20,left:p});this.text_overlay.addClass("omnigrid-text-overlay")},showWhiteOverflow:function(u){if(this.container.getElement(".gBlock")){this.container.getElement(".gBlock").dispose()}var l=new Element("div",{style:"top: 0px; left: 0px; background: white none repeat scroll 0% 0%;  -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; position: absolute; z-index: 999; opacity: 0.5; filter: alpha(opacity=50"});var p=this.container.getElement(".bDiv");var r=1;r+=this.container.getElement(".tDiv")?this.container.getElement(".tDiv").getSize().y:0;r+=this.container.getElement(".hDiv")?this.container.getElement(".hDiv").getSize().y:0;l.setStyles({width:this.width,height:this.height,top:0});l.addClass("gBlock");this.container.appendChild(l);var o=this.container.getElement("div.pDiv .pReload");if(o){o.addClass("loading")}},showLoader:function(){if(this.loader){return}if(this.text_overlay){this.text_overlay.dispose()}this.showWhiteOverflow();this.loader=new Element("div");this.loader.addClass("elementloader");this.loader.inject(this.container);var b=this.container.getSize();this.loader.setStyles({top:b.y/2-16,left:b.x/2})},hideLoader:function(){if(!this.loader){return}this.hideWhiteOverflow();this.loader.dispose();this.loader=null},selectAll:function(){this.unselectAll();this.elements.each(function(f,g){if(this.isHidden(g)){return}this.selected.push(f.retrieve("row"));f.addClass("selected")},this)},unselectAll:function(){this.elements.each(function(f,g){f.removeClass("selected")},this);this.selected=[]},getSelectedIndices:function(){return this.selected},setSelectedIndices:function(j,o){this.selected=j;if(!j){return}for(var p=0;p<j.length;p++){var l=this.elements[j[p]];this.onRowClick({target:l.getFirst(),control:false},o)}},onMouseOver:function(b){b.columnModel.onMouseOver(b.element,b.data)},removeHeader:function(){var b=this.container.getElement(".hDiv");if(b){b.empty()}this.options.columnModel=null},removeAll:function(f){if(this.ulBody){this.ulBody.empty();this.ulBody.setStyle("width","auto");if(this.options.showNoData){this.overlayText("No data.")}}this.selected=new Array();if(f){var g=this.container.getElement(".hDivBox");if(g){g.empty();g.setStyle("width","auto")}}},setColumnModel:function(b){if(!b){return}this.options.columnModel=b;this.draw()},setColumnProperty:function(l,p,r){var o=this.options.columnModel;if(!o||!l||!p){return}l=l.toLowerCase();for(var u=0;u<o.length;u++){if(o[u].dataIndex&&o[u].dataIndex.toLowerCase()==l){o[u][p]=r;return}}},setColumnFilterClass:function(B,D){var u=this.options.columnModel;if(!u||!B){return}var p=this.container.getElements(".hDiv .th"),z,r;for(var C=0;C<p.length;C++){z=p[C];c=z.retrieve("column");if(this.options.columnModel[c].dataIndex==B){this.options.columnModel[c].filtered=D;if(D){z.addClass("column-filtered")}else{z.removeClass("column-filtered")}return}}},removeColumnFilterClass:function(){var b;if(!this.options.columnModel){return}for(b=0;b<this.options.columnModel.length;b++){this.options.columnModel[b].filtered=false}this.container.getElements(".hDiv .th").removeClass("column-filtered");this.closeDropDown()},setAutoColumnModel:function(){if(!this.options.data){return}var l=this.options.data.length;if(!(l>0)){return}this.options.columnModel=[];var r=Object.getLength(this.options.data[0]),u=0,o;for(var p in this.options.data[0]){u++;o=typeof(this.options.data[0][p])=="number"?"number":"string";this.options.columnModel.push({header:p,dataIndex:p,dataType:o,editable:true,width:this.options.defaultColumnWidth})}this.fireEvent("autocolummodel",{target:this,columnModel:this.options.columnModel});this.draw()},setSize:function(l,o){this.options.width=l?l:this.options.width;this.options.height=o?o:this.options.height;this.calculatesSize();if(this.options.width>0){this.container.setStyle("width",this.options.width)}if(this.options.buttons&&this.width>0){this.container.getElement(".tDiv").setStyle("width",this.width)}var p=this.container.getElement(".hDiv");if(this.options.showHeader&&p&&this.width>0){p.setStyle("width",this.width)}if(this.width>0){this.bDiv.setStyle("width",this.width)}if(this.options.pagination&&this.container.getElement("div.pDiv")&&this.width>0){this.container.getElement("div.pDiv").setStyle("width",this.width)}this.bDiv.setStyle("height",null);this.bDiv.setStyle("height",this.getBodyHeight());if(this.height>0){this.container.setStyle("height",this.height)}var j=this.container.getElement(".gBlock");if(j){j.setStyles({width:this.width>0?this.width:0,height:this.bDiv.getSize().y})}},onBodyScroll:function(){var j=this.container.getElement(".hDivBox");var l=this.container.getElement(".bDiv");var g=l.getScroll().x;j.setStyle("left",-g);this.rePosDrag();this.closeDropDown()},onBodyClick:function(){},onBodyMouseOver:function(){},onBodyMouseOut:function(){},rePosDrag:function(){if(!this.options.resizeColumns||!this.options.columnModel){return}var o=0;var r=this.container.getElements(".cDrag div");var u=this.container.getElement("div.bDiv").getScroll().x;for(var p=0;p<this.options.columnModel.length;p++){var B=this.options.columnModel[p];var z=r[p];if(!B.hidden){o+=B.width+1}z.setStyle("left",o-2-u)}},onColumnDragComplete:function(f){this.dragging=false;var g=f.retrieve("column");this.setColumnWidth(g)},setColumnWidth:function(R,O){var Q;if(!O){var N=this.container.getElement("div.cDrag"),U=N.getElements("div")[R],G=this.container.getElement("div.bDiv").getScroll().x}this.sumWidth=0;for(var J=0;J<this.options.columnModel.length;J++){var K=this.options.columnModel[J];if(J==R){Q=O?O:U.getStyle("left").toInt()+G-this.sumWidth-(Browser.Engine.trident?-1:1)}else{if(!K.hidden){this.sumWidth+=K.width}}}if(Q<30){Q=30}this.options.columnModel[R].width=Q;this.sumWidth+=Q;this.ulBody.setStyle("width",this.sumWidth+this.visibleColumns*(Browser.Engine.trident?1:1));var T=this.container.getElement("div.hDivBox");T.setStyle("width",this.sumWidth+this.visibleColumns*2);var M=T.getElements("div.th");var H=M[R];H.setStyle("width",Q-(Browser.Engine.trident?6:6));var F=this.visibleColumns;var S=this.ulBody.getElements("li.tr");var P=S.length>0?S[0].getElement(".td"):null;var I=P?P.getStyle("padding-left").toInt()+P.getStyle("padding-right").toInt():0;S.each(function(a,b){a.setStyle("width",this.sumWidth+(I+2)*F);if(!a.hasClass("section")){var f=a.getElements("div.td");var g=f[R];g.setStyle("width",Q-(Browser.Engine.trident?6:6))}},this);this.rePosDrag()},onColumnDragStart:function(b){this.dragging=true},onColumnDragging:function(b){b.setStyle("top",1)},overDragColumn:function(b){b.target.addClass("dragging")},outDragColumn:function(b){b.target.removeClass("dragging")},clickHeaderColumn:function(l){if(this.dragging){return}var o=l.target;if(!o.hasClass("th")){return}var p=l.target.retrieve("column");var j=this.options.columnModel[p];l.target.removeClass(j.sort);j.sort=(j.sort=="ASC")?"DESC":"ASC";l.target.addClass(j.sort);if(!j.sortDisabled){this.sort(p,j.sort)}},overHeaderColumn:function(l){if(this.dragging){return}var o=l.target;if(!o.hasClass("th")){o=o.getParent(".th")}var p=o.retrieve("column");var j=this.options.columnModel[p];if(!j.sortDisabled){o.addClass(j.sort)}},outHeaderColumn:function(l){if(this.dragging){return}var o=l.target;if(!o.hasClass("th")){o=o.getParent(".th")}var p=o.retrieve("column");var j=this.options.columnModel[p];if(!j.sortDisabled){o.removeClass(j.sort)}},clickHeaderDropDown:function(o){if(this.dragging){return}var r=o.target;if(!r.hasClass("th")){r=r.getParent(".th")}var u=r.retrieve("column");var l=this.options.columnModel[u];var p=this.ddcont.retrieve("colindex");this.ddcont.store("colindex",u);if(p!=u||!this.ddcont.isVisible()){this.ddcont.show();this.fireEvent("dropdown-show",{target:this,dropdown:this.ddcont,columnModel:l,columnIndex:u})}else{this.ddcont.hide();this.fireEvent("dropdown-hide",{target:this,dropdown:this.ddcont,columnModel:l,columnIndex:u})}this.positionDropDown(o)},positionDropDown:function(l){if(l&&l.target){var p=l.target.getCoordinates();this.ddcont.setPosition({x:p.left,y:p.top+10})}else{var p=this.ddcont.getCoordinates();var u=this.ddcont.getCoordinates();var o=this.container.getSize().y;var r=p.top+10;if((u.top+p.height)>window.getSize().y){r=r-p.height-20}this.ddcont.setPosition({y:r,x:p.left})}},closeDropDown:function(){if(!this.options.columnHeaderDropdown||!this.ddcont){return}this.ddcont.hide()},getBodyHeight:function(){var o=this.options.showHeader?24:0;var p=this.options.buttons?this.container.getElement(".tDiv").getStyle("height").toInt():0;var l=this.options.pagination?26:0;var r=this.container.getSize().y;if(!r){r=this.container.getComputedSize().y}if(!r){r=this.options.height}var u=r-o-p-l;return u>2?u:0},refreshHeight:function(l,g){if(this.bDiv){if(l){var j=g?g.getSize().y:this.container.getParent().getSize().y;this.setSize(this.width,j)}this.bDiv.setStyle("height",null);this.bDiv.setStyle("height",this.getBodyHeight())}},refreshData:function(){if(this.options.data&&this.options.data.length){var D=this.options.columnModel.length;var B=this.options.data.length;for(var I=0;I<B;I++){var G=this.options.data[I];var J=this.elements[I];var r=-1;for(var C=0;C<D;C++){var E=this.options.columnModel[C];if(E.hidden){continue}var H=J.getElements(".td")[C];r=(!E.hidden&&r==-1)?C:r;var F="";if(r==C&&this.options.accordion&&this.options.showtoggleicon){F="<div class='toggleicon'></div>"}this.setColumnValue(H,J,E,G,I,C,{toggleicon:F,firstvisible:r})}}}},setColumnValue:function(S,O,N,W,T,I,U){if(N.dataType=="checkbox"){var r=new Element("input",{type:"checkbox"});if(N.onChange){r.onclick=this.onSelect.bind(this,{columnModel:N,row:T,input:r})}S.appendChild(r);var P=W[N.dataIndex];if(P==1||P=="t"){r.set("checked",true)}}else{if(N.type=="image"){}else{if(N.type=="custom"){}else{if(N.dataType=="crud_buttons"){var K=new Element("div");K.addClass("row-crud-buttons");K.inject(S);var Y="<div class='row-crud-buttons' >";var J=this;this.options.crudRowButtons.each(function(b,f){var a={data:b,columnModel:N,rowdata:W,row:T,column:I,skip:false};J.fireEvent("crudbutton_before_render",a);if(!a.skip){var g=new Element("a",{href:"javascript:;",html:b.label,title:b.title});g.addClass(b["class"]);g.addClass("row-crud-button");g.inject(K);g.addEvent("click",function(j){J.fireEvent("crudbuttonclick",{data:b,columnModel:N,rowdata:W,row:T,column:I})})}else{K.set("html","&nbsp;")}})}else{if(N.labelFunction!=null){var Q="";if(U&&U.toggleicon){Q+=U.toggleicon}html=Q+N.labelFunction(W,T,N);S.set("html",html!=""?html:"&nbsp;");if(U&&U.firstvisible==I&&this.options.accordion&&this.options.showtoggleicon){S.getElement(".toggleicon").addEvent("click",this.toggleIconClick.bind(this))}}else{if(N.dataType=="timestamp"){var V=W[N.dataIndex],Z=N.format?N.format:"L";S.innerHTML=V&&!isNaN(V)?moment.unix(V).format(Z):""}else{var R=new String(W[N.dataIndex]);if(R==null||R=="null"||R=="undefined"||R==""){R="&nbsp;"}var M=R.replace(/^\s+|\s+$/g,"");if(M.length==0){R="&nbsp;"}S.innerHTML="";if(U&&U.toggleicon){S.innerHTML+=U.toggleicon}S.innerHTML+=R;if(U.firstvisible==I&&this.options.accordion&&this.options.showtoggleicon){S.getElement(".toggleicon").addEvent("click",this.toggleIconClick.bind(this))}}}}}}}},isInsertMode:function(){return this.newrowobj?true:false},addNewRow:function(){if(!this.options.columnModel){return}if(this.newrowobj){this.options.data.splice(this.newrowobj.rowelement.retrieve.row,1);this.newrowobj.rowelement.dispose()}if(this.options.editToolbarContainer){var C=$(this.options.editToolbarContainer);C.empty();var B=new Element("a",{href:"javascript:;",html:"OK"});B.addClass("linkbutton");B.inject(C);B.addEvent("click",this.newRowInsertClick.bind(this))}var z=this.options.columnModel.length,D;var u={};for(D=0;D<z;D++){var r=this.options.columnModel[D];u[r.dataIndex]=""}var p;if(this.options.data){p=this.options.data.push(u)-1}else{this.options.data=[u];p=0}this.newrowobj=this.renderRow(u,p,z);this.newrowobj.rowelement.store("newrow",true);this.newrowobj.rowelement.addClass("newrow");this.bDiv.setStyle("height",this.getBodyHeight());this.initRows()},renderRow:function(C,K,E){var I=new Element("li");I.setStyle("width",this.sumWidth+2*this.visibleColumns);I.store("row",K);I.addClass("tr");this.ulBody.appendChild(I);var G={target:this,rowelement:I,rowdata:C,row:K};this.fireEvent("rowrender",G);if(this.options.tooltip){this.options.tooltip.attach(tr)}var M=-1;for(var D=0;D<E;D++){var F=this.options.columnModel[D];var J=new Element("div");J.store("column_model",F);J.addClass("td");J.setStyle("width",F.width-6);I.appendChild(J);M=(!F.hidden&&M==-1)?D:M;var H="";if(M==D&&this.options.accordion&&this.options.showtoggleicon){H="<div class='toggleicon'></div>"}if(F.hidden){J.setStyle("display","none")}if(F.onMouseOver){J.onmouseover=this.onMouseOver.bind(this,{element:J,columnModel:F,data:C})}if(F.title){J.title=C[F.title]}this.setColumnValue(J,I,F,C,K,D,{toggleicon:H,firstvisible:M})}if(this.options.accordion){var r=new Element("li");r.addClass("section");r.addClass("section-"+K);r.setStyle("width",this.sumWidth+2*this.visibleColumns);this.ulBody.appendChild(r);if(this.options.accordionRenderer){this.options.accordionRenderer({parent:r,row:K,grid:this,rowdata:C})}}return G},renderData:function(){this.ulBody.empty();this.inlineEditSafe=null;if(this.options.data&&this.options.data.length){var p=this.options.columnModel.length;var l=this.options.data.length;for(var j=0;j<l;j++){var o=this.options.data[j];this.renderRow(o,j,p)}}this.bDiv.setStyle("height",this.getBodyHeight())},calculatesSize:function(){this.width=this.options.width.toString().indexOf("%")>0?this.options.width:(this.options.width-this.options.outerBorder);this.height=this.options.height.toString().indexOf("%")>0?this.options.height:(this.options.height-this.options.outerBorder)},pagination:function(f){var g=this.container.getElement("div.pDiv");this.options.pagination=f;if(!f&&g){g.dispose()}this.reset()},draw:function(){if(this.options.noredraw){return}this.removeAll();var ax=this.container.getElement("div.pDiv"),aB=this.container.getElement(".hDiv"),aG=this.container.getElement(".cDrag"),ax=this.container.getElement("div.pDiv");this.bDiv=this.container.getElement(".bDiv");if(aB){aB.empty()}if(aG){aG.empty()}if(this.bDiv){this.bDiv.empty()}if(this.text_overlay){this.text_overlay.dispose()}this.calculatesSize();var aa=this.options.columnModel?this.options.columnModel.length:0;if(this.width){this.container.setStyle("width",this.width)}this.container.addClass("omnigrid");var aF=this.container.getElement(".tDiv");if(this.options.buttons&&!aF){aF=new Element("div");aF.addClass("tDiv");aF.setStyle("width",this.width);aF.setStyle("height",25);this.container.appendChild(aF);var ac=this.options.buttons;for(var ak=0;ak<ac.length;ak++){var az=new Element("div");aF.appendChild(az);if(ac[ak].separator){az.addClass("btnseparator");continue}az.addClass("fbutton");var an=new Element("div");if(ac[ak].onclick){an.addEvent("click",ac[ak].onclick.bind(this))}an.addEvent("mouseover",function(){this.addClass("fbOver")});an.addEvent("mouseout",function(){this.removeClass("fbOver")});az.appendChild(an);var at=new Element("span",{title:ac[ak].title});at.addClass(ac[ak].bclass);at.setStyle("padding-left",20);at.set("html",ac[ak].name);an.appendChild(at)}}var aC=this.width.toString().indexOf("%")>0?"100%":this.width;if(!aB){aB=new Element("div");aB.addClass("hDiv");this.container.appendChild(aB)}aB.setStyle("width",aC);var ay=new Element("div");ay.addClass("hDivBox");aB.appendChild(ay);this.sumWidth=0;this.visibleColumns=0;for(var ab=0;ab<aa;ab++){var ai=this.options.columnModel[ab];var am=new Element("div");if(ai.width==null){this.options.columnModel[ab].width=this.options.defaultColumnWidth}if(!ai.sort){ai.sort="ASC"}if(this.options.sortHeader&&!ai.sortDisabled){am.addEvent("click",this.clickHeaderColumn.bind(this));am.addEvent("mouseout",this.outHeaderColumn.bind(this));am.addEvent("mouseover",this.overHeaderColumn.bind(this))}am.store("column",ab);am.store("dataType",ai.dataType);am.addClass("th");if(ai.filtered){am.addClass("column-filtered")}am.setStyle("width",ai.width-(Browser.Engine.trident?6:6));ay.appendChild(am);if(ai.hidden){am.setStyle("display","none")}else{this.sumWidth+=ai.width;this.visibleColumns++}var al=ai.header;if(al){am.set("text",al);am.title=al}else{am.innerHTML="&nbsp;"}if(this.options.columnHeaderDropdown&&!ai.noDropDown){var aq=new Element("div");aq.addClass("th-dropdown");aq.inject(am);aq.addEvent("click",this.clickHeaderDropDown.bind(this))}}ay.setStyle("width",this.sumWidth+this.visibleColumns*2);if(!this.options.showHeader){aB.setStyle("display","none")}else{}this.container.setStyle("height",this.height);var au=this.getBodyHeight();if(this.options.resizeColumns){if(!aG){aG=new Element("div");aG.addClass("cDrag");this.container.appendChild(aG)}var ag=this.options.buttons?aF.getStyle("height").toInt():0;aG.setStyle("top",ag);var aw=0;for(var ab=0;ab<aa;ab++){var ai=this.options.columnModel[ab];var ao=new Element("div");var ap=this.options.showHeader?24:0;if(!ai.hidden){aw+=ai.width+1}ao.setStyles({top:1,left:aw-2,height:ap,display:"block"});ao.store("column",ab);aG.appendChild(ao);ao.addEvent("mouseout",this.outDragColumn.bind(this));ao.addEvent("mouseover",this.overDragColumn.bind(this));var ae=new Drag(ao,{snap:0});ae.addEvent("drag",this.onColumnDragging.bind(this));ae.addEvent("start",this.onColumnDragStart.bind(this));ae.addEvent("complete",this.onColumnDragComplete.bind(this));if(ai.hidden){ao.setStyle("display","none")}}}if(!this.bDiv){this.bDiv=new Element("div");this.bDiv.addClass("bDiv");this.container.appendChild(this.bDiv)}this.bDiv.setStyle("width",aC);this.onBodyScrollBind=this.onBodyScroll.bind(this);this.bDiv.addEvent("scroll",this.onBodyScrollBind);this.ulBody=new Element("ul");this.ulBody.setStyle("width",this.sumWidth+this.visibleColumns*(Browser.Engine.trident?1:1));this.bDiv.appendChild(this.ulBody);if(this.options.pagination&&!ax){ax=new Element("div");ax.addClass("pDiv");ax.setStyle("width",this.width);ax.setStyle("height",25);this.container.appendChild(ax);this.pDiv2=new Element("div");this.pDiv2.addClass("pDiv2");ax.appendChild(this.pDiv2);var aj='<div class="pGroup"><select class="rp" name="rp">';var af;var ar=false;for(af=0;af<this.options.perPageOptions.length;af++){if(this.options.perPageOptions[af]!=this.options.perPage){aj+='<option value="'+this.options.perPageOptions[af]+'">'+this.options.perPageOptions[af]+"</option>"}else{ar=true;aj+='<option selected="selected" value="'+this.options.perPageOptions[af]+'">'+this.options.perPageOptions[af]+"</option>"}}aj+="</select></div>";aj+='<div class="btnseparator"></div><div class="pGroup"><div class="pFirst pButton"></div><div class="pPrev pButton"></div></div>';aj+='<div class="btnseparator"></div><div class="pGroup"><span class="pcontrol"><input class="cpage" type="text" value="1" size="4" style="text-align:center"/> / <span></span></span></div>';aj+='<div class="btnseparator"></div><div class="pGroup"><div class="pNext pButton"></div><div class="pLast pButton"></div></div>';aj+='<div class="btnseparator"></div><div class="pGroup"><div class="pReload pButton"></div></div>';aj+='<div class="btnseparator"></div><div class="pGroup"><span class="pPageStat"></div>';if(this.options.filterInput){aj+='<div class="btnseparator"></div><div class="pGroup"><span class="pcontrol"><input class="cfilter" type="text" value="" style="" /><span></div>'}aj+=this.options.bottomHtml;this.pDiv2.set("html",aj);var ah=this.pDiv2.getElement(".rp");if(!ar&&ah.options.length>0){this.options.perPage=ah.options[0].value;ah.options[0].selected=true}this.pDiv2.getElement(".pFirst").addEvent("click",this.firstPage.bind(this));this.pDiv2.getElement(".pPrev").addEvent("click",this.prevPage.bind(this));this.pDiv2.getElement(".pNext").addEvent("click",this.nextPage.bind(this));this.pDiv2.getElement(".pLast").addEvent("click",this.lastPage.bind(this));this.pDiv2.getElement(".pReload").addEvent("click",this.refreshClick.bind(this));this.pDiv2.getElement(".rp").addEvent("change",this.perPageChange.bind(this));this.pDiv2.getElement("input.cpage").addEvent("keyup",this.pageChange.bind(this));if(this.options.filterInput){this.pDiv2.getElement("input.cfilter").addEvent("change",this.firstPage.bind(this))}}if(this.options.autoFitLastColumn){var aD=-1,ad=0,Z,av,aE=this.container.getSize().x;for(var ab=0;ab<aa;ab++){var ai=this.options.columnModel[ab];if(!ai.hidden){aD=ab;Z=ai.width?ai.width:this.options.defaultColumnWidth;ad+=Z}}av=aE-ad+Z-30;if(aD>=0&&av>0){this.setColumnWidth(aD,av)}}this.ddcont=$(document.body).getElement(".gc-omnigrid-dropdown");if(this.options.columnHeaderDropdown&&!this.ddcont){this.ddcont=new Element("div");this.ddcont.addClass("gc-app gc-omnigrid-dropdown");this.ddcont.inject(document.body);var aA=this;document.addEvent("click",function(a){var b=$(a.target);var g=b.getParent(".gc-omnigrid-dropdown");var f=aA.ddcont;if(f!=b&&g!=f&&(b.hasClass&&b.className&&(!b.className.clean||!b.hasClass("th-dropdown")))){aA.closeDropDown()}})}},refreshClick:function(b){this.refresh()},firstPage:function(){this.options.page=1;this.refresh()},prevPage:function(){if(this.options.page>1){this.options.page--;this.refresh()}},nextPage:function(){if((this.options.page+1)>this.options.maxpage){return}this.options.page++;this.refresh()},lastPage:function(){this.options.page=this.options.maxpage;this.refresh()},perPageChange:function(){this.options.page=1;this.options.perPage=this.container.getElement(".rp").value;this.refresh()},pageChange:function(){var b=this.container.getElement("div.pDiv2 input").value;if(b>0&&b<=this.options.maxpage){if(this.refreshDelayID){$clear(this.refreshDelayID)}this.options.page=b;this.refreshDelayID=this.refresh.delay(1000,this)}},gotoPage:function(b){if(b>0&&b<=this.options.maxpage){this.options.page=b;this.refresh()}},setPerPage:function(b){if(b>0){this.options.perPage=b;this.refresh()}},sort:function(l,p){if(l<0||l>=this.options.columnModel.length){return}if(this.options.onStart){this.fireEvent("onStart")}var o=this.container.getElements(".th");var j=o[l];j.sortBy=p.toUpperCase();if(this.options.serverSort){this.options.sortOn=this.options.columnModel[l].dataIndex;this.options.sortBy=j.sortBy;this.refresh()}else{this.elements.sort(j.compare);this.elements.injectInside(this.ulBody);this.selected=new Array();this.elements.each(function(a,b){if(a.hasClass("selected")){this.selected.push(a.retrieve("row"))}},this);if(this.filtered){this.filteredAltRow()}else{this.altRow()}}},altRow:function(){this.elements.each(function(f,g){if(g%2){f.removeClass("erow")}else{f.addClass("erow")}})},filteredAltRow:function(){this.ulBody.getElements("."+this.options.filterSelectedCls).each(function(f,g){if(g%2){f.removeClass("erow")}else{f.addClass("erow")}})},filter:function(I){var F=0;var z="";if(!(I.length>0)){this.clearFilter()}if(this.options.filterServer){this.options.query=I;var B=this.container.getElement("input.cfilter");if(B){B.value=I}if(this.__filter_intid){clearInterval(this.__filter_intid)}this.__filter_intid=(function(){this.__filter_intid=null;this.refresh()}).delay(500,this);return}z=I;if(z){for(var E=0;E<this.options.data.length;E++){var J=this.options.data[E];for(var C=0;C<this.options.columnModel.length;C++){var D=this.options.columnModel[C];if(D.type=="checkbox"){continue}var H=this.elements[E];if(this.options.filterHide){H.removeClass("erow")}var G=D.dataIndex?J[D.dataIndex]:null;G=G?G:(D.labelFunction?D.labelFunction(J,E,D):null);if(G&&G.toLowerCase().indexOf(z)>-1){H.addClass(this.options.filterSelectedCls);if(this.options.accordion){H.getNext(".section").addClass(this.options.filterSelectedCls)}if(this.options.filterHide){H.removeClass(this.options.filterHideCls);if(this.options.accordion){H.getNext(".section").removeClass(this.options.filterHideCls)}}break}else{H.removeClass(this.options.filterSelectedCls);if(this.options.accordion){H.getNext(".section").removeClass(this.options.filterSelectedCls)}if(this.options.filterHide){H.addClass(this.options.filterHideCls);if(this.options.accordion){H.getNext(".section").addClass(this.options.filterHideCls)}}}}}if(this.options.filterHide){this.filteredAltRow();this.filtered=true}}},clearFilter:function(){this.elements.each(function(f,g){f.removeClass(this.options.filterSelectedCls);if(this.options.filterHide){f.removeClass(this.options.filterHideCls)}},this);if(this.options.filterHide){this.altRow();this.filtered=false}}});var OmniTabs=new Class({Implements:[Events,Options],options:{enableOnClick:false},initialize:function(l,g){this.setOptions(this.options,g);this.container=$(l);this.omnitabsheader=this.container.getElement("ul.omnitabs-header").getChildren("li");this.omnitabs=this.container.getElement("div.omnitabs-container").getChildren(".omnitab");var j=0;this.omnitabsheader.each(function(a,b){a.addEvent("mouseover",this.tabOver.bind(this,[b,a]));a.addEvent("mouseout",this.tabOut.bind(this,[b,a]));a.addEvent("click",this.showTab.bind(this,[b,a]));if(a.hasClass("selected")){j=b}},this);this.showTab(j);this.currentTab=this.lastTab=j},tabOver:function(g,f){this.fireEvent("tabover",{target:this,element:f})},tabOut:function(g,f){this.fireEvent("tabout",{target:this,element:f})},enable:function(){this.container.removeClass("disabled")},disable:function(){this.container.addClass("disabled")},enableTab:function(j){if(j<0||j>=this.omnitabs.length){return}var l=this.omnitabs[j];if(!l){return false}var g=l.getElement(".tabdisabled");if(g){g.dispose()}},disableTab:function(D,z){if(D<0||D>=this.omnitabs.length){return}var F=this.omnitabs[D];if(!F){return false}var B=F.getElement(".tabdisabled");if(!B){var B=new Element("div",{"class":"tabdisabled"});B.addClass("taboverlay");B.inject(F)}var E=F.measure(function(){return this.getCoordinates()});var r=this.container.getElement("div.omnitabs-container").getCoordinates();B.setPosition({x:r.left,y:r.top});B.setStyles({width:E.width,height:E.height});if(z){var u=F.getElement(".taboverlaytext");if(u){u.set("html",z)}else{var C=new Element("div",{"class":"taboverlaytext",html:z});C.inject(B)}}},disableTab2:function(o,u){if(o<0||o>=this.omnitabs.length){return}var r=this.omnitabs[o];if(!r){return false}var z=r.getElement(".tabdisabled");if(!z){var z=new Element("div",{"class":"tabdisabled"});z.addClass("taboverlay");z.inject(r)}z.setPosition({x:0,y:0});z.setStyles({right:0,bottom:0});if(u){var p=r.getElement(".taboverlaytext");if(p){p.set("html",u)}else{var B=new Element("div",{"class":"taboverlaytext",html:u});B.inject(z)}}},isDisabled:function(){return this.container.hasClass("disabled")},hideTab:function(f){var g=this.omnitabsheader[f];g.hide();g.removeClass("activetab");this.omnitabs[f].hide()},showTab:function(g,f){this.fireEvent("tabclick",{target:this,element:f});if(!this.options.enableOnClick&&this.isDisabled()){return}if(this.currentTab==g||g<0||g>=this.omnitabs.length){return}if(this.currentTab>=0){this.omnitabsheader[this.currentTab].removeClass("activetab");this.omnitabs[this.currentTab].hide()}this.omnitabsheader[g].addClass("activetab");this.omnitabs[g].show();this.lastTab=this.currentTab;this.currentTab=g;this.fireEvent("change",{tab:g,element:f})},showLastTab:function(){this.showTab(this.lastTab)}});var omRanges=new Class({Implements:[Events,Options],options:{input1Validation:{},inputButton:false,headerFunction:null,renderFunction:null,serializeFunction:null,deserializeFunction:null,sortable:false,selectable:false,addButton:true},data:[],initialize:function(g,f){this.setOptions(f);this.container=$(g);this.container.addClass("omranges");this.lastSelectedItemID=null;this.reset();this.addRange({})},reset:function(b){if(this.options.headerFunction){this.options.headerFunction(this.container,this.options)}this.valia=[];this.ul=new Element("ul");this.messspan=new Element("span");this.messspan.addClass("vl_message");this.ul.inject(this.container);this.messspan.inject(this.container);if(this.options.sortable){this.itemSort=new Sortables(this.ul,{constrain:true,clone:true,onComplete:this.onSortComplete,control:true})}},onSortComplete:function(b){this.fireEvent("orderchange")},addRange:function(O,M,E){var K=new Element("li");var F=this.ul.getElements("li").length;if(this.options.renderFunction){this.options.renderFunction(K,O,this)}else{this.input1=new Element("input",{type:"text"});this.input1.addClass("firstinput");if(this.options.input1Validation){var C=new LiveValidation(this.input1,{onInvalid:this.onInvalid.bind(this),onValid:this.onValid.bind(this)});for(var I=0;I<this.options.input1Validation.length;I++){if(!(F==0&&this.options.input1Validation[I].options.notFirst)){C.add(this.options.input1Validation[I].func,this.options.input1Validation[I].options)}}this.valia.push(C)}this.input2=new Element("input",{type:"text"});this.input2.addClass("secondinput");if(this.options.input2Validation){var G=new LiveValidation(this.input2,{onInvalid:this.onInvalid.bind(this),onValid:this.onValid.bind(this)});for(var I=0;I<this.options.input2Validation.length;I++){if(!(F==0&&this.options.input1Validation[I].options.notFirst)){G.add(this.options.input2Validation[I].func,this.options.input2Validation[I].options)}}this.valia.push(G)}if(this.options.inputButton){this.inputval=new Element("a",{href:"javascript:;",text:"Change",style:"margin-right:10px;"});this.inputval.addEvent("click",this.changeRange.bind(this,K))}else{this.inputval=new Element("input",{type:"text"});this.inputval.addClass("valinput");if(this.options.input3Validation){var N=new LiveValidation(this.inputval,{onInvalid:this.onInvalid.bind(this),onValid:this.onValid.bind(this)});for(var I=0;I<this.options.input3Validation.length;I++){if(!(F==0&&this.options.input1Validation[I].options.notFirst)){N.add(this.options.input3Validation[I].func,this.options.input3Validation[I].options)}}this.valia.push(N)}}if(O){if(O.value1){this.input1.value=O.value1}if(O.value2){this.input2.value=O.value2}if(O.value3&&!this.options.inputButton){this.inputval.value=O.value3}}this.input1.inject(K);this.input2.inject(K);this.inputval.inject(K)}if((E&&!E.nodelete)||!E){var J=new Element("div",{title:"Delete"});J.addClass("deleteBt ui-delete");J.addEvent("click",this.deleteRange.bind(this,K));J.inject(K)}if(this.options.addButton){var D=new Element("div",{title:"Add new"});D.addClass("addBt");D.addEvent("click",this.newRangeClick.bind(this,K));D.inject(K)}if(M){var H=this.getIndexByLi(M);if(H>=0){K.inject(M,"after")}}else{K.inject(this.ul)}K.store("data",O);if(this.options.sortable){this.itemSort.addItems(K)}if(this.options.selectable){K.addEvent("click",this.liClick.bind(this));K.setStyle("cursor","pointer")}return K},setSelection:function(b){if(this.lastSelectedItemID){this.lastSelectedItemID.removeClass("selected")}b.addClass("selected");this.lastSelectedItemID=b;this.fireEvent("itemclick",b)},liClick:function(b){if(b.target.get("tag")=="li"){this.setSelection(b.target)}},newRangeClick:function(g){var f=this.addRange({},g);this.fireEvent("newrange",f)},addRanges:function(g){for(var f=0;f<g.length;f++){this.addRange(g[f])}},changeRange:function(b){},deleteRange:function(r){var B=this.ul.getChildren("li");if(B.length>1){var z=this.getIndexByLi(r);if(z>=0){var p=r.getChildren();for(var u=0;u<p.length;u++){for(var j=0;j<this.valia.length;j++){if(this.valia[j].element==p[u]){this.valia.splice(j,1)}}}this.fireEvent("deleterange",{li:r,data:r.retrieve("data"),target:this,last:false});r.highlight("#FFFFFF","#FFc0d0");(function(a){a.dispose()}).delay(200,null,r)}}else{if(B.length==1){this.fireEvent("deleterange",{li:r,data:r.retrieve("data"),target:this,last:true})}}},getLiParent:function(b){b=$(b);while(b&&b.get("tag")!="li"){b=b.getParent()}if(b){return b}},getIndexByLi:function(j){var j=this.getLiParent(j);var l=this.ul.getElements("li");for(var g=0;g<l.length;g++){if(l[g]==j){return g}}return -1},setData:function(j,l){var g=this.getElement(j);if(g){g.store("data",l)}},getData:function(g){var f=this.getElement(g);if(f){return f.retrieve("data")}},count:function(){return this.ul.getElements("li").length},getElement:function(f){var g=this.ul.getElements("li");if(f<0||f>=g.length){return null}return g[f]},serialize:function(){if(!this.options.serializeFunction){return}this.elements=this.ul.getElements("li");var b=[];this.elements.each((function(g,a){b.push(this.options.serializeFunction(g,a))}).bind(this));return JSON.encode(b)},deserialize:function(l){if(!l){return}this.removeAll();if($type(l)=="string"){var g=JSON.decode(l)}else{var g=l}if(!g){return}for(var j=0;j<g.length;j++){if(this.options.deserializeFunction){this.addRange(this.options.deserializeFunction(g[j]))}else{this.addRange(g[j])}}},removeAll:function(){this.ul.empty();this.valia=[];this.messspan.set("text","")},onInvalid:function(g,f){if(g){g.addFieldClass()}this.messspan.set("text",f)},onValid:function(g,f){if(g){g.addFieldClass()}this.messspan.set("text","")},validate:function(){return LiveValidation.massValidate(this.valia)}});var omniList=new Class({Implements:[Events,Options],getOptions:function(){return{multipleSelection:true,link:false,toggle:false,hover:true}},initialize:function(b){this.setOptions(this.getOptions(),b);this.data=null;this.container=null},populate:function(z,D){this.container=typeof(z)=="string"?$(z):z;if(!this.container||this.container.get("tag")!="select"||!D.data){return}if(!D.dontempty){this.container.empty()}for(var u=0;u<D.data.length;u++){var C=(D.field)?D.data[u][D.field]:D.data[u];var B=(D.fieldValue)?D.data[u][D.fieldValue]:C;var E=false;for(var j=0;j<this.container.options.length;j++){if(this.container.options[j].value==C||(D.filter&&D.filter.contains(C))){E=true;break}}if(!E||D.allowDuplicates){var F=new Element("option",{html:C,value:B});F.inject(this.container);if(D.store){F.store("data",D.data[u])}}}},clear:function(){this.data=null;this.container.empty()},embed:function(C,u){this.setOptions(this.getOptions(),u);this.container=typeof(C)=="string"?$(C):C;if(!u.data){return}this.data=this.data&&u.dontempty?this.data.concat(u.data):u.data;this.container.empty();this.ul=new Element("ul",{});this.ul.addClass("omnilist");this.ul.inject(this.container);for(var F=0;F<this.data.length;F++){var B=this.data[F];var a=new Element("li");if(u.altering){a.addClass(F%2==0?"altrow":"")}if(u.store){a.store(u.store,B[u.store])}if(u.link){var D=new Element("a",{});D.addClass("gc-label")}var z=u.labelFunction?u.labelFunction(B,F):B[u.label];if(u.link){D.set("html",z)}else{if(u.toggle){var D=new Element("a",{html:z});D.addClass("gc-label");var E=new Element("div",{});E.addClass("checkbox");a.set("html","<div class='checkbox'></div><span class='gc-label'>"+z+"</span>")}else{a.set("html",z)}}if(u.link&&u.onclick){D.addEvent("click",u.onclick)}if(u.link&&u.ondblclick){D.addEvent("dblclick",u.ondblclick)}if(u.link&&u.selection){D.addEvent("click",this.onItemClick.bind(this))}if(u.link){D.inject(a)}if(u.hover){a.addEvent("mouseover",this.onItemMouseOver.bind(this));a.addEvent("mouseout",this.onItemMouseOut.bind(this))}if(u.toggle){a.addEvent("click",this.onItemClick.bind(this))}a.store("index",F);a.inject(this.ul)}},selectByRow:function(b){this.ul.getChildren("li:nth-child("+b+")").each(function(l,j){l.addClass("selected");var a=l.getElement("div.checkbox");if(a){a.addClass("checked")}})},selectAll:function(b){this.ul.getChildren().each(function(l,j){l.addClass("selected");var a=l.getElement("div.checkbox");if(a){a.addClass("checked")}})},unselectAll:function(b){this.ul.getChildren().each(function(l,j){l.removeClass("selected");var a=l.getElement("div.checkbox");if(a){a.removeClass("checked")}})},serialize:function(z){if(!z){return}var o=[];var r;var p=this.ul.getElements("li.selected");for(var B=0;B<p.length;B++){var u=this.options.data[p[B].retrieve("index")];r=null;r=z(u);o.push(r)}return o.join()},addItem:function(j){var a=new Element("li");a.addClass("");var l=new Element("a",{html:j.name});l.addClass("gc-label");l.inject(a);a.inject(this.ul)},getLiByID:function(o){var j=this.ul.getElements("li");for(var p=0;p<j.length;p++){var l=j[p];if(o==l.retrieve("id")){return l}}return null},getLiParent:function(g){var f=$(g);while(f&&(f.get("tag")!="li")){f=f.getParent()}return f},onItemMouseOver:function(f){var g=this.getLiParent(f.target);g.addClass("hover")},onItemMouseOut:function(f){var g=this.getLiParent(f.target);g.removeClass("hover")},onItemClick:function(j){var l=this.getLiParent(j.target);var p=l.retrieve("index");if(!this.options.multipleSelection){l.getParent().getChildren().removeClass("selected")}if(this.options.toggle){var o=l.getElement("div.checkbox");if(l.hasClass("selected")){l.removeClass("selected");if(o){o.removeClass("checked")}}else{l.addClass("selected");if(o){o.addClass("checked")}}}else{if(this.options.link&&this.options.selection){l.addClass("selected")}}this.fireEvent("itemclick",{li:l,index:p})},onItemDblClick:function(g){if(g.target.id){var f={};f.grp=this.getLiParent(g.target).retrieve("grp");f.id=g.target.id.substring(6);this.fireEvent("itemdblclick",f)}}});omnilist=new omniList();var omniCheckBox=new Class({Implements:[Events,Options],options:{title:""},initialize:function(l,g){this.setOptions(this.options,g);this.target=$(l);var j=g&&g.toggleClass?"omf-checkbox-toggle-"+g.toggleClass:"omf-checkbox-toggle";this.size=g&&g.size>0?g.size:10;this.offsetClass="omf-checkbox-offset"+this.size;this.target.addClass("omcheckbox gc-icon"+this.size+" "+j);if(this.options.title.length>0){this.target.setProperty("title",this.options.title)}this.target.addEvent("click",this.click.bind(this));if(g&&g.checked){this.set(true,false)}},click:function(b){if(this.target.hasClass("checked")){this.target.removeClass("checked");this.target.removeClass(this.offsetClass)}else{this.target.addClass("checked");this.target.addClass(this.offsetClass)}this.fireEvent("change",{checked:this.target.hasClass("checked"),target:this.target})},set:function(j,g){var l=this.target.hasClass("checked");if(j){this.target.addClass("checked");this.target.addClass(this.offsetClass)}else{this.target.removeClass("checked");this.target.removeClass(this.offsetClass)}if(!g&&(l^j)){this.fireEvent("change",{checked:this.target.hasClass("checked"),target:this.target})}},get:function(){return this.target.hasClass("checked")}});var omniEdit=new Class({Implements:[Events,Options],options:{},initialize:function(f,g){this.setOptions(this.options,g);this.container=$(f);if(!this.container){return}this.input=new Element("input",{maxlength:254});this.input.hide();this.input.addClass("inline");this.input.addEvent("keyup",this.finishEditing.bind(this));this.input.addEvent("blur",this.finishEditing.bind(this));this.text=new Element("div",{});this.text.addClass("omniedit");this.container.empty();this.input.inject(this.container);this.text.inject(this.container);this.set(this.container.innerHTML);this.gotoEditBind=this.gotoEdit.bind(this);this.text.addEvent("click",this.gotoEditBind)},gotoEdit:function(l){if(this.inlineeditmode){return}var p=this.text.get("text");var u=this.container.getSize();var r=u.x>30?u.x:30;var o=13;this.input.setStyles({width:r,height:o});this.text.hide();this.input.value=p;this.input.show();this.input.focus();this.input.selectRange(0,p.length);this.inlineEditSafe={input:this.input,oldvalue:p};this.inlineeditmode=true},finishEditing:function(g){if(!this.inlineeditmode){return}if(g&&g.type=="keyup"&&g.key!="enter"&&g.key!="esc"){return}var f=(g&&g.type=="keyup"&&g.key=="enter")?this.inlineEditSafe.input.value:this.inlineEditSafe.oldvalue;this.set(this.options.labelFunction?this.options.labelFunction(f):f);this.input.hide();this.text.show();if(g&&g.type=="keyup"&&g.key=="enter"&&this.inlineEditSafe.oldvalue!=this.container.innerHTML){this.inlineEditSafe.newvalue=f;this.inlineEditSafe.target=this;this.fireEvent("editcomplete",this.inlineEditSafe)}this.inlineeditmode=false},isEdit:function(){return this.inlineeditmode},set:function(b){if(!this.text){return}if(b&&b.length==0){b="&nbsp;"}this.text.set("html",b)}});var omniBlink=new Class({Implements:[Options,Events],options:{min:0,max:1,duration:600,fancy:true,times:5,pause:0},initialize:function(f,g){this.setOptions(g);this.element=$(f);this.times=0;this.start(0)},start:function(b){if(!b){b=10000000000000}this.running=1;if(this.options.fancy){this.fireEvent("start").run(b-1)}else{this.fireEvent("start").runBlink(b-1)}},stop:function(){this.running=0;this.element.setStyles({opacity:1,visibility:"visible"});this.fireEvent("stop")},runBlink:function(f){if(!this.element){return}var g=this.element.getStyle("visibility")=="visible";this.element.setStyle("visibility","hidden");(function(){this.element.setStyle("visibility","visible")}).delay(this.options.duration,this);this.runBlink.delay(this.options.pause*1000,this,f-1)},run:function(g){var j=this;var l=j.element.get("opacity")==j.options.min?j.options.max:j.options.min;j.fx=new Fx.Tween(j.element,{duration:j.options.duration/2,onComplete:function(){j.fireEvent("tick");if(j.running&&g){if(j.options.pause>0&&l==j.options.max){j.run.delay(j.options.pause*1000,j,g-1)}else{j.run(g-1)}}else{j.fireEvent("complete")}}}).start("opacity",l)}});var omniInput=new Class({Implements:[Events,Options],options:{blurColor:"#BBBBBB",focusColor:"black",borderFocusColor:"#BBBBBB",borderOverColor:"#CCCCCC",borderOutColor:"#DDDDDD",forceInit:false,text:"",delayedChange:false,minimumLength:3,keyDelay:1000},initialize:function(l,j){this.setOptions(this.options,j);var g=this;this.target=$(l);if(!this.target){return}this.target.addEvent("focus",this.clear.bind(this));this.target.addEvent("blur",function(){g.restore()});this.target.addEvent("mouseover",this.mouseOver.bind(this));this.target.addEvent("mouseout",this.mouseOut.bind(this));if(this.options.delayedChange){this.bindDelayFunc=this.fireEvent.bind(this,["delaychange",{target:this.target,parent:this}]);this.target.addEvent("keyup",this.delayedchange.bind(this))}this.restore(this.options.forceInit)},delayedchange:function(f){if(this.delayFuncID){$clear(this.delayFuncID)}var g=this.target.value;if(g.length>=this.options.minimumLength){this.delayFuncID=this.bindDelayFunc.delay(this.options.keyDelay,this)}},getValue:function(){return(this.target.value==this.options.text)?"":this.target.value},mouseOver:function(b){this.target.setStyle("border-color",this.options.borderOverColor)},mouseOut:function(b){this.target.setStyle("border-color",this.options.borderOutColor)},focus:function(g){this.clear();try{if(!g){this.fireEvent("focus",{parent:this,target:el})}this.target.focus()}catch(f){}},clear:function(){var b=this.target;if(b.value==this.options.text){b.value="";b.setStyle("color",this.options.focusColor);this.fireEvent("clear",{parent:this,target:b})}this.target.setStyle("border-color",this.options.borderFocusColor)},restore:function(f){var g=this.target;if(g.value==""||f){g.value=this.options.text;g.setStyle("color",this.options.blurColor);this.target.blur();this.fireEvent("restore",{parent:this,target:g})}}});var omniMenu=new Class({Implements:[Events,Options],getOptions:function(){return{openonhover:true,hideonleave:true}},initialize:function(l,g){this.setOptions(this.getOptions(),g);this.element=$(l);var j=this.element.getElements(".omnimenu-menu li[class!=separator]");this.overlay=new Element("div",{style:"display:none"});this.overlay.addClass("overlay");this.overlay.inject(this.element);if(!Browser.Engine.name=="trident"||Browser.Engine.version>5){this.overlay.setStyle("top",this.element.getPosition().y)}this.activenum=-1;this.menuopen=false;this.menucount=j.length;if(this.menucount>0){this.init(l)}},init:function(f){this.element.getElements("ul.omnimenu-menu li[class!=separator]").each(function(b,l){b.setProperty("id","omnimenu_menu_"+(l+1));var a=b.getElement("div[class=arrow]");if(a){a.addEvent("click",this.onMenuClick.bind(this));a.addEvent("mouseenter",this.onArrowEnter.bind(this));a.addEvent("mouseleave",this.onArrowLeave.bind(this))}else{b.addEvent("click",this.onMenuClick.bind(this))}b.addEvent("mouseenter",this.onMenuEnter.bind(this));b.addEvent("mouseleave",this.onMenuLeave.bind(this))},this);this.element.getElements("div.omnimenu-container ul").each(function(a,b){a.setProperty("id","omnimenu_container_"+(b+1));if(!a.iframe){a.iframe=new Element("iframe",{marginwidth:0,marginheight:0,frameBorder:0});a.iframe.inject(a)}a.addEvent("mouseleave",this.onContLeave.bind(this));if(Browser.Engine.name=="trident"&&Browser.Engine.version==4){a.style.height=a.getElements("li[class!=separator]").length*24+a.getElements("li[class=separator]").length*2}},this);var g=this.element.getElements(".omnimenu-container li");g.each(function(a,b){a.addEvent("click",this.hideAllMenus.bind(this))},this);if(this.options.hideonleave){this.element.addEvent("mouseleave",this.onMainMenuLeave.bind(this))}(Browser.Engine.trident?document:window).addEvent("click",this.globalClick.bind(this))},enable:function(){this.overlay.hide()},getLiMenuByIndex:function(g,f){if(g==null||g==undefined){return}this.elements=this.element.getElements("ul.omnimenu-menu li[class!=separator]");return this.elements[g]},enableMenu:function(g,l){var j=this.getLiMenuByIndex(g,l);if(!j){return}j.removeClass("disable")},disableMenu:function(g,l){var j=this.getLiMenuByIndex(g,l);if(!j){return}j.addClass("disable")},disable:function(){this.overlay.setStyle("width",this.element.getStyle("width"));this.overlay.show()},globalClick:function(o){var p=o.event.clientX;var r=o.event.clientY;var l=true;for(var u=1;u<=this.menucount;u++){if(!this.isOut(p,r,$("omnimenu_container_"+u))||!this.isOut(p,r,$("omnimenu_menu_"+u))){l=false;break}}if(l){this.hideAllMenus()}},isOut:function(p,j,l){if(!l){return true}var o=l.getCoordinates();if(p<o.left||p>o.right||j<o.top||j>o.bottom){return true}return false},hideAllMenus:function(j){for(var g=1;g<=this.menucount;g++){var l=$("omnimenu_container_"+g);if(j==l){continue}if(l){l.addClass("hide")}}this.menuopen=false;this.activenum=-1},onMenuEnter:function(j){var l=$(j.target);l=l.get("tag")!="li"?l.getParent():l;if(l.hasClass("disable")){return}l.addClass("hover");var g=l.id.split("_")[2];if((this.menuopen||this.options.openonhover)&&this.activenum!=g){this.onMenuClick(j)}},onMenuLeave:function(j){var l=$(j.target);l=l.get("tag")!="li"?l.getParent():l;l.removeClass("hover");var g=l.id.split("_")[2]},onMainMenuLeave:function(j){var l=j.event.clientX;var g=j.event.clientY;this.isLeave(l,g,this.activenum)},onContLeave:function(o){var r=this.getTagParent(o.target,"ul");var l=r.id.split("_")[2];if(this.options.hideonleave){var p=o.event.clientX;var u=o.event.clientY;this.isLeave(p,u,l)}},isLeave:function(l,g,j){if((this.menuopen&&this.activenum==j)){if(this.isOut(l,g,$("omnimenu_container_"+this.activenum))&&this.isOut(l,g,this.element)){this.hideAllMenus()}}},getTagParent:function(f,g){f=$(f);while(f&&f.get("tag")!=g){f=f.getParent()}return f},onArrowEnter:function(g){var f=$(g.target);f.addClass("hover")},onArrowLeave:function(g){var f=$(g.target);f.removeClass("hover")},toggleMenu:function(b){if(!b){return false}if(b.hasClass("hide")){b.removeClass("hide");return true}else{b.addClass("hide");return false}},onMenuClick:function(l){var o=$(l.target);o=o.get("tag")!="li"?o.getParent():o;if(o.hasClass("disable")){return}var j=o.id.split("_")[2];var p=$("omnimenu_container_"+j);if(p){p.setStyle("left",o.getPosition().x-this.element.getPosition().x)}this.hideAllMenus(p);this.menuopen=this.toggleMenu(p);if(this.menuopen){this.activenum=j}}});var omniProgressBar=new Class({Implements:[Options],options:{container:$$("body")[0],boxID:"box",percentageID:"perc",displayID:"text",startPercentage:0,displayText:false,speed:1000,width:200},initialize:function(b){this.setOptions(b);this.createElements()},createElements:function(){this.box=new Element("div");this.box.addClass(this.options.boxID);this.perc=new Element("div",{style:"width:0px;"});this.perc.addClass(this.options.percentageID);this.perc.inject(this.box);this.box.inject(this.options.container);this.box.setStyle("width",this.options.width);this.options.container.addClass("omniprogressbar");if(this.options.displayText){this.text=new Element("div");this.text.addClass(this.options.displayID);this.text.inject(this.options.container)}this.set(this.options.startPercentage)},calculate:function(b){return(this.box.getStyle("width").replace("px","")*(b/100)).toInt()},animate:function(b){this.perc.set("morph",{duration:this.options.speed,link:"cancel"}).morph({width:this.calculate(b.toInt())});if(this.options.displayText){this.text.set("text",b.toInt()+"%")}},set:function(b){this.animate(b)}});var omniFileManager=new Class({Extends:omModule,options:{url:fno.liveSite+"assets/omf/omnifilemanager/comnifilemanager.php",module:"filemanager",startupdir:null,multipleSelection:false,upload:true,selectmode:false},initialize:function(o){this.setOptions(this.options,o);var r=this;this.setTitle();this.sm_file_operation=null;this.GetCapabilitiesData=null;var u={columnModel:cmu,alternaterows:false,showHeader:true,sortHeader:true,height:280,width:510,editable:true,multipleSelection:this.options.multipleSelection};this.fm_table=new omniGrid("filetable",u);this.fm_table.addEvent("click",this.fileTableClick.bind(this));this.fm_table.addEvent("dblclick",this.fileTableDblClick.bind(this));this.fm_table.addEvent("editcomplete",this.fileTableEditChange.bind(this));this.select_bt=$("gc-src-browser-select");this.cancel_bt=$("gc-src-browser-cancel");if($("fm_pg_tablename")){this.tableNameVal=new LiveValidation($("fm_pg_tablename"));this.tableNameVal.add(Validate.Format,{pattern:/^(([_a-zA-Z])([_a-zA-Z0-9])*)$/i});this.tableNameVal.add(Validate.Presence);this.tableNameVal.add(Validate.Length,{minimum:1,maximum:30})}this.fileTreeObj=new MooTreeControl({div:"fm_tree",theme:fno.liveSite+"libs/mootree/mootree.gif",mode:"files",grid:true,onExpand:function(a,b){},onSelect:function(a,b){},onClick:function(a){if(a.data.path||a.data.root){sf_showFileSystem()}r.fireEvent("sourcetypeclick",{node:a})}},{text:gclang.fileman.sources,open:true,data:{populate:true}});if(!o.nofiles){this.diskRoot=this.fileTreeObj.insert({text:gclang.fileman.filesystem,data:{path:"/",root:true,populate:true}});this.newfolderformVal=new LiveValidation("fm_newfoldername");this.newfolderformVal.add(Validate.Format,{pattern:/^(([_a-zA-Z])([_a-zA-Z0-9])*)$/i});this.newfolderformVal.add(Validate.Presence);$("fm_checkallbt").addEvent("click",this.onCheckAllClick.bind(this));$("fm_newfolderbt").addEvent("click",this.onNewFolderClick.bind(this));$("fm_copytobt").addEvent("click",this.onCopyToClick.bind(this));$("fm_movebt").addEvent("click",this.onMoveClick.bind(this));$("fm_duplicatebt").addEvent("click",this.onDuplicateClick.bind(this));$("fm_createfolderbt").addEvent("click",this.onCreateFolderClick.bind(this));$("fm_deletefilesbt").addEvent("click",this.deleteFiles.bind(this));$("fm_editfolderbt").addEvent("click",this.onEditFolderClick.bind(this));$("fm_edit_structure_bt").addEvent("click",this.onEditStructureClick.bind(this));$("fm_unzipbt").addEvent("click",this.onUnzipClick.bind(this));$("fm_refreshdirectorybt").addEvent("click",this.refreshFiles.bind(this));$("fm_filterinput").addEvent("keyup",this.onExtFilterChange.bind(this));$("fm_filterinput").addEvent("focus",this.clearFilter.bind(this));$("fm_filterinput").addEvent("blur",this.restoreFilter.bind(this));var l=formManager.get("filemanager").options.data.extensions;if(l){omnilist.populate("sourcebrowser_filetype",{data:l,field:"label",fieldValue:"ext"})}$("sourcebrowser_filetype").addEvent("change",this.changeFileType.bind(this));if(!globalDoNotOpenStartUpDir){source_browser_current_view="file";var p=Cookie.read("gc_sourcebrowser_lastdir");if(this.options.startupdir!=null){this.listDir(this.options.startupdir,false)}else{if(p!=null){this.listDir(p,false)}else{if(source_browser_current_view=="file"&&!wmsRoot&&!tileRoot&&!postgisRoot){this.listDir("/",false)}}}}if(this.options.upload){$("fm_uploadbt").addEvent("click",this.showUploadForm.bind(this));if(fno.remote_download){$("fm_remotebt").addEvent("click",this.showUploadRemoteForm.bind(this))}if(fno.geocommons){$("fm_geocommbt").addEvent("click",this.showGeocommonsForm.bind(this))}}}},getShortUserPath:function(b){if(!b){return null}return b.substr(b.indexOf("resources/")+42)},getRelativeDir:function(){return omnifilemanager.getShortUserPath(currentDir)},setTitle:function(){},changeFileType:function(b){formManager.get("filemanager").options.data.extensions=b.target.value;this.setTitle();this.refreshFiles()},onListDir:function(b){source_browser_current_view="file";populateTree(b)},listDir:function(r,p){if(this.options.no_file_browsing&&r!=this.options.startupdir){return}source_browser_current_view="file";var u={};if(r&&r.length>0){u.path=r}if(p){u.onlydir=true}if(this.fm_table){this.fm_table.removeAll();this.fm_table.showLoader()}var l=$("fm_filterinput").value;var o=$("sourcebrowser_filetype").value;if(o){u.filter=o}u.module="filemanager";u.task="listdir";this.call(u,"listdir",this.onListDir.bind(this))},refreshFiles:function(){lastExtFilterChange=null;refreshDirectory=true;this.listDir(currentDir,false)},fileTableDblClick:function(j){var l=this.fm_table.getDataByRow(j.row);if(source_browser_current_view=="file"&&l.tip.toLowerCase()==gclang.fileman.directory.toLowerCase()){var g=l.path!=null?l.path:currentDir+"/"+l.name;this.listDir(g,false);return}if(this.options.selectmode){if(source_browser_current_view=="file"){if(l.tip.toLowerCase()!=gclang.fileman.directory.toLowerCase()){onSelectFiles()}}else{onSelectFiles()}}},fileTableMouseOver:function(b){},fileTableMouseOut:function(b){},fileTableClick:function(o){var r=this.fm_table.getDataByRow(o.row);var p=this.fm_table.getSelectedIndices();var u=[];for(var z=0;z<p.length;z++){var B=this.fm_table.getDataByRow(p[z]);u.push(B.name)}switch(source_browser_current_view){case"file":if(this.options.selectmode){lastRowSelected=r.id}$("sourcebrowser_filename").value=u.join(", ");break;case"postgis":if($("fm_pg_tablename")){$("fm_pg_tablename").value=u.join(", ")}break;case"wms":omnilist.populate($("sf_proj"),{data:r.srs,dontempty:true});break}},onCheckAllClick:function(b){this.checkAll(true)},checkAll:function(b){if(b){this.fm_table.selectAll()}else{this.fm_table.unselectAll()}},onUnzipClick:function(p){var u=new Array(),z,C,D=this.fm_table.getSelectedIndices();for(z=0;z<D.length;z++){C=this.fm_table.getDataByRow(D[z]).name;if(C!=".."){u.push(C)}}if(u.length==0){alert("Select files before");return}var r=omnifilemanager.getRelativeDir();r=r?r:"/";for(z=0;z<u.length;z++){var B="storage/fs"+r+"/"+u[z]+"/unzip";om.rest(B,null,this.onUnzipComplete.bind(this))}},onUnzipComplete:function(b){gcapp.check_subscription();this.refreshFiles()},onEditStructureClick:function(l){var o=this.fm_table.getSelectedIndices();if(!o||o.length==0){alert("Please select vector file first.");return}var p=this.fm_table.getDataByRow(o[0]),j=omnifilemanager.getRelativeDir()+"/"+p.name;openEditStructureForm(p.name,j.substr(1),true)},onEditFolderClick:function(o){var u=this.fm_table.getSelectedIndices();if(!u||u.length==0){alert(gclang.fileman.rename_noselection_alert);return}var r=this.fm_table.edit({dataIndex:"name"});var z=r.input.value;if(z==".."||z=="/"){this.fm_table.finishEditing();return}var p=z.indexOf(".");if(p==-1){p=r.input.value.length}if(p>0){if(r.input.createTextRange){var B=r.input.createTextRange();B.moveStart("character",0);B.moveEnd("character",p-r.input.value.length);B.select()}else{if(r.input.setSelectionRange){r.input.setSelectionRange(0,p)}}}r.input.focus()},onNewFolderClick:function(b){$("newfolderform").toggle();if($("newfolderform").isVisible()){$("fm_newfoldername").focus();$("fm_newfoldername").select()}},onCreateFolderClick:function(g){if(!LiveValidation.massValidate([this.newfolderformVal])){return}var f={module:this.options.module,task:"mkdir",path:currentDir,newname:$("fm_newfoldername").value};this.call(f,"createfolder",this.onCreateFolderComplete.bind(this))},onCreateFolderComplete:function(b){if(b.result=="yes"){om.showConfirm(b.msg);$("newfolderform").hide();refreshDirectory=true;this.listDir(currentDir)}else{om.showError(b.msg)}},deleteFiles:function(u){var z=new Array();var D=this.fm_table.getSelectedIndices();for(var B=0;B<D.length;B++){var p=this.fm_table.getDataByRow(D[B]).name;if(p!=".."){z.push(p)}}if(z.length==0){alert(gclang.fileman.select_files_before_delete);return}if(confirm(gclang.fileman.delete_confirm_1+z.length+gclang.fileman.delete_confirm_2)){var C=fno.liveSite+"modules_gc/filemanager/cfilemanager.php";var r={module:this.options.module,task:"deletefiles",files:z.join(","),path:currentDir};this.call(r,"deletefiles",this.onDeleteFilesComplete.bind(this))}},onDeleteFilesComplete:function(b){if(b.result=="no"){om.showError(b.msg)}else{om.showConfirm(b.msg)}gcapp.check_subscription();refreshDirectory=true;this.listDir(currentDir)},sf_onRenameComplete:function(b){if(!b){return}if(b.result=="yes"){gcapp.check_subscription();om.showConfirm(b.msg)}else{om.showError(b.msg);this.refreshFiles()}},fileTableEditChange:function(j){var g=this.fm_table.getDataByRow(j.row).name;if(j.oldvalue==g){return}var l={module:this.options.module,task:"rename",source:currentDir+"/"+j.oldvalue,newname:g};this.call(l,"rename",this.sf_onRenameComplete.bind(this))},sm_onDuplicateComplete:function(b){if(!b){return}if(b.result=="yes"){gcapp.check_subscription();om.showConfirm(b.msg);this.refreshFiles()}else{om.showError(b.msg)}},onDuplicateClick:function(r){var p=this.fm_table.getSelectedIndices();if(!p||p.length==0){alert(gclang.fileman.select_items_first);return}var z=[];for(var B=0;B<p.length;B++){var o=currentDir+"/"+this.fm_table.getDataByRow(p[B]).name;z.push(o)}var u={module:this.options.module,task:"duplicate",files:JSON.encode(z)};this.call(u,"duplicate",this.sm_onDuplicateComplete.bind(this))},onCopyToClick:function(b){this.sm_file_operation="cp";this.sm_onFileOperation(b)},onMoveClick:function(b){this.sm_file_operation="mv";this.sm_onFileOperation(b)},sm_onMoveComplete:function(b){if(!b){return}if(b.result=="yes"){gcapp.check_subscription();om.showConfirm(b.msg);this.refreshFiles()}else{om.showError(b.msg)}},sm_onMoveFolderTreeClose:function(r){if(r&&r.path){var p=this.fm_table.getSelectedIndices();if(!p||p.length==0){alert(gclang.fileman.select_items_first);return}var u=[];for(var l=0;l<p.length;l++){var o=currentDir+"/"+this.fm_table.getDataByRow(p[l]).name;u.push(o)}var r={module:this.options.module,task:"copy",files:JSON.encode(u),destination:r.path,operation:this.sm_file_operation};this.call(r,"copy",this.sm_onMoveComplete.bind(this))}},sm_onFileOperation:function(g){var f=this.fm_table.getSelectedIndices();if(!f||f.length==0){alert(gclang.fileman.select_items_first);return}foldertreeform=formManager.open({title:gclang.fileman.browse_for_folder,overlay:true,width:320,height:470,url:fno.liveSite+"assets/omf/omnifilemanager/filemanager_foldertree_form.php",buttons:[{html:gclang.close,click:"foldertreeform.close();"}]});foldertreeform.addEvent("close",this.sm_onMoveFolderTreeClose.bind(this))},onExtFilterChange:function(b){this.fm_table.filter(b.target.value)},clearFilter:function(g){var f=g.target;if(f.value=="filter..."){f.value=""}},restoreFilter:function(g){var f=g.target;if(f.value==""){f.value="filter..."}},showUploadForm:function(){this.uploadform=formManager.fileUpload({uploaddir:$("currentdirmsg").value});this.uploadform.addEvent("close",this.onUploadFormClose.bind(this))},showUploadRemoteForm:function(){this.uploadform=formManager.fileRemoteUpload({uploaddir:$("currentdirmsg").value});this.uploadform.addEvent("close",this.onUploadFormClose.bind(this))},showGeocommonsForm:function(){},onUploadFormClose:function(){if(formManager.isOpen("filemanager")){gcapp.check_subscription();this.refreshFiles()}}});var omniDataSourceBrowser=new Class({Extends:omniFileManager,options:{url:fno.liveSite+"assets/omf/omnifilemanager/comnifilemanager.php",module:"filemanager",startupdir:null,multipleSelection:false,upload:true,selectmode:false},initialize:function(b){this.parent(b);this.fm_table.addEvent("beforerender",this.beforeDataGridRender.bind(this));this.addEvent("sourcetypeclick",this.sourceTypeClick.bind(this))},getSourceType:function(){return source_browser_current_view},createMobileLayerClick:function(b){},sourceTypeClick:function(g){var f=g.node;if(this.select_bt){this.select_bt.show()}if(this.cancel_bt){this.cancel_bt.set("html","Cancel")}if(f.data.postgis){sf_showPostGIS()}else{if(f.data.tile){sf_showTileServices()}else{if(f.data.gcmap){sf_showGCMap()}else{if(f.data.mobile){this.showMobileType()}else{if(f.data.arcMap){this.showArcMapPluginPanel()}else{if(f.data.mapBox){this.showMapBoxPluginPanel()}else{if(f.data.datasources){this.showDatasourcesPanel(f.data.type)}else{if(f.data.apollo){this.showApolloPanel(f.data.id)}}}}}}}}if(f.data.path){om.show("filetable")}giscloud.log.push("source_browser_view_type",{mid:currentMapID,source_type:source_browser_current_view})},loadGISCloudMaps:function(){lastRowSelected=-1;$("currentdirmsg").value="";om.hide("bottomfilemenu");om.hide("wms_source_form");om.hide("pg_source_form");om.show("gcmap_source_form");om.hide("mobile_source_form");omnifilemanager.fm_table.setColumnModel(gcmap_cmu);omnifilemanager.fm_table.options.perPage=50;omnifilemanager.fm_table.options.page=1;omnifilemanager.fm_table.options.multipleSelection=false;omnifilemanager.fm_table.options.url="/rest/1/maps.json";omnifilemanager.fm_table.refresh()},showMobileType:function(b){source_browser_current_view="mobile";$("currentdirmsg").hide();$("sf_file_toolbar").hide();om.hide("bottomfilemenu");om.hide("wms_source_form");om.hide("pg_source_form");om.hide("gcmap_source_form");om.show("mobile_source_form");om.hide("sf_wms_url");om.hide("sf_pgdb_connmenu");om.hide("filetable");om.hide("arcmap_plugin_form");om.hide("mapbox_plugin_form");om.hide("datasources_form");om.hide("apollo_ds_form")},showArcMapPluginPanel:function(){omnifilemanager.fm_table.options.accordion=false;omnifilemanager.fm_table.options.multipleSelection=false;source_browser_current_view="arcmap";$("currentdirmsg").hide();$("sf_file_toolbar").hide();om.hide("bottomfilemenu");om.hide("wms_source_form");om.hide("pg_source_form");om.hide("gcmap_source_form");om.hide("mobile_source_form");om.hide("sf_wms_url");om.hide("sf_pgdb_connmenu");om.hide("filetable");om.hide("mapbox_plugin_form");om.hide("datasources_form");om.hide("apollo_ds_form");om.show("arcmap_plugin_form")},showMapBoxPluginPanel:function(){omnifilemanager.fm_table.options.accordion=false;omnifilemanager.fm_table.options.multipleSelection=false;source_browser_current_view="mapbox";$("currentdirmsg").hide();$("sf_file_toolbar").hide();om.hide("bottomfilemenu");om.hide("wms_source_form");om.hide("pg_source_form");om.hide("gcmap_source_form");om.hide("mobile_source_form");om.hide("sf_wms_url");om.hide("sf_pgdb_connmenu");om.hide("filetable");om.hide("arcmap_plugin_form");om.hide("datasources_form");om.hide("apollo_ds_form");om.show("mapbox_plugin_form")},showDatasourcesPanel:function(b){if(!b){b="10,70,80";om.hide("omf_datasources_tools")}else{om.show("omf_datasources_tools")}omnifilemanager.fm_table.options.accordion=false;omnifilemanager.fm_table.options.multipleSelection=false;source_browser_current_view="datasources";$("currentdirmsg").hide();$("sf_file_toolbar").hide();om.hide("bottomfilemenu");om.hide("wms_source_form");om.hide("pg_source_form");om.hide("gcmap_source_form");om.hide("mobile_source_form");om.hide("sf_wms_url");om.hide("sf_pgdb_connmenu");om.hide("filetable");om.hide("arcmap_plugin_form");om.hide("mapbox_plugin_form");om.hide("apollo_ds_form");om.show("filetable");om.show("datasources_form");omnifilemanager.datasourceType=b;omnifilemanager.fm_table.setColumnModel(datasources_cmu);omnifilemanager.fm_table.options.perPage=50;omnifilemanager.fm_table.options.page=1;omnifilemanager.fm_table.options.multipleSelection=false;omnifilemanager.fm_table.options.url="/rest/1/datasources?type="+b;omnifilemanager.fm_table.refresh()},showApolloPanel:function(b){this.select_bt.hide();this.cancel_bt.set("html","Close");omnifilemanager.fm_table.options.accordion=false;omnifilemanager.fm_table.options.multipleSelection=false;source_browser_current_view="apollo";$("currentdirmsg").hide();$("sf_file_toolbar").hide();om.hide("bottomfilemenu");om.hide("wms_source_form");om.hide("pg_source_form");om.hide("gcmap_source_form");om.hide("mobile_source_form");om.hide("sf_wms_url");om.hide("sf_pgdb_connmenu");om.hide("filetable");om.hide("arcmap_plugin_form");om.hide("mapbox_plugin_form");om.hide("datasources_form");om.show("apollo_ds_form");apollobrowserform={};apollobrowserform.options={};apollobrowserform.options.fdata={};apollobrowserform.options.fdata.dsid=b;apollobrowserform.options.fdata.width=532;apollobrowserform.options.fdata.results_height=300;$$("#apollo_form_content").load("/datasource/browser_apollo")},beforeDataGridRender:function(l){switch(source_browser_current_view){case"gcmap":var p=l.data.data;for(var j=0;j<p.length;j++){var o=p[j];if(o.id==currentMapID){p.splice(j,1)}}break;default:}},deleteDatasource:function(){var f=omnifilemanager.fm_table.getSelectedIndices();if(f.length>0){var g=omnifilemanager.fm_table.getDataByRow(f[0]);if(confirm(gclang.fileman.delete_confirm_1)){if(confirm("All layers connected to this datasource will be deleted too. Do you still want to proceed?")){giscloud.datasources.remove(g.id).done(function(){omnifilemanager.fm_table.refresh()})}}}},openDatasourceForm:function(C){var B=null;if(C){var D=omnifilemanager.fm_table.getSelectedIndices();if(D.length>0){B=omnifilemanager.fm_table.getDataByRow(D[0]);datasource_id=B.id}}else{datasource_id=0}gcapp.datasourceManager=omnifilemanager;var u,z,p,r;if(omnifilemanager.datasourceType==70){u="wfsform";z="WFS Datasource Form";p="form_wfs";r=350}else{if(omnifilemanager.datasourceType==80){u="wmtsform";z="WMTS Datasource Form";p="form_wmts";r=240}else{if(omnifilemanager.datasourceType==40){u="wmsform";z="WMS Datasource Form";p="form_wms";r=240}}}this[u]=formManager.open({fid:u,overlay:false,dragable:true,title:z,fdata:{dsid:datasource_id},width:600,height:r,url:fno.liveSite+"datasource/"+p,buttons:[{html:gclang.Save,"class":"bluebutton",click:"gcapp."+u+".save()"},{html:gclang.Close,click:"gcapp.datasourceManager."+u+".close()"}]});this[u].addEvent("close",function(){omnifilemanager.fm_table.refresh()})}});var Autocompleter=new Class({Implements:[Options,Events],options:{minLength:1,markQuery:true,width:"inherit",maxChoices:10,injectChoice:null,customChoices:null,emptyChoices:null,visibleChoices:true,className:"autocompleter-choices",zIndex:501498,delay:400,observerOptions:{},fxOptions:{},autoSubmit:false,overflow:false,overflowMargin:25,selectFirst:false,filter:null,filterCase:false,filterSubset:false,forceSelect:false,selectMode:true,choicesMatch:null,multiple:false,separator:", ",separatorSplit:/\s*[,;]\s*/,autoTrim:false,allowDupes:false,cache:true,relative:false},initialize:function(g,j){this.element=$(g);this.setOptions(j);this.build();this.observer=new Observer(this.element,this.prefetch.bind(this),$merge({delay:this.options.delay},this.options.observerOptions));this.queryValue=null;if(this.options.filter){this.filter=this.options.filter.bind(this)}var l=this.options.selectMode;this.typeAhead=(l=="type-ahead");this.selectMode=(l===true)?"selection":l;this.cached=[]},build:function(){if($(this.options.customChoices)){this.choices=this.options.customChoices}else{this.choices=new Element("ul",{"class":this.options.className,styles:{zIndex:this.options.zIndex}}).inject(document.body);this.relative=false;if(this.options.relative){this.choices.inject(this.element,"after");this.relative=this.element.getOffsetParent()}this.fix=new OverlayFix(this.choices)}if(!this.options.separator.test(this.options.separatorSplit)){this.options.separatorSplit=this.options.separator}this.fx=(!this.options.fxOptions)?null:new Fx.Tween(this.choices,$merge({property:"opacity",link:"cancel",duration:200},this.options.fxOptions)).addEvent("onStart",Chain.prototype.clearChain).set(0);this.element.setProperty("autocomplete","off").addEvent((Browser.Engine.trident||Browser.Engine.webkit)?"keydown":"keypress",this.onCommand.bind(this)).addEvent("click",this.onCommand.bind(this,[false])).addEvent("focus",this.toggleFocus.create({bind:this,arguments:true,delay:100})).addEvent("blur",this.toggleFocus.create({bind:this,arguments:false,delay:100}))},destroy:function(){if(this.fix){this.fix.destroy()}this.choices=this.selected=this.choices.destroy()},toggleFocus:function(b){this.focussed=b;if(!b){this.hideChoices(true)}this.fireEvent((b)?"onFocus":"onBlur",[this.element])},onCommand:function(f){if(!f&&this.focussed){return this.prefetch()}if(f&&f.key&&!f.shift){switch(f.key){case"enter":if(this.element.value!=this.opted){return true}if(this.selected&&this.visible){this.choiceSelect(this.selected);return !!(this.options.autoSubmit)}break;case"up":case"down":if(!this.prefetch()&&this.queryValue!==null){var g=(f.key=="up");this.choiceOver((this.selected||this.choices)[(this.selected)?((g)?"getPrevious":"getNext"):((g)?"getLast":"getFirst")](this.options.choicesMatch),true)}return false;case"esc":case"tab":this.hideChoices(true);break}}return true},setSelection:function(C){var B=this.selected.inputValue,z=B;var H=this.queryValue.length,F=B.length;if(B.substr(0,H).toLowerCase()!=this.queryValue.toLowerCase()){H=0}if(this.options.multiple){var D=this.options.separatorSplit;z=this.element.value;H+=this.queryIndex;F+=this.queryIndex;var G=z.substr(this.queryIndex).split(D,1)[0];z=z.substr(0,this.queryIndex)+B+z.substr(this.queryIndex+G.length);if(C){var E=z.split(this.options.separatorSplit).filter(function(a){return this.test(a)},/[^\s,]+/);if(!this.options.allowDupes){E=[].combine(E)}var u=this.options.separator;z=E.join(u)+u;F=z.length}}this.observer.setValue(z);this.opted=z;if(C||this.selectMode=="pick"){H=F}this.element.selectRange(H,F);this.fireEvent("onSelection",[this.element,this.selected,z,B])},showChoices:function(){var H=this.options.choicesMatch,J=this.choices.getFirst(H);this.selected=this.selectedValue=null;if(this.fix){var F=this.element.getCoordinates(this.relative),K=this.options.width||"auto";this.choices.setStyles({left:F.left,top:F.bottom,width:(K===true||K=="inherit")?F.width:K})}if(!J){return}if(!this.visible){this.visible=true;this.choices.setStyle("display","");if(this.fx){this.fx.start(1)}this.fireEvent("onShow",[this.element,this.choices])}if(this.options.selectFirst||this.typeAhead||J.inputValue==this.queryValue){this.choiceOver(J,this.typeAhead)}var G=this.choices.getChildren(H),E=this.options.maxChoices;var B={overflowY:"hidden",height:""};this.overflown=false;if(G.length>E){var M=G[E-1];B.overflowY="scroll";B.height=M.getCoordinates(this.choices).bottom;this.overflown=true}this.choices.setStyles(B);this.fix.show();if(this.options.visibleChoices){var C=document.getScroll(),I=document.getSize(),D=this.choices.getCoordinates();if(D.right>C.x+I.x){C.x=D.right-I.x}if(D.bottom>C.y+I.y){C.y=D.bottom-I.y}window.scrollTo(Math.min(C.x,D.left),Math.min(C.y,D.top))}},hideChoices:function(j){if(j){var l=this.element.value;if(this.options.forceSelect){l=this.opted}if(this.options.autoTrim){l=l.split(this.options.separatorSplit).filter($arguments(0)).join(this.options.separator)}this.observer.setValue(l)}if(!this.visible){return}this.visible=false;if(this.selected){this.selected.removeClass("autocompleter-selected")}this.observer.clear();var g=function(){this.choices.setStyle("display","none");this.fix.hide()}.bind(this);if(this.fx){this.fx.start(0).chain(g)}else{g()}this.fireEvent("onHide",[this.element,this.choices])},prefetch:function(){var u=this.element.value,z=u;if(this.options.multiple){var C=this.options.separatorSplit;var r=u.split(C);var p=this.element.getSelectedRange().start;var D=u.substr(0,p).split(C);var B=D.length-1;p-=D[B].length;z=r[B]}if(z.length<this.options.minLength){this.hideChoices()}else{if(z===this.queryValue||(this.visible&&z==this.selectedValue)){if(this.visible){return false}this.showChoices()}else{this.queryValue=z;this.queryIndex=p;if(!this.fetchCached()){this.query()}}}return true},fetchCached:function(){return false;if(!this.options.cache||!this.cached||!this.cached.length||this.cached.length>=this.options.maxChoices||this.queryValue){return false}this.update(this.filter(this.cached));return true},update:function(f){this.choices.empty();this.cached=f;var g=f&&$type(f);if(!g||(g=="array"&&!f.length)||(g=="hash"&&!f.getLength())){(this.options.emptyChoices||this.hideChoices).call(this)}else{if(this.options.maxChoices<f.length&&!this.options.overflow){f.length=this.options.maxChoices}f.each(this.options.injectChoice||function(a){var b=new Element("li",{html:this.markQueryValue(a)});b.inputValue=a;this.addChoiceEvents(b).inject(this.choices)},this);this.showChoices()}},choiceOver:function(C,B){if(!C||C==this.selected){return}if(this.selected){this.selected.removeClass("autocompleter-selected")}this.selected=C.addClass("autocompleter-selected");this.fireEvent("onSelect",[this.element,this.selected,B]);if(!this.selectMode){this.opted=this.element.value}if(!B){return}this.selectedValue=this.selected.inputValue;if(this.overflown){var u=this.selected.getCoordinates(this.choices),z=this.options.overflowMargin,D=this.choices.scrollTop,r=this.choices.offsetHeight,p=D+r;if(u.top-z<D&&D){this.choices.scrollTop=Math.max(u.top-z,0)}else{if(u.bottom+z>p){this.choices.scrollTop=Math.min(u.bottom-r+z,p)}}}if(this.selectMode){this.setSelection()}},choiceSelect:function(b){if(b){this.choiceOver(b)}this.setSelection(true);this.queryValue=false;this.hideChoices()},filter:function(b){return(b||this.tokens).filter(function(a){return this.test(a)},new RegExp(((this.options.filterSubset)?"":"^")+this.queryValue.escapeRegExp(),(this.options.filterCase)?"":"i"))},markQueryValue:function(b){return(!this.options.markQuery||!this.queryValue)?b:b.replace(new RegExp("("+((this.options.filterSubset)?"":"^")+this.queryValue.escapeRegExp()+")",(this.options.filterCase)?"":"i"),'<span class="autocompleter-queried">$1</span>')},addChoiceEvents:function(b){return b.addEvents({mouseover:this.choiceOver.bind(this,[b]),click:this.choiceSelect.bind(this,[b])})}});var OverlayFix=new Class({initialize:function(b){if(Browser.Engine.trident){this.element=$(b);this.relative=this.element.getOffsetParent();this.fix=new Element("iframe",{frameborder:"0",scrolling:"no",src:"javascript:false;",styles:{position:"absolute",border:"none",display:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}}).inject(this.element,"after")}},show:function(){if(this.fix){var b=this.element.getCoordinates(this.relative);delete b.right;delete b.bottom;this.fix.setStyles($extend(b,{display:"",zIndex:(this.element.getStyle("zIndex")||1)-1}))}return this},hide:function(){if(this.fix){this.fix.setStyle("display","none")}return this},destroy:function(){if(this.fix){this.fix=this.fix.destroy()}}});Element.implement({getSelectedRange:function(){if(!Browser.Engine.trident){return{start:this.selectionStart,end:this.selectionEnd}}var p={start:0,end:0};var o=this.getDocument().selection.createRange();if(!o||o.parentElement()!=this){return p}var u=o.duplicate();if(this.type=="text"){p.start=0-u.moveStart("character",-100000);p.end=p.start+o.text.length}else{var l=this.value;var r=l.length-l.match(/[\n\r]*$/)[0].length;u.moveToElementText(this);u.setEndPoint("StartToEnd",o);p.end=r-u.text.length;u.setEndPoint("StartToStart",o);p.start=r-u.text.length}return p},selectRange:function(o,l){if(Browser.Engine.trident){var p=this.value.substr(o,l-o).replace(/\r/g,"").length;o=this.value.substr(0,o).replace(/\r/g,"").length;var j=this.createTextRange();j.collapse(true);j.moveEnd("character",o+p);j.moveStart("character",o);j.select()}else{this.focus();this.setSelectionRange(o,l)}return this}});Autocompleter.Base=Autocompleter;Autocompleter.Local=new Class({Extends:Autocompleter,options:{minLength:0,delay:200},initialize:function(g,l,j){this.parent(g,j);this.tokens=l},query:function(){this.update(this.filter())}});Autocompleter.Request=new Class({Extends:Autocompleter,options:{postData:{},ajaxOptions:{},postVar:"value"},query:function(){var l=$unlink(this.options.postData)||{};l[this.options.postVar]=this.queryValue;var g=$(this.options.indicator);if(g){g.setStyle("display","")}var j=this.options.indicatorClass;if(j){this.element.addClass(j)}this.fireEvent("onRequest",[this.element,this.request,l,this.queryValue]);this.request.send({data:l})},queryResponse:function(){var f=$(this.options.indicator);if(f){f.setStyle("display","none")}var g=this.options.indicatorClass;if(g){this.element.removeClass(g)}return this.fireEvent("onComplete",[this.element,this.request])}});Autocompleter.Request.JSON=new Class({Extends:Autocompleter.Request,initialize:function(l,g,j){this.parent(l,j);this.request=new Request.JSON($merge({url:g,link:"cancel"},this.options.ajaxOptions)).addEvent("onComplete",this.queryResponse.bind(this))},queryResponse:function(b){this.parent();this.update(b)}});Autocompleter.Request.HTML=new Class({Extends:Autocompleter.Request,initialize:function(l,g,j){this.parent(l,j);this.request=new Request.HTML($merge({url:g,link:"cancel",update:this.choices},this.options.ajaxOptions)).addEvent("onComplete",this.queryResponse.bind(this))},queryResponse:function(g,f){this.parent();if(!f||!f.length){this.hideChoices()}else{this.choices.getChildren(this.options.choicesMatch).each(this.options.injectChoice||function(b){var a=b.innerHTML;b.inputValue=a;this.addChoiceEvents(b.set("html",this.markQueryValue(a)))},this);this.showChoices()}}});Autocompleter.Ajax={Base:Autocompleter.Request,Json:Autocompleter.Request.JSON,Xhtml:Autocompleter.Request.HTML};var Observer=new Class({Implements:[Options,Events],options:{periodical:false,delay:1000},initialize:function(l,j,g){this.element=$(l)||$$(l);this.addEvent("onFired",j);this.setOptions(g);this.bound=this.changed.bind(this);this.resume()},changed:function(){var b=this.element.get("value");if($equals(this.value,b)){return}this.clear();this.value=b;this.timeout=this.onFired.delay(this.options.delay,this)},setValue:function(b){this.value=b;this.element.set("value",b);return this.clear()},onFired:function(){this.fireEvent("onFired",[this.value,this.element])},clear:function(){$clear(this.timeout||null);return this},pause:function(){if(this.timer){$clear(this.timer)}else{this.element.removeEvent("keyup",this.bound)}return this.clear()},resume:function(){this.value=this.element.get("value");if(this.options.periodical){this.timer=this.changed.periodical(this.options.periodical,this)}else{this.element.addEvent("keyup",this.bound)}return this}});var $equals=function(f,g){return(f==g||JSON.encode(f)==JSON.encode(g))};if(!Mif){var Mif={}}if(!Mif.ids){Mif.ids={}}if(!Mif.id){Mif.id=function(b){return Mif.ids[b]}}Mif.Tree=new Class({version:"1.2.6",Implements:[Events,Options],options:{types:{},forest:false,animateScroll:true,height:18,expandTo:true,selectable:["input"],multipleSelection:true},initialize:function(g){this.setOptions(g);$extend(this,{types:this.options.types,forest:this.options.forest,animateScroll:this.options.animateScroll,dfltType:this.options.dfltType,height:this.options.height,container:$(g.container),UID:++Mif.Tree.UID,key:{},expanded:[]});this.defaults={name:"",cls:"",openIcon:"mif-tree-empty-icon",closeIcon:"mif-tree-empty-icon",loadable:false,hidden:false};this.dfltState={open:false};this.$index=[];this.updateOpenState();if(this.options.expandTo){this.initExpandTo()}this.DOMidPrefix="mif-tree-";this.wrapper=new Element("div").addClass("mif-tree-wrapper").injectInside(this.container);this.initEvents();this.initScroll();this.initSelection();this.initHover();this.addEvent("drawChildren",function(p){var b=p._toggle||[];for(var a=0,l=b.length;a<l;a++){b[a].drawToggle()}p._toggle=[]});var f=this.options.id;this.id=f;if(f!=null){Mif.ids[f]=this}if(MooTools.version>="1.2.2"&&this.options.initialize){this.options.initialize.call(this)}},initEvents:function(){this.wrapper.addEvents({mousemove:this.mouse.bindWithEvent(this),mouseover:this.mouse.bindWithEvent(this),mouseout:this.mouse.bindWithEvent(this),mouseleave:this.mouseleave.bind(this),mousedown:function(b){if(b.which!=1){return}this.fireEvent("mousedown");return this.stopSelection(b)}.bind(this),click:this.toggleClick.bindWithEvent(this),dblclick:this.toggleDblclick.bindWithEvent(this)});if(Browser.Engine.trident){this.wrapper.addEvent("selectstart",this.stopSelection.bind(this))}this.container.addEvent("click",this.focus.bind(this));document.addEvent("click",this.blurOnClick.bind(this));document.addEvents({keydown:this.keyDown.bindWithEvent(this),keyup:this.keyUp.bindWithEvent(this)})},stopSelection:function(r){var p=$(r.target);var l=this.options.selectable;for(var u=0,o=l.length;u<o;u++){if(p.match(l[u])){return true}}return false},blurOnClick:function(g){var f=g.target;while(f){if(f==this.container){return}f=f.parentNode}this.blur()},focus:function(){if(Mif.Focus&&Mif.Focus==this){return this}if(Mif.Focus){Mif.Focus.blur()}Mif.Focus=this;this.focused=true;this.container.addClass("mif-tree-focused");return this.fireEvent("focus")},blur:function(){Mif.Focus=null;if(!this.focused){return this}this.focused=false;this.container.removeClass("mif-tree-focused");return this.fireEvent("blur")},$getIndex:function(){this.$index=[];var f=this.forest?this.root.getFirst():this.root;var g=f;while(f){if(!(g.hidden&&g.contains(f))){if(!f.hidden){this.$index.push(f)}g=f}f=f._getNextVisible()}},mouseleave:function(){this.mouse.coords={x:null,y:null};this.mouse.target=false;this.mouse.node=false;if(this.hover){this.hover()}},mouse:function(g){this.mouse.coords=this.getCoords(g);var f=this.getTarget(g);this.mouse.target=f.target;this.mouse.node=f.node},getTarget:function(B){var z=B.target,C;while(!/mif-tree/.test(z.className)){z=z.parentNode}var D=z.className.match(/mif-tree-(gadjet)-[^n]|mif-tree-(icon2)|mif-tree-(icon)|mif-tree-(name)|mif-tree-(checkbox)/);if(!D){var u=this.mouse.coords.y;if(u==-1||!this.$index){C=false}else{C=this.$index[((u)/this.height).toInt()]}return{node:C,target:"node"}}for(var r=5;r>0;r--){if(D[r]){var p=D[r];break}}return{node:Mif.Tree.Nodes[z.getAttribute("uid")],target:p}},getCoords:function(u){var l=this.wrapper.getPosition();var o=u.page.x-l.x;var p=u.page.y-l.y;var r=this.wrapper;if((p-r.scrollTop>r.clientHeight)||(o-r.scrollLeft>r.clientWidth)){p=-1}return{x:o,y:p}},keyDown:function(b){this.key=b;this.key.state="down";if(this.focused){this.fireEvent("keydown",[b])}},keyUp:function(b){this.key={};this.key.state="up";if(this.focused){this.fireEvent("keyup",[b])}},toggleDblclick:function(g){var f=this.mouse.target;if(!(f=="name"||f=="icon")){return}this.mouse.node.toggle();this.mouse.node.dblclick()},toggleClick:function(b){if(this.mouse.target=="icon2"){this.mouse.node.icon2Click()}if(this.mouse.target!="gadjet"){return}this.mouse.node.toggle()},initScroll:function(){this.scroll=new Fx.Scroll(this.wrapper,{link:"cancel"})},scrollTo:function(u){var l=u.getVisiblePosition();var r=l*this.height;var o=(r<this.wrapper.scrollTop);var p=(r>(this.wrapper.scrollTop+this.wrapper.clientHeight-this.height));if(l==-1||(!o&&!p)){this.scroll.fireEvent("complete");return false}if(this.animateScroll){this.scroll.start(this.wrapper.scrollLeft,r-(p?this.wrapper.clientHeight-this.height:this.height))}else{this.scroll.set(this.wrapper.scrollLeft,r-(p?this.wrapper.clientHeight-this.height:this.height));this.scroll.fireEvent("complete")}},updateOpenState:function(){this.addEvents({drawChildren:function(o){var p=o.children;for(var j=0,l=p.length;j<l;j++){p[j].updateOpenState()}},drawRoot:function(){this.root.updateOpenState()}})},expandTo:function(g){if(!g){return this}var f=[];while(!g.isRoot()&&!(this.forest&&g.getParent().isRoot())){g=g.getParent();if(!g){break}f.unshift(g)}f.each(function(a){a.toggle(true)});return this},initExpandTo:function(){this.addEvent("loadChildren",function(o){if(!o){return}var p=o.children;for(var a=p.length;a--;){var l=p[a];if(l.expandTo){this.expanded.push(l)}}});function b(){this.expanded.each(function(a){this.expandTo(a)},this);this.expanded=[]}this.addEvents({load:b.bind(this),loadNode:b.bind(this)})}});Mif.Tree.UID=0;Array.implement({inject:function(u,r,o){var p=this.indexOf(r)+(o=="before"?0:1);for(var l=this.length-1;l>=p;l--){this[l+1]=this[l]}this[p]=u;return this}});Mif.Tree.Node=new Class({Implements:[Events],initialize:function(j,g){$extend(this,j);this.children=[];this.type=g.type||this.tree.dfltType;this.property=g.property||{};this.data=g.data;this.state=$extend($unlink(this.tree.dfltState),g.state);this.$calculate();this.UID=Mif.Tree.Node.UID++;Mif.Tree.Nodes[this.UID]=this;var l=this.id;if(l!=null){Mif.ids[l]=this}this.tree.fireEvent("nodeCreate",[this]);this._property=["id","name","cls","openIcon","closeIcon","openIconUrl","closeIconUrl","hidden"]},$calculate:function(){$extend(this,$unlink(this.tree.defaults));this.type=$splat(this.type);this.type.each(function(f){var g=this.tree.types[f];if(g){$extend(this,g)}},this);$extend(this,this.property);return this},getDOM:function(g){var j=$(this.tree.DOMidPrefix+this.UID);if(!j){return null}if(g=="node"){return j}var l=j.getFirst();if(g=="wrapper"){return l}if(g=="children"){return l.getNext()}return l.getElement(".mif-tree-"+g)},getGadjetType:function(){return(this.loadable&&!this.isLoaded())?"plus":(this.hasVisibleChildren()?(this.isOpen()?"minus":"plus"):"none")},toggle:function(o,j){if(this.state.open==o||this.$loading||this.$toggling){return this}var p=this.getParent();function l(a){this.state.open=!this.state.open;if(a=="drawed"){this.drawToggle()}else{p._toggle=(p._toggle||[])[this.state.open?"include":"erase"](this)}if(!j){this.fireEvent("toggle",[this.state.open]);this.tree.fireEvent("toggle",[this,this.state.open])}return this}if(p&&!p.$draw){return l.apply(this,[])}if(this.loadable&&!this.state.loaded){if(!this.load_event){this.load_event=true;this.addEvent("load",function(){this.toggle()}.bind(this))}return this.load()}if(!this.hasChildren()){return this}return l.apply(this,["drawed"])},dblclick:function(){this.tree.fireEvent("dblclick",[this])},icon2Click:function(l,p,o){var j=this.getDOM("icon2");if(!j){return}if(o!=undefined){if(o){j.addClass("tree-icon-unlock");j.removeClass("tree-icon-lock")}else{j.removeClass("tree-icon-unlock");j.addClass("tree-icon-lock")}}else{if(j.hasClass("tree-icon-lock")){j.addClass("tree-icon-unlock");j.removeClass("tree-icon-lock")}else{j.removeClass("tree-icon-unlock");j.addClass("tree-icon-lock")}}if(!p){this.tree.fireEvent("lock",[this,j.hasClass("tree-icon-lock")])}},drawToggle:function(){this.tree.$getIndex();Mif.Tree.Draw.update(this)},recursive:function(f,g){g=$splat(g);if(f.apply(this,g)!==false){this.children.each(function(a){if(a.recursive(f,g)===false){return false}})}return this},isOpen:function(){return this.state.open},isLoaded:function(){return this.state.loaded},isLast:function(){if(this.parentNode==null||this.parentNode.children.getLast()==this){return true}return false},isFirst:function(){if(this.parentNode==null||this.parentNode.children[0]==this){return true}return false},isRoot:function(){return this.parentNode==null?true:false},getChildren:function(){return this.children},hasChildren:function(){return this.children.length?true:false},index:function(){if(this.isRoot()){return 0}return this.parentNode.children.indexOf(this)},getNext:function(){if(this.isLast()){return null}return this.parentNode.children[this.index()+1]},getPrevious:function(){if(this.isFirst()){return null}return this.parentNode.children[this.index()-1]},getFirst:function(){if(!this.hasChildren()){return null}return this.children[0]},getLast:function(){if(!this.hasChildren()){return null}return this.children.getLast()},getParent:function(){return this.parentNode},_getNextVisible:function(){var f=this;if(f.isRoot()){if(!f.isOpen()||!f.hasChildren(true)){return false}return f.getFirst(true)}else{if(f.isOpen()&&f.getFirst(true)){return f.getFirst(true)}else{var g=f;do{f=g.getNext(true);if(f){return f}}while(g=g.parentNode);return false}}},getPreviousVisible:function(){var b=this.tree.$index.indexOf(this);return b==0?null:this.tree.$index[b-1]},getNextVisible:function(){var b=this.tree.$index.indexOf(this);return b<this.tree.$index.length-1?this.tree.$index[b+1]:null},getVisiblePosition:function(){return this.tree.$index.indexOf(this)},hasVisibleChildren:function(){if(!this.hasChildren()){return false}if(this.isOpen()){var g=this.getNextVisible();if(!g){return false}if(g.parentNode!=this){return false}return true}else{var f=this.getFirst();while(f){if(!f.hidden){return true}f=f.getNext()}return false}},isLastVisible:function(){var b=this.getNext();while(b){if(!b.hidden){return false}b=b.getNext()}return true},contains:function(b){while(b){if(b==this){return true}b=b.parentNode}return false},addType:function(b){return this.processType(b,"add")},removeType:function(b){return this.processType(b,"remove")},setType:function(b){return this.processType(b,"set")},processType:function(j,g){switch(g){case"add":this.type.include(j);break;case"remove":this.type.erase(j);break;case"set":this.type=j;break}var l={};this._property.each(function(a){l[a]=this[a]},this);this.$calculate();this._property.each(function(a){this.updateProperty(a,l[a],this[a])},this);return this},set:function(p){this.tree.fireEvent("beforeSet",[this,p]);var u=p.property||p||{};for(var r in u){var l=u[r];var o=this[r];this.updateProperty(r,o,l);this[r]=this.property[r]=l}this.tree.fireEvent("set",[this,p]);return this},updateProperty:function(G,E,z){if(z==E){return this}if(G=="id"){delete Mif.ids[E];if(z){Mif.ids[z]=this}return this}if(!Mif.Tree.Draw.isUpdatable(this)){return this}switch(G){case"name":this.getDOM("name").set("html",z);return this;case"cls":this.getDOM("wrapper").removeClass(E).addClass(z);return this;case"openIcon":case"closeIcon":this.getDOM("icon").removeClass(E).addClass(z);return this;case"openIconUrl":case"closeIconUrl":var p=this.getDOM("icon");p.setStyle("background-image","none");if(z){p.setStyle("background-image","url("+z+")")}return this;case"hidden":this.getDOM("node").setStyle("display",z?"none":"block");var B=this.getPreviousVisible();var F=this.getNextVisible();var H=this.getParent();this[G]=this.property[G]=z;this.tree.$getIndex();var C=this.getPreviousVisible();var D=this.getNextVisible();[B,F,C,D,H,this].each(function(a){Mif.Tree.Draw.update(a)});return this}},updateOpenState:function(){if(this.state.open){this.state.open=false;this.toggle()}}});Mif.Tree.Node.UID=0;Mif.Tree.Nodes={};Mif.Tree.Draw={getParams:function(){var b={type:this.type.value};b.color=this.fillpicker.getColor("strrgb");b.border=this.borderpicker.getColor("strrgb");b.bw=this.borderwidth.value;b.size=this.size.value;return b},getSymbolUrl:function(b){return fno.liveSite+"assets/icon.php?"+Hash.toQueryString(b)},getIcon:function(D,a){var r=D.styles||[];this.options={forprint:false};var z="";if(D.textfield||D.label){z="&label=1"}switch(D.tip){case"raster":break;case"label":icon.addClass("labelicon");break;case"wms":case"tile":break;case"point":if(r.length==1){var u=r[0];if(u.url){var B=fno.liveSite+"assets/icon.php?p="+urlencode(u.url);B=B.replace(/ /g,"%20");a.img=B}else{if(u.symbol){a.img=this.getSymbolUrl(u.symbol)}}}else{a.style="style='background-image:url("+fno.liveSite+"assets/images/layertree/color_swatch.gif)' "}break;case"line":if(r.length==1){var u=r[0];a.style="style='background-image:url("+fno.liveSite+"assets/icon.php?type=line&color="+u.color+(z)+")' "}else{a.style="style='background-image:url("+fno.liveSite+"assets/images/layertree/color_swatch.gif)' "}break;case"polygon":case"geometry":if(r.length==1){var u=r[0];var B=fno.liveSite+"assets/icon.php?type=polygon&color="+u.color+"&border="+u.bordercolor+(z);if(!this.options.forprint){a.style="style='background-image:url("+B+")' "}}else{a.style="style='background-image:url("+fno.liveSite+"assets/images/layertree/color_swatch.gif)' "}break;case"analysis":if(D.atype=="buffer"){var C=JSON.decode(D.params);var B=fno.liveSite+"assets/icon.php?type=polygon&color="+C.fillcolor+"&border="+C.bordercolor;if(this.options.forprint){}else{a.style="style='background-image:url("+B+")' "}}break}},getHTML:function(M,I){var G=M.tree.DOMidPrefix;if($defined(M.state.checked)){if(M.hasCheckbox){M.state.checked=(M.data&&M.data.visible=="t")?"checked":"unchecked"}else{M.state.checked="nochecked"}var F='<span class="mif-tree-checkbox mif-tree-node-'+M.state.checked+'" uid="'+M.UID+'">'+Mif.Tree.Draw.zeroSpace+"</span>"}else{var F=""}var H={className:"",style:""};if(M.type=="folder"){var K=""}else{if(M.type=="fture"){}else{this.getIcon(M.data,H);if(["file","buffer","raster","raster","tile"].contains(M.data.tip)||["feature","rasterfolder","basemapfolder"].contains(M.type)||(M.data&&M.data.raster=="t")||(M.data&&M.data.grp==2)){var K=""}else{var K='<span class="mif-tree-icon2 tree-icon-'+(M.data.lock=="t"?"lock":"unlock")+'" uid="'+M.UID+'" >'+Mif.Tree.Draw.zeroSpace+"</span>"}}}var E=H.className?H.className:(M.closeIconUrl?'" style="background-image: url('+M.closeIconUrl+')" ':M.closeIcon+"");var C=H.style;var J=H.img?H.img:Mif.Tree.Draw.zeroSpace;if(H.img){var D='<img class="mif-tree-icon" src="'+H.img+'" uid="'+M.UID+'" style="padding-right:5px !important;" width="10" height="10" />'}else{var D="<span "+C+'class="mif-tree-icon '+E+'" uid="'+M.UID+'">'+Mif.Tree.Draw.zeroSpace+"</span>"}var O=M.data.hint?'title="'+M.data.hint+'" ':"";var N=(M.data&&M.data.count)?' <span class="comment small">('+M.data.count.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")+")</span>":"";I=I||[];I.push("<div ",O,'class="mif-tree-node ',(M.isLast()?"mif-tree-node-last":""),'"'+(M.hidden?' style="display:none"':"")+' id="',G,M.UID,'">','<span class="mif-tree-node-wrapper ',M.cls,(M.state.selected?" mif-tree-node-selected":""),'" uid="',M.UID,'">','<span class="mif-tree-gadjet mif-tree-gadjet-',M.getGadjetType(),'" uid="',M.UID,'">',Mif.Tree.Draw.zeroSpace,"</span>",F,K,D,'<span class="mif-tree-name" uid="',M.UID,'">',M.name,N,"</span>","</span>",'<div class="mif-tree-children" style="display:none"></div>',"</div>");return I},children:function(B,l){B.open=true;B.$draw=true;var r=[];var u=B.children;for(var z=0,p=u.length;z<p;z++){this.getHTML(u[z],r)}l=l||B.getDOM("children");l.set("html",r.join(""));B.tree.fireEvent("drawChildren",[B])},root:function(f){var g=this.node(f.root);g.inject(f.wrapper);f.$draw=true;f.fireEvent("drawRoot")},forestRoot:function(g){var f=new Element("div").addClass("mif-tree-children-root").injectInside(g.wrapper);Mif.Tree.Draw.children(g.root,f)},node:function(b){return new Element("div").set("html",this.getHTML(b).join("")).getFirst()},isUpdatable:function(b){if((!b||!b.tree)||(b.getParent()&&!b.getParent().$draw)||(b.isRoot()&&(!b.tree.$draw||b.tree.forest))){return false}return true},update:function(f){if(!this.isUpdatable(f)){return}if(!f.hasChildren()){f.state.open=false}f.getDOM("gadjet").className="mif-tree-gadjet mif-tree-gadjet-"+f.getGadjetType();if(f.closeIconUrl){f.getDOM("icon").setStyle("background-image","url("+(f.isOpen()?f.openIconUrl:f.closeIconUrl)+")")}else{f.getDOM("icon").className="mif-tree-icon "+f[f.isOpen()?"openIcon":"closeIcon"]}f.getDOM("node")[(f.isLastVisible()?"add":"remove")+"Class"]("mif-tree-node-last");if(f.$loading){return}var g=f.getDOM("children");if(f.isOpen()){if(!f.$draw){Mif.Tree.Draw.children(f)}g.style.display="block"}else{g.style.display="none"}f.tree.fireEvent("updateNode",f);return f},inject:function(o,j){if(!this.isUpdatable(o)){return}j=j||o.getDOM("node")||this.node(o);var p=o.getPrevious();if(p){j.injectAfter(p.getDOM("node"));return}var l;if(o.tree.forest&&o.parentNode.isRoot()){l=o.tree.wrapper.getElement(".mif-tree-children-root")}else{if(o.tree.root==o){l=o.tree.wrapper}else{l=o.parentNode.getDOM("children")}}j.inject(l,"top")}};Mif.Tree.Draw.zeroSpace=Browser.Engine.trident?"&shy;":(Browser.Engine.webkit?"&#8203":"");Mif.Tree.implement({initSelection:function(){this.defaults.selectClass="";this.selected2=[];this.selected=false;this.wrapper.addEvent("mousedown",this.attachSelect.bindWithEvent(this))},attachSelect:function(f){if(!["icon","name","node"].contains(this.mouse.target)){return}var g=this.mouse.node;if(!g){return}this.select(g,f)},select:function(p,l,j){if(!p||!l){return this}if((!p.data||p.type=="feature")&&p.parentNode){p=p.parentNode}if((!l.control&&!l.shift)||!this.options.multipleSelection){this.unselectAll();this.selected2=[]}var o=false;if((l.control||l.shift)&&this.selected2.contains(p,true)){p.select(false);o=true}if(!o){this.selected2.push(p);this.selected2.unique();p.select(true)}this.selected=p;if(!j){this.fireEvent("select",[this.selected2]).fireEvent("selectChange",[this.selected2,true])}return this},unselectAll:function(){this.root.recursive(function(b){this.select(false)});this.selected2=[];this.selected=false},unselect:function(){var b=this.selected;if(!b){return this}this.selected=false;b.select(false);this.fireEvent("unSelect",[b]).fireEvent("selectChange",[b,false]);return this},getSelected:function(){return this.selected},isSelected:function(b){return b.isSelected()}});Mif.Tree.Node.implement({select:function(g){this.state.selected=g;if(!Mif.Tree.Draw.isUpdatable(this)){return}var l=this.getDOM("wrapper");if(!l){return}var j=l[(g?"add":"remove")+"Class"];l[(g?"add":"remove")+"Class"](this.selectClass||"mif-tree-node-selected")},isSelected:function(){return this.state.selected}});Mif.Tree.implement({initHover:function(){this.defaults.hoverClass="";this.wrapper.addEvent("mousemove",this.hover.bind(this));this.wrapper.addEvent("mouseout",this.hover.bind(this));this.defaultHoverState={gadjet:false,checkbox:false,icon:false,name:false,node:false};this.hoverState=$unlink(this.defaultHoverState)},hover:function(){var f=this.mouse.node;var g=this.mouse.target;$each(this.hoverState,function(l,a,b){if(l==f&&(a=="node"||a==g)){return}if(l){Mif.Tree.Hover.out(l,a);b[a]=false;this.fireEvent("hover",[l,a,"out"])}if(f&&(a=="node"||a==g)){Mif.Tree.Hover.over(f,a);b[a]=f;this.fireEvent("hover",[f,a,"over"])}else{b[a]=false}},this)},updateHover:function(){this.hoverState=$unlink(this.defaultHoverState);this.hover()}});Mif.Tree.Hover={over:function(j,g){var l=j.getDOM("wrapper");l.addClass((j.hoverClass||"mif-tree-hover")+"-"+g);if(j.state.selected){l.addClass((j.hoverClass||"mif-tree-hover")+"-selected-"+g)}},out:function(j,g){var l=j.getDOM("wrapper");l.removeClass((j.hoverClass||"mif-tree-hover")+"-"+g).removeClass((j.hoverClass||"mif-tree-hover")+"-selected-"+g)}};Mif.Tree.Load={children:function(C,B,u){for(var p=C.length;p--;){var D=C[p];var r=D.children;var z=new Mif.Tree.Node({tree:u,parentNode:B||undefined},D);if(u.forest||B!=undefined){B.children.unshift(z)}else{u.root=z}if(r&&r.length){arguments.callee(r,z,u)}}if(B){B.state.loaded=true}u.fireEvent("loadChildren",B)}};Mif.Tree.implement({load:function(g){var j=this;this.loadOptions=this.loadOptions||$lambda({});function l(b){if(j.forest){j.root=new Mif.Tree.Node({tree:j,parentNode:null},{});var a=j.root}else{var a=null}Mif.Tree.Load.children(b,a,j);Mif.Tree.Draw[j.forest?"forestRoot":"root"](j);j.$getIndex();j.fireEvent("load");return j}g=$extend($extend({isSuccess:$lambda(true),secure:true,onSuccess:l,method:"get"},this.loadOptions()),g);if(g.json){return l(g.json)}new Request.JSON(g).send();return this}});Mif.Tree.Node.implement({load:function(g){this.$loading=true;g=g||{};this.addType("loader");var j=this;function l(a){Mif.Tree.Load.children(a,j,j.tree);delete j.$loading;j.state.loaded=true;j.removeType("loader");Mif.Tree.Draw.update(j);j.fireEvent("load");j.tree.fireEvent("loadNode",j);return j}g=$extend($extend($extend({isSuccess:$lambda(true),secure:true,onSuccess:l,method:"get"},this.tree.loadOptions(this)),this.loadOptions),g);if(g.json){return l(g.json)}new Request.JSON(g).send();return this}});Mif.Tree.KeyNav=new Class({initialize:function(b){this.tree=b;this.bound={action:this.action.bind(this),attach:this.attach.bind(this),detach:this.detach.bind(this)};b.addEvents({focus:this.bound.attach,blur:this.bound.detach})},attach:function(){var b=Browser.Engine.trident||Browser.Engine.webkit?"keydown":"keypress";document.addEvent(b,this.bound.action)},detach:function(){var b=Browser.Engine.trident||Browser.Engine.webkit?"keydown":"keypress";document.removeEvent(b,this.bound.action)},action:function(g){if(!["down","left","right","up","pgup","pgdown","end","home"].contains(g.key)){return}var j=this.tree;if(!j.selected){j.select(j.forest?j.root.getFirst():j.root)}else{var l=j.selected;switch(g.key){case"down":this.goForward(l);g.stop();break;case"up":this.goBack(l);g.stop();break;case"left":this.goLeft(l);g.stop();break;case"right":this.goRight(l);g.stop();break;case"home":this.goStart(l);g.stop();break;case"end":this.goEnd(l);g.stop();break;case"pgup":this.goPageUp(l);g.stop();break;case"pgdown":this.goPageDown(l);g.stop();break}}j.scrollTo(j.selected)},goForward:function(f){var g=f.getNextVisible();if(g){this.tree.select(g)}},goBack:function(f){var g=f.getPreviousVisible();if(g){this.tree.select(g)}},goLeft:function(b){if(b.isRoot()){if(b.isOpen()){b.toggle()}else{return false}}else{if(b.hasChildren(true)&&b.isOpen()){b.toggle()}else{if(b.tree.forest&&b.getParent().isRoot()){return false}return this.tree.select(b.getParent())}}},goRight:function(b){if(!b.hasChildren(true)&&!b.loadable){return false}else{if(!b.isOpen()){return b.toggle()}else{return this.tree.select(b.getFirst(true))}}},goStart:function(){this.tree.select(this.tree.$index[0])},goEnd:function(){this.tree.select(this.tree.$index.getLast())},goPageDown:function(o){var l=this.tree;var p=(l.container.clientHeight/l.height).toInt()-1;var j=Math.min(l.$index.indexOf(o)+p,l.$index.length-1);l.select(l.$index[j])},goPageUp:function(o){var l=this.tree;var p=(l.container.clientHeight/l.height).toInt()-1;var j=Math.max(l.$index.indexOf(o)-p,0);l.select(l.$index[j])}});Event.Keys.extend({pgdown:34,pgup:33,home:36,end:35});Mif.Tree.implement({initSortable:function(b){this.sortable=true;this.sortFunction=b||function(g,a){if(g.name>a.name){return 1}else{if(g.name<a.name){return -1}else{return 0}}};this.addEvent("loadChildren",function(a){if(a){a.sort()}});this.addEvent("structureChange",function(l,o,a,p){l.sort()});return this}});Mif.Tree.Node.implement({sort:function(b){this.children.sort(b||this.tree.sortFunction);return this}});Mif.Tree.Node.implement({inject:function(E,C,D){C=C||"inside";var z=this.parentNode;function G(b){var a=b;while(a){a=a.getPrevious();if(!a){return null}if(!a.hidden){return a}}}var F=G(this);var B=D?"copy":"move";switch(C){case"after":case"before":if(E["get"+(C=="after"?"Next":"Previous")]()==this){return false}if(this.parentNode){this.parentNode.children.erase(this)}this.parentNode=E.parentNode;this.parentNode.children.inject(this,E,C);break;case"inside":if(E.tree&&E.getLast()==this){return false}if(this.parentNode){this.parentNode.children.erase(this)}if(E.tree){if(!E.hasChildren()){E.$draw=true;E.state.open=true}E.children.push(this);this.parentNode=E}else{E.root=this;this.parentNode=null;E.fireEvent("drawRoot")}break}var u=E.tree||E;if(this==this.tree.root){this.tree.root=false}if(this.tree!=u){var H=this.tree;this.recursive(function(){this.tree=u})}u.fireEvent("structureChange",[this,E,C,B]);u.$getIndex();if(H){H.$getIndex()}Mif.Tree.Draw.inject(this,D);[E,this,z,F,G(this)].each(function(a){Mif.Tree.Draw.update(a)});return this},copy:function(p,l){if(this.copyDenied){return}function o(a){var f=a.node;var b=a.tree;var u=$unlink({property:f.property,type:f.type,state:f.state,data:f.data});u.state.open=false;var g=new Mif.Tree.Node({parentNode:a.parentNode,children:[],tree:b},u);f.children.each(function(B){var r=o({node:B,parentNode:g,tree:b});g.children.push(r)});return g}var j=o({node:this,parentNode:null,tree:p.tree});return j.inject(p,l,Mif.Tree.Draw.node(j))},remove:function(){if(this.removeDenied){return}this.tree.fireEvent("remove",[this]);var g=this.parentNode,f=this.getPreviousVisible();if(g){g.children.erase(this)}else{if(!this.tree.forest){this.tree.root=null}}this.tree.selected=false;this.getDOM("node").destroy();this.tree.$getIndex();Mif.Tree.Draw.update(g);Mif.Tree.Draw.update(f);this.recursive(function(){if(this.id){delete Mif.ids[this.id]}});this.tree.mouse.node=false;this.tree.updateHover()}});Mif.Tree.implement({move:function(l,g,j){if(l.inject(g,j)){this.fireEvent("move",[l,g,j])}return this},copy:function(o,p,l){var j=o.copy(p,l);if(j){this.fireEvent("copy",[o,p,l,j])}return this},remove:function(b){b.remove();return this},add:function(g,l,j){if(!(g instanceof Mif.Tree.Node)){g=new Mif.Tree.Node({parentNode:null,tree:this},g)}g.inject(l,j,Mif.Tree.Draw.node(g));this.fireEvent("add",[g,l,j]);return g}});Mif.Tree.Drag=new Class({Implements:[Events,Options],Extends:Drag,options:{group:"tree",droppables:[],snap:4,animate:true,open:600,scrollDelay:100,scrollSpeed:100,modifier:"control",startPlace:["icon","name"],allowContainerDrop:true},initialize:function(g,f){g.drag=this;this.setOptions(f);$extend(this,{tree:g,snap:this.options.snap,groups:[],droppables:[],action:this.options.action});this.addToGroups(this.options.group);this.setDroppables(this.options.droppables);$extend(g.defaults,{dropDenied:[],dragDisabled:false});g.addEvent("drawRoot",function(){g.root.dropDenied.combine(["before","after"])});this.pointer=new Element("div").addClass("mif-tree-pointer").injectInside(g.wrapper);this.current=Mif.Tree.Drag.current;this.target=Mif.Tree.Drag.target;this.where=Mif.Tree.Drag.where;this.element=[this.current,this.target,this.where];this.document=g.wrapper.getDocument();this.selection=(Browser.Engine.trident)?"selectstart":"mousedown";this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:$lambda(false),leave:this.leave.bind(this),enter:this.enter.bind(this),keydown:this.keydown.bind(this)};this.attach();this.addEvent("start",function(){Mif.Tree.Drag.dropZone=this;this.tree.unselect();document.addEvent("keydown",this.bound.keydown);this.setDroppables();this.droppables.each(function(a){a.getElement().addEvents({mouseleave:this.bound.leave,mouseenter:this.bound.enter})},this);Mif.Tree.Drag.current.getDOM("name").addClass("mif-tree-drag-current");this.addGhost()},true);this.addEvent("complete",function(){document.removeEvent("keydown",this.bound.keydown);this.droppables.each(function(b){b.getElement().removeEvent("mouseleave",this.bound.leave).removeEvent("mouseenter",this.bound.enter)},this);Mif.Tree.Drag.current.getDOM("name").removeClass("mif-tree-drag-current");var a=Mif.Tree.Drag.dropZone;if(!a||a.where=="notAllowed"){Mif.Tree.Drag.startZone.onstop();Mif.Tree.Drag.startZone.emptydrop();return}if(a.onstop){a.onstop()}a.beforeDrop()})},getElement:function(){return this.tree.wrapper},addToGroups:function(b){b=$splat(b);this.groups.combine(b);b.each(function(a){Mif.Tree.Drag.groups[a]=(Mif.Tree.Drag.groups[a]||[]).include(this)},this)},setDroppables:function(b){this.droppables.combine($splat(b));this.groups.each(function(a){this.droppables.combine(Mif.Tree.Drag.groups[a])},this)},attach:function(){this.tree.wrapper.addEvent("mousedown",this.bound.start);return this},detach:function(){this.tree.wrapper.removeEvent("mousedown",this.bound.start);return this},dragTargetSelect:function(){function f(){this.current.getDOM("name").addClass("mif-tree-drag-current")}function g(){this.current.getDOM("name").removeClass("mif-tree-drag-current")}this.addEvent("start",f.bind(this));this.addEvent("beforeComplete",g.bind(this))},leave:function(g){var l=Mif.Tree.Drag.dropZone;if(l){l.where="notAllowed";Mif.Tree.Drag.ghost.firstChild.className="mif-tree-ghost-icon mif-tree-ghost-"+l.where;if(l.onleave){l.onleave()}Mif.Tree.Drag.dropZone=false}var j=this.getZone(g.relatedTarget);if(j){this.enter(null,j)}},onleave:function(){this.tree.unselect();this.clean();$clear(this.scrolling);this.scrolling=null;this.target=false},enter:function(g,j){if(g){j=this.getZone(g.target)}var l=Mif.Tree.Drag.dropZone;if(l&&l.onleave){l.onleave()}Mif.Tree.Drag.dropZone=j;j.current=Mif.Tree.Drag.current;if(j.onenter){j.onenter()}},onenter:function(){this.onleave()},getZone:function(o){if(!o){return false}var p=$(o);do{for(var j=this.droppables.length;j--;){var l=this.droppables[j];if(p==l.getElement()){return l}}p=p.getParent()}while(p);return false},keydown:function(f){if(f.key=="esc"){var g=Mif.Tree.Drag.dropZone;if(g){g.where="notAllowed"}this.stop(f)}},autoScroll:function(){var r=this.y;if(r==-1){return}var u=this.tree.wrapper;var B=r-u.scrollTop;var o=u.offsetHeight-B;var p=0;if(B<this.tree.height){var z=B;p=1}else{if(o<this.tree.height){var z=o;p=-1}}if(p&&!this.scrolling){this.scrolling=function(a){if(r!=this.y){r=this.y;z=(p==1?(r-u.scrollTop):(u.offsetHeight-r+u.scrollTop))||1}u.scrollTop=u.scrollTop-p*this.options.scrollSpeed/z}.periodical(this.options.scrollDelay,this,[p])}if(!p){$clear(this.scrolling);this.scrolling=null}},start:function(g){if(this.options.preventDefault){g.preventDefault()}this.fireEvent("beforeStart",this.element);var f=this.tree.mouse.target;if(!f){return}this.current=$splat(this.options.startPlace).contains(f)?this.tree.mouse.node:false;if(!this.current||this.current.dragDisabled){return}Mif.Tree.Drag.current=this.current;Mif.Tree.Drag.startZone=this;this.mouse={start:g.page};this.document.addEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});this.document.addEvent(this.selection,this.bound.eventStop)},drag:function(g){Mif.Tree.Drag.ghost.position({x:g.page.x+20,y:g.page.y+20});var f=Mif.Tree.Drag.dropZone;if(!f||!f.ondrag){return}Mif.Tree.Drag.dropZone.ondrag(g)},ondrag:function(o){this.autoScroll();if(!this.checkTarget()){return}this.clean();var r=this.where;var z=this.target;var u=r;if(r=="after"&&z&&(z.getNext())||r=="before"&&z.getPrevious()){u="between"}Mif.Tree.Drag.ghost.firstChild.className="mif-tree-ghost-icon mif-tree-ghost-"+u;if(r=="notAllowed"){this.tree.unselect();return}if(z&&z.tree){this.tree.select(z)}if(r=="inside"){if(z.tree&&!z.isOpen()&&!this.openTimer&&(z.loadable||z.hasChildren())){this.wrapper=z.getDOM("wrapper").setStyle("cursor","progress");this.openTimer=function(){z.toggle();this.clean()}.delay(this.options.open,this)}}else{var p=this.tree.wrapper;var B=this.index*this.tree.height;if(r=="after"){B+=this.tree.height}this.pointer.setStyles({left:p.scrollLeft,top:B,width:p.clientWidth})}},clean:function(){this.pointer.style.width=0;if(this.openTimer){$clear(this.openTimer);this.openTimer=false;this.wrapper.style.cursor="inherit";this.wrapper=false}},addGhost:function(){var f=this.current.getDOM("wrapper");var g=new Element("span").addClass("mif-tree-ghost");g.adopt(Mif.Tree.Draw.node(this.current).getFirst()).injectInside(document.body).addClass("mif-tree-ghost-notAllowed").setStyle("position","absolute");new Element("span").set("html",Mif.Tree.Draw.zeroSpace).injectTop(g);g.getLast().getFirst().className="";Mif.Tree.Drag.ghost=g},checkTarget:function(){this.y=this.tree.mouse.coords.y;var j=this.tree.mouse.node;if(!j){if(this.options.allowContainerDrop&&(this.tree.forest||!this.tree.root)){this.target=this.tree.$index.getLast();this.index=this.tree.$index.length-1;if(this.index==-1){this.where="inside";this.target=this.tree.root||this.tree}else{this.where="after"}}else{this.target=false;this.where="notAllowed"}this.fireEvent("drag");return true}if((this.current instanceof Mif.Tree.Node)&&this.current.contains(j)){this.target=j;this.where="notAllowed";this.fireEvent("drag");return true}this.index=Math.floor(this.y/this.tree.height);var o=this.y-this.index*this.tree.height;var p=j.dropDenied;if(this.tree.sortable){p.include("before").include("after")}var l;if(!p.contains("inside")&&o>(this.tree.height/4)&&o<(3/4*this.tree.height)){l="inside"}else{if(o<this.tree.height/2){if(p.contains("before")){if(p.contains("inside")){l=p.contains("after")?"notAllowed":"after"}else{l="inside"}}else{l="before"}}else{if(p.contains("after")){if(p.contains("inside")){l=p.contains("before")?"notAllowed":"before"}else{l="inside"}}else{l="after"}}}if(this.where==l&&this.target==j){return false}this.where=l;this.target=j;this.fireEvent("drag");return true},emptydrop:function(){var p=this.current,r=this.target,u=this.where;var o=this.tree.scroll;var l=function(){o.removeEvent("complete",l);if(this.options.animate){var b=p.getDOM("wrapper");var a=b.getPosition();Mif.Tree.Drag.ghost.set("morph",{duration:"short",onComplete:function(){Mif.Tree.Drag.ghost.dispose();this.fireEvent("emptydrop",this.element)}.bind(this)});Mif.Tree.Drag.ghost.morph({left:a.x,top:a.y});return}Mif.Tree.Drag.ghost.dispose();this.fireEvent("emptydrop",this.element);return}.bind(this);o.addEvent("complete",l);this.tree.select(this.current);this.tree.scrollTo(this.current)},beforeDrop:function(){if(this.options.beforeDrop){this.options.beforeDrop.apply(this,[this.current,this.target,this.where])}else{this.drop()}},drop:function(){var p=this.current,r=this.target,o=this.where;Mif.Tree.Drag.ghost.dispose();var u=this.action||(this.tree.key[this.options.modifier]?"copy":"move");if(this.where=="inside"&&r.tree&&!r.isOpen()){if(r.tree){r.toggle()}if(r.$loading){var l=function(){this.tree[u](p,r,o);this.tree.select(p).scrollTo(p);this.fireEvent("drop",[p,r,o]);r.removeEvent("load",l)};r.addEvent("load",l);return}}if(!(p instanceof Mif.Tree.Node)){p=p.toNode(this.tree)}this.tree[u](p,r,o);this.tree.select(p).scrollTo(p);this.fireEvent("drop",[p,r,o])},onstop:function(){this.clean();$clear(this.scrolling)}});Mif.Tree.Drag.groups={};Mif.Tree.Drag.Element=new Class({Implements:[Options,Events],initialize:function(f,g){this.element=$(f);this.setOptions(g)},getElement:function(){return this.element},onleave:function(){this.where="notAllowed";Mif.Tree.Drag.ghost.firstChild.className="mif-tree-ghost-icon mif-tree-ghost-"+this.where},onenter:function(){this.where="inside";Mif.Tree.Drag.ghost.firstChild.className="mif-tree-ghost-icon mif-tree-ghost-"+this.where},beforeDrop:function(){if(this.options.beforeDrop){this.options.beforeDrop.apply(this,[this.current,this.trarget,this.where])}else{this.drop()}},drop:function(){Mif.Tree.Drag.ghost.dispose();this.fireEvent("drop",Mif.Tree.Drag.current)}});Mif.Tree.implement({attachRenameEvents:function(){this.wrapper.addEvents({click:function(b){if($(b.target).get("tag")=="input"){return}this.beforeRenameComplete()}.bind(this),keydown:function(b){if(b.key=="enter"){this.beforeRenameComplete()}if(b.key=="esc"){this.renameCancel()}}.bind(this)})},disableEvents:function(){if(!this.eventStorage){this.eventStorage=new Element("div")}this.eventStorage.cloneEvents(this.wrapper);this.wrapper.removeEvents()},enableEvents:function(){this.wrapper.removeEvents();this.wrapper.cloneEvents(this.eventStorage)},getInput:function(){if(!this.input){this.input=new Element("input").addClass("mif-tree-rename");this.input.addEvent("focus",function(){this.select()});Mif.Tree.Rename.autoExpand(this.input)}return this.input},startRename:function(f){this.unselect();this.disableEvents();this.attachRenameEvents();var g=this.getInput();g.value=f.name;this.renameName=f.getDOM("name");this.renameNode=f;g.setStyle("width",this.renameName.offsetWidth+15);g.replaces(this.renameName);g.focus()},finishRename:function(){this.renameName.replaces(this.getInput())},beforeRenameComplete:function(){if(this.options.beforeRename){var g=this.getInput().value;var f=this.renameNode;this.options.beforeRename.apply(this,[f,f.name,g])}else{this.renameComplete()}},renameComplete:function(){this.enableEvents();this.finishRename();var f=this.renameNode;var g=f.name;f.set({property:{name:this.getInput().value}});this.fireEvent("rename",[f,f.name,g]);this.select(f)},renameCancel:function(){this.enableEvents();this.finishRename();this.select(this.renameNode)}});Mif.Tree.Node.implement({rename:function(){if(this.property.renameDenied){return}this.tree.startRename(this)}});Mif.Tree.Rename={autoExpand:function(g){var f=new Element("span").addClass("mif-tree-rename").setStyles({position:"absolute",left:-2000,top:0,padding:0}).injectInside(document.body);g.addEvent("keydown",function(a){(function(){g.setStyle("width",Math.max(20,f.set("html",g.value.replace(/\s/g,"&nbsp;")).offsetWidth+15))}).delay(10)})}};Mif.Tree.implement({initCheckbox:function(b){this.checkboxType=b||"simple";this.dfltState.checked="unchecked";this.defaults.hasCheckbox=true;this.wrapper.addEvent("click",this.checkboxClick.bind(this));if(this.checkboxType=="simple"){return}this.addEvent("loadChildren",function(g){if(!g){return}if(g.state.checked=="checked"){g.recursive(function(){this.state.checked="checked"})}else{var a=g.getFirst();if(a){a.setParentCheckbox(1)}}})},checkboxClick:function(b){if(this.mouse.target!="checkbox"){return}this.mouse.node["switch"]()},getChecked:function(g){var f=[];this.root.recursive(function(){var a=g?this.state.checked!=="unchecked":this.state.checked=="checked";if(this.hasCheckbox&&a){f.push(this)}});return f}});Mif.Tree.Node.implement({"switch":function(o,l){if(this.state.checked==o||!this.hasCheckbox){return}var j=this.tree.checkboxType;var p=(this.state.checked=="checked")?"unchecked":"checked";if(j=="simple"){this.setCheckboxState(p);if(!l){this.tree.fireEvent(p=="checked"?"check":"unCheck",this);this.tree.fireEvent("switch",[this,(p=="checked"?true:false)])}return this}this.recursive(function(){this.setCheckboxState(p)});this.setParentCheckbox();if(!l){this.tree.fireEvent(p=="checked"?"check":"unCheck",this);this.tree.fireEvent("switch",[this,(p=="checked"?true:false)])}return this},setCheckboxState:function(f){if(!this.hasCheckbox){return}var g=this.state.checked;this.state.checked=f;if((!this.parentNode&&this.tree.$draw)||(this.parentNode&&this.parentNode.$draw)){this.getDOM("checkbox").removeClass("mif-tree-node-"+g).addClass("mif-tree-node-"+f)}},setParentCheckbox:function(z){if(!this.hasCheckbox||!this.parentNode||(this.tree.forest&&!this.parentNode.parentNode)){return}var B=this.parentNode;var u="";var C=B.children;for(var p=C.length;p--;p>0){var D=C[p];if(!D.hasCheckbox){continue}var r=D.state.checked;if(r=="partially"){u="partially";break}else{if(r=="checked"){if(u=="unchecked"){u="partially";break}u="checked"}else{if(u=="checked"){u="partially";break}else{u="unchecked"}}}}if(B.state.checked==u||(z&&u=="partially"&&B.state.checked=="checked")){return}B.setCheckboxState(u);B.setParentCheckbox(z)}});Mif.Tree.CookieStorage=new Class({Implements:[Options],options:{store:function(b){return b.property.id},retrieve:function(b){return Mif.id(b)},event:"toggle",action:"toggle"},initialize:function(g,f){this.setOptions(f);this.tree=g;this.cookie=new Cookie("mif.tree:"+this.options.event+g.id||"");this.nodes=[];this.initSave()},write:function(){this.cookie.write(JSON.encode(this.nodes))},read:function(){return JSON.decode(this.cookie.read())||[]},restore:function(B){if(!B){this.restored=this.restored||this.read()}var u=B||this.restored;for(var l=0,p=u.length;l<p;l++){var z=u[l];var r=this.options.retrieve(z);if(r){r[this.options.action](true);u.erase(z);p--}}return u},initSave:function(){this.tree.addEvent(this.options.event,function(j,l){var g=this.options.store(j);if(l){this.nodes.include(g)}else{this.nodes.erase(g)}this.write()}.bind(this))}});var omniRibbon=new Class({Implements:[Events,Options],options:{animated:false,minimized:false},initialize:function(f,g){this.setOptions(this.options,g);this.container=$(f);this.tabs=new OmniTabs(f,{enableOnClick:true});this.tabs.addEvent("change",this.changeTab.bind(this));this.tabs.addEvent("tabclick",this.tabClick.bind(this));this.tabs.addEvent("tabover",function(a){a.element.addClass("gc-theme-color-hover")});this.tabs.addEvent("tabout",function(a){a.element.removeClass("gc-theme-color-hover")});this.tabscontainer=this.container.getElement(".omnitabs-container");this.sliderbt=this.container.getElement(".ribbon-slider-bt");if(this.sliderbt){this.sliderbt.addEvent("click",this.toggle.bind(this))}if(this.options.minimized){this.minimize()}this.container.getElements(".omnicombo").each(function(a,b){new omniCombo(a,{changetitle:false,hover:false,usejQueryPositioning:true})});this.full_page_container=$$(".gc-omnitab-full-page")},changeTab:function(b){this.fireEvent("change",{target:this,tab:b.tab,element:b.element})},tabClick:function(b){if((this.isDisabled()||this.isMinimized)&&b.element!=this.sliderbt){this.toggle()}},toggle:function(){if(this.isMinimized){this.maximize();this.enable()}else{this.minimize();this.disable()}},enable:function(){this.container.removeClass("disabled");this.tabs.enable()},disable:function(){this.container.addClass("disabled");this.tabs.disable()},isDisabled:function(){return this.container.hasClass("disabled")},minimize:function(){if(this.options.animated){var b=new Fx.Reveal(this.tabscontainer,{duration:500});b.addEvent("hide",MUI.Desktop.onBrowserResize.bind(MUI.Desktop));this.numfuncall=10;this.perID=this.desktopRedraw.periodical(0,this);b.dissolve()}else{this.tabscontainer.hide();this.desktopRedraw()}this.isMinimized=true;if(this.full_page_container){this.full_page_container.setStyle("top","46px")}},maximize:function(){if(this.options.animated){var b=new Fx.Reveal(this.tabscontainer,{duration:500});b.addEvent("show",MUI.Desktop.onBrowserResize.bind(MUI.Desktop));this.numfuncall=10;this.perID=this.desktopRedraw.periodical(50,this);b.reveal()}else{this.tabscontainer.show();this.desktopRedraw()}this.isMinimized=false;if(this.full_page_container){this.full_page_container.setStyle("top","132px")}},desktopRedraw:function(){MUI.Desktop.onBrowserResize();if(this.options.animated&&--this.numfuncall<=0){$clear(this.perID)}},showFullpage:function(g){if(!this.full_page_container){return}var f=this.full_page_container.getElement(".gc-omnitab-full-page-content");f[0].empty();if(g){f.showLoader();f.load(g)}this.full_page_container.show();return f[0]},hideFullpage:function(){if(!this.full_page_container){return}this.full_page_container.hide()}});var omniRibbonButton=new Class({Implements:[Events,Options],options:{className:"omniRibbonButton",size:32,toggle:false},initialize:function(g,f){this.setOptions(this.options,f);this.container=$(g);if(!this.container){return}this.icon=this.container.getElement(".gc-ribbon-"+this.options.size);this.container.addEvent("click",this.onClick.bind(this))},onClick:function(){if(this.options.toggle){this.toggle()}if(!this.isDisabled()){this.fireEvent("click",{target:this})}},enable:function(){if(!this.container){return}this.container.removeClass("disabled");this.setBackgroundPosition(-this.options.size);this.fireEvent("enabled",{target:this,enabled:true})},disable:function(){if(!this.container){return}this.container.addClass("disabled");this.setBackgroundPosition(0);this.fireEvent("enabled",{target:this,enabled:false});this.off(true)},isDisabled:function(){return this.container&&this.container.hasClass("disabled")},isOn:function(b){return this.container&&this.container.hasClass("toggle")},on:function(b){if(!this.container){return}this.container.addClass("toggle");if(!b&&!this.isDisabled()){this.fireEvent("toggle",{target:this,toggle:true})}},off:function(b){if(!this.container){return}this.container.removeClass("toggle");if(!b&&!this.isDisabled()){this.fireEvent("toggle",{target:this,toggle:false})}},toggle:function(){if(this.isDisabled()){return}var b=this.container.hasClass("toggle");if(b){this.off()}else{this.on()}},setBackgroundPosition:function(l){var j=this.icon;if(!j){return}if(Browser.Engine.trident){j.style.backgroundPositionX=l+"px"}else{var g=$(j).getStyle("background-position").split(" ");j.style.backgroundPosition=l+"px "+g[1]}}});var GISCLOUD=new Class({});GISCLOUD.Color=new Class({Implements:[Options],options:{},initialize:function(b){this.setOptions(this.options,b)},RGB2Color:function(g,l,b){return(g&255)*65536|(l&255)*256|(b&255)},hsv2rgb:function(H,O,F){var J,G,K;var I=new Array();if(O==0){I.red=I.green=I.blue=Math.round(F*255)}else{var N=H*6;if(N==6){N=0}var r=Math.floor(N);var M=F*(1-O);var b=F*(1-O*(N-r));var g=F*(1-O*(1-(N-r)));if(r==0){var_r=F;var_g=g;var_b=M}else{if(r==1){var_r=b;var_g=F;var_b=M}else{if(r==2){var_r=M;var_g=F;var_b=g}else{if(r==3){var_r=M;var_g=b;var_b=F}else{if(r==4){var_r=g;var_g=M;var_b=F}else{var_r=F;var_g=M;var_b=b}}}}}I.red=Math.round(var_r*255);I.green=Math.round(var_g*255);I.blue=Math.round(var_b*255)}return I}});GISCLOUD.FileFormats=new (new Class({Implements:[Options],options:{},initialize:function(b){this.setOptions(this.options,b);this.fileformats_by_ext=new Array();this.fileformats_by_ext.wav=this.fileformats_by_ext.mp3="ui-audio";this.fileformats_by_ext.doc=this.fileformats_by_ext.docx="ui-word";this.fileformats_by_ext.xls=this.fileformats_by_ext.xlsx="ui-excel";this.fileformats_by_ext.pdf="ui-pdf";this.fileformats_by_ext.ogv=this.fileformats_by_ext["3gp"]=this.fileformats_by_ext.wmv=this.fileformats_by_ext.webm=this.fileformats_by_ext.mp4=this.fileformats_by_ext.flv=this.fileformats_by_ext.avi=this.fileformats_by_ext.mpg="ui-video";this.fileformats_by_ext.jpg=this.fileformats_by_ext.jpeg=this.fileformats_by_ext.png=this.fileformats_by_ext.gif="picture"},formatFileForRecord:function(R,W,af,ad){var P,O,V,ae="",T=[],M=[],S=this,ac,U,aa,Q=R.split(","),N,Z=[];jQuery.each(Q,function(a,b){var g=b.substr(0,7);P=b.substr(7);V=P.substr(P.lastIndexOf("/")+1),aa=P.substr(P.lastIndexOf(".")+1).toLowerCase();if(S.fileformats_by_ext[aa]){ae=S.fileformats_by_ext[aa]}else{ae="ui-doc"}if(W&&af){U=fno.liveSite+"view/"+W+"/"+P;ac=U}else{U=R;ac=R}T.push(ac);M.push(V);if(ad&&ad.thumb&&ae=="picture"){Z.push("<img src='"+ac+"?size=thumb' style='height:50px' />")}});var ab={url:T,external:!af,title:M.join(", "),autoplay:true};var Y=user&&user.options.MEDIA_PLAYER_NEXT_AND_PREV;if(ad&&ad.dataIndex&&Y){ab.column=ad.dataIndex}var N="";if(ae=="ui-audio"){if(af){U="javascript:;"}N=af?"onclick='fn.showMedia("+JSON.stringify(ab)+"); return false;'":""}else{if(ae=="picture"){if(af){U="javascript:;"}ab.width=640;ab.height=480;N=af?"onclick='fn.showMedia("+JSON.stringify(ab)+"); return false;'":""}else{if(ae=="ui-video"&&(aa=="mpg"||aa=="flv"||aa=="mp4"||aa=="webm"||aa=="wmv"||aa=="ogv"||aa=="avi"||aa=="3gp")){U="javascript:;";N=af?"onclick='fn.showMedia("+JSON.stringify(ab)+"); return false;'":""}else{if(ae=="ui-pdf"){U=U;ab.target="_blank";O=" target='_blank' "}else{ab.target="_blank";O=" target='_blank' "}}}}if(!af){ab.target="_blank";O=" target='_blank' "}var f=(ad&&ad.thumb&&ae=="picture")?Z.join(""):('<span class="gc-icon ui-voffset '+ae+'"></span>'+M.join());return(ad&&ad.actionOnly)?ab:'<a href="'+U+'" '+N+" "+O+" >"+f+"</a>"},formatRecordValue:function(u,r,B){if(u===""||u==null){return"&nbsp;"}var o=u.toString();var p=/^\s*mailto\:\s*([\S]+)\s*$/i;var z=o.substr(0,7);if(z=="file://"||z=="http://"||o.substr(0,8)=="https://"){return GISCLOUD.FileFormats.formatFileForRecord(o,r,z=="file://",B)}if(p.test(o)){return jQuery("<a/>",{href:o,text:o.replace(p,"$1")}).prepend('<span class="ui-icon ui-voffset ui-link"></span>').html()}return giscloud.xssSafe(o)}}));function codeEmail(j,l,g){document.write('<a href="mailto:'+j+"?subject="+l+'" mce_href="mailto:'+j+"?subject="+l+'">'+(g?g:j)+"</a>")}function is_numeric(b){return(typeof(b)==="number"||typeof(b)==="string")&&b!==""&&!isNaN(b)}function IsNumeric(j){if(!j){return}var o="0123456789.";var p=true;var l;for(i=0;i<j.length&&p==true;i++){l=j.charAt(i);if(o.indexOf(l)==-1){p=false;break}}return p}function toggleFieldset(g){var f=$(g);if(f.hasClass("collapsible")){hideFieldset(g)}else{openFieldset(g)}}function hideFieldset(f){var p=$(f).getElement(".form");var u=$(f);var r=new Fx.Slide(p,{duration:"slow"});if(!(p.getStyle("height").toInt()>0)){var o=u.getCoordinates().height;p.setStyle("height",o-40)}r.hide();u.addClass("collapsed");u.removeClass("collapsible")}function openFieldset(l){var o=$(l).getElement(".form");var f=$(l);var p=new Fx.Slide(o,{duration:"slow"});p.show();f.addClass("collapsible");f.removeClass("collapsed")}function setHTMLValue(l,g){if(l==null){return}if(l.get("tag")=="select"){for(var j=0;j<l.options.length;j++){if(l.options[j].value==g){l.options.selectedIndex=j;return}}}}function visible(g,f){var g=$(g);if(g){if(f){g.setStyle("visibility","visible")}else{g.setStyle("visibility","hidden")}}}function getRandomString(r){var u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var p=r?r:8;var z="";for(var B=0;B<p;B++){var o=Math.floor(Math.random()*u.length);z+=u.substring(o,o+1)}return z}function enable(g,f){var g=$(g);if(g){if(g.get("tag")=="input"){if(f){g.removeProperty("disabled")}else{g.setProperty("disabled",true)}}}}function clone(l){if(l==null||typeof(l)!="object"){return l}var j=new l.constructor();for(var g in l){j[g]=clone(l[g])}return j}function getStyleRanges(T,ab,V,O){var M=T.color.split(",");var aa=ab.color.split(",");var W=new Number(M[0]);var Y=new Number(M[1]);var Z=new Number(M[2]);var R=new Number(aa[0]);var r=new Number(aa[1]);var U=new Number(aa[2]);var J=[];for(var Q=0;Q<V;Q++){var K;var S=clone(T);if(Q==0){K=M}else{if(Q==(V-1)){K=aa}else{var P=[];P[0]=Math.abs(Math.round(W+((R-W)/V*Q)));P[1]=Math.abs(Math.round(Y+((r-Y)/V*Q)));P[2]=Math.abs(Math.round(Z+((U-Z)/V*Q)));if(P[0]>255){P[0]=255}if(P[1]>255){P[1]=255}if(P[2]>255){P[2]=255}K=P}}S.width=1;S.borderwidth=Math.abs(Math.round(T.borderwidth+((ab.borderwidth-T.borderwidth)/V*Q)));S.visible=true;S.color=K.join();if(O=="point"){if(T.symbol&&ab.symbol){var N=Math.round(Math.abs(ab.symbol.size-T.symbol.size)/V);S.symbol=clone(T.symbol);S.symbol.size=Number(T.symbol.size)+N*Q}else{S.symbol={type:"circle",color:S.color,border:"0,0,0",bw:"2",size:"6"};S.iconsoverlap=2}}J.push(S)}return J}function getRandomStyle(z){var o={};if(z&&z.alg==1){var u=Math.round(359/z.max);var B=Math.round(u*z.i);o.bordercolor=$HSB(B,100,80).join();o.color=$HSB(B,50,80).join()}else{if(z&&z.alg==2){var r=giscloud.Color.randomHue(80,90),p=r.darker();o.bordercolor=p.rgb().join();o.color=r.rgb().join()}else{var B=Math.round(Math.random()*359);o.bordercolor=$HSB(B,100,80).join();o.color=$HSB(B,50,80).join()}}o.fontcolor="0,0,0";o.outline="255,255,255";o.width=1;o.borderwidth=(z&&z.geomtype=="line")?1:0;o.fontsize=12;o.cap=false;o.scale=true;o.visible=true;if(z&&z.geomtype=="point"){o.symbol={type:"circle",color:o.color,border:"0,0,0",bw:"2",size:"6"};o.iconsoverlap=2}return o}var pallete=[3329330,16716947,255,15787660,9127187,65280,16711680,65535,16776960,10824234,32768,16711935,128,16753920,16416882,32896,8388736,4620980,16766720,13789470,8421376,14315734,8087790,11403055,12357519,65407,16729344,7372944,0,8421504];function getTwoRandomStyles(){var j={};var g=Math.round(Math.random()*359);j.bordercolor=$HSB(g,90,100).join();j.color=$HSB(g,30,100).join();j.fontcolor="0,0,0";j.outline="255,255,255";j.width=1;j.borderwidth=0;j.fontsize=12;j.cap=false;j.scale=true;j.visible=true;var l=clone(j);l.color=$HSB(g,80,100).join();return[j,l]}function setDivStyle(r,p,u){if($type(p)=="string"){p=$(p)}p.setStyle("background-color","white");p.setStyle("background-image","none");if(u.galleryUrl||u.url||u.symbol||u.color){p.removeClass("nocolor");p.removeClass("nocolor-20");p.empty();if(u.galleryUrl){p.setStyle("background-image","url("+u.galleryUrl+")");p.title=u.galleryUrl.substring(u.galleryUrl.lastIndexOf("/")+1,u.galleryUrl.lastIndexOf("."))}else{if(u.url){var l=u.url.replace(/ /g,"%20");p.setStyle("background-image","url("+fno.liveSite+"assets/icon.php?p="+encodeURI(l)+")");p.title=u.url.substring(u.url.lastIndexOf("/")+1);return}else{if(u.symbol&&u.symbol.type){var l=fno.liveSite+"assets/icon.php?"+Hash.toQueryString(u.symbol);var o=new Element("img",{src:l,width:"20px",height:"20px"});o.inject(p);return}}}if(u.color){p.setStyle("background-color","rgb("+u.color+")")}}else{if(p.hasClass("styleicon2")||p.hasClass("styleicon")){p.addClass("nocolor-20")}else{p.addClass("nocolor")}}if(u.bordercolor){p.setStyle("border","1px solid rgb("+u.bordercolor+")")}else{p.setStyle("border","1px solid #333333")}}var ImgTip=new Class({options:{onShow:function(b){b.setStyle("visibility","visible")},onHide:function(b){b.dispose()},maxTitleChars:30,showDelay:0,hideDelay:100,className:"tool",offsets:{x:16,y:16},fixed:false},initialize:function(l,g){this.setOptions(g);this.toolTip=new Element("div",{"class":this.options.className+"-tip",styles:{position:"absolute",top:"0",left:"0",visibility:"hidden"}}).inject(document.body);var j=this.end.bind(this);document.addEvent("dblclick",j);if(document.img_tip_wrapper){document.img_tip_wrapper.dispose()}document.img_tip_wrapper=this.wrapper=new Element("div").inject(this.toolTip);$$(l).each(this.build,this);if(this.options.initialize){this.options.initialize.call(this)}},build:function(f){this.start(f);this.position(f);if(!this.options.fixed){f.addEvent("mousemove",this.locate.bindWithEvent(this))}var g=this.end.bind(this);f.addEvent("mouseleave",g);f.addEvent("trash",g)},onData:function(b){this.options.cont.text.innerHTML=b.value},start:function(b){this.wrapper.empty();if(this.options.imgsrc){if(this.options.imgsrc.indexOf(".swf")){this.str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" ';this.str+='width="'+this.options.width+'" ';this.str+='height="'+this.options.height+'" ';this.str+='title="MultiBoxMedia">';this.str+='<param name="movie" value="'+this.options.imgsrc+'" />';this.str+='<param name="quality" value="high" />';this.str+='<embed src="'+this.options.imgsrc+'" ';this.str+='quality="high" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" ';this.str+='width="'+this.options.width+'" ';this.str+='height="'+this.options.height+'"></embed>';this.str+="</object>";this.img=new Element("div");this.img.innerHTML=this.str}else{this.img=new Element("img",{src:this.options.imgsrc,style:"border:1px solid #e4e4e4; padding:5px; background-color:white"})}}this.img.inject(this.wrapper);$clear(this.timer);this.timer=this.show.delay(this.options.showDelay,this)},end:function(b){$clear(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this)},position:function(g){var f=g.getPosition();this.toolTip.setStyles({left:f.x+this.options.offsets.x,top:f.y+this.options.offsets.y})},locate:function(p){var B={x:window.getWidth(),y:window.getHeight()};var u={x:window.getScrollLeft(),y:window.getScrollTop()};var C={x:this.toolTip.offsetWidth,y:this.toolTip.offsetHeight};var D={x:"left",y:"top"};for(var z in D){var r=p.page[z]+this.options.offsets[z];if((r+C[z]-u[z])>B[z]){r=p.page[z]-this.options.offsets[z]-C[z]}this.toolTip.setStyle(D[z],r)}},show:function(){if(this.options.timeout){this.timer=this.hide.delay(this.options.timeout,this)}this.fireEvent("onShow",[this.toolTip])},hide:function(){this.fireEvent("onHide",[this.toolTip])}});ImgTip.implement(new Events,new Options);function insertAtCaret(F,u){if(document.selection){F.focus();var C=F.value.replace(/\r\n/g,"\n");var E=document.selection.createRange();if(E.parentElement()!=F){return false}E.text=u;var z=tmp=F.value.replace(/\r\n/g,"\n");for(var B=0;B<C.length;B++){if(C.charAt(B)!=z.charAt(B)){break}}for(var D=0,H=0;tmp.match(u)&&(tmp=tmp.replace(u,""))&&D<=B;D=H+u.length){H=z.indexOf(u,D)}}else{if(F.selectionStart){var H=F.selectionStart;var G=F.selectionEnd;F.value=F.value.substr(0,H)+u+F.value.substr(G,F.value.length)}}if(H!=null){setCaretTo(F,H+u.length)}else{F.value+=u}}function setCaretTo(g,l){if(g.createTextRange){var j=g.createTextRange();j.move("character",l);j.select()}else{if(g.selectionStart){g.focus();g.setSelectionRange(l,l)}}}function getOGRType(){}function getOGRGeometryType(b){switch(b){case 0:return"Undefined";break;case 1:return"Point";break;case 2:case 2:return"Point";break}}function getFileExtension(b){return b.substring(b.lastIndexOf(".")+1)}function getSourceObject(j){var l=typeof(j)=="object"?j:JSON.decode(j);if(!l){return null}if(l.type=="pg"){var g=l.src.split(".");if(g.length==2){l.schema=g[0];l.table=g[1]}else{l.schema="public";l.table=g[0]}l.fullsrc=(l.schema=="public")?l.table:l.src;return l}else{if(l.type=="file"){if(l.src){l.name=l.src.substring(l.src.lastIndexOf("/")+1)}}}return l}function formatGetInfo(p,B){if(!p){return"Invalid data."}var u="Source projection(PROJ4): "+p.proj4;u+="<br/>Bound: "+p.bound.xmin+", "+p.bound.ymin+", "+p.bound.xmax+", "+p.bound.ymax;u+="<br/>Units: "+p.unit;u+=", Features: "+p.featurecount;if(p.attributes&&(!B||(B&&!B.noattributes))){u+="<br/>Attributes: ";var z=p.attributes;for(var r=0;r<z.length;r++){var a=z[r];u+=a.name+"("+a.type+")";if(r<z.length-1){u+=", "}}}return u}function showProjections(j,l){var g={fid:"projectionform",width:600,height:470,title:gclang.spatial_projections,url:fno.liveSite+"modules_gc/filemanager/projectionform.php"};if(j){g.data=j}projectionform=formManager.open(g);if(l){projectionform.addEvent("close",l)}return projectionform}var encodingsList=new Array();encodingsList.push({name:"UTF8",desc:"Unicode, 8-bit",lang:"all",alias:"Unicode"});encodingsList.push({name:"BIG5",desc:"Big Five",lang:"Traditional Chinese",alias:"WIN950, Windows950"});encodingsList.push({name:"EUC_CN",desc:"Extended UNIX Code-CN",lang:"Simplified Chinese",alias:""});encodingsList.push({name:"EUC_JP",desc:"Extended UNIX Code-JP",lang:"Japanese",alias:""});encodingsList.push({name:"EUC_KR",desc:"Extended UNIX Code-KR",lang:"Korean",alias:""});encodingsList.push({name:"EUC_TW",desc:"Extended UNIX Code-TW",lang:"Traditional Chinese, Taiwanese",alias:""});encodingsList.push({name:"GB18030",desc:"National Standard",lang:"Chinese",alias:""});encodingsList.push({name:"GBK",desc:"Extended National Standard",lang:"Simplified Chinese",alias:"WIN936, Windows936"});encodingsList.push({name:"ISO_8859_5",desc:"ISO 8859-5, ECMA 113",lang:"Latin/Cyrillic",alias:""});encodingsList.push({name:"ISO_8859_6",desc:"ISO 8859-6, ECMA 114",lang:"Latin/Arabic",alias:""});encodingsList.push({name:"ISO_8859_7",desc:"ISO 8859-7, ECMA 118",lang:"Latin/Greek",alias:""});encodingsList.push({name:"ISO_8859_8",desc:"ISO 8859-8, ECMA 121",lang:"Latin/Hebrew",alias:""});encodingsList.push({name:"JOHAB",desc:"JOHAB",lang:"Korean (Hangul)",alias:""});encodingsList.push({name:"KOI8",desc:"KOI8-R(U)",lang:"Cyrillic",alias:"KOI8R"});encodingsList.push({name:"LATIN1",desc:"ISO 8859-1, ECMA 94",lang:"Western European",alias:"ISO88591"});encodingsList.push({name:"LATIN2",desc:"ISO 8859-2, ECMA 94",lang:"Central European",alias:"ISO88592"});encodingsList.push({name:"LATIN3",desc:"ISO 8859-3, ECMA 94",lang:"South European",alias:"ISO88593"});encodingsList.push({name:"LATIN4",desc:"ISO 8859-4, ECMA 94",lang:"North European",alias:"ISO88594"});encodingsList.push({name:"LATIN5",desc:"ISO 8859-9, ECMA 128",lang:"Turkish",alias:"ISO88599"});encodingsList.push({name:"LATIN6",desc:"ISO 8859-10, ECMA 144",lang:"Nordic",alias:"ISO885910"});encodingsList.push({name:"LATIN7",desc:"ISO 8859-13",lang:"Baltic",alias:"ISO885913"});encodingsList.push({name:"LATIN8",desc:"ISO 8859-14",lang:"Celtic",alias:"ISO885914"});encodingsList.push({name:"LATIN9",desc:"ISO 8859-15",lang:"LATIN1 with Euro and accents",alias:"ISO885915"});encodingsList.push({name:"LATIN10",desc:"ISO 8859-16, ASRO SR 14111",lang:"Romanian",alias:"ISO885916"});encodingsList.push({name:"MULE_INTERNAL",desc:"Mule internal code",lang:"Multilingual Emacs",alias:""});encodingsList.push({name:"SJIS",desc:"Shift JIS, Japanese, Mskanji",lang:"ShiftJIS",alias:"WIN932, Windows932"});encodingsList.push({name:"SQL_ASCII",desc:"unspecified (see text)",lang:"any",alias:""});encodingsList.push({name:"UHC",desc:"Unified Hangul Code",lang:"Korean",alias:"WIN949, Windows949"});encodingsList.push({name:"WIN866",desc:"Windows CP866",lang:"Cyrillic",alias:"ALT"});encodingsList.push({name:"WIN874",desc:"Windows CP874",lang:"Thai",alias:""});encodingsList.push({name:"WIN1250",desc:"Windows CP1250",lang:"Central European",alias:""});encodingsList.push({name:"WIN1251",desc:"Windows CP1251",lang:"Cyrillic",alias:"WIN"});encodingsList.push({name:"WIN1252",desc:"Windows CP1252",lang:"Western European",alias:""});encodingsList.push({name:"WIN1253",desc:"Windows CP1253",lang:"Greek",alias:""});encodingsList.push({name:"WIN1254",desc:"Windows CP1254",lang:"Turkish",alias:""});encodingsList.push({name:"WIN1255",desc:"Windows CP1255",lang:"Hebrew",alias:""});encodingsList.push({name:"WIN1256",desc:"Windows CP1256",lang:"Arabic",alias:""});encodingsList.push({name:"WIN1257",desc:"Windows CP1257",lang:"Baltic",alias:""});encodingsList.push({name:"WIN1258",desc:"Windows CP1258",lang:"Vietnamese",alias:"ABC, TCVN, TCVN5712, VSCII"});var iconvenc=["437","500","500V1","850","851","852","855","856","857","860","861","862","863","864","865","866","866NAV","869","874","904","1026","1046","1047","8859_1","8859_2","8859_3","8859_4","8859_5","8859_6","8859_7","8859_8","8859_9","10646-1:1993","10646-1:1993/UCS4","ANSI_X3.4-1968","ANSI_X3.4-1986","ANSI_X3.4","ANSI_X3.110-1983","ANSI_X3.110","ARABIC","ARABIC7","ARMSCII-8","ASCII","ASMO-708","ASMO_449","BALTIC","BIG-5","BIG-FIVE","BIG5-HKSCS","BIG5","BIG5HKSCS","BIGFIVE","BRF","BS_4730","CA","CN-BIG5","CN-GB","CN","CP-AR","CP-GR","CP-HU","CP037","CP038","CP273","CP274","CP275","CP278","CP280","CP281","CP282","CP284","CP285","CP290","CP297","CP367","CP420","CP423","CP424","CP437","CP500","CP737","CP775","CP803","CP813","CP819","CP850","CP851","CP852","CP855","CP856","CP857","CP860","CP861","CP862","CP863","CP864","CP865","CP866","CP866NAV","CP868","CP869","CP870","CP871","CP874","CP875","CP880","CP891","CP901","CP902","CP903","CP904","CP905","CP912","CP915","CP916","CP918","CP920","CP921","CP922","CP930","CP932","CP933","CP935","CP936","CP937","CP939","CP949","CP950","CP1004","CP1008","CP1025","CP1026","CP1046","CP1047","CP1070","CP1079","CP1081","CP1084","CP1089","CP1097","CP1112","CP1122","CP1123","CP1124","CP1125","CP1129","CP1130","CP1132","CP1133","CP1137","CP1140","CP1141","CP1142","CP1143","CP1144","CP1145","CP1146","CP1147","CP1148","CP1149","CP1153","CP1154","CP1155","CP1156","CP1157","CP1158","CP1160","CP1161","CP1162","CP1163","CP1164","CP1166","CP1167","CP1250","CP1251","CP1252","CP1253","CP1254","CP1255","CP1256","CP1257","CP1258","CP1282","CP1361","CP1364","CP1371","CP1388","CP1390","CP1399","CP4517","CP4899","CP4909","CP4971","CP5347","CP9030","CP9066","CP9448","CP10007","CP12712","CP16804","CPIBM861","CSA7-1","CSA7-2","CSASCII","CSA_T500-1983","CSA_T500","CSA_Z243.4-1985-1","CSA_Z243.4-1985-2","CSA_Z243.419851","CSA_Z243.419852","CSDECMCS","CSEBCDICATDE","CSEBCDICATDEA","CSEBCDICCAFR","CSEBCDICDKNO","CSEBCDICDKNOA","CSEBCDICES","CSEBCDICESA","CSEBCDICESS","CSEBCDICFISE","CSEBCDICFISEA","CSEBCDICFR","CSEBCDICIT","CSEBCDICPT","CSEBCDICUK","CSEBCDICUS","CSEUCKR","CSEUCPKDFMTJAPANESE","CSGB2312","CSHPROMAN8","CSIBM037","CSIBM038","CSIBM273","CSIBM274","CSIBM275","CSIBM277","CSIBM278","CSIBM280","CSIBM281","CSIBM284","CSIBM285","CSIBM290","CSIBM297","CSIBM420","CSIBM423","CSIBM424","CSIBM500","CSIBM803","CSIBM851","CSIBM855","CSIBM856","CSIBM857","CSIBM860","CSIBM863","CSIBM864","CSIBM865","CSIBM866","CSIBM868","CSIBM869","CSIBM870","CSIBM871","CSIBM880","CSIBM891","CSIBM901","CSIBM902","CSIBM903","CSIBM904","CSIBM905","CSIBM918","CSIBM921","CSIBM922","CSIBM930","CSIBM932","CSIBM933","CSIBM935","CSIBM937","CSIBM939","CSIBM943","CSIBM1008","CSIBM1025","CSIBM1026","CSIBM1097","CSIBM1112","CSIBM1122","CSIBM1123","CSIBM1124","CSIBM1129","CSIBM1130","CSIBM1132","CSIBM1133","CSIBM1137","CSIBM1140","CSIBM1141","CSIBM1142","CSIBM1143","CSIBM1144","CSIBM1145","CSIBM1146","CSIBM1147","CSIBM1148","CSIBM1149","CSIBM1153","CSIBM1154","CSIBM1155","CSIBM1156","CSIBM1157","CSIBM1158","CSIBM1160","CSIBM1161","CSIBM1163","CSIBM1164","CSIBM1166","CSIBM1167","CSIBM1364","CSIBM1371","CSIBM1388","CSIBM1390","CSIBM1399","CSIBM4517","CSIBM4899","CSIBM4909","CSIBM4971","CSIBM5347","CSIBM9030","CSIBM9066","CSIBM9448","CSIBM12712","CSIBM16804","CSIBM11621162","CSISO4UNITEDKINGDOM","CSISO10SWEDISH","CSISO11SWEDISHFORNAMES","CSISO14JISC6220RO","CSISO15ITALIAN","CSISO16PORTUGESE","CSISO17SPANISH","CSISO18GREEK7OLD","CSISO19LATINGREEK","CSISO21GERMAN","CSISO25FRENCH","CSISO27LATINGREEK1","CSISO49INIS","CSISO50INIS8","CSISO51INISCYRILLIC","CSISO58GB1988","CSISO60DANISHNORWEGIAN","CSISO60NORWEGIAN1","CSISO61NORWEGIAN2","CSISO69FRENCH","CSISO84PORTUGUESE2","CSISO85SPANISH2","CSISO86HUNGARIAN","CSISO88GREEK7","CSISO89ASMO449","CSISO90","CSISO92JISC62991984B","CSISO99NAPLPS","CSISO103T618BIT","CSISO111ECMACYRILLIC","CSISO121CANADIAN1","CSISO122CANADIAN2","CSISO139CSN369103","CSISO141JUSIB1002","CSISO143IECP271","CSISO150","CSISO150GREEKCCITT","CSISO151CUBA","CSISO153GOST1976874","CSISO646DANISH","CSISO2022CN","CSISO2022JP","CSISO2022JP2","CSISO2022KR","CSISO2033","CSISO5427CYRILLIC","CSISO5427CYRILLIC1981","CSISO5428GREEK","CSISO10367BOX","CSISOLATIN1","CSISOLATIN2","CSISOLATIN3","CSISOLATIN4","CSISOLATIN5","CSISOLATIN6","CSISOLATINARABIC","CSISOLATINCYRILLIC","CSISOLATINGREEK","CSISOLATINHEBREW","CSKOI8R","CSKSC5636","CSMACINTOSH","CSNATSDANO","CSNATSSEFI","CSN_369103","CSPC8CODEPAGE437","CSPC775BALTIC","CSPC850MULTILINGUAL","CSPC862LATINHEBREW","CSPCP852","CSSHIFTJIS","CSUCS4","CSUNICODE","CSWINDOWS31J","CUBA","CWI-2","CWI","CYRILLIC","DE","DEC-MCS","DEC","DECMCS","DIN_66003","DK","DS2089","DS_2089","E13B","EBCDIC-AT-DE-A","EBCDIC-AT-DE","EBCDIC-BE","EBCDIC-BR","EBCDIC-CA-FR","EBCDIC-CP-AR1","EBCDIC-CP-AR2","EBCDIC-CP-BE","EBCDIC-CP-CA","EBCDIC-CP-CH","EBCDIC-CP-DK","EBCDIC-CP-ES","EBCDIC-CP-FI","EBCDIC-CP-FR","EBCDIC-CP-GB","EBCDIC-CP-GR","EBCDIC-CP-HE","EBCDIC-CP-IS","EBCDIC-CP-IT","EBCDIC-CP-NL","EBCDIC-CP-NO","EBCDIC-CP-ROECE","EBCDIC-CP-SE","EBCDIC-CP-TR","EBCDIC-CP-US","EBCDIC-CP-WT","EBCDIC-CP-YU","EBCDIC-CYRILLIC","EBCDIC-DK-NO-A","EBCDIC-DK-NO","EBCDIC-ES-A","EBCDIC-ES-S","EBCDIC-ES","EBCDIC-FI-SE-A","EBCDIC-FI-SE","EBCDIC-FR","EBCDIC-GREEK","EBCDIC-INT","EBCDIC-INT1","EBCDIC-IS-FRISS","EBCDIC-IT","EBCDIC-JP-E","EBCDIC-JP-KANA","EBCDIC-PT","EBCDIC-UK","EBCDIC-US","EBCDICATDE","EBCDICATDEA","EBCDICCAFR","EBCDICDKNO","EBCDICDKNOA","EBCDICES","EBCDICESA","EBCDICESS","EBCDICFISE","EBCDICFISEA","EBCDICFR","EBCDICISFRISS","EBCDICIT","EBCDICPT","EBCDICUK","EBCDICUS","ECMA-114","ECMA-118","ECMA-128","ECMA-CYRILLIC","ECMACYRILLIC","ELOT_928","ES","ES2","EUC-CN","EUC-JISX0213","EUC-JP-MS","EUC-JP","EUC-KR","EUC-TW","EUCCN","EUCJP-MS","EUCJP-OPEN","EUCJP-WIN","EUCJP","EUCKR","EUCTW","FI","FR","GB","GB2312","GB13000","GB18030","GBK","GB_1988-80","GB_198880","GEORGIAN-ACADEMY","GEORGIAN-PS","GOST_19768-74","GOST_19768","GOST_1976874","GREEK-CCITT","GREEK","GREEK7-OLD","GREEK7","GREEK7OLD","GREEK8","GREEKCCITT","HEBREW","HP-ROMAN8","HPROMAN8","HU","IBM-803","IBM-856","IBM-901","IBM-902","IBM-921","IBM-922","IBM-930","IBM-932","IBM-933","IBM-935","IBM-937","IBM-939","IBM-943","IBM-1008","IBM-1025","IBM-1046","IBM-1047","IBM-1097","IBM-1112","IBM-1122","IBM-1123","IBM-1124","IBM-1129","IBM-1130","IBM-1132","IBM-1133","IBM-1137","IBM-1140","IBM-1141","IBM-1142","IBM-1143","IBM-1144","IBM-1145","IBM-1146","IBM-1147","IBM-1148","IBM-1149","IBM-1153","IBM-1154","IBM-1155","IBM-1156","IBM-1157","IBM-1158","IBM-1160","IBM-1161","IBM-1162","IBM-1163","IBM-1164","IBM-1166","IBM-1167","IBM-1364","IBM-1371","IBM-1388","IBM-1390","IBM-1399","IBM-4517","IBM-4899","IBM-4909","IBM-4971","IBM-5347","IBM-9030","IBM-9066","IBM-9448","IBM-12712","IBM-16804","IBM037","IBM038","IBM256","IBM273","IBM274","IBM275","IBM277","IBM278","IBM280","IBM281","IBM284","IBM285","IBM290","IBM297","IBM367","IBM420","IBM423","IBM424","IBM437","IBM500","IBM775","IBM803","IBM813","IBM819","IBM848","IBM850","IBM851","IBM852","IBM855","IBM856","IBM857","IBM860","IBM861","IBM862","IBM863","IBM864","IBM865","IBM866","IBM866NAV","IBM868","IBM869","IBM870","IBM871","IBM874","IBM875","IBM880","IBM891","IBM901","IBM902","IBM903","IBM904","IBM905","IBM912","IBM915","IBM916","IBM918","IBM920","IBM921","IBM922","IBM930","IBM932","IBM933","IBM935","IBM937","IBM939","IBM943","IBM1004","IBM1008","IBM1025","IBM1026","IBM1046","IBM1047","IBM1089","IBM1097","IBM1112","IBM1122","IBM1123","IBM1124","IBM1129","IBM1130","IBM1132","IBM1133","IBM1137","IBM1140","IBM1141","IBM1142","IBM1143","IBM1144","IBM1145","IBM1146","IBM1147","IBM1148","IBM1149","IBM1153","IBM1154","IBM1155","IBM1156","IBM1157","IBM1158","IBM1160","IBM1161","IBM1162","IBM1163","IBM1164","IBM1166","IBM1167","IBM1364","IBM1371","IBM1388","IBM1390","IBM1399","IBM4517","IBM4899","IBM4909","IBM4971","IBM5347","IBM9030","IBM9066","IBM9448","IBM12712","IBM16804","IEC_P27-1","IEC_P271","INIS-8","INIS-CYRILLIC","INIS","INIS8","INISCYRILLIC","ISIRI-3342","ISIRI3342","ISO-2022-CN-EXT","ISO-2022-CN","ISO-2022-JP-2","ISO-2022-JP-3","ISO-2022-JP","ISO-2022-KR","ISO-8859-1","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-9E","ISO-8859-10","ISO-8859-11","ISO-8859-13","ISO-8859-14","ISO-8859-15","ISO-8859-16","ISO-10646","ISO-10646/UCS2","ISO-10646/UCS4","ISO-10646/UTF-8","ISO-10646/UTF8","ISO-CELTIC","ISO-IR-4","ISO-IR-6","ISO-IR-8-1","ISO-IR-9-1","ISO-IR-10","ISO-IR-11","ISO-IR-14","ISO-IR-15","ISO-IR-16","ISO-IR-17","ISO-IR-18","ISO-IR-19","ISO-IR-21","ISO-IR-25","ISO-IR-27","ISO-IR-37","ISO-IR-49","ISO-IR-50","ISO-IR-51","ISO-IR-54","ISO-IR-55","ISO-IR-57","ISO-IR-60","ISO-IR-61","ISO-IR-69","ISO-IR-84","ISO-IR-85","ISO-IR-86","ISO-IR-88","ISO-IR-89","ISO-IR-90","ISO-IR-92","ISO-IR-98","ISO-IR-99","ISO-IR-100","ISO-IR-101","ISO-IR-103","ISO-IR-109","ISO-IR-110","ISO-IR-111","ISO-IR-121","ISO-IR-122","ISO-IR-126","ISO-IR-127","ISO-IR-138","ISO-IR-139","ISO-IR-141","ISO-IR-143","ISO-IR-144","ISO-IR-148","ISO-IR-150","ISO-IR-151","ISO-IR-153","ISO-IR-155","ISO-IR-156","ISO-IR-157","ISO-IR-166","ISO-IR-179","ISO-IR-193","ISO-IR-197","ISO-IR-199","ISO-IR-203","ISO-IR-209","ISO-IR-226","ISO/TR_11548-1","ISO646-CA","ISO646-CA2","ISO646-CN","ISO646-CU","ISO646-DE","ISO646-DK","ISO646-ES","ISO646-ES2","ISO646-FI","ISO646-FR","ISO646-FR1","ISO646-GB","ISO646-HU","ISO646-IT","ISO646-JP-OCR-B","ISO646-JP","ISO646-KR","ISO646-NO","ISO646-NO2","ISO646-PT","ISO646-PT2","ISO646-SE","ISO646-SE2","ISO646-US","ISO646-YU","ISO2022CN","ISO2022CNEXT","ISO2022JP","ISO2022JP2","ISO2022KR","ISO6937","ISO8859-1","ISO8859-2","ISO8859-3","ISO8859-4","ISO8859-5","ISO8859-6","ISO8859-7","ISO8859-8","ISO8859-9","ISO8859-9E","ISO8859-10","ISO8859-11","ISO8859-13","ISO8859-14","ISO8859-15","ISO8859-16","ISO11548-1","ISO88591","ISO88592","ISO88593","ISO88594","ISO88595","ISO88596","ISO88597","ISO88598","ISO88599","ISO88599E","ISO885910","ISO885911","ISO885913","ISO885914","ISO885915","ISO885916","ISO_646.IRV:1991","ISO_2033-1983","ISO_2033","ISO_5427-EXT","ISO_5427","ISO_5427:1981","ISO_5427EXT","ISO_5428","ISO_5428:1980","ISO_6937-2","ISO_6937-2:1983","ISO_6937","ISO_6937:1992","ISO_8859-1","ISO_8859-1:1987","ISO_8859-2","ISO_8859-2:1987","ISO_8859-3","ISO_8859-3:1988","ISO_8859-4","ISO_8859-4:1988","ISO_8859-5","ISO_8859-5:1988","ISO_8859-6","ISO_8859-6:1987","ISO_8859-7","ISO_8859-7:1987","ISO_8859-7:2003","ISO_8859-8","ISO_8859-8:1988","ISO_8859-9","ISO_8859-9:1989","ISO_8859-9E","ISO_8859-10","ISO_8859-10:1992","ISO_8859-14","ISO_8859-14:1998","ISO_8859-15","ISO_8859-15:1998","ISO_8859-16","ISO_8859-16:2001","ISO_9036","ISO_10367-BOX","ISO_10367BOX","ISO_11548-1","ISO_69372","IT","JIS_C6220-1969-RO","JIS_C6229-1984-B","JIS_C62201969RO","JIS_C62291984B","JOHAB","JP-OCR-B","JP","JS","JUS_I.B1.002","KOI-7","KOI-8","KOI8-R","KOI8-RU","KOI8-T","KOI8-U","KOI8","KOI8R","KOI8U","KSC5636","L1","L2","L3","L4","L5","L6","L7","L8","L10","LATIN-9","LATIN-GREEK-1","LATIN-GREEK","LATIN1","LATIN2","LATIN3","LATIN4","LATIN5","LATIN6","LATIN7","LATIN8","LATIN10","LATINGREEK","LATINGREEK1","MAC-CENTRALEUROPE","MAC-CYRILLIC","MAC-IS","MAC-SAMI","MAC-UK","MAC","MACCYRILLIC","MACINTOSH","MACIS","MACUK","MACUKRAINIAN","MIK","MS-ANSI","MS-ARAB","MS-CYRL","MS-EE","MS-GREEK","MS-HEBR","MS-MAC-CYRILLIC","MS-TURK","MS932","MS936","MSCP949","MSCP1361","MSMACCYRILLIC","MSZ_7795.3","MS_KANJI","NAPLPS","NATS-DANO","NATS-SEFI","NATSDANO","NATSSEFI","NC_NC0010","NC_NC00-10","NC_NC00-10:81","NF_Z_62-010","NF_Z_62-010_(1973)","NF_Z_62-010_1973","NF_Z_62010","NF_Z_62010_1973","NO","NO2","NS_4551-1","NS_4551-2","NS_45511","NS_45512","OS2LATIN1","OSF00010001","OSF00010002","OSF00010003","OSF00010004","OSF00010005","OSF00010006","OSF00010007","OSF00010008","OSF00010009","OSF0001000A","OSF00010020","OSF00010100","OSF00010101","OSF00010102","OSF00010104","OSF00010105","OSF00010106","OSF00030010","OSF0004000A","OSF0005000A","OSF05010001","OSF100201A4","OSF100201A8","OSF100201B5","OSF100201F4","OSF100203B5","OSF1002011C","OSF1002011D","OSF1002035D","OSF1002035E","OSF1002035F","OSF1002036B","OSF1002037B","OSF10010001","OSF10020025","OSF10020111","OSF10020115","OSF10020116","OSF10020118","OSF10020122","OSF10020129","OSF10020352","OSF10020354","OSF10020357","OSF10020359","OSF10020360","OSF10020364","OSF10020365","OSF10020366","OSF10020367","OSF10020370","OSF10020387","OSF10020388","OSF10020396","OSF10020402","OSF10020417","PT","PT2","PT154","R8","RK1048","ROMAN8","RUSCII","SE","SE2","SEN_850200_B","SEN_850200_C","SHIFT-JIS","SHIFT_JIS","SHIFT_JISX0213","SJIS-OPEN","SJIS-WIN","SJIS","SS636127","STRK1048-2002","ST_SEV_358-88","T.61-8BIT","T.61","T.618BIT","TCVN-5712","TCVN","TCVN5712-1","TCVN5712-1:1993","TIS-620","TIS620-0","TIS620.2529-1","TIS620.2533-0","TIS620","TS-5881","TSCII","UCS-2","UCS-2BE","UCS-2LE","UCS-4","UCS-4BE","UCS-4LE","UCS2","UCS4","UHC","UJIS","UK","UNICODE","UNICODEBIG","UNICODELITTLE","US-ASCII","US","UTF-7","UTF-8","UTF-16","UTF-16BE","UTF-16LE","UTF-32","UTF-32BE","UTF-32LE","UTF7","UTF8","UTF16","UTF16BE","UTF16LE","UTF32","UTF32BE","UTF32LE","VISCII","WCHAR_T","WIN-SAMI-2","WINBALTRIM","WINDOWS-31J","WINDOWS-874","WINDOWS-936","WINDOWS-1250","WINDOWS-1251","WINDOWS-1252","WINDOWS-1253","WINDOWS-1254","WINDOWS-1255","WINDOWS-1256","WINDOWS-1257","WINDOWS-1258","WINSAMI2","WS2","YU"];var gcFileExt={};gcFileExt.All={label:"All Files (*.*)",ext:""};gcFileExt.Spatial={label:"All Spatial Files (*.shp; *.mif; *.mid; *.tab; *.kml; *.gpx, *.tif; *.tiff; *.jpg; *.gif, *.json)",ext:"shp,mif,mid,tab,kml,gpx,tif,tiff,jpg,gif,sid,hgt,dem,json"};gcFileExt.SpatialVector={label:"Spatial Vector Files (*.shp; *.mif; *.mid; *.tab; *.kml; *.gpx, *.json)",ext:"shp,mif,mid,tab,kml,gpx,json"};gcFileExt.SpatialRaster={label:"Spatial Raster Files (*.tif; *.tiff; *.jpg; *.gif)",ext:"tif,tiff,jpg,gif,sid,hgt,dem"};gcFileExt.Icons={label:"Image Files (*.jpg; *.gif; *.swf; *.png)",ext:"jpg,gif,swf,png"};gcFileExt.Shape=gcFileExt.Shapefile={label:"ESRI Shapefiles (*.shp)",ext:"shp"};gcFileExt.MapInfo={label:"MapInfo Files(*.mif)",ext:"mif"};gcFileExt.CSV={label:"Excel 2003 and CSV Files (*.csv; *.xls)",ext:"csv,xls"};gcFileExt.GTiff={label:"GeoTiff Files (*.tif; *.tiff)",ext:"tif,tiff"};gcFileExt.Media={label:"Media Files (*.jpg; *.png; *.gif; *.pdf; *.mp3; *.mp4; *.3gp; *.ogv; *.wmv; *.webm; *.flv; *.avi; *.mpg)",ext:"jpg,png,gif,pdf,mp3,mp4,3gp,ogv,wmv,webm,flv,avi,mpg"};gcFileExt.AAll=[gcFileExt.All,gcFileExt.Spatial,gcFileExt.SpatialVector,gcFileExt.SpatialRaster,gcFileExt.Icons,gcFileExt.CSV];var cPostGIS=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/layer/cpostgis.php",module:"postgis"},initialize:function(b){this.lastImportData=null},a:function(b){alert(2)},onImportToPostGISComplete:function(f){om.hideLoader();if(f.result=="yes"){gcapp.check_subscription();om.showMessage(f.msg);loadPostGISLayers()}else{var g="<h2>Error while importing data into database</h2>";g+='<span class="red">';if(f.output){g+=f.output}else{g+=f.msg}g+="</span>";giscloud.log.push("import_postgis_error",{error:g});this.lastImportData.error=g;this.showImportToPGDialog(this.lastImportData)}},onImportFormClose:function(b){if(!b||!b.epsg){return}this.lastImportData=b;giscloud.log.push("import_postgis_start",{epsg:b.epsg,tablename:b.tablename});fnm.importToPostGIS(b,gcPostGIS.onImportToPostGISComplete.bind(gcPostGIS))},showImportToPGDialog:function(j,l){var g={fid:"postgisimport",width:600,height:370,title:"Import to database",url:fno.liveSite+"modules_gc/filemanager/importtogis_form.php",data:j};importtopgdialogform=formManager.open(g);importtopgdialogform.addEvent("close",this.onImportFormClose.bind(this))},duplicate:function(j,l){if(!j||!(j.length>0)){return}var g={module:"postgis",task:"duplicate",tables:j.join()};this.call(g,"duplicate",l)},truncate:function(j,l){if(!j||!(j.length>0)){return}var g={module:"postgis",task:"truncate",tables:j.join()};this.call(g,"truncate",l)},showCSV2PostGISWizard:function(j,l){var g={fid:"csv2postgis",width:600,height:330,title:gclang.csv_import_wizard,url:fno.liveSite+"modules_gc/filemanager/importcsv2postgis_form.php",data:j};csv2postgiswizard=formManager.open(g);csv2postgiswizard.addEvent("close",this.onImportFormClose.bind(this))}});gcPostGIS=new cPostGIS();var fnApplication=new Class({Implements:[Events,Options],getOptions:function(){return{isMap:false,hideAuxMenu:false,generatorConnected:false,auxMenuOpacity:0}},initialize:function(g,f){this.setOptions(this.getOptions(),f);this.path=null;this.liveSite=null;this.lastMapID=-1;this.queue=new Roar()},isConnected:function(){return this.options.generatorConnected},safeUnloadMap:function(){if(fnm.isVisible()){fnw.removeEventListener("scalechange",gcapp.gcmap.onScaleChange.bind(gcapp.map));fnw.removeEventListener("onloadstart",gcapp.gcmap.onTileStartLoading.bind(gcapp.map));fnw.removeEventListener("onloadend",gcapp.gcmap.onTileStopLoading.bind(gcapp.map))}},loadModule:function(l,p,j){this.safeUnloadMap();if(l=="main"){l="main2"}else{$(l).empty();$(l).showLoader()}var o=new Request.HTML({url:p.url,update:$(l),onComplete:j,evalResponse:false,evalScripts:true}).get(p.data)},unloadModule:function(b){this.safeUnloadMap();if(b=="main"){}else{$(b).empty()}},call:function(j,l){var g=new Request.JSON({url:j,onComplete:function(a){l(a)}}).send()},setWorkspace:function(b){if(b){if($("workspacetitle")){$("workspacetitle").innerHTML=b.name}if($("mainPanel_title")){$("mainPanel_title").innerHTML="&#160;"}this.currentWorkspace=b}else{if($("workspacetitle")){$("workspacetitle").innerHTML="&#160;"}if($("mainPanel_title")){$("mainPanel_title").innerHTML="&#160;"}this.currentWorkspace=null}},getWorkspace:function(){return this.currentWorkspace},showMap:function(j,g){var l=this.getMap();if(fnm.isVisible()){if(l.mid==this.lastMapID&&!g){gcapp.gcmap.reloadMap(j)}else{this.lastMapID=l.mid;gcapp.gcmap.loadMap(l.mid,j)}}else{safeLoadMapData={mid:l.mid,callback:j}}},unloadMap:function(){if(fnm.isVisible()){}},setMap:function(l){this.currentMap=l;var j={};if(l&&l.options){if(typeof(l.options)=="string"){var g=l.options.split(";_;_");g.each(function(a){var b=a.split("||||");j[b[0]]=b[1]})}else{j=l.options}}if(this.currentMap){this.currentMap.options=j}gcapp.gcmap.updateProj4();fn.setTitle(l);fn.shareStatus()},shareStatus:function(){var b=jQuery("#layers-panel_title");if(!b.length||!this.currentMap){return}jQuery(".gc-map-share-status").remove();if(this.currentMap.share=="t"){jQuery("<div />").addClass("gc-map-share-status gc-icon gc-world12").css("float","right").css("margin-top","7px").css("height","12px").appendTo(b.parent()).attr("title","This map is publicly available. Click to change.").click(function(){if(gcapp.checkAndWarnForLogin()){gcproject.sharingAndPublishMap()}})}},getPermalink:function(){if(!this.currentMap.name){return null}var b=get_sef(this.currentMap.name);return fno.liveSite+"map/"+this.currentMap.mid+"/"+b},getPermalinkPath:function(){if(!this.currentMap||!this.currentMap.name){return""}var b=get_sef(this.currentMap.name);return"/map/"+this.currentMap.mid+"/"+b},getViewerPermalink:function(){if(!this.currentMap.name){return null}var b=get_sef(this.currentMap.name);return fno.viewerSite+"map/"+this.currentMap.mid+"/"+b},setTitle:function(l){if(l){var g=this.getPermalink();l.name=l.name||"";var j=gcApp.utils.escapeHtml(l.name);if($("layers-panel_title")){$("layers-panel_title").innerHTML="<a id='map_perm_link' class='linkbutton' href='"+g+"' target=\"_parent\" title='"+j+"'>"+l.name+"</a>"}document.title=fno.name+" - Map '"+l.name+"'";if(this.currentMap){this.currentMap.name=l.name}}else{if($("layers-panel_title")){$("layers-panel_title").innerHTML=""}document.title=fno.name}},getUserDir:function(b){return(b>=0)?"resources/us_id_"+b:null},getMap:function(){return this.currentMap},showMedia:function(p){if(!p||!p.url){return}var l=p.width?p.width:150;var o=p.height?p.height+69:190;l=Math.min(800,l);o=Math.min(800,o);var r="Media Player";if(p.title){r=p.title+" - "+r}if(this.mediaform){this.mediaform.close()}var u=[{html:"Close",click:"fn.mediaform.close();"}];if(p.column){u.push({id:"fm_next_bt",html:"Next",click:"fmNext();"});u.push({id:"fm_prev_bt",html:"Previous",click:"fmPrev();"})}this.mediaform=formManager.open({fid:"mediaform",minimize:true,overlay:false,dragable:true,title:r,width:l,height:o,url:fno.liveSite+"modules_gc/media/form_media.php",data:p,buttons:u});this.mediaform.fdata=p;this.mediaform.addEvent("minimize",function(){jQuery(".gc-media-form-pagination").hide()});this.mediaform.addEvent("maximize",function(){jQuery(".gc-media-form-pagination").show()})},getFormValues:function(g){g=$(g);if(!g){return null}var f={};g.getElements("input, select, textarea").each(function(b){if(!b.name||b.disabled){return}var a=(b.tagName.toLowerCase()=="select")?Element.getSelected(b).map(function(j){return j.value}):((b.type=="radio"||b.type=="checkbox")&&!b.checked)?null:b.value;var l=new Array();$splat(a).each(function(j){if(j){l.push(j)}});if(l.length>0){f[b.name]=l.join(",")}});return f}});var gcGeoprocessing=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/geoprocessing/cgeoprocessing.php",module:"layer"},initialize:function(b){this.options.module="geoprocessing"},merge:function(g,f){if(!g||typeof(g)!="object"){return}g.module=this.options.module;g.task="merge";this.call(g,"merge",f)}});var fnLayer=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/layer/clayer.php",module:"layer"},initialize:function(b){this.layerData=[];this.lastSelectedLayer=-1;this.lastBeforeID=-1;this.options.module="layer"},treelist:function(j,o,l){if(!j){return}var p=this;this.lastSelection=l;this.call({module:"layer",task:"treelist",count:true,mid:j},null,function(a){p.setData(a);if(o){o()}})},unselect:function(){if(gcapp.gclayer){gcapp.gclayer.llist.unselect()}},list:function(g,l,j){this.treelist(g,l,j)},setData:function(b){this.removeLayers(true);if(b&&b.length>0){b.each(function(g,a){g.data.dts_permissions=g.data.dts_permissions?g.data.dts_permissions.split(","):[]})}this.layerData=b;if(gcapp.gclayer){gcapp.gclayer.llist.setData(b)}if(this.lastSelection){if(gcapp.gclayer){gcapp.gclayer.llist.setSelection(this.lastSelection,true)}this.lastSelection=null}else{this.unselect()}this.fireEvent("setdata",{data:this.layerData})},transformPoint:function(o,r,B,u,p,z){if(!B||!u){return}this.call({module:"layer",task:"transform_point",x:o,y:r,s_srs:B,t_srs:u,postgis:p?"yes":"no"},"transform_point",z)},getFileImportInfo:function(f,g){if(!f){return}this.call({module:"layer",task:"getfileimportinfo",filepath:f},"getfileimportinfo",g)},getInfoByLayerID:function(f,g){if(!f){return}this.call({module:"layer",task:"getinfobylayerid",lid:f},"getinfobylayerid",g)},getStatsByLayerID:function(f,g){if(!f||!f.lid||!f.column||!f.operation){return}f.module="layer";f.task="getstatsbylayerid";this.call(f,"getstatsbylayerid",g)},getSelectedLayers:function(r){if(!gcapp.gclayer){return null}if(r){var u=gcapp.gclayer.llist.tree.getSelected();return u?u.data:null}var p=gcapp.gclayer.llist.getSelection();var o=[];for(var B=0;B<p.length;B++){var z=p[B].data;o.push(z)}return o},getLayersNum:function(){return this.layerData.length},getLayers:function(p,u){var l=[];if(!this.layerData){return l}var o=["buffer","raster"];if(p&&!p.wms){o.push("wms")}if(p&&!p.tile){o.push("tile")}var r=this.recursiveFlatten(this.layerData,[]);jQuery(r).each(function(){if(this.data&&this.data.tip&&!(o.contains(this.data.tip)||this.type.contains("feature")||(!u&&this.type.contains("folder"))||this.data.raster=="t")&&(!(p&&p.pgOnly)||(this.data.source&&this.data.source.indexOf('"type":"pg"')>-1))&&(!(p&&p.tmsOnly)||(this.data.source&&this.data.source.indexOf('"type":"tile"')>-1))){l.push(this.data)}});return l},recursiveFlatten:function(j,l){if(!j){return l}var g=this;jQuery(j).each(function(){l.push(this);if(this.children&&this.children.length>0){l=g.recursiveFlatten(this.children,l)}});return l},getLayer:function(b){return this.layerData[b]},getLayerById:function(b){if(b<0){return null}return this.recursiveLayerWalker(this.layerData,b)},recursiveLayerWalker:function(o,p){var l=null;if(!o){return l}var j=this;jQuery(o).each(function(){if(this.data&&this.data.id==p){l=this.data;return}if(!l&&this.children&&this.children.length>0){l=j.recursiveLayerWalker(this.children,p)}});return l},removeLayers:function(b){if(gcapp.gclayer&&gcapp.gclayer.llist){gcapp.gclayer.llist.empty(b)}this.layerData=[]},removeLayer:function(b){if(gcapp.gclayer){gcapp.gclayer.llist.removeItem(b)}},addLayer:function(b){this.layerData.push(b)},saveLayer:function(f,g){if(!f){return}f.module="layer";this.call(f,"savelayer",g)},deleteLayer:function(g,f){if(!g||(g&&g.length==0)){return}giscloud.log.push("layer_delete",{lid:g});this.call({module:"layer",task:"delete",lids:g},"deletelayer",f)},duplicateLayer:function(l,g,j){if(!l){return}giscloud.log.push("layer_duplicate",{lid:l,duplicatesource:g});this.call({module:"layer",task:"duplicate",layerid:l,dplsrc:g?"yes":"no"},"duplicatelayer",j)},invertSelection:function(g,f){if(!g){return}this.call({module:"layer",task:"invertselection",selection:g},"invertselection",f)},newLayerFromSelection:function(g,f){if(!g||!g.lid||!g.fids){return}giscloud.log.push("layer_new_from_selection",{mid:currentMapID,lid:g.lid,count:g.fids.length});this.call({module:"layer",task:"newlayerfromselection",selection:JSON.encode(g)},"newlayerfromselection",f)},createLayer:function(g,f){if(!g||!g.tablename||!g.attributes||!g.epsg||!g.geometrytype){return}g.module="layer";g.task="createlayer";giscloud.log.push("layer_create",g);this.call(g,"createlayer",f)},getFeaturesByBound:function(f,g){if(!f||!f.lid||!f.bound){return}f.bound=JSON.encode(f.bound);f.module="layer";f.task="getfeaturesbybound";this.call(f,"getfeaturesbybound",g)},getType:function(b){switch(parseInt(b)){case 1:case 4:return"point";break;case 2:case 5:return"line";break;case 3:case 6:return"polygon";break}return"geometry"},saveOrder:function(u,o,l,p){if(!u){return}var r=l.data.grp==2;this.call({module:"layer",task:"sort",ordernames:u,mid:o,lid:l.data.id,isbasemap:r},"saveorder",p)},dumpsql:function(b){if(!b){return}this.call({module:"layer",task:"dumpsql",layer:b},"dumpsql")},if_table_exists:function(b){if(!b){return}this.call({module:"layer",task:"iftableexists",layer:b},"iftableexists")},saveState:function(r,u,l,o,p){if((r||o)&&u&&l!=undefined&&l!=null){this.call({module:"layer",task:"savestate",lid:r,property:u,value:l,baselayer:o},"savestate",p)}},changePermission:function(g,f){if(!g||!g.lid){return}g.module="layer";g.task="changepermission";this.call(g,"changepermission",f)},getcsv:function(b){if(!b){return}this.call({module:"layer",task:"getcsv",csvfile:b},"getcsv")},getPostGISColumns:function(g,f){if(!g){return}if(typeof(g)=="object"){g=JSON.encode(g)}this.call({module:"layer",task:"getpostgiscolumns",sources:g},"getPostGISColumns",f)},getInfo:function(p,o){var l;switch(typeof(p)){case"string":l=getSourceObject(p);break;case"object":l=p;break;default:return false}if(!l){return false}switch(l.type){case"file":var j={};j.getinfo=fno.resources+"resources"+l.src;this.getPostGISInfo(l,l.proj4,l.encoding,o);return true;break;case"pg":this.getPostGISInfo(l,l.proj4,l.encoding,o);return true;break;default:return false}return false},getPostGISInfo:function(r,o,u,p){if(!r||typeof(r)!="object"){return}var l={module:"layer",task:"getpostgisinfo",source:JSON.encode(r)};if(u&&u.length>0){l.encoding=u}if(o&&o.length>0){l.proj4=o}this.call(l,"getpostgisinfo",p)},getPostGISLayer:function(r,B){var z={module:"layer",task:"getpostgislayer",lid:r.id};if(r.query&&r.query.length>0){z.where=r.query}var o=this.options.url+"?"+Hash.toQueryString(z);var u=new Request.JSON({url:o});var p=function(a){B(r,a)};u.addEvent("complete",p);u.send()},getPostGISLayers:function(f){var g={};g.module="layer";g.task="getpostgislayers";this.call(g,"getpostgislayers",f);return true},deletePostGISLayers:function(j,l,o){if(!j){return false}var p={};p.module="layer";p.task="deletepostgislayers";p.layers=j.join(",");p.connid=l;this.call(p,"getpostgislayers",o);return true},getPostGISRecord:function(H,G,D,F,C,B,u,z){if(!H||!G){return}var E={module:"layer",task:"getpostgisrecord",source:H,id:G};if(F&&F.length>0){E.encoding=F}if(D&&D.length>0){E.proj4=D}if(C){E.lid=C}if(B){E.mid=B}if(u){E.tooltip=u}this.call(E,"getpostgisrecord",z)},reproject:function(g,f){if(!g||typeof(g)!="object"){return}g.module="layer";g.task="reproject";this.call(g,"reproject",f)},getQuery:function(j,l){if(!j){return}var g={module:"layer",task:"getquery",queries:JSON.encode(j)};this.call(g,"getquery",l)},exportToCSV:function(g){if(!g.table||!g.id||!g.column){return}var f=new Request.HTML({url:this.options.url}).get()}});var fnMap=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/map/cmap.php",module:"map"},initialize:function(b){this.mapdata=null;this.activemapid=null;this.layerstogenerate=null;this.editable=null;this.addEvent("list",function(a){this.mapdata=a})},getInfo:function(u,D,r,C,B){if(!u){return}var z={};z.getinfo=u;if(C){z.enc=C}if(r){z.proj4=r}if(D){z.src_layer_id=D}om.gaq("map","getinfo","postgis",u+" "+D+" "+r);var p=new Request.JSON({url:fno.cgiApp,onComplete:B}).get(z)},getFeatureInfo:function(z,I,G,B,C,D,J,F){if(!z||!I||!B){return}var H={};H.module="layer";H.task="getinfoforfile";H.source=I;H.lid=z;H.mid=currentMapID;H.uid=B;H.layerid=G;H.tooltip=J;if(D&&D.length>0){H.enc=D}if(C&&C.length>0){H.proj4=C}om.gaq("map","getfeatureinfo",currentMapID,z+" "+I);var E=new Request.JSON({url:"/modules_gc/layer/clayer.php",onComplete:F}).get(H)},removeMaps:function(){mapTbl.removeAll();fnl.removeLayers();this.mapdata=[]},getMapsNum:function(){if(this.mapdata){return this.mapdata.length}else{return 0}},getMapData:function(b){if(this.mapdata){if(b>=0&&b<this.mapdata.length){return this.mapdata[b]}}return null},isReprojectable:function(l){var p=fnl.getLayers({wms:true,tile:true}),r,u,o=[];if(!fn.getMap()){return null}if(!p.length){return[]}for(r=0;r<p.length;r++){u=p[r];if((["tile","wmts","wms","wfs"].contains(u.sourcetype))&&is_numeric(u.epsg)&&u.epsg*1!=l){o.push(u)}}return o},getReprojectionConfirmMsg:function(j){var g,l;g=jQuery.map(j,function(a){return"<li>"+a.name+"</li>"}).join("");l="<div class='big' >Some layers in your map can not be reprojected so they need to be removed.<br><br>";l+="<ul class='gc-list' >"+g+"</ul>";l+="<br/>Do you want to continue?</div>";return l},showUserPrivateMaps:function(){var g,f;if(!user.private_maps){return}if(user.private_maps.length==0){giscloud.ui.confirm("All your maps are already public.",{title:"Private maps",hide_no:true});return}else{if(user.private_maps.length<10){g=jQuery.map(user.private_maps,function(a){return"<li class='gc-pointer' title='Click to open map' rel='"+a.id+"' >"+a.name+"</li>"}).join("");g="<ul class='gc-list' >"+g+"</ul>"}else{g="You have "+user.private_maps.length+" private maps.<br/>"}}f="<div class='gc-private-maps-list big' >Free license doesn't allow private maps.<br/><br/>";f+=g;f+="<br/>Do you want to make them all publicly available to continue using the service under Free subscription?";f+="<br/><br/>WARNING: ANYONE WILL BE ABLE TO SEE YOUR MAPS. Once you make your maps publicly available you'll need to manually make them private again if you decide to switch to the premium license!</div>";giscloud.ui.confirm(f,{title:"Private maps"}).yes(function(){var a=user.private_maps.map(function(b){return b.id}).join(",");om.kcall("map/make_all_maps_public",null,function(){gcapp.check_subscription(function(){if(gcapp.userform){gcapp.userform.subscription.refresh()}});om.showConfirm("All your maps are now publicly available.")})});jQuery(".gc-private-maps-list li").click(function(a){var b=jQuery(a.currentTarget).attr("rel");gcproject.mapChange(b)})},getMapDataByID:function(g,f){if(!g){return}this.call({module:"map",task:"getmapbyid",mid:g,__LOADERMSG:"Loading map! Please wait... "},"getmapbyid",f)},getUserMaps:function(g,f){this.call({module:"map",task:"getusermaps",options:g},"getusermaps",f)},getMapIndexByID:function(g){if(this.mapdata){for(var f=0;f<this.mapdata.length;f++){if(this.mapdata[f].id==g){return f}}}return -1},saveMap:function(f,g){if(!f){return}f.module="map";this.call(f,"savemap",g)},deleteMap:function(j,g){if(!(j>0)){return}var l={};l.module="map";l.mapid=j;l.task="delete";giscloud.log.push("map_delete",{mid:j});this.call(l,"deletemap",g)},duplicateMap:function(j,g){if(!(j>0)){return}var l={};l.module="map";l.mapid=j;l.task="duplicate";giscloud.log.push("map_duplicate",{mid:j});this.call(l,"duplicatemap",g)},saveAttribute:function(g,f){if(!g||!g.mid||!g.p||g.v==undefined||g.v==null){return}g.module="map";g.task="saveattribute";this.call(g,"saveattribute",f)},fullvacuum:function(b){this.call({module:"map",task:"fullvacuum"},"fullvacuum",b)},list:function(b){if(!b){return}this.call({module:"map",task:"list",wid:b},"list")},generate:function(b){if(!b){return}this.call({module:"map",task:"generate",mid:b},"generate")},cache:function(l,u,p){if(!l){return}var r={init:1,f:fno.path+"maps/map"+l+".xml"};if(u){this.layerstogenerate=r.l=u.join()}om.gaq("map","cache",l,u);var o=fno.cgiApp+"?"+Hash.toQueryString(r);new Request.JSON({url:o,onComplete:p}).get()},cache2:function(j){if(!j||!j.mid){return}var l=function(a){if(!a){om.showError("There was an error creating cache.");return}if(a.result=="yes"){om.showConfirm("Finished successfully!")}else{if(a.code&&a.msg){om.showError(a.code+" "+a.msg)}}};var g={module:"map",task:"cache",mid:j.mid};if(j.layers){g.layers=j.layers}if(j.force){g.force=j.force}this.call(g,"cache",l)},vectorTilesSeed:function(j,o){if(!j.mid){return}var p={module:"map",task:"vectortilesseed",mid:j.mid};if(!o){o=function(a){if(!a){return}om.showMessage("Seeding vector tiles finished.")}}if(PCM.connected){var l=this.options.url+"?"+Hash.toQueryString(p);PCM.add(l,o)}else{this.call(p,"vectortilesseed",o)}},rasterTilesSeed:function(j,o){if(!j.mid){return}var p={module:"map",task:"rastertilesseed",mid:j.mid};p.tolevel=j.tolevel?j.tolevel:null;p.fromlevel=j.fromlevel?j.fromlevel:null;if(PCM.connected){var l=this.options.url+"?"+Hash.toQueryString(p);PCM.add(l,o)}else{this.call(p,"rastertilesseed",o)}},rasterTilesClear:function(g){if(!g){return}var f=function(a){om.showMessage(a.msg)};this.call({module:"map",task:"rastertilesclear",mid:g},"rastertilesclear",f)},clearMapCache:function(o,u,l){if(!o){return}var p=function(a){om.showMessage(a.msg)};var r={module:"map",task:"clearmapcache",mid:o,__LOADERMSG:"Clearing map cache! Please wait... "};if(u){r.layersname=u}if(l){r.recache=l}this.call(r,"clearmapcache",p)},clearGeneratorCache:function(){om.showLoader();var b=new Request.HTML({url:fno.cgiApp,onComplete:function(){om.hideLoader();om.showConfirm("Generator cache cleared.")}}).get({cache:"clear"})},getUpdatedLayers:function(g,f){if(!g){return}this.call({module:"map",task:"getupdatedlayers",mid:g},"getupdatedlayers",f)},isVisible:function(){if($("flashcontent")&&fnw){return true}else{return false}},shareUser:function(l,p,o,u){if(!l||!p||!o){return}var r={module:"map",task:"shareuser",mid:l,username:p,options:o};giscloud.log.push("share_map_to_user",{mid:l,username:p,options:o});this.call(r,"shareuser",u)},deleteShareUser:function(l,o,j){if(!l||!o){return}var p={module:"map",task:"deleteshareuser",mid:l,username:o};giscloud.log.push("share_map_remove_user",{mid:l,username:o});this.call(p,"deleteshareuser",j)},changeShareUser:function(l,p,o,u){if(!l||!p||!o){return}var r={module:"map",task:"changeshareuser",mid:l,username:p,access:o};this.call(r,"changeshareuser",u)},shareWMS:function(l,j,p){if(!l||!j){return}var o={module:"map",task:"sharewms",mid:l,wmsaccess:j};giscloud.log.push("share_map_wms",{mid:l,wmsaccess:j});this.call(o,"sharepublic",p)},sharePublic:function(l,j,p){if(!l||!j){return}var o={module:"map",task:"sharepublic",mid:l,share:j};giscloud.log.push("share_map_public",{mid:l,share:j});this.call(o,"sharepublic",p)},importToPostGIS:function(l,g){if(!l||!l.filename||!l.epsg){return}l.module="map";l.task="importtopostgis";if(PCM.connected){var j=this.options.url+"?"+Hash.toQueryString(l);PCM.add(j,g)}else{this.call(l,"importtopostgis",g)}},proj42epsg:function(g,f){if(!g){return}this.call({module:"map",task:"proj42epsg",proj4:g},"proj42epsg",f)},getUnitFromProj4:function(D,G){if(!D){return}var u=D.split(" ");var F,B,C,z;for(var E=0;E<u.length;E++){var H=u[E].split("=");switch(H[0]){case"+proj":F=H[1];break;case"+units":B=H[1];break;case"+ellps":C=H[1].toLowerCase();break;case"+datum":z=H[1].toLowerCase();break}}if(C=="wgs84"||z=="wgs84"){return"degree"}if(B=="m"){return"meter"}switch(F){case"longlat":return"degree";break;case"utm":return"meter";break;case"merc":return"meter";break;case"tmerc":return"meter";break;default:return"";break}},cropToSelectedArea:function(r,u){if(!this.areaSelectionObject){alert("Please select an area first.");return}var o=this.areaSelectionObject;var l={xMin:o.xMin,yMin:o.yMin,xMax:o.xMax,yMax:o.yMax};var p={module:"map",task:"croptobound",bound:JSON.encode(l),mid:currentMapID};if(r){p.layers=r}this.call(p,"croptobound",u)}});var fnSearch=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/search/csearch.php"},initialize:function(b){},onSearchComplete:function(o){var u=o.data;for(var l=0;l<u.length;l++){var p=u[l];var r=this.sources[p.srcid];p.layername=r.lyrname;if(p.pkey){p.oid="layer"+r.lid+"||"+p.pkey}else{p.oid="layer"+r.lid+"||"+p.uid}}this.callback(o)},onRESTSearchComplete:function(u){var E=u.data,C=[],G=E.length;if(G>0){for(var D=0;D<G;D++){var B=E[D];var F=fnl.getLayerById(B.__layer_id);B.__layername=F?F.name:"Unknown"}var H=this.sources.length;C.push({header:("<i class='comment' >"+gclang.layer+"</i>"),labelFunction:function(a){return("<i class='comment' >"+a.__layername+"</i>")},editable:false,width:150});if(H==1){C.push({header:"FID",dataIndex:"__id",editable:false,width:50});for(var z in E[0].data){C.push({header:z,labelFunction:(function(a){return(function(b){return b.data[a]})})(z),editable:false})}}else{if(H>1){C.push({header:"Object",labelFunction:function(a){return"Object #ID "+a.__id},editable:false})}}}this.callback(u,C)},search:function(z,r,B,p){if(!r||!z.length){return}this.options.txt=r;this.sources=z;this.callback=p;var o=fn.getMap(),u={query:r,x:0,y:0,perpage:gcapp.gcsearch.searchResultGrid.options.perPage,page:1,srid:o.srid,proj4:o.proj4};u.fields=this.getFields(this.sources);om.rest("search",u,this.onRESTSearchComplete.bind(this))},search_old:function(p,l,j,o){if(!l||!p.length){return}this.options.txt=l;this.callback=o;if(j){this.proj4=j}this.sources=p;this.loadData({page:1,perpage:gcapp.gcsearch.searchResultGrid.options.perPage})},getSearchResult:function(F,z){var B=fn.getMap().options.RESULT_FIELDS,r,u,E,D="";r=B?JSON.decode(B):null;u=r[F];for(var C=0;C<u.length;C++){var E=u[C];D+=z[E]+" "}return D},getFields:function(B){var r=[],p,o=fn.getMap().options.SEARCH_FIELDS,u=o?JSON.decode(o):gcapp.gcsearch.options.fields;if(B){for(var z=0;z<B.length;z++){var p=B[z].lid;layer_fields="*";if(u){if(u[p]){layer_fields=u[p].join(",");r.push(p+"~"+layer_fields)}}else{r.push(p+"~"+layer_fields)}}}else{Object.each(u,function(a,b){layer_fields=a.join(",");r.push(b+"~"+layer_fields)})}return r.join(";")},loadData:function(g){if(!this.options.txt||!this.sources.length){return}var f=g;f.query=this.options.txt;f.x=0;f.y=0;f.srid=fn.getMap().srid;f.proj4=fn.getMap().proj4;f.fields=this.getFields(this.sources);om.rest("search",f,this.onRESTSearchComplete.bind(this))}});var fnWorkspace=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/projects/cworkspace.php",module:"workspace"},initialize:function(b){this.workspacedata=null;this.addEvent("list",function(a){this.workspacedata=a})},getWorkspacesNum:function(){if(this.workspacedata){return this.workspacedata.length}else{return 0}},getWorkspaceData:function(b){if(this.workspacedata){if(b>=0&&b<this.workspacedata.length){return this.workspacedata[b]}}return null},getWorkspaceIndexById:function(f){if(this.workspacedata){for(var g=0;g<this.workspacedata.length;g++){if(this.workspacedata[g].id==f){return g}}}return -1},saveWorkspace:function(f,g){if(!f){return}f.module="workspace";this.call(f,"saveworkspace",g)},onList:function(b){},list:function(){this.call({module:"workspace",task:"list"},"list")},treeList:function(g,f){this.call({module:"workspace",task:"treelist"},"treelist",f)},deletew:function(g,f){if(!(g>-1)){return}this.call({module:"workspace",task:"delete",wid:g},"delete",f)},duplicateWorkspace:function(f,g){if(!(f>0)){return}this.call({module:"workspace",task:"duplicate",wid:f},"duplicateworkspace",g)}});var gcReferences=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/media/cmedia.php",module:"media",container:null,addButton:false},initialize:function(b){this.setOptions(b);this.container=$(this.options.container);if(!this.container){return}this.references=new omRanges(this.container,{renderFunction:this.referenceRenderer.bind(this),sortable:true,addButton:this.options.addButton});this.references.addEvent("newrange",this.onNewReference.bind(this));this.references.addEvent("deleterange",this.onDeleteReference.bind(this));this.list()},onListComplete:function(f,g){if(window.formreferences){formreferences.enable(true)}if(!f){om.showError("There was an error.");return}if(f.result=="yes"){if(f.references&&f.references.length>0){this.references.deserialize(f.references)}}else{om.showError(f.msg)}},list:function(){if(!this.container){return}var g=gcapp.selo.selection;if(!g||!g.fids||!g.fids.length==1){alert("Please select one feature on the map.");return}this.references.removeAll();this.references.addRange();var f={module:this.options.module,task:"listreferences",src:g.lid,fid:g.fids[0]};if(window.formreferences){formreferences.disable(true)}this.call(f,"listreferences",this.onListComplete.bind(this))},onSaveComplete:function(f,g){if(!f){om.showError("There was an error.");return}if(f.result=="yes"){g.store("data",{id:f.id,reference:f.reference});om.showConfirm(f.msg)}else{om.showError(f.msg)}this.list()},onBrowserSelect:function(B,z){var C=gcapp.selo.selection;if(!C||!C.fids||!C.fids.length==1){alert("Please selecte one feature on the map.");return}var r=z.retrieve("data");if(!B||!B.files||!(B.files.length>0)){if(!r){this.references.deleteRange(z)}return}var D=B.files[0];z.getElement(".reference").set("html",this.formatField({reference:D.path}));var E=C.lid;var F=C.fids[0];var u={module:this.options.module};if(r&&is_numeric(r.id)){u.task="updatereference";u.rid=r.id}else{u.task="savereference"}u.src=E;u.fid=F;u.reference=D.path;this.call(u,null,this.onSaveComplete.bindWithEvent(this,z))},newReference:function(b){this.onNewReference(this.references.addRange())},onNewReference:function(b){this.showBrowser(b)},onDeleteReferenceComplete:function(b){if(!b){om.showError("There was an error.");return}if(b.result=="yes"){om.showConfirm(b.msg)}else{om.showError(b.msg)}},onDeleteReference:function(g){if(!g.data||!is_numeric(g.data.id)){return}var f={module:this.options.module,task:"deletereference",rid:g.data.id};if(g.last){g.li.getElement(".reference").innerHTML="";g.li.store("data",null)}this.call(f,"deletereference",this.onDeleteReferenceComplete.bind(this))},showMedia:function(j,l){var o=l.retrieve("data");var p=o.reference.substring(o.reference.lastIndexOf(".")+1);if(["jpg","jpeg","gif","png"].contains(p)){fn.showMedia({url:fno.liveSite+"assets/icon.php?p="+o.reference})}},referenceRenderer:function(o,l){var p=new Element("div",{html:""});p.addClass("reference");var r=new Element("div",{title:"Click to change reference"});r.addClass("gc-icon ui-attach");r.inject(o);p.inject(o);if(l&&l.reference){o.store("data",l);var u=this.formatField(l);p.set("html",u)}},formatField:function(p){var o=p.reference.substring(p.reference.lastIndexOf("/")+1);var r=p.reference.substring(p.reference.lastIndexOf(".")+1);if(["jpg","jpeg","gif","png"].contains(r)){var l=fno.liveSite+"assets/icon.php?p="+p.reference}else{var l=fno.liveSite+"assets/download.php?p=resources"+p.reference}var u="<a class='linkbutton' href='"+l+"' target='_blank' >"+o+"</a>";u+="<span class='small comment' style='margin-left:20px' >"+jQuery.datepicker.formatDate("dd MM, yy",new Date(p.created*1000))+"</span>";return u},onChangeReferenceClick:function(f,g){this.showBrowser(g)},showBrowser:function(g){var f=formManager.fileBrowser({upload:true,selectmode:true,showimages:true,extensions:[gcFileExt.All],postgis:false});f.addEvent("close",this.onBrowserSelect.bindWithEvent(this,g))},close:function(b){}});var gcedit;var gcEdit=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/geometry/cgeometry.php",module:"geometry"},initialize:function(b){this.setOptions(this.options,b);this.layertableform=null;gcapp.gctoolbar.addEvent("toolchange",this.onToolChange.bind(this));if(gcapp.gclayer){gcapp.gclayer.llist.addEvent("select",this.onLayerSelectionChange.bind(this))}if(gcapp.ribbonMenu){gcapp.ribbonMenu.editmodebt=new omniRibbonButton("EditToggle",{toggle:true});gcapp.ribbonMenu.editmodebt.addEvent("toggle",this.onEditModeToggle.bind(this));gcapp.ribbonMenu.addfeaturebt=new omniRibbonButton("tool-add-point",{toggle:true});gcapp.ribbonMenu.addfeaturebt.addEvent("toggle",this.onAddModeToggle.bind(this));gcapp.ribbonMenu.editcancelbt=new omniRibbonButton("tool-edit-cancel",{size:16});gcapp.ribbonMenu.editsavebt=new omniRibbonButton("tool-edit-save",{size:16});gcapp.ribbonMenu.editcancelbt.addEvent("click",this.editFeatureCancel.bind(this));gcapp.ribbonMenu.editsavebt.addEvent("click",this.editFeatureSave.bind(this))}gcapp.gcmap.addEvent("objectclick",this.objectClick.bind(this));this.reset()},reset:function(){if(!fnm.isVisible()||!canvas){return}if(canvas&&this.onAddGeometryBind&&this.onClickGeometryBind){canvas.removeEventListener("add",this.onAddGeometryBind);canvas.removeEventListener("click",this.onClickGeometryBind);canvas.removeEventListener("change",this.onChangeGeometryBind)}this.onAddGeometryBind=this.onAddGeometry.bind(this);this.onClickGeometryBind=this.onClickGeometry.bind(this);this.onChangeGeometryBind=this.onChangeGeometry.bind(this);canvas.addEventListener("add",this.onAddGeometryBind);canvas.addEventListener("click",this.onClickGeometryBind);canvas.addEventListener("change",this.onChangeGeometryBind)},reverseGeo:function(f,g){if(!f||!f.x||!f.y){return}this.call({module:"geometry",task:"reversegeo",x:f.x,y:f.y,mid:currentMapID},"reversegeo",g)},deleteFeatures:function(g,f){if(!g||!g.lid||!g.fids){return}giscloud.log.push("feature_delete",{mid:currentMapID,lid:g.lid,count:g.fids.length});this.call({module:"geometry",task:"deletefeatures",selection:JSON.encode(g)},"deletefeatures",f)},editFeatureCancel:function(b){gcapp.gctoolbar.setSelectableLayers();if(this.active_edit_gid){canvas.remove(this.active_edit_gid);this.active_edit_gid=null;gcapp.ribbonMenu.editsavebt.disable();gcapp.ribbonMenu.editcancelbt.disable()}if(this.editsafeobj){fnw.modifyObject("layer"+this.editsafeobj.lid+"||"+this.editsafeobj.fid,{visible:true},"",true);this.editsafeobj=null}},getDefaultGeometryStyle:function(g){var f={};f.color=f.linecolor=16711680;f.alpha=50;f.fillalpha=50;f.linealpha=50;f.fillcolor=16711935;f.width=(g&&g.toLowerCase()==="line")?5:3;f.showmiddlepoints=true;f.noscale=true;return f},onFeatureGeometryLoad:function(p){if(!p){alert("There was some errors returning geometry.");return}if(p.result==="no"){om.showError(p.msg);return}om.hideLoader();if(this.active_edit_gid){canvas.remove(this.active_edit_gid);this.active_edit_gid=null}var o=this.getDefaultGeometryStyle(p.geometry.substring(0,4));o.geom=p.geometry;var j=fnl.getLayerById(this.editsafeobj.lid);var l=j.styles;if(l.length>0){o.icon=fno.liveSite+"assets/icon.php?p="+l[0].url}gcapp.gctoolbar.setSelectableLayers(true);this.active_edit_gid=canvas.deserializeGeometryOpenGIS(o);canvas.editGeometry(this.active_edit_gid);gcapp.ribbonMenu.editsavebt.enable();gcapp.ribbonMenu.editcancelbt.enable();fnw.modifyObject("layer"+this.editsafeobj.lid+"||"+this.editsafeobj.fid,{visible:false},"",true)},getFeatureByID:function(f,g){if(!f.fid||!f.lid){return}f.module="geometry";f.task="getfeaturebyid";this.editFeatureCancel();this.active_edit_gid=null;this.editsafeobj=f;this.call(f,"getfeaturebyid",this.onFeatureGeometryLoad.bind(this))},objectClick:function(g){if(gcapp.ribbonMenu&&gcapp.ribbonMenu.editmodebt&&gcapp.ribbonMenu.editmodebt.isOn()){om.showLoader();var j=fnl.getLayerById(g.lid);var l=getSourceObject(j.source);if(l.type!=="pg"){alert("You can only edit database data sources");return}gcedit.getFeatureByID({fid:g.fid,lid:g.lid})}},editFeatureSave:function(b){this.updateFeature()},onUpdateFeature:function(b){if(!b){om.showError("There was an error.")}if(b.result==="yes"){om.showConfirm(b.msg);fnw.modifyObject("layer"+this.editsafeobj.lid+"||"+this.editsafeobj.fid,{visible:true},"",true);this.editsafeobj=null;this.editFeatureCancel();gcproject.showMap(true);gcapp.gclayer.loadLayerList(true)}else{om.showError(b.msg);gcapp.ribbonMenu.editsavebt.enable();gcapp.ribbonMenu.editcancelbt.enable()}},updateFeature:function(){var b={};b.module="geometry";b.task="updatefeature";b.geometry=canvas.serializeGeometryOpenGIS(this.active_edit_gid);b.fid=this.editsafeobj.fid;b.lid=this.editsafeobj.lid;gcapp.ribbonMenu.editsavebt.disable();gcapp.ribbonMenu.editcancelbt.disable();giscloud.log.push("feature_geom_update_save",{lid:b.lid,fid:b.fid});this.call(b,"updatefeature",this.onUpdateFeature.bind(this))},add:function(b){this.activegid=canvas.add(b)},addToSelectedLayer:function(){var b=fnl.getSelectedLayers(true);if(!b){alert("Please select layer for edit.");return}this.editFeatureCancel();giscloud.log.push("feature_add_mode",{lid:b.id,type:b.tip});switch(b.tip){case"point":this.activelayerdata=b;this.add("point");break;case"line":this.activelayerdata=b;this.add("line");break;case"polygon":this.activelayerdata=b;this.add("polygon");break;default:alert("Can not edit '"+b.tip+"' type of layer. Only point, line and polygon type.")}},stop:function(b){if(!b){gcapp.ribbonMenu.editmodebt.off(true)}if(this.activegid){canvas.endDraw({noEvent:true});this.removeActiveDrawing();if(this.layertableform){this.layertableform.close()}if(gcapp.gctoolbar.active==="add-point"){gcapp.gctoolbar.setTool("InfoTool")}}},removeActiveDrawing:function(){if(this.activegid){canvas.remove(this.activegid);this.activegid=this.activelayerdata=null}},onAddModeToggle:function(b){this.stop();if(b.toggle){fnw.setTool("add-point");jQuery("#flashcontent").addClass("gc-edit-cursor");this.addToSelectedLayer();gcapp.gctoolbar.setBehavior({panWithMiddle:true,selection:false,clearselection:false})}else{gcapp.gctoolbar.setTool("InfoTool")}},onEditModeToggle:function(b){this.editFeatureCancel();this.stop(true);gcapp.ribbonMenu.addfeaturebt.off(true);if(b.toggle){gcapp.gctoolbar.setSelectableLayers();fnw.setTool("editmode");jQuery("#flashcontent").addClass("gc-edit-cursor");giscloud.log.push("feature_edit_mode",{toggle:true});gcapp.gctoolbar.setBehavior({panWithMiddle:true,selection:true,clearselection:true})}else{giscloud.log.push("feature_edit_mode",{toggle:false});gcapp.gctoolbar.setTool("InfoTool")}},onToolChange:function(b){if(gcapp.ribbonMenu&&gcapp.ribbonMenu.editmodebt){gcapp.ribbonMenu.editmodebt.off(true)}},onLayerSelectionChange:function(g){var f=getSourceObject(g.layer.source);if(gcapp.gctoolbar.active==="add-point"&&selected&&this.layertableform&&selected.id!==this.layertableform.fdata.lid){this.stop()}if(f&&f.type==="pg"){this.enableEditButtons(true)}else{this.enableEditButtons(false)}},enableEditButtons:function(b){if(!$("EditToggle")){return}if(b){gcapp.ribbonMenu.editmodebt.enable();gcapp.ribbonMenu.addfeaturebt.enable()}else{gcapp.ribbonMenu.editmodebt.disable();gcapp.ribbonMenu.addfeaturebt.disable()}},test:function(b){},drawNewGeometry:function(b){canvas.editGeometry(b.id);b.color=16711680;b.width=3;if(b.gtype==="line"){b.gtype="linestring";canvas.setAttributeGeometry(b.id,"color",b.color);canvas.setAttributeGeometry(b.id,"width",b.width)}else{if(b.gtype==="point"){b.width=7;b.fillcolor=16711680;b.color=3355443;canvas.setAttributeGeometry(b.id,"icon",fno.liveSite+"assets/icon.php?p=/icons/defaulticon.png")}else{if(b.gtype==="polygon"){canvas.setAttributeGeometry(b.id,"alpha",70)}}}},onAddGeometry:function(b){if(gcapp.gctoolbar.active==="MeasureTool"){return}if(!gcapp.ribbonMenu.addfeaturebt.isOn()){return}this.drawNewGeometry(b);this.openLayerTable(b)},onClickGeometry:function(b){},onChangeGeometry:function(b){if(this.layertableform){clt.initGeometryFields()}},showEditorToolbar:function(){formManager.close("editortoolbarform");this.editortoolbarform=formManager.open({fid:"editortoolbarform",title:gclang.mainmenu.edit_toolbar,width:350,height:180,url:fno.liveSite+"modules_gc/layer/form-editor-toolbar.php",buttons:[{html:gclang.save,click:"clt.save();"},{html:gclang.cancel,click:"gcedit.editortoolbarform.close();"}]})},openLayerTable:function(l){if(this.activelayerdata&&this.activelayerdata.use_info_window==="t"){var g=giscloud.ui.map.mapId,j=this.activelayerdata.id;giscloud.ui.customForm.open({layerId:this.activelayerdata.id}).done(function(a){a.on({"submitStart.gc-custom-form":function(){giscloud.ui.customForm.disable()},"submitSuccess.gc-custom-form":function(){giscloud.ui.customForm.close();giscloud.layers.reset(g,[j])},"submitFailure.gc-custom-form":function(){giscloud.ui.customForm.enable();giscloud.ui.alert.show(":(",1000)}});a.trigger("setFeatureGeometry.gc-custom-form",[l.geom])});gcapp.ribbonMenu.addfeaturebt.off(false)}else{if(!this.layertableform){this.layertableform=formManager.open({overlay:false,dragable:true,fid:"layertableform",title:"Layer attribute data",width:450,height:480,url:fno.liveSite+"modules_gc/layer/formlayertable.php",data:{src:this.activelayerdata.source},buttons:[{html:"Save",click:"clt.save();","class":"bluebutton"},{html:"Cancel",click:"gcedit.layertableform.close();"}]});this.layertableform.fdata.lid=fnl.getSelectedLayers(true).id;this.layertableform.addEvent("close",this.onLayerTableFormClose.bind(this))}else{clt.reset()}}},onLayerTableFormClose:function(b){gcapp.ribbonMenu.addfeaturebt.off(false);this.layertableform=null},onSave:function(b){this.layertableform.enable();giscloud.log.push("feature_add_onsave",b);if(!b){om.showError("There was an error.");return}if(b.result==="yes"){if(clt.insertAnotherAfterSave()){this.removeActiveDrawing();gcapp.ribbonMenu.addfeaturebt.on()}else{this.layertableform.close()}om.showConfirm(b.msg);gcapp.gclayer.loadLayerList(true,function(){fn.showMap()});gcdatagrid.refresh()}else{om.showError(b.msg)}},save:function(g){if(!g){return}var f={};f.module="geometry";f.task="addfeature";f.data=g;f.lid=this.activelayerdata.id;f.geom=canvas.serializeGeometryOpenGIS(this.activegid);this.layertableform.disable(true);giscloud.log.push("feature_add",{lid:f.lid});this.call(f,"addfeature",this.onSave.bind(this))},editAttribute:function(l,p,o){if(!p){return}if(!gcapp.isEditable(l)){alert("You do not have enough permissions to edit this map.");return}var j={};j[p.attribute]=p.value;giscloud.features.update(p.lid,p.fid,{data:j}).done(function(a){giscloud.layers.reset(giscloud.ui.map.mapId,[p.lid]).done(function(){giscloud.ui.map.reloadMap();gcdatagrid.refresh()});if(o){o({result:"yes",msg:gclang.geom.updated})}}).fail(function(a,f,b){msg=a==404?"You do not have sufficient permissions to edit this resource":"There was an error in the value you entered";if(o){o({result:"no",msg:msg})}})}});var gcToolbar=new Class({Implements:[Events,Options],options:{container:null,edit:true,printURL:fno.liveSite+"map/print",printParams:null,elements:["pan","zoom","viewall","select","info","coordinatetool","selectarea","measure","print","coordinates","scale","crop"]},initialize:function(g,f){this.setOptions(this.options,f);this.container=$(g);this.tools={};this.draw();this.active=null},draw:function(){if(this.container){var l=new Element("div",{});l.addClass("toolbar");l.inject(this.container);var j=new Element("div",{});j.addClass("toolbar_inner");j.inject(l);this.ul=new Element("ul",{});this.ul.inject(j);if(!fno.mobilephone){if(this.container&&this.options.elements.contains("scale")){this.scale=new Element("div",{id:"scale"});this.scale.addClass("scale");this.scale.inject(j)}if(this.container&&this.options.elements.contains("coordinates")){this.cordcheck=new Element("div",{id:"toolbar_cord_picker",title:gclang.Change_units_projection});this.cordcheck.addClass("gc-icon gc-pointer gc-grid");this.cordcheck.inject(j);this.coordinates=new Element("div",{html:"<div id='coordinatesnum' title='"+gclang.tools.coordinates_hint+"' >0, 0</div>"});this.coordinates.addClass("coordinates");this.coordinates.inject(j)}}this.numselfeatures=new Element("div",{});this.numselfeatures.addClass("numselfeatures");this.numselfeatures.inject(j)}if(this.container&&flashnavigator.html5Enabled&&this.options.elements.contains("html5")){var g;if(flashnavigator.html5Compatible){if(flashnavigator.html5){g=""}else{g="Legacy rendering."}}else{g="Your browser doesn't support HTML5. Please consider upgrading to a modern browser."}if(!fno.mobilephone&&gcapp.options.mochaui){this.html5check=new Element("div",{title:gclang.tools.html5_toggle_hint,title:g});this.html5check.addClass("html5_check tool-html5");this.html5check.inject(gcapp.mappanel.panelHeaderContentEl);if(flashnavigator.html5&&flashnavigator.html5Compatible){this.onHover(this.html5check)}}}if(!fno.mobilebrowser){if(this.options.elements.contains("pan")){this.add({tool:"DragTool",target:"DragTool",title:gclang.tools.pan,className:"tool-pan",panWithMiddle:false,active:false,selection:false,clearselection:true})}if(this.options.elements.contains("zoom")){this.add({tool:"SelectAreaTool",target:"SelectAreaTool",title:gclang.tools.zoom,className:"tool-zoom",panWithMiddle:true,selection:false,clearselection:true})}}if(this.options.elements.contains("viewall")){this.add({tool:"viewall",title:gclang.tools.viewall,className:"tool-extent",target:"viewallbutton"})}if(this.options.elements.contains("info")){this.add({tool:"InfoTool",target:"InfoTool",title:gclang.tools.info,className:"tool-info",panWithMiddle:true,active:true,selection:true,clearselection:true})}if(!fno.mobilebrowser){if(this.options.elements.contains("select")){this.add("separator");this.add({tool:"SelectTool",target:"SelectTool",title:gclang.tools.select,className:"tool-select",panWithMiddle:true,selection:true,clearselection:false})}if(this.options.elements.contains("selectarea")){this.add({tool:"AreaSelection",target:"AreaSelection",title:gclang.tools.areaselection,className:"tool-areaselection",panWithMiddle:true,selection:false,clearselection:false})}if(this.options.elements.contains("print")){if(!(user&&user.options&&user.options.TOOLBAR_NO_PRINT)){this.add("separator");this.add({tool:"print",title:gclang.tools.print,className:"tool-print",target:"printtool",selection:false})}}}this.add("separator");if(this.options.elements.contains("coordinatetool")){this.add({tool:"CoordinateTool",target:"CoordinateTool",title:gclang.Coordinate_Tool,className:"coordinate-tool",panWithMiddle:true,selection:false,clearselection:true})}if(!fno.mobilebrowser){if(this.options.elements.contains("measure")){this.add({tool:"MeasureTool",target:"measuretool",title:gclang.tools.measure,className:"tool-measure",selection:false,panWithMiddle:true})}}if(this.options.elements.contains("crop")){this.add({tool:"crop",invisible:true,panWithMiddle:true,selection:false,clearselection:true})}},add:function(l){if(this.container&&!l.invisible){var p=new Element("div");var o=new Element("li");o.inject(this.ul);p.inject(o);if(typeOf(l)=="string"&&l=="separator"){o.addClass("separator");return}var r=l.target?l.target:l.tool;o.set("id",r);o.set("title",l&&l.title||"");if(l.className){p.addClass("gc-icon12");p.addClass(l.className)}if(l.onclick){o.addEvent("click",l.onclick)}var u=o;u.addEvent("mouseover",this.onToolMouseOver.bindWithEvent(this,l));u.addEvent("mouseout",this.onToolMouseOut.bindWithEvent(this,l));u.addEvent("click",this.onToolClick.bindWithEvent(this,l))}this.tools[l.tool]=l;if(l.active){this.setTool(l.tool)}},setSelectionInfo:function(b){if(!this.numselfeatures){return}this.numselfeatures.set("html",b)},setTool:function(o,j){var p=this.tools[o];if(!p){return}var l=(this.active==o)||o=="InfoTool";this.resetActive();this.onToolMouseOver(p,p);this.onToolClick(p,p,j,l)},hideTool:function(j){if(j=="coordinates"){}else{var g=this.tools[j];var l=$(g.target)}l.hide()},showTool:function(j){if(j=="coordinates"){}else{var g=this.tools[j];var l=$(g.target)}l.show()},isToolActive:function(f){var g=this.tools[f];return(g&&g.toggle&&g.target.hasClass("toggle"))},onToolMouseOver:function(j,g){if(g.invisible){return}var l=$(g.target);this.onHover(l)},onToolMouseOut:function(l,j,p){if(j.invisible){return}var o=$(l.target);if(this.active!=j.tool&&(!j.toggle||!o.hasClass("toggle"))||p){this.onLeave(o)}},onToolClick:function(u,r,l,o){if(!r.invisible){var p=$(u.target);if(r.toggle){if(l==null||l==undefined){p.toggleClass("toggle")}else{if(l){p.addClass("toggle")}else{p.removeClass("toggle")}}}}if(!o){giscloud.log.push("tool_set",{tool:r.tool,toggle:r.toggle,on:l})}this.resetActive();if(this.specialTools(r)){this.setTool("InfoTool");this.fireEvent("toolchange",{tool:r.tool});return false}if(r.invisible){this.setTool("InfoTool");this.fireEvent("toolchange",{tool:r.tool});return false}this.onToolMouseOver(r,r,true);this.active=(r.toggle&&!p.hasClass("toggle"))?null:r.tool;if(fnm.isVisible()&&this.active){this.setBehavior(r);$(r.target).addClass("active");fnw.setTool(this.active)}this.fireEvent("toolchange",{tool:this.active});return false},specialTools:function(u,B){if(!u){return}var F=$(u.target);switch(u.tool){case"AreaSelection":var H=fnl.getSelectedLayers(true);if(!H){alert("Please select layer first.");return true}if(!B&&H.lock=="t"){alert("The currently selected layer is locked.");return true}if(!B&&H.visible!="t"){alert("The currently selected layer is not visible.");return true}break;case"editorToolbar":gcedit.showEditorToolbar();return true;break;case"viewall":fnw.setViewBoundAnim();return true;break;case"MeasureTool":return false;case"print":this.print();return true;break;case"editmode":gcedit.editFeatureCancel();if(B){}else{this.resetActive();this.onToolMouseOver(u,u,true);this.setBehavior(u);this.setSelectableLayers();this.active="editmode";fnw.setTool("editmode")}return true;break;case"add-point":gcedit.stop();if(B){}else{this.resetActive();this.onToolMouseOver(u,u,true);this.setBehavior(u);this.active="add-point";fnw.setTool("add-point");gcedit.addToSelectedLayer()}return true;break;case"crop":this.resetActive();om.showConfirm("<b>Click and drag</b> to select an area to crop.<br/>Once done, click inside the selected area to proceed.");fnw.setTool("AreaSelection");this.active=u.tool;this.setBehavior(u);break;case"InfoTool":case"SelectTool":var E=fnl.getLayers();for(var D=0;D<E.length;D++){var z=E[D];var G=(z.grp!=null)?"layer_group_"+z.grp:"layer"+z.id;var C=fnw.getLayerByName(G);if(!C){continue}if(z.lock=="t"){C.setSelectable(false)}else{C.setSelectable(true)}}break;case"CoordinateTool":formManager.close("coordinatetoolwin");if(!B){gcapp.coordinatetoolwin=formManager.open({fid:"coordinatetoolwin",minimize:true,dragable:true,title:gclang.Coordinate_Tool,width:340,height:215,url:fno.liveSite+"toolbox/coordinatetool/form"})}break}return false},print:function(){if(fnw){var b=fnw.getViewBound(),l=this.options.printURL,j={b:b.xMin+","+b.yMin+","+b.xMax+","+b.yMax,mid:currentMapID};j=Object.merge(j,typeof this.options.printParams=="function"?this.options.printParams():this.options.printParams);l+="?"+Hash.toQueryString(j);window.open(l,"print","height=600,width=800,modal=yes,alwaysRaised=yes")}},resetActive:function(){if(this.active){var b=this.tools[this.active];if(!b.toggle&&!b.invisible){this.onToolMouseOut(b,b,true);this.specialTools(b,true);this.active=null;$(b.target).removeClass("active")}}},setBehavior:function(b){if(fnm.isVisible()){if(b.panWithMiddle){fnw.enablePanWithMiddleButton()}else{fnw.disablePanWithMiddleButton()}if(b.selection){fnw.enableSelection()}else{fnw.disableSelection()}if(b.clearselection&&gcapp.selo){gcapp.selo.clearSelection()}}},setSelectableLayers:function(r){var u=fnl.getLayers();for(var o=0;o<u.length;o++){var z=u[o];var B=(z.grp!=null)?"layer_group_"+z.grp:"layer"+z.id;var p=fnw.getLayerByName(B);if(!p){continue}if(z.lock=="t"||r){p.setSelectable(false)}else{p.setSelectable(true)}}},registerExternalTool:function(b){if(!b||!b.target){return}b.target.addEvent("mouseover",this.onToolMouseOver.bindWithEvent(this,b));b.target.addEvent("mouseout",this.onExternalToolMouseOut.bindWithEvent(this,b));b.target.addEvent("click",this.onExternalToolClick.bindWithEvent(this,b))},onExternalToolMouseOut:function(j,g){var l=$(j.target);if(!g.toggle||!l.hasClass("toggle")){this.onLeave(l)}},onExternalToolClick:function(j,g){var l=$(j.target);if(g.toggle){l.toggleClass("toggle")}if(g.onclick){g.onclick(j)}},onHover:function(b){if(!b){return}if(b.get("tag")=="div"){b=b.getParent()}b.addClass("hover")},onLeave:function(b){if(!b){return}if(b.get("tag")=="div"){b=b.getParent()}b.removeClass("hover")},onPrintClick:function(b){}});var activeTool=null;function toolClick(g,j){if(activeTool==j){return}if(activeTool){if(Browser.Engine.trident){}else{var l=$(activeTool).getStyle("background-position").split(" ")}}fnw.setTool(g);activeTool=j}function setToolEvents(g,l,j){if(j&&!l.onclick){l.onclick=function(){toolClick(g,l)}}l.onmouseout=function(){if(activeTool!=l&&!l.hasClass("toggle")){if(Browser.Engine.trident){}else{var a=$(l).getStyle("background-position").split(" ")}}}}function toolOver(j,p,l){if(!p.onclick||p.id=="activeTool"){p.id=j;setToolEvents(j,p,l)}if(Browser.Engine.trident){p.style.backgroundPositionX="-16px"}else{var o=$(p).getStyle("background-position").split(" ");p.style.backgroundPosition="-16px "+o[1]}}!function(Y){function au(aB,aA){return function(aC){return Z(aB.call(this,aC),aA)}}function R(aB,aA){return function(aC){return this.lang().ordinal(aB.call(this,aC),aA)}}function W(){}function ay(aA){aS(this,aA)}function V(aB){var aD=aB.years||aB.year||aB.y||0,aF=aB.months||aB.month||aB.M||0,aA=aB.weeks||aB.week||aB.w||0,aE=aB.days||aB.day||aB.d||0,aI=aB.hours||aB.hour||aB.h||0,aC=aB.minutes||aB.minute||aB.m||0,aG=aB.seconds||aB.second||aB.s||0,aH=aB.milliseconds||aB.millisecond||aB.ms||0;this._input=aB,this._milliseconds=aH+1000*aG+60000*aC+3600000*aI,this._days=aE+7*aA,this._months=aF+12*aD,this._data={},this._bubble()}function aS(aB,aA){for(var aC in aA){aA.hasOwnProperty(aC)&&(aB[aC]=aA[aC])}return aB}function S(aA){return 0>aA?Math.ceil(aA):Math.floor(aA)}function Z(aB,aA){for(var aC=aB+"";aC.length<aA;){aC="0"+aC}return aC}function ax(aB,aD,aF,aA){var aE,aI,aC=aD._milliseconds,aG=aD._days,aH=aD._months;aC&&aB._d.setTime(+aB._d+aC*aF),(aG||aH)&&(aE=aB.minute(),aI=aB.hour()),aG&&aB.date(aB.date()+aG*aF),aH&&aB.month(aB.month()+aH*aF),aC&&!aA&&g.updateOffset(aB),(aG||aH)&&(aB.minute(aE),aB.hour(aI))}function at(aA){return"[object Array]"===Object.prototype.toString.call(aA)}function ar(aA,aD){var aC,aF=Math.min(aA.length,aD.length),aB=Math.abs(aA.length-aD.length),aE=0;for(aC=0;aF>aC;aC++){~~aA[aC]!==~~aD[aC]&&aE++}return aE+aB}function av(aA){return aA?ai[aA]||aA.toLowerCase().replace(/(.)s$/,"$1"):aA}function P(aB,aA){return aA.abbr=aB,ad[aB]||(ad[aB]=new W),ad[aB].set(aA),ad[aB]}function aR(aB){if(!aB){return g.fn._lang}if(!ad[aB]&&al){try{require("./lang/"+aB)}catch(aA){return g.fn._lang}}return ad[aB]}function Q(aA){return aA.match(/\[.*\]/)?aA.replace(/^\[|\]$/g,""):aA.replace(/\\/g,"")}function af(aB){var aD,aC,aA=aB.match(a);for(aD=0,aC=aA.length;aC>aD;aD++){aA[aD]=ab[aA[aD]]?ab[aA[aD]]:Q(aA[aD])}return function(aF){var aE="";for(aD=0;aC>aD;aD++){aE+=aA[aD] instanceof Function?aA[aD].call(aF,aB):aA[aD]}return aE}}function r(aB,aD){function aC(aE){return aB.lang().longDateFormat(aE)||aE}for(var aA=5;aA--&&u.test(aD);){aD=aD.replace(u,aC)}return ae[aD]||(ae[aD]=af(aD)),ae[aD](aB)}function aw(aB,aA){switch(aB){case"DDDD":return H;case"YYYY":return K;case"YYYYY":return aj;case"S":case"SS":case"SSS":case"DDD":return j;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return D;case"a":case"A":return aR(aA._l)._meridiemParse;case"X":return am;case"Z":case"ZZ":return az;case"T":return U;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return l;default:return new RegExp(aB.replace("\\",""))}}function T(aB){var aD=(az.exec(aB)||[])[0],aC=(aD+"").match(aT)||["-",0,0],aA=+(60*aC[1])+~~aC[2];return"+"===aC[0]?-aA:aA}function ao(aA,aD,aC){var aE,aB=aC._a;switch(aA){case"M":case"MM":aB[1]=null==aD?0:~~aD-1;break;case"MMM":case"MMMM":aE=aR(aC._l).monthsParse(aD),null!=aE?aB[1]=aE:aC._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=aD&&(aB[2]=~~aD);break;case"YY":aB[0]=~~aD+(~~aD>68?1900:2000);break;case"YYYY":case"YYYYY":aB[0]=~~aD;break;case"a":case"A":aC._isPm=aR(aC._l).isPM(aD);break;case"H":case"HH":case"h":case"hh":aB[3]=~~aD;break;case"m":case"mm":aB[4]=~~aD;break;case"s":case"ss":aB[5]=~~aD;break;case"S":case"SS":case"SSS":aB[6]=~~(1000*("0."+aD));break;case"X":aC._d=new Date(1000*parseFloat(aD));break;case"Z":case"ZZ":aC._useUTC=!0,aC._tzm=T(aD)}null==aD&&(aC._isValid=!1)}function M(aB){var aD,aC,aA=[];if(!aB._d){for(aD=0;7>aD;aD++){aB._a[aD]=aA[aD]=null==aB._a[aD]?2===aD?1:0:aB._a[aD]}aA[3]+=~~((aB._tzm||0)/60),aA[4]+=~~((aB._tzm||0)%60),aC=new Date(0),aB._useUTC?(aC.setUTCFullYear(aA[0],aA[1],aA[2]),aC.setUTCHours(aA[3],aA[4],aA[5],aA[6])):(aC.setFullYear(aA[0],aA[1],aA[2]),aC.setHours(aA[3],aA[4],aA[5],aA[6])),aB._d=aC}}function ac(aA){var aD,aC,aE=aA._f.match(a),aB=aA._i;for(aA._a=[],aD=0;aD<aE.length;aD++){aC=(aw(aE[aD],aA).exec(aB)||[])[0],aC&&(aB=aB.slice(aB.indexOf(aC)+aC.length)),ab[aE[aD]]&&ao(aE[aD],aC,aA)}aB&&(aA._il=aB),aA._isPm&&aA._a[3]<12&&(aA._a[3]+=12),aA._isPm===!1&&12===aA._a[3]&&(aA._a[3]=0),M(aA)}function aQ(aA){var aD,aG,aF,aE,aC,aB=99;for(aE=0;aE<aA._f.length;aE++){aD=aS({},aA),aD._f=aA._f[aE],ac(aD),aG=new ay(aD),aC=ar(aD._a,aG.toArray()),aG._il&&(aC+=aG._il.length),aB>aC&&(aB=aC,aF=aG)}aS(aA,aF)}function aa(aB){var aD,aC=aB._i,aA=o.exec(aC);if(aA){for(aB._f="YYYY-MM-DD"+(aA[2]||" "),aD=0;4>aD;aD++){if(J[aD][1].exec(aC)){aB._f+=J[aD][0];break}}az.exec(aC)&&(aB._f+=" Z"),ac(aB)}else{aB._d=new Date(aC)}}function F(aA){var aC=aA._i,aB=f.exec(aC);aC===Y?aA._d=new Date:aB?aA._d=new Date(+aB[1]):"string"==typeof aC?aa(aA):at(aC)?(aA._a=aC.slice(0),M(aA)):aA._d=aC instanceof Date?new Date(+aC):new Date(aC)}function aq(aA,aD,aC,aE,aB){return aB.relativeTime(aD||1,!!aC,aA,aE)}function E(aB,aD,aF){var aA=I(Math.abs(aB)/1000),aE=I(aA/60),aI=I(aE/60),aC=I(aI/24),aG=I(aC/365),aH=45>aA&&["s",aA]||1===aE&&["m"]||45>aE&&["mm",aE]||1===aI&&["h"]||22>aI&&["hh",aI]||1===aC&&["d"]||25>=aC&&["dd",aC]||45>=aC&&["M"]||345>aC&&["MM",I(aC/30)]||1===aG&&["y"]||["yy",aG];return aH[2]=aD,aH[3]=aB>0,aH[4]=aF,aq.apply({},aH)}function b(aA,aD,aC){var aF,aB=aC-aD,aE=aC-aA.day();return aE>aB&&(aE-=7),aB-7>aE&&(aE+=7),aF=g(aA).add("d",aE),{week:Math.ceil(aF.dayOfYear()/7),year:aF.year()}}function z(aB){var aA=aB._i,aC=aB._f;return null===aA||""===aA?null:("string"==typeof aA&&(aB._i=aA=aR().preparse(aA)),g.isMoment(aA)?(aB=aS({},aA),aB._d=new Date(+aA._d)):aC?at(aC)?aQ(aB):ac(aB):F(aB),new ay(aB))}function ag(aB,aA){g.fn[aB]=g.fn[aB+"s"]=function(aD){var aC=this._isUTC?"UTC":"";return null!=aD?(this._d["set"+aC+aA](aD),g.updateOffset(this),this):this._d["get"+aC+aA]()}}function an(aA){g.duration.fn[aA]=function(){return this._data[aA]}}function p(aB,aA){g.duration.fn["as"+aB]=function(){return +this/aA}}for(var g,B,G="2.1.0",I=Math.round,ad={},al="undefined"!=typeof module&&module.exports,f=/^\/?Date\((\-?\d+)/i,N=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,a=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,u=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,l=/\d\d?/,j=/\d{1,3}/,H=/\d{3}/,K=/\d{1,4}/,aj=/[+\-]?\d{1,6}/,D=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,az=/Z|[\+\-]\d\d:?\d\d/i,U=/T/i,am=/[\+\-]?\d+(\.\d{1,3})?/,o=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,C="YYYY-MM-DDTHH:mm:ssZ",J=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],aT=/([\+\-]|\d\d)/gi,O="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),ak={Milliseconds:1,Seconds:1000,Minutes:60000,Hours:3600000,Days:86400000,Months:2592000000,Years:31536000000},ai={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",y:"year"},ae={},ap="DDD w W M D d".split(" "),ah="M D H h m s w W".split(" "),ab={M:function(){return this.month()+1},MMM:function(aA){return this.lang().monthsShort(this,aA)},MMMM:function(aA){return this.lang().months(this,aA)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(aA){return this.lang().weekdaysMin(this,aA)},ddd:function(aA){return this.lang().weekdaysShort(this,aA)},dddd:function(aA){return this.lang().weekdays(this,aA)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return Z(this.year()%100,2)},YYYY:function(){return Z(this.year(),4)},YYYYY:function(){return Z(this.year(),5)},gg:function(){return Z(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return Z(this.weekYear(),5)},GG:function(){return Z(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return Z(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return ~~(this.milliseconds()/100)},SS:function(){return Z(~~(this.milliseconds()/10),2)},SSS:function(){return Z(this.milliseconds(),3)},Z:function(){var aB=-this.zone(),aA="+";return 0>aB&&(aB=-aB,aA="-"),aA+Z(~~(aB/60),2)+":"+Z(~~aB%60,2)},ZZ:function(){var aB=-this.zone(),aA="+";return 0>aB&&(aB=-aB,aA="-"),aA+Z(~~(10*aB/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};ap.length;){B=ap.pop(),ab[B+"o"]=R(ab[B],B)}for(;ah.length;){B=ah.pop(),ab[B+B]=au(ab[B],2)}for(ab.DDDD=au(ab.DDD,3),W.prototype={set:function(aB){var aA,aC;for(aC in aB){aA=aB[aC],"function"==typeof aA?this[aC]=aA:this["_"+aC]=aA}},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(aA){return this._months[aA.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(aA){return this._monthsShort[aA.month()]},monthsParse:function(aB){var aD,aC,aA;for(this._monthsParse||(this._monthsParse=[]),aD=0;12>aD;aD++){if(this._monthsParse[aD]||(aC=g([2000,aD]),aA="^"+this.months(aC,"")+"|^"+this.monthsShort(aC,""),this._monthsParse[aD]=new RegExp(aA.replace(".",""),"i")),this._monthsParse[aD].test(aB)){return aD}}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(aA){return this._weekdays[aA.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(aA){return this._weekdaysShort[aA.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(aA){return this._weekdaysMin[aA.day()]},weekdaysParse:function(aB){var aD,aC,aA;for(this._weekdaysParse||(this._weekdaysParse=[]),aD=0;7>aD;aD++){if(this._weekdaysParse[aD]||(aC=g([2000,1]).day(aD),aA="^"+this.weekdays(aC,"")+"|^"+this.weekdaysShort(aC,"")+"|^"+this.weekdaysMin(aC,""),this._weekdaysParse[aD]=new RegExp(aA.replace(".",""),"i")),this._weekdaysParse[aD].test(aB)){return aD}}},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(aB){var aA=this._longDateFormat[aB];return !aA&&this._longDateFormat[aB.toUpperCase()]&&(aA=this._longDateFormat[aB.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(aC){return aC.slice(1)}),this._longDateFormat[aB]=aA),aA},isPM:function(aA){return"p"===(aA+"").toLowerCase()[0]},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(aB,aA,aC){return aB>11?aC?"pm":"PM":aC?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(aB,aA){var aC=this._calendar[aB];return"function"==typeof aC?aC.apply(aA):aC},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(aA,aD,aC,aE){var aB=this._relativeTime[aC];return"function"==typeof aB?aB(aA,aD,aC,aE):aB.replace(/%d/i,aA)},pastFuture:function(aB,aA){var aC=this._relativeTime[aB>0?"future":"past"];return"function"==typeof aC?aC(aA):aC.replace(/%s/i,aA)},ordinal:function(aA){return this._ordinal.replace("%d",aA)},_ordinal:"%d",preparse:function(aA){return aA},postformat:function(aA){return aA},week:function(aA){return b(aA,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}},g=function(aB,aA,aC){return z({_i:aB,_f:aA,_l:aC,_isUTC:!1})},g.utc=function(aB,aA,aC){return z({_useUTC:!0,_isUTC:!0,_l:aC,_i:aB,_f:aA})},g.unix=function(aA){return g(1000*aA)},g.duration=function(aC,aG){var aH,aB,aE=g.isDuration(aC),aA="number"==typeof aC,aD=aE?aC._input:aA?{}:aC,aF=N.exec(aC);return aA?aG?aD[aG]=aC:aD.milliseconds=aC:aF&&(aH="-"===aF[1]?-1:1,aD={y:0,d:~~aF[2]*aH,h:~~aF[3]*aH,m:~~aF[4]*aH,s:~~aF[5]*aH,ms:~~aF[6]*aH}),aB=new V(aD),aE&&aC.hasOwnProperty("_lang")&&(aB._lang=aC._lang),aB},g.version=G,g.defaultFormat=C,g.updateOffset=function(){},g.lang=function(aB,aA){return aB?(aA?P(aB,aA):ad[aB]||aR(aB),g.duration.fn._lang=g.fn._lang=aR(aB),void 0):g.fn._lang._abbr},g.langData=function(aA){return aA&&aA._lang&&aA._lang._abbr&&(aA=aA._lang._abbr),aR(aA)},g.isMoment=function(aA){return aA instanceof ay},g.isDuration=function(aA){return aA instanceof V},g.fn=ay.prototype={clone:function(){return g(this)},valueOf:function(){return +this._d+60000*(this._offset||0)},unix:function(){return Math.floor(+this/1000)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return r(g(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var aA=this;return[aA.year(),aA.month(),aA.date(),aA.hours(),aA.minutes(),aA.seconds(),aA.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!ar(this._a,(this._isUTC?g.utc(this._a):g(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(aB){var aA=r(this,aB||g.defaultFormat);return this.lang().postformat(aA)},add:function(aB,aA){var aC;return aC="string"==typeof aB?g.duration(+aA,aB):g.duration(aB,aA),ax(this,aC,1),this},subtract:function(aB,aA){var aC;return aC="string"==typeof aB?g.duration(+aA,aB):g.duration(aB,aA),ax(this,aC,-1),this},diff:function(aD,aG,aF){var aC,aE,aB=this._isUTC?g(aD).zone(this._offset||0):g(aD).local(),aA=60000*(this.zone()-aB.zone());return aG=av(aG),"year"===aG||"month"===aG?(aC=43200000*(this.daysInMonth()+aB.daysInMonth()),aE=12*(this.year()-aB.year())+(this.month()-aB.month()),aE+=(this-g(this).startOf("month")-(aB-g(aB).startOf("month")))/aC,aE-=60000*(this.zone()-g(this).startOf("month").zone()-(aB.zone()-g(aB).startOf("month").zone()))/aC,"year"===aG&&(aE/=12)):(aC=this-aB,aE="second"===aG?aC/1000:"minute"===aG?aC/60000:"hour"===aG?aC/3600000:"day"===aG?(aC-aA)/86400000:"week"===aG?(aC-aA)/604800000:aC),aF?aE:S(aE)},from:function(aB,aA){return g.duration(this.diff(aB)).lang(this.lang()._abbr).humanize(!aA)},fromNow:function(aA){return this.from(g(),aA)},calendar:function(){var aB=this.diff(g().startOf("day"),"days",!0),aA=-6>aB?"sameElse":-1>aB?"lastWeek":0>aB?"lastDay":1>aB?"sameDay":2>aB?"nextDay":7>aB?"nextWeek":"sameElse";return this.format(this.lang().calendar(aA,this))},isLeapYear:function(){var aA=this.year();return 0===aA%4&&0!==aA%100||0===aA%400},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(aB){var aA=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=aB?"string"==typeof aB&&(aB=this.lang().weekdaysParse(aB),"number"!=typeof aB)?this:this.add({d:aB-aA}):aA},month:function(aB){var aA,aC=this._isUTC?"UTC":"";return null!=aB?"string"==typeof aB&&(aB=this.lang().monthsParse(aB),"number"!=typeof aB)?this:(aA=this.date(),this.date(1),this._d["set"+aC+"Month"](aB),this.date(Math.min(aA,this.daysInMonth())),g.updateOffset(this),this):this._d["get"+aC+"Month"]()},startOf:function(aA){switch(aA=av(aA)){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===aA&&this.weekday(0),this},endOf:function(aA){return this.startOf(aA).add(aA,1).subtract("ms",1)},isAfter:function(aB,aA){return aA="undefined"!=typeof aA?aA:"millisecond",+this.clone().startOf(aA)>+g(aB).startOf(aA)},isBefore:function(aB,aA){return aA="undefined"!=typeof aA?aA:"millisecond",+this.clone().startOf(aA)<+g(aB).startOf(aA)},isSame:function(aB,aA){return aA="undefined"!=typeof aA?aA:"millisecond",+this.clone().startOf(aA)===+g(aB).startOf(aA)},min:function(aA){return aA=g.apply(null,arguments),this>aA?this:aA},max:function(aA){return aA=g.apply(null,arguments),aA>this?this:aA},zone:function(aB){var aA=this._offset||0;return null==aB?this._isUTC?aA:this._d.getTimezoneOffset():("string"==typeof aB&&(aB=T(aB)),Math.abs(aB)<16&&(aB=60*aB),this._offset=aB,this._isUTC=!0,aA!==aB&&ax(this,g.duration(aA-aB,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},daysInMonth:function(){return g.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(aB){var aA=I((g(this).startOf("day")-g(this).startOf("year"))/86400000)+1;return null==aB?aA:this.add("d",aB-aA)},weekYear:function(aB){var aA=b(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==aB?aA:this.add("y",aB-aA)},isoWeekYear:function(aB){var aA=b(this,1,4).year;return null==aB?aA:this.add("y",aB-aA)},week:function(aB){var aA=this.lang().week(this);return null==aB?aA:this.add("d",7*(aB-aA))},isoWeek:function(aB){var aA=b(this,1,4).week;return null==aB?aA:this.add("d",7*(aB-aA))},weekday:function(aB){var aA=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==aB?aA:this.add("d",aB-aA)},isoWeekday:function(aA){return null==aA?this.day()||7:this.day(this.day()%7?aA:aA-7)},lang:function(aA){return aA===Y?this._lang:(this._lang=aR(aA),this)}},B=0;B<O.length;B++){ag(O[B].toLowerCase().replace(/s$/,""),O[B])}ag("year","FullYear"),g.fn.days=g.fn.day,g.fn.months=g.fn.month,g.fn.weeks=g.fn.week,g.fn.isoWeeks=g.fn.isoWeek,g.fn.toJSON=g.fn.toISOString,g.duration.fn=V.prototype={_bubble:function(){var aC,aF,aH,aB,aD=this._milliseconds,aG=this._days,aA=this._months,aE=this._data;aE.milliseconds=aD%1000,aC=S(aD/1000),aE.seconds=aC%60,aF=S(aC/60),aE.minutes=aF%60,aH=S(aF/60),aE.hours=aH%24,aG+=S(aH/24),aE.days=aG%30,aA+=S(aG/30),aE.months=aA%12,aB=S(aA/12),aE.years=aB},weeks:function(){return S(this.days()/7)},valueOf:function(){return this._milliseconds+86400000*this._days+2592000000*(this._months%12)+31536000000*~~(this._months/12)},humanize:function(aB){var aA=+this,aC=E(aA,!aB,this.lang());return aB&&(aC=this.lang().pastFuture(aA,aC)),this.lang().postformat(aC)},add:function(aB,aA){var aC=g.duration(aB,aA);return this._milliseconds+=aC._milliseconds,this._days+=aC._days,this._months+=aC._months,this._bubble(),this},subtract:function(aB,aA){var aC=g.duration(aB,aA);return this._milliseconds-=aC._milliseconds,this._days-=aC._days,this._months-=aC._months,this._bubble(),this},get:function(aA){return aA=av(aA),this[aA.toLowerCase()+"s"]()},as:function(aA){return aA=av(aA),this["as"+aA.charAt(0).toUpperCase()+aA.slice(1)+"s"]()},lang:g.fn.lang};for(B in ak){ak.hasOwnProperty(B)&&(p(B,ak[B]),an(B.toLowerCase()))}p("Weeks",604800000),g.duration.fn.asMonths=function(){return(+this-31536000000*this.years())/2592000000+12*this.years()},g.lang("en",{ordinal:function(aB){var aA=aB%10,aC=1===~~(aB%100/10)?"th":1===aA?"st":2===aA?"nd":3===aA?"rd":"th";return aB+aC}}),al&&(module.exports=g),"undefined"==typeof ender&&(this.moment=g),"function"==typeof define&&define.amd&&define("moment",[],function(){return g})}.call(this);var jg_ok,jg_ie,jg_fast,jg_dom,jg_moz;function _chkDHTM(g,f){g=document.body||null;jg_ie=g&&typeof g.insertAdjacentHTML!="undefined"&&document.createElement;jg_dom=(g&&!jg_ie&&typeof g.appendChild!="undefined"&&typeof document.createRange!="undefined"&&typeof(f=document.createRange()).setStartBefore!="undefined"&&typeof f.createContextualFragment!="undefined");jg_fast=jg_ie&&document.all&&!window.opera;jg_moz=jg_dom&&typeof g.style.MozOpacity!="undefined";jg_ok=!!(jg_ie||jg_dom)}function _pntCnvDom(){var b=this.wnd.document.createRange();b.setStartBefore(this.cnv);b=b.createContextualFragment(jg_fast?this._htmRpc():this.htm);if(this.cnv){this.cnv.appendChild(b)}this.htm=""}function _pntCnvIe(){if(this.cnv){this.cnv.insertAdjacentHTML("BeforeEnd",jg_fast?this._htmRpc():this.htm)}this.htm=""}function _pntDoc(){this.wnd.document.write(jg_fast?this._htmRpc():this.htm);this.htm=""}function _pntN(){}function _mkDiv(l,o,j,p){this.htm+='<div style="position:absolute;left:'+l+"px;top:"+o+"px;width:"+j+"px;height:"+p+"px;clip:rect(0,"+j+"px,"+p+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}function _mkDivIe(l,o,j,p){this.htm+="%%"+this.color+";"+l+";"+o+";"+j+";"+p+";"}function _mkDivPrt(l,o,j,p){this.htm+='<div style="position:absolute;border-left:'+j+"px solid "+this.color+";left:"+l+"px;top:"+o+"px;width:0px;height:"+p+"px;clip:rect(0,"+j+"px,"+p+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}var _regex=/%%([^;]+);([^;]+);([^;]+);([^;]+);([^;]+);/g;function _htmRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2;top:$3;width:$4;height:$5"></div>\n')}function _htmPrtRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2;top:$3;width:$4;height:$5;border-left:$4px solid $1"></div>\n')}function _mkLin(N,H,R,J){if(N>R){var Q=R;var K=J;R=N;J=H;N=Q;H=K}var U=R-N,V=Math.abs(J-H),I=N,T=H,W=(H>J)?-1:1;if(U>=V){var S=V<<1,p=S-(U<<1),O=S-U,M=I;while(U>0){--U;++I;if(O>0){this._mkDiv(M,T,I-M,1);T+=W;O+=p;M=I}else{O+=S}}this._mkDiv(M,T,R-M+1,1)}else{var S=U<<1,p=S-(V<<1),O=S-V,P=T;if(J<=H){while(V>0){--V;if(O>0){this._mkDiv(I++,T,1,P-T+1);T+=W;O+=p;P=T}else{T+=W;O+=S}}this._mkDiv(R,J,1,P-J+1)}else{while(V>0){--V;T+=W;if(O>0){this._mkDiv(I++,P,1,T-P);O+=p;P=T}else{O+=S}}this._mkDiv(R,P,1,J-P+1)}}}function _mkLin2D(N,ac,O,ad){if(N>O){var Y=O;var R=ad;O=N;ad=ac;N=Y;ac=R}var p=O-N,Q=Math.abs(ad-ac),U=N,W=ac,S=(ac>ad)?-1:1;var V=this.stroke;if(p>=Q){if(p>0&&V-3>0){var M=(V*p*Math.sqrt(1+Q*Q/(p*p))-p-(V>>1)*Q)/p;M=(!(V-4)?Math.ceil(M):Math.round(M))+1}else{var M=V}var K=Math.ceil(V/2);var P=Q<<1,Z=P-(p<<1),T=P-p,aa=U;while(p>0){--p;++U;if(T>0){this._mkDiv(aa,W,U-aa+K,M);W+=S;T+=Z;aa=U}else{T+=P}}this._mkDiv(aa,W,O-aa+K+1,M)}else{if(V-3>0){var M=(V*Q*Math.sqrt(1+p*p/(Q*Q))-(V>>1)*p-Q)/Q;M=(!(V-4)?Math.ceil(M):Math.round(M))+1}else{var M=V}var K=Math.round(V/2);var P=p<<1,Z=P-(Q<<1),T=P-Q,ab=W;if(ad<=ac){++K;while(Q>0){--Q;if(T>0){this._mkDiv(U++,W,M,ab-W+K);W+=S;T+=Z;ab=W}else{W+=S;T+=P}}this._mkDiv(O,ad,M,ab-ad+K)}else{while(Q>0){--Q;W+=S;if(T>0){this._mkDiv(U++,ab,M,W-ab+K);T+=Z;ab=W}else{T+=P}}this._mkDiv(O,ab,M,ad-ab+K+1)}}}function _mkLinDott(N,I,Q,S){if(N>Q){var G=Q;var M=S;Q=N;S=I;N=G;I=M}var T=Q-N,U=Math.abs(S-I),P=N,J=I,p=(I>S)?-1:1,H=true;if(T>=U){var R=U<<1,K=R-(T<<1),O=R-T;while(T>0){--T;if(H){this._mkDiv(P,J,1,1)}H=!H;if(O>0){J+=p;O+=K}else{O+=R}++P}}else{var R=T<<1,K=R-(U<<1),O=R-U;while(U>0){--U;if(H){this._mkDiv(P,J,1,1)}H=!H;J+=p;if(O>0){++P;O+=K}else{O+=R}}}if(H){this._mkDiv(P,J,1,1)}}function _mkOv(af,W,S,U){var a=(++S)>>1,b=(++U)>>1,aa=S&1,ag=U&1,ah=af+a,ai=W+b,R=0,Y=b,ac=0,ae=b,T=(a*a)<<1,V=T<<1,Z=(b*b)<<1,ab=Z<<1,Q=(T>>1)*(1-(b<<1))+Z,aj=(Z>>1)-T*((b<<1)-1),ad,P;while(Y>0){if(Q<0){Q+=Z*((R<<1)+3);aj+=ab*(++R)}else{if(aj<0){Q+=Z*((R<<1)+3)-V*(Y-1);aj+=ab*(++R)-T*(((Y--)<<1)-3);ad=R-ac;P=ae-Y;if((ad&2)&&(P&2)){this._mkOvQds(ah,ai,R-2,Y+2,1,1,aa,ag);this._mkOvQds(ah,ai,R-1,Y+1,1,1,aa,ag)}else{this._mkOvQds(ah,ai,R-1,ae,ad,P,aa,ag)}ac=R;ae=Y}else{aj-=T*((Y<<1)-3);Q-=V*(--Y)}}}ad=a-ac+1;P=(ae<<1)+ag;Y=ai-ae;this._mkDiv(ah-a,Y,ad,P);this._mkDiv(ah+ac+aa-1,Y,ad,P)}function _mkOv2D(aQ,aN,aU,aT){var l=this.stroke;aU+=l+1;aT+=l+1;var az=aU>>1,aD=aT>>1,aF=aU&1,ap=aT&1,aE=aQ+az,aG=aN+aD,ak=0,an=aD,at=(az*az)<<1,av=at<<1,aO=(aD*aD)<<1,aR=aO<<1,aK=(at>>1)*(1-(aD<<1))+aO,aH=(aO>>1)-at*((aD<<1)-1);if(l-4<0&&(!(l-2)||aU-51>0&&aT-51>0)){var ay=0,aA=aD,aj,aL,ar;while(an>0){if(aK<0){aK+=aO*((ak<<1)+3);aH+=aR*(++ak)}else{if(aH<0){aK+=aO*((ak<<1)+3)-av*(an-1);aH+=aR*(++ak)-at*(((an--)<<1)-3);aj=ak-ay;aL=aA-an;if(aj-1){ar=aj+1+(l&1);aL=l}else{if(aL-1){ar=l;aL+=1+(l&1)}else{ar=aL=l}}this._mkOvQds(aE,aG,ak-1,aA,ar,aL,aF,ap);ay=ak;aA=an}else{aH-=at*((an<<1)-3);aK-=av*(--an)}}}this._mkDiv(aE-az,aG-aA,l,(aA<<1)+ap);this._mkDiv(aE+az+aF-l,aG-aA,l,(aA<<1)+ap)}else{var ax=(aU-(l<<1))>>1,aC=(aT-(l<<1))>>1,am=0,ao=aC,au=(ax*ax)<<1,aw=au<<1,aP=(aC*aC)<<1,aS=aP<<1,aI=(au>>1)*(1-(aC<<1))+aP,aJ=(aP>>1)-au*((aC<<1)-1),al=new Array(),aq=new Array(),b=new Array();al[0]=0;aq[0]=aD;b[0]=aC-1;while(an>0){if(aK<0){al[al.length]=ak;aq[aq.length]=an;aK+=aO*((ak<<1)+3);aH+=aR*(++ak)}else{if(aH<0){al[al.length]=ak;aK+=aO*((ak<<1)+3)-av*(an-1);aH+=aR*(++ak)-at*(((an--)<<1)-3);aq[aq.length]=an}else{aH-=at*((an<<1)-3);aK-=av*(--an)}}if(ao>0){if(aI<0){aI+=aP*((am<<1)+3);aJ+=aS*(++am);b[b.length]=ao-1}else{if(aJ<0){aI+=aP*((am<<1)+3)-aw*(ao-1);aJ+=aS*(++am)-au*(((ao--)<<1)-3);b[b.length]=ao-1}else{aJ-=au*((ao<<1)-3);aI-=aw*(--ao);b[b.length-1]--}}}}var ay=-aF,aA=aD,aB=b[0],a=al.length,aj,aL;for(var aM=0;aM<a;aM++){if(typeof b[aM]!="undefined"){if(b[aM]<aB||aq[aM]<aA){ak=al[aM];this._mkOvQds(aE,aG,ak,aA,ak-ay,aA-aB,aF,ap);ay=ak;aA=aq[aM];aB=b[aM]}}else{ak=al[aM];this._mkDiv(aE-ak,aG-aA,1,(aA<<1)+ap);this._mkDiv(aE+ay+aF,aG-aA,1,(aA<<1)+ap);ay=ak;aA=aq[aM]}}this._mkDiv(aE-az,aG-aA,1,(aA<<1)+ap);this._mkDiv(aE+ay+aF,aG-aA,1,(aA<<1)+ap)}}function _mkOvDott(ab,V,P,R){var a=(++P)>>1,b=(++R)>>1,Z=P&1,ac=R&1,T=ac^1,ad=ab+a,ae=V+b,Y=0,aa=b,Q=(a*a)<<1,U=Q<<1,W=(b*b)<<1,N=W<<1,O=(Q>>1)*(1-(b<<1))+W,af=(W>>1)-Q*((b<<1)-1),S=true;while(aa>0){if(O<0){O+=W*((Y<<1)+3);af+=N*(++Y)}else{if(af<0){O+=W*((Y<<1)+3)-U*(aa-1);af+=N*(++Y)-Q*(((aa--)<<1)-3)}else{af-=Q*((aa<<1)-3);O-=U*(--aa)}}if(S&&aa>=T){this._mkOvQds(ad,ae,Y,aa,1,1,Z,ac)}S=!S}}function _mkRect(o,p,l,r){var u=this.stroke;this._mkDiv(o,p,l,u);this._mkDiv(o+l,p,u,r);this._mkDiv(o,p+r,l+u,u);this._mkDiv(o,p+u,u,r-u)}function _mkRectDott(l,o,j,p){this.drawLine(l,o,l+j,o);this.drawLine(l+j,o,l+j,o+p);this.drawLine(l,o+p,l+j,o+p);this.drawLine(l,o,l,o+p)}function jsgFont(){this.PLAIN="font-weight:normal;";this.BOLD="font-weight:bold;";this.ITALIC="font-style:italic;";this.ITALIC_BOLD=this.ITALIC+this.BOLD;this.BOLD_ITALIC=this.ITALIC_BOLD}var Font=new jsgFont();function jsgStroke(){this.DOTTED=-1}var Stroke=new jsgStroke();function jsGraphics(g,f){this.setColor=function(a){this.color=a.toLowerCase()};this.setStroke=function(a){this.stroke=a;if(!(a+1)){this.drawLine=_mkLinDott;this._mkOv=_mkOvDott;this.drawRect=_mkRectDott}else{if(a-1>0){this.drawLine=_mkLin2D;this._mkOv=_mkOv2D;this.drawRect=_mkRect}else{this.drawLine=_mkLin;this._mkOv=_mkOv;this.drawRect=_mkRect}}};this.setPrintable=function(a){this.printable=a;if(jg_fast){this._mkDiv=_mkDivIe;this._htmRpc=a?_htmPrtRpc:_htmRpc}else{this._mkDiv=a?_mkDivPrt:_mkDiv}};this.setFont=function(b,a,l){this.ftFam=b;this.ftSz=a;this.ftSty=l||Font.PLAIN};this.drawPolyline=this.drawPolyLine=function(l,a){for(var b=l.length-1;b;){--b;this.drawLine(l[b],a[b],l[b+1],a[b+1])}};this.fillRect=function(p,a,o,b){this._mkDiv(p,a,o,b)};this.drawPolygon=function(b,a){this.drawPolyline(b,a);this.drawLine(b[b.length-1],a[b.length-1],b[0],a[0])};this.drawEllipse=this.drawOval=function(p,a,o,b){this._mkOv(p,a,o,b)};this.fillEllipse=this.fillOval=function(af,V,ad,Q){var a=ad>>1,b=Q>>1,ab=ad&1,ag=Q&1,ah=af+a,ai=V+b,Y=0,ac=b,ae=b,T=(a*a)<<1,U=T<<1,Z=(b*b)<<1,R=Z<<1,S=(T>>1)*(1-(b<<1))+Z,aj=(Z>>1)-T*((b<<1)-1),W,aa,P;if(ad){while(ac>0){if(S<0){S+=Z*((Y<<1)+3);aj+=R*(++Y)}else{if(aj<0){S+=Z*((Y<<1)+3)-U*(ac-1);W=ah-Y;aa=(Y<<1)+ab;aj+=R*(++Y)-T*(((ac--)<<1)-3);P=ae-ac;this._mkDiv(W,ai-ae,aa,P);this._mkDiv(W,ai+ac+ag,aa,P);ae=ac}else{aj-=T*((ac<<1)-3);S-=U*(--ac)}}}}this._mkDiv(ah-a,ai-ae,ad,(ae<<1)+ag)};this.fillArc=function(aw,a,aa,aq,av,af){var b=aa>>1,W=aq>>1,ak=(aa&1)|((aq&1)<<16),au=aw+b,ax=a+W,an=0,ap=W,ag=an,am=ap,ae=(b*b)<<1,ah=ae<<1,aj=(W*W)<<1,al=aj<<1,ac=(ae>>1)*(1-(W<<1))+aj,ay=(aj>>1)-ae*((W<<1)-1),ab,ao,ar,Y,Z=(1<<(Math.floor((av%=360)/180)<<3))|(2<<(Math.floor((af%=360)/180)<<3))|((av>=af)<<16),at=new Array(W+1),ad=new Array(W+1);av*=Math.PI/180;af*=Math.PI/180;ab=au+Math.round(b*Math.cos(av));ao=ax+Math.round(-W*Math.sin(av));_mkLinVirt(at,au,ax,ab,ao);ar=au+Math.round(b*Math.cos(af));Y=ax+Math.round(-W*Math.sin(af));_mkLinVirt(ad,au,ax,ar,Y);while(ap>0){if(ac<0){ac+=aj*((an<<1)+3);ay+=al*(++an)}else{if(ay<0){ac+=aj*((an<<1)+3)-ah*(ap-1);ag=an;ay+=al*(++an)-ae*(((ap--)<<1)-3);this._mkArcDiv(ag,ap,am,au,ax,ak,at,ad,Z);am=ap}else{ay-=ae*((ap<<1)-3);ac-=ah*(--ap);if(ap&&(at[ap]!=at[ap-1]||ad[ap]!=ad[ap-1])){this._mkArcDiv(an,ap,am,au,ax,ak,at,ad,Z);ag=an;am=ap}}}}this._mkArcDiv(an,0,am,au,ax,ak,at,ad,Z);if(ak>>16){if(Z>>16){var ai=(ao<=ax||Y>ax)?(au-an):au;this._mkDiv(ai,ax,an+au-ai+(ak&65535),1)}else{if((Z&1)&&Y>ax){this._mkDiv(au-an,ax,an,1)}}}};this.fillPolygon=function(b,J){var S;var U;var R,H;var O,T;var P,a;var I,Q;var N;var M=b.length;if(!M){return}R=J[0];H=J[0];for(S=1;S<M;S++){if(J[S]<R){R=J[S]}if(J[S]>H){H=J[S]}}for(U=R;U<=H;U++){var K=new Array();N=0;for(S=0;S<M;S++){if(!S){I=M-1;Q=0}else{I=S-1;Q=S}T=J[I];a=J[Q];if(T<a){O=b[I];P=b[Q]}else{if(T>a){a=J[I];T=J[Q];P=b[I];O=b[Q]}else{continue}}if((U>=T)&&(U<a)){K[N++]=Math.round((U-T)*(P-O)/(a-T)+O)}else{if((U==H)&&(U>T)&&(U<=a)){K[N++]=Math.round((U-T)*(P-O)/(a-T)+O)}}}K.sort(_CompInt);for(S=0;S<N;S+=2){this._mkDiv(K[S],U,K[S+1]-K[S]+1,1)}}};this.drawString=function(b,l,a){this.htm+='<div style="position:absolute;white-space:nowrap;left:'+l+"px;top:"+a+"px;font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+b+"</div>"};this.drawStringRect=function(p,r,u,b,a){this.htm+='<div style="position:absolute;overflow:hidden;left:'+r+"px;top:"+u+"px;width:"+b+"px;text-align:"+a+";font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+p+"</div>"};this.drawImage=function(B,u,z,b,a,r){this.htm+='<div style="position:absolute;left:'+u+"px;top:"+z+"px;"+(b?("width:"+b+"px;"):"")+(a?("height:"+a+"px;"):"")+'"><img src="'+B+'"'+(b?(' width="'+b+'"'):"")+(a?(' height="'+a+'"'):"")+(r?(" "+r):"")+"></div>"};this.clear=function(){this.htm="";if(this.cnv){this.cnv.innerHTML=""}};this._mkOvQds=function(J,K,N,O,G,I,a,b){var H=J-N,M=J+N+a-G,E=K-O,F=K+O+b-I;if(M>H+G){this._mkDiv(M,E,G,I);this._mkDiv(M,F,G,I)}else{G=M-H+G}this._mkDiv(H,E,G,I);this._mkDiv(H,F,G,I)};this._mkArcDiv=function(U,b,O,J,K,N,I,Q,S){var P=J+U+(N&65535),H,a=O-b,R,M,T;if(!a){a=1}U=J-U;if(S&16711680){H=K-b-a;if(S&255){if(S&2){R=Math.max(U,Q[b]);T=P-R;if(T>0){this._mkDiv(R,H,T,a)}}if(S&1){M=Math.min(P,I[b]);T=M-U;if(T>0){this._mkDiv(U,H,T,a)}}}else{this._mkDiv(U,H,P-U,a)}H=K+b+(N>>16);if(S&65280){if(S&256){R=Math.max(U,I[b]);T=P-R;if(T>0){this._mkDiv(R,H,T,a)}}if(S&512){M=Math.min(P,Q[b]);T=M-U;if(T>0){this._mkDiv(U,H,T,a)}}}else{this._mkDiv(U,H,P-U,a)}}else{if(S&255){if(S&2){R=Math.max(U,Q[b])}else{R=U}if(S&1){M=Math.min(P,I[b])}else{M=P}H=K-b-a;T=M-R;if(T>0){this._mkDiv(R,H,T,a)}}if(S&65280){if(S&256){R=Math.max(U,I[b])}else{R=U}if(S&512){M=Math.min(P,Q[b])}else{M=P}H=K+b+(N>>16);T=M-R;if(T>0){this._mkDiv(R,H,T,a)}}}};this.setStroke(1);this.setFont("verdana,geneva,helvetica,sans-serif","12px",Font.PLAIN);this.color="#000000";this.htm="";this.wnd=f||window;if(!jg_ok){_chkDHTM()}if(jg_ok){if(g){if(typeof(g)=="string"){this.cont=document.all?(this.wnd.document.all[g]||null):document.getElementById?(this.wnd.document.getElementById(g)||null):null}else{if(g==window.document){this.cont=document.getElementsByTagName("body")[0]}else{this.cont=g}}this.cnv=this.wnd.document.createElement("div");this.cnv.style.fontSize=0;this.cont.appendChild(this.cnv);this.paint=jg_dom?_pntCnvDom:_pntCnvIe}else{this.paint=_pntDoc}}else{this.paint=_pntN}this.setPrintable(false)}function _mkLinVirt(H,N,J,P,Q){var U=Math.abs(P-N),V=Math.abs(Q-J),I=N,T=J,S=(N>P)?-1:1,W=(J>Q)?-1:1,O,M=0;if(U>=V){var R=V<<1,p=R-(U<<1);O=R-U;while(U>0){--U;if(O>0){H[M++]=I;T+=W;O+=p}else{O+=R}I+=S}}else{var R=U<<1,p=R-(V<<1);O=R-V;while(V>0){--V;T+=W;H[M++]=I;if(O>0){I+=S;O+=p}else{O+=R}}}for(var K=H.length,M=K-M;M;){H[K-(M--)]=I}}function _CompInt(g,f){return(g-f)}var MooRainbow=new Class({Implements:[Options,Events],options:{id:"mooRainbow",prefix:"moor-",imgPath:"images/",startColor:[255,0,0],wheel:false,onComplete:Class.empty,onChange:Class.empty,onCancel:Class.empty,overlay:false,selectText:"Select color"},initialize:function(f,g){this.element=$(f);if(!this.element){return}this.setOptions(g);this.sliderPos=0;this.pickerPos={x:0,y:0};this.backupColor=this.options.startColor;this.currentColor=this.options.startColor;this.sets={rgb:[],hsb:[],hex:[]};this.pickerClick=this.sliderClick=false;if(!this.layout){this.doLayout()}this.OverlayEvents();this.sliderEvents();this.backupEvent();if(this.options.wheel){this.wheelEvents()}this.element.addEvent("click",function(a){this.toggle(a)}.bind(this));this.layout.overlay.setStyle("background-color",this.options.startColor.rgbToHex());this.layout.backup.setStyle("background-color",this.backupColor.rgbToHex());this.pickerPos.x=this.snippet("curPos").l+this.snippet("curSize","int").w;this.pickerPos.y=this.snippet("curPos").t+this.snippet("curSize","int").h;this.manualSet(this.options.startColor);this.pickerPos.x=this.snippet("curPos").l+this.snippet("curSize","int").w;this.pickerPos.y=this.snippet("curPos").t+this.snippet("curSize","int").h;this.sliderPos=this.snippet("arrPos")-this.snippet("arrSize","int");if(Browser.chrome||Browser.safari){this.hide()}document.addEvent("keyup",this.onEscapeRelease.bind(this))},toggle:function(){this[this.visible?"hide":"show"]()},show:function(){this.rePosition();if(document.all&&this.iframe&&iframeshimCollection){iframeshimCollection.erase(this.iframe);iframeshimCollection.push(this.iframe)}this.layout.setStyle("display","block");this.visible=true;if(document.__moo_bow_instance&&document.__moo_bow_instance.hide){document.__moo_bow_instance.hide()}document.__moo_bow_instance=this;if(this.options.overlay){this.color_overlay=new ModalOverlay({zIndex:500503,element:"color_overlay"})}},hide:function(){this.layout.setStyles({display:"none"});this.visible=false;if(document.all&&this.iframe&&iframeshimCollection){iframeshimCollection.erase(this.iframe)}document.__moo_bow_instance=null;if(this.color_overlay){this.color_overlay.dispose()}},manualSet:function(l,r){if(!r||(r!="hsb"&&r!="hex")){r="rgb"}var u,o,p;if(r=="rgb"){u=l;o=l.rgbToHsb();p=l.rgbToHex()}else{if(r=="hsb"){o=l;u=l.hsbToRgb();p=u.rgbToHex()}else{p=l;u=l.hexToRgb(true);o=u.rgbToHsb()}}this.setMooRainbow(u);this.autoSet(o)},autoSet:function(M){var K=this.snippet("curSize","int").h;var N=this.snippet("curSize","int").w;var J=this.layout.overlay.height;var C=this.layout.overlay.width;var O=this.layout.slider.height;var E=this.snippet("arrSize","int");var H;var D=Math.round(((C*M[1])/100)-N);var G=Math.round(-((J*M[2])/100)+J-K);var F=Math.round(((O*M[0])/360));F=(F==360)?0:F;var I=O-F+this.snippet("slider")-E;H=[this.sets.hsb[0],100,100].hsbToRgb().rgbToHex();this.layout.cursor.setStyles({top:G,left:D});this.layout.arrows.setStyle("top",I);this.layout.overlay.setStyle("background-color",H);this.sliderPos=this.snippet("arrPos")-E;this.pickerPos.x=this.snippet("curPos").l+N;this.pickerPos.y=this.snippet("curPos").t+K},setMooRainbow:function(l,r){if(!r||(r!="hsb"&&r!="hex")){r="rgb"}var u,o,p;if(r=="rgb"){u=l;o=l.rgbToHsb();p=l.rgbToHex()}else{if(r=="hsb"){o=l;u=l.hsbToRgb();p=u.rgbToHex()}else{p=l;u=l.hexToRgb();o=u.rgbToHsb()}}this.sets={rgb:u,hsb:o,hex:p};if(!$chk(this.pickerPos.x)){this.autoSet(o)}this.RedInput.value=u[0];this.GreenInput.value=u[1];this.BlueInput.value=u[2];this.HueInput.value=o[0];this.SatuInput.value=o[1];this.BrighInput.value=o[2];this.hexInput.value=p;this.currentColor=u;this.chooseColor.setStyle("background-color",u.rgbToHex())},parseColors:function(z,B,p){var r=Math.round((z*100)/this.layout.overlay.width);var b=100-Math.round((B*100)/this.layout.overlay.height);var u=360-Math.round((p*360)/this.layout.slider.height)+this.snippet("slider")-this.snippet("arrSize","int");u-=this.snippet("arrSize","int");u=(u>=360)?0:(u<0)?0:u;r=(r>100)?100:(r<0)?0:r;b=(b>100)?100:(b<0)?0:b;return[u,r,b]},onEscapeRelease:function(b){if(b.key=="esc"&&this.visible){this.hide();this.fireEvent("onCancel",[this])}},OverlayEvents:function(){var H,z,I,D;z=this.snippet("curSize","int").h;I=this.snippet("curSize","int").w;D=Array.from(this.arrRGB).concat(this.arrHSB,this.hexInput);var F=function(){if(this.visible){this.hide(this.layout);this.fireEvent("onCancel",[this])}};var G=F.bind(this);document.addEvent("click",G);D.each(function(a){if(a){a.addEvent("keydown",this.eventKeydown.bindWithEvent(this,a));a.addEvent("keyup",this.eventKeyup.bindWithEvent(this,a))}},this);[this.element,this.layout].each(function(a){a.addEvents({click:function(b){new Event(b).stop()},keyup:function(b){b=new Event(b);if(b.key=="esc"&&this.visible){this.hide(this.layout);this.fireEvent("onCancel",[this])}}.bind(this)},this)},this);H={x:[0-I,(this.layout.overlay.width-I)],y:[0-z,(this.layout.overlay.height-z)]};this.layout.drag=new Drag(this.layout.cursor,{limit:H,onStart:this.overlayDrag.bind(this),onDrag:this.overlayDrag.bind(this),snap:0});var C=function(a){a=new Event(a);this.layout.cursor.setStyles({top:a.page.y-this.layout.overlay.getPosition().y-z,left:a.page.x-this.layout.overlay.getPosition().x-I});this.overlayDrag();this.layout.drag.start(a)};var E=C.bind(this);this.layout.overlay2.addEvent("mousedown",E);var J=function(){if(this.currentColor==this.options.startColor){this.hide();this.fireEvent("onComplete",[this.sets,this])}else{this.backupColor=this.currentColor;this.layout.backup.setStyle("background-color",this.backupColor.rgbToHex());this.hide();this.fireEvent("onComplete",[this.sets,this])}};var B=J.bind(this);this.okButton.removeEvent("click",B);this.okButton.addEvent("click",B)},overlayDrag:function(){var f=this.snippet("curSize","int").h;var g=this.snippet("curSize","int").w;this.pickerPos.x=this.snippet("curPos").l+g;this.pickerPos.y=this.snippet("curPos").t+f;this.setMooRainbow(this.parseColors(this.pickerPos.x,this.pickerPos.y,this.sliderPos),"hsb");this.fireEvent("onChange",[this.sets,this])},sliderEvents:function(){var g=this.snippet("arrSize","int"),f;f=[0+this.snippet("slider")-g,this.layout.slider.height-g+this.snippet("slider")];this.layout.sliderDrag=new Drag(this.layout.arrows,{limit:{y:f},modifiers:{x:false},onStart:this.sliderDrag.bind(this),onDrag:this.sliderDrag.bind(this),snap:0});this.layout.slider.addEvent("mousedown",function(a){a=new Event(a);this.layout.arrows.setStyle("top",a.page.y-this.layout.slider.getPosition().y+this.snippet("slider")-g);this.sliderDrag();this.layout.sliderDrag.start(a)}.bind(this))},sliderDrag:function(){var g=this.snippet("arrSize","int"),f;this.sliderPos=this.snippet("arrPos")-g;this.setMooRainbow(this.parseColors(this.pickerPos.x,this.pickerPos.y,this.sliderPos),"hsb");f=[this.sets.hsb[0],100,100].hsbToRgb().rgbToHex();this.layout.overlay.setStyle("background-color",f);this.fireEvent("onChange",[this.sets,this])},backupEvent:function(){this.layout.backup.addEvent("click",function(){this.manualSet(this.backupColor);this.fireEvent("onChange",[this.sets,this])}.bind(this))},wheelEvents:function(){var b=Array.from(this.arrRGB).extend(this.arrHSB);b.each(function(a){a.addEvents({mousewheel:this.eventKeys.bindWithEvent(this,a),keydown:this.eventKeys.bindWithEvent(this,a)})},this);[this.layout.arrows,this.layout.slider].each(function(a){a.addEvents({mousewheel:this.eventKeys.bindWithEvent(this,[this.arrHSB[0],"slider"]),keydown:this.eventKeys.bindWithEvent(this,[this.arrHSB[0],"slider"])})},this)},eventKeys:function(E,H,I){var D,C;I=(!I)?H.id:this.arrHSB[0];if(E.type=="keydown"){if(E.key=="up"){D=1}else{if(E.key=="down"){D=-1}else{return}}}else{if(E.type==Element.Events.mousewheel.base){D=(E.wheel>0)?1:-1}}if(this.arrRGB.contains(H)){C="rgb"}else{if(this.arrHSB.contains(H)){C="hsb"}else{C="hsb"}}if(C=="rgb"){var B=this.sets.rgb,G=this.sets.hsb,F=this.options.prefix,J;var z=(H.value.toInt()||0)+D;z=(z>255)?255:(z<0)?0:z;switch(H.className){case F+"rInput":J=[z,B[1],B[2]];break;case F+"gInput":J=[B[0],z,B[2]];break;case F+"bInput":J=[B[0],B[1],z];break;default:J=B}this.manualSet(J);this.fireEvent("onChange",[this.sets,this])}else{var B=this.sets.rgb,G=this.sets.hsb,F=this.options.prefix,J;var z=(H.value.toInt()||0)+D;if(H.className.test(/(HueInput)/)){z=(z>359)?0:(z<0)?0:z}else{z=(z>100)?100:(z<0)?0:z}switch(H.className){case F+"HueInput":J=[z,G[1],G[2]];break;case F+"SatuInput":J=[G[0],z,G[2]];break;case F+"BrighInput":J=[G[0],G[1],z];break;default:J=G}this.manualSet(J,"hsb");this.fireEvent("onChange",[this.sets,this])}E.stop()},eventKeydown:function(p,j){var o=p.code,l=p.key;if((!j.className.test(/hexInput/)&&!(o>=48&&o<=57))&&(l!="backspace"&&l!="tab"&&l!="delete"&&l!="left"&&l!="right")){p.stop()}},eventKeyup:function(u,C){var D=u.code,r=u.key,B,z,p=C.value.charAt(0);if(!$chk(C.value)){return}if(C.className.test(/hexInput/)){if(p!="#"&&C.value.length!=6){return}if(p=="#"&&C.value.length!=7){return}}else{if(!(D>=48&&D<=57)&&(!["backspace","tab","delete","left","right"].contains(r))&&C.value.length>3){return}}z=this.options.prefix;if(C.className.test(/(rInput|gInput|bInput)/)){if(C.value<0||C.value>255){return}switch(C.className){case z+"rInput":B=[C.value,this.sets.rgb[1],this.sets.rgb[2]];break;case z+"gInput":B=[this.sets.rgb[0],C.value,this.sets.rgb[2]];break;case z+"bInput":B=[this.sets.rgb[0],this.sets.rgb[1],C.value];break;default:B=this.sets.rgb}this.manualSet(B);this.fireEvent("onChange",[this.sets,this])}else{if(!C.className.test(/hexInput/)){if(C.className.test(/HueInput/)&&C.value<0||C.value>360){return}else{if(C.className.test(/HueInput/)&&C.value==360){C.value=0}else{if(C.className.test(/(SatuInput|BrighInput)/)&&C.value<0||C.value>100){return}}}switch(C.className){case z+"HueInput":B=[C.value,this.sets.hsb[1],this.sets.hsb[2]];break;case z+"SatuInput":B=[this.sets.hsb[0],C.value,this.sets.hsb[2]];break;case z+"BrighInput":B=[this.sets.hsb[0],this.sets.hsb[1],C.value];break;default:B=this.sets.hsb}this.manualSet(B,"hsb");this.fireEvent("onChange",[this.sets,this])}else{B=C.value.hexToRgb(true);if(isNaN(B[0])||isNaN(B[1])||isNaN(B[2])){return}if($chk(B)){this.manualSet(B);this.fireEvent("onChange",[this.sets,this])}}}},doLayout:function(){var ad=this.options.id,W=this.options.prefix;var aq=ad+" ."+W;this.layout=document.getElementById(ad);if(this.layout){if(document.all&&this.iframe&&iframeshimCollection){iframeshimCollection.erase(this.iframe);this.iframe.dispose();this.iframe=null}this.layout.dispose()}this.layout=new Element("div",{styles:{display:"block",position:"absolute",zIndex:501499},id:ad}).inject(document.body);if(!this.iframe){w=h="100%";this.iframe=new Element("iframe",{marginwidth:0,marginheight:0,frameBorder:0,style:"position:absolute;z-index:0;left:0px;top:0px;width:"+w+";height:"+h+";filter:alpha(opacity=0);"});this.iframe.inject(this.layout);if(document.all&&iframeshimCollection){iframeshimCollection.push(this.iframe)}}var aj=new Element("div",{styles:{position:"relative",zIndex:501499},"class":W+"box"}).inject(this.layout);var ah=new Element("div",{styles:{position:"absolute",overflow:"hidden"},"class":W+"overlayBox"}).inject(aj);var ag=new Element("div",{styles:{position:"absolute",zIndex:1},"class":W+"arrows"}).inject(aj);ag.width=ag.getStyle("width").toInt();ag.height=ag.getStyle("height").toInt();var am=new Element("img",{styles:{"background-color":"#fff",position:"relative",zIndex:2},src:this.options.imgPath+"moor_woverlay.png","class":W+"overlay"}).inject(ah);var ai=new Element("img",{styles:{position:"absolute",top:0,left:0,zIndex:2},src:this.options.imgPath+"moor_boverlay.png","class":W+"overlay"}).inject(ah);if(Browser.ie6){ah.setStyle("overflow","");var al=am.src;am.src=this.options.imgPath+"blank.gif";am.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+al+"', sizingMethod='scale')";al=ai.src;ai.src=this.options.imgPath+"blank.gif";ai.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+al+"', sizingMethod='scale')"}am.width=ai.width=ah.getStyle("width").toInt();am.height=ai.height=ah.getStyle("height").toInt();var an=new Element("div",{styles:{overflow:"hidden",position:"absolute",zIndex:2},"class":W+"cursor"}).inject(ah);an.width=an.getStyle("width").toInt();an.height=an.getStyle("height").toInt();var U=new Element("img",{styles:{position:"absolute","z-index":2},src:this.options.imgPath+"moor_slider.png","class":W+"slider"}).inject(aj);this.layout.slider=document.getElement("#"+aq+"slider");U.width=U.getStyle("width").toInt();U.height=U.getStyle("height").toInt();new Element("div",{styles:{position:"absolute"},"class":W+"colorBox"}).inject(aj);new Element("div",{styles:{zIndex:2,position:"absolute"},"class":W+"chooseColor"}).inject(aj);this.layout.backup=new Element("div",{styles:{zIndex:2,position:"absolute",cursor:"pointer"},"class":W+"currentColor"}).inject(aj);var ao=new Element("label").inject(aj).setStyle("position","absolute");var af=ao.clone().inject(aj).addClass(W+"gLabel").set("html","G: ");var ae=ao.clone().inject(aj).addClass(W+"bLabel").set("html","B: ");ao.set("html","R: ").addClass(W+"rLabel");var G=new Element("input");var ar=G.clone().inject(af).addClass(W+"gInput");var ap=G.clone().inject(ae).addClass(W+"bInput");G.inject(ao).addClass(W+"rInput");var aa=new Element("label").inject(aj).setStyle("position","absolute");var R=aa.clone().inject(aj).addClass(W+"SatuLabel").set("html","S: ");var Y=aa.clone().inject(aj).addClass(W+"BrighLabel").set("html","B: ");aa.set("html","H: ").addClass(W+"HueLabel");var ac=new Element("input");var V=ac.clone().inject(R).addClass(W+"SatuInput");var ab=ac.clone().inject(Y).addClass(W+"BrighInput");ac.inject(aa).addClass(W+"HueInput");R.innerHTML+=" %";Y.innerHTML+=" %";SP=new Element("span",{styles:{position:"absolute"},"class":W+"ballino"});SP.innerHTML=" &deg;";SP.inject(aa,"after");var ak=new Element("label").inject(aj).setStyle("position","absolute").addClass(W+"hexLabel").set("html","#hex: ").adopt(new Element("input").addClass(W+"hexInput"));var Z=new Element("a",{styles:{position:"absolute"},html:MooRainbowLANG.select?MooRainbowLANG.select:this.options.selectText,"class":W+"okButton"}).addClass("bluebutton").inject(aj);this.rePosition();var B=$$("#"+aq+"overlay");this.layout.overlay=B[0];this.layout.overlay2=B[1];this.layout.cursor=document.getElement("#"+aq+"cursor");this.layout.arrows=document.getElement("#"+aq+"arrows");this.chooseColor=document.getElement("#"+aq+"chooseColor");this.layout.backup=document.getElement("#"+aq+"currentColor");this.RedInput=document.getElement("#"+aq+"rInput");this.GreenInput=document.getElement("#"+aq+"gInput");this.BlueInput=document.getElement("#"+aq+"bInput");this.HueInput=document.getElement("#"+aq+"HueInput");this.SatuInput=document.getElement("#"+aq+"SatuInput");this.BrighInput=document.getElement("#"+aq+"BrighInput");this.hexInput=document.getElement("#"+aq+"hexInput");this.arrRGB=[this.RedInput,this.GreenInput,this.BlueInput];this.arrHSB=[this.HueInput,this.SatuInput,this.BrighInput];this.okButton=document.getElement("#"+aq+"okButton");if(!(Browser.chrome||Browser.safari)){this.hide()}},rePosition:function(){var b=this.element.getCoordinates();this.layout.setStyles({left:b.left,top:b.top+1})},snippet:function(C,D){var z;D=(D)?D:"none";switch(C){case"arrPos":var B=this.layout.arrows.getStyle("top").toInt();z=B;break;case"arrSize":var u=this.layout.arrows.height;u=(D=="int")?(u/2).toInt():u;z=u;break;case"curPos":var l=this.layout.cursor.getStyle("left").toInt();var B=this.layout.cursor.getStyle("top").toInt();z={l:l,t:B};break;case"slider":var B=this.layout.slider.getStyle("marginTop").toInt();z=B;break;default:var u=this.layout.cursor.height;var r=this.layout.cursor.width;u=(D=="int")?(u/2).toInt():u;r=(D=="int")?(r/2).toInt():r;z={w:r,h:u}}return z}});var omColorPicker=new Class({Extends:omModule,options:{imgPath:fno.liveSite+"libs/colorpicker/images/"},initialize:function(l,j){this.setOptions(this.options,j);this.container=$(l);if(!this.container){return}this.container.addClass("color");var g={id:"box_"+l,imgPath:this.options.imgPath,onComplete:this.onComplete.bind(this)};if(this.options.color){g.startColor=this.options.color;this.container.setStyle("background-color",this.options.color.rgbToHex())}else{this.clearStyle()}this.rainbow=new MooRainbow(l,g)},onComplete:function(b){this.container.setStyle("background-color",b.hex);this.container.removeClass("nocolor");this.fireEvent("change",{color:b})},clearStyle:function(){this.container.setStyle("background-color","white");this.container.addClass("nocolor")},setColor:function(g,f){if($type(g)=="string"){g=g.split(",")}this.rainbow.manualSet(g);this.container.setStyle("background-color",g.rgbToHex())},getColor:function(f){var g=this.rainbow.sets;if(!g){return null}switch(f){case"strhex":return g.hex;case"hex":case"strrgb":return g.rgb.join(",");case"rgb":return g.rgb;case"hsb":return g.hsb;default:return g}}});var Picker=new Class({Implements:[Options,Events],options:{pickerClass:"datepicker",inject:null,animationDuration:400,useFadeInOut:true,positionOffset:{x:0,y:0},pickerPosition:"bottom",draggable:true,showOnInit:true,columns:1,footer:false},initialize:function(b){this.setOptions(b);this.constructPicker();if(this.options.showOnInit){this.show()}},constructPicker:function(){var D=this.options;var r=this.picker=new Element("div",{"class":D.pickerClass,styles:{left:0,top:0,display:"none",opacity:0}}).inject(D.inject||document.body);r.addClass("column_"+D.columns);if(D.useFadeInOut){r.set("tween",{duration:D.animationDuration,link:"cancel"})}var E=this.header=new Element("div.header").inject(r);var z=this.title=new Element("div.title").inject(E);var B=this.titleID="pickertitle-"+String.uniqueID();this.titleText=new Element("div",{role:"heading","class":"titleText",id:B,"aria-live":"assertive","aria-atomic":"true"}).inject(z);this.closeButton=new Element("div.closeButton[text=x][role=button]").addEvent("click",this.close.pass(false,this)).inject(E);var u=this.body=new Element("div.body").inject(r);if(D.footer){this.footer=new Element("div.footer").inject(r);r.addClass("footer")}var C=this.slider=new Element("div.slider",{styles:{position:"absolute",top:0,left:0}}).set("tween",{duration:D.animationDuration,transition:Fx.Transitions.Quad.easeInOut}).inject(u);this.newContents=new Element("div",{styles:{position:"absolute",top:0,left:0}}).inject(C);this.oldContents=new Element("div",{styles:{position:"absolute",top:0}}).inject(C);this.originalColumns=D.columns;this.setColumns(D.columns);var F=this.shim=window.IframeShim?new IframeShim(r):null;if(D.draggable&&typeOf(r.makeDraggable)=="function"){this.dragger=r.makeDraggable(F?{onDrag:F.position.bind(F)}:null);r.setStyle("cursor","move")}},open:function(l){if(this.opened==true){return this}this.opened=true;var j=this,g=this.picker.setStyle("display","block").set("aria-hidden","false");if(this.shim){this.shim.show()}this.fireEvent("open");if(this.options.useFadeInOut&&!l){g.get("tween").start("opacity",1).chain(function(){j.fireEvent("show");this.callChain()})}else{g.setStyle("opacity",1);this.fireEvent("show")}return this},show:function(){return this.open(true)},close:function(o){if(this.opened==false){return this}this.opened=false;this.fireEvent("close");var l=this,j=this.picker,p=function(){j.setStyle("display","none").set("aria-hidden","true");if(l.shim){l.shim.hide()}l.fireEvent("hide")};if(this.options.useFadeInOut&&!o){j.get("tween").start("opacity",0).chain(p)}else{j.setStyle("opacity",0);p()}return this},hide:function(){return this.close(true)},toggle:function(){return this[this.opened==true?"close":"open"]()},destroy:function(){this.picker.destroy();if(this.shim){this.shim.destroy()}},position:function(C,D){var H=this.options.positionOffset,B=document.getScroll(),u=document.getSize(),z=this.picker.getSize();if(typeOf(C)=="element"){var G=C,F=D||this.options.pickerPosition;var E=G.getCoordinates();C=(F=="left")?E.left-z.x:(F=="bottom"||F=="top")?E.left:E.right;D=(F=="bottom")?E.bottom:(F=="top")?E.top-z.y:E.top}C+=H.x*((F&&F=="left")?-1:1);D+=H.y*((F&&F=="top")?-1:1);if((C+z.x)>(u.x+B.x)){C=(u.x+B.x)-z.x}if((D+z.y)>(u.y+B.y)){D=(u.y+B.y)-z.y}if(C<0){C=0}if(D<0){D=0}this.picker.setStyles({left:C,top:D});if(this.shim){this.shim.position()}return this},setBodySize:function(){var b=this.bodysize=this.body.getSize();this.slider.setStyles({width:2*b.x,height:b.y});this.oldContents.setStyles({left:b.x,width:b.x,height:b.y});this.newContents.setStyles({width:b.x,height:b.y})},setColumnContent:function(p,o){var l=this.columns[p];if(!l){return this}var j=typeOf(o);if(["string","number"].contains(j)){l.set("text",o)}else{l.empty().adopt(o)}return this},setColumnsContent:function(l,g){var j=this.columns;this.columns=this.newColumns;this.newColumns=j;l.forEach(function(b,a){this.setColumnContent(a,b)},this);return this.setContent(null,g)},setColumns:function(z){var r=this.columns=new Elements,p=this.newColumns=new Elements;for(var B=z;B--;){r.push(new Element("div.column").addClass("column_"+(z-B)));p.push(new Element("div.column").addClass("column_"+(z-B)))}var o="column_"+this.options.columns,u="column_"+z;this.picker.removeClass(o).addClass(u);this.options.columns=z;return this},setContent:function(l,g){if(l){return this.setColumnsContent([l],g)}var j=this.oldContents;this.oldContents=this.newContents;this.newContents=j;this.newContents.empty();this.newContents.adopt(this.columns);this.setBodySize();if(g){this.fx(g)}else{this.slider.setStyle("left",0);this.oldContents.setStyles({left:0,opacity:0});this.newContents.setStyles({left:0,opacity:1})}return this},fx:function(p){var o=this.oldContents,l=this.newContents,r=this.slider,u=this.bodysize;if(p=="right"){o.setStyles({left:0,opacity:1});l.setStyles({left:u.x,opacity:1});r.setStyle("left",0).tween("left",0,-u.x)}else{if(p=="left"){o.setStyles({left:u.x,opacity:1});l.setStyles({left:0,opacity:1});r.setStyle("left",-u.x).tween("left",-u.x,0)}else{if(p=="fade"){r.setStyle("left",0);o.setStyle("left",0).set("tween",{duration:this.options.animationDuration/2}).tween("opacity",1,0).get("tween").chain(function(){o.setStyle("left",u.x)});l.setStyles({opacity:0,left:0}).set("tween",{duration:this.options.animationDuration}).tween("opacity",0,1)}}}},toElement:function(){return this.picker},setTitle:function(f,g){if(!g){g=Function.from}this.titleText.empty().adopt(Array.from(f).map(function(a,b){return typeOf(a)=="element"?a:new Element("div.column",{text:g(a,this.options)}).addClass("column_"+(b+1))},this));return this},setTitleEvent:function(b){this.titleText.removeEvents("click");if(b){this.titleText.addEvent("click",b)}this.titleText.setStyle("cursor",b?"pointer":"");return this}});Picker.Attach=new Class({Extends:Picker,options:{togglesOnly:true,showOnInit:false,blockKeydown:true},initialize:function(p,r){this.parent(r);this.attachedEvents=[];this.attachedElements=[];this.toggles=[];this.inputs=[];var l=function(a){if(this.attachedElements.contains(a.target)){return}this.close()}.bind(this);var o=this.picker.getDocument().addEvent("click",l);var u=function(a){a.stopPropagation();return false};this.picker.addEvent("click",u);if(this.options.toggleElements){this.options.toggle=o.getElements(this.options.toggleElements)}this.attach(p,this.options.toggle)},attach:function(G,F){if(typeOf(G)=="string"){G=document.id(G)}if(typeOf(F)=="string"){F=document.id(F)}var H=Array.from(G),E=Array.from(F),D=[].append(H).combine(E),u=this;var B=function(g){var a=u.options.blockKeydown&&g.type=="keydown"&&!(["tab","esc"].contains(g.key)),f=g.type=="keydown"&&(["tab","esc"].contains(g.key)),b=g.target.get("tag")=="a";if(a||b){g.preventDefault()}if(f||b){u.close()}};var z=function(a){return function(f){var b=f.target.get("tag");if(b=="input"&&f.type=="click"&&!a.match(":focus")||(u.opened&&u.input==a)){return}if(b=="a"){f.stop()}u.position(a);u.open();u.fireEvent("attached",[f,a])}};var C=function(a,b){return function(f){if(u.opened){b(f)}else{a(f)}}};D.each(function(g){if(u.attachedElements.contains(g)){return}var j={},a=g.get("tag"),b=z(g),f=C(b,B);if(a=="input"){if(!u.options.togglesOnly||!E.length){j={focus:b,click:b,keydown:B}}u.inputs.push(g)}else{if(E.contains(g)){u.toggles.push(g);j.click=f}else{j.click=b}}g.addEvents(j);u.attachedElements.push(g);u.attachedEvents.push(j)});return this},detach:function(B,r){if(typeOf(B)=="string"){B=document.id(B)}if(typeOf(r)=="string"){r=document.id(r)}var p=Array.from(B),u=Array.from(r),z=[].append(p).combine(u),o=this;if(!z.length){z=o.attachedElements}z.each(function(b){var f=o.attachedElements.indexOf(b);if(f<0){return}var j=o.attachedEvents[f];b.removeEvents(j);delete o.attachedEvents[f];delete o.attachedElements[f];var g=o.toggles.indexOf(b);if(g!=-1){delete o.toggles[g]}var a=o.inputs.indexOf(b);if(g!=-1){delete o.inputs[a]}});return this},destroy:function(){this.detach();return this.parent()}});(function(){this.DatePicker=Picker.Date=new Class({Extends:Picker.Attach,options:{timePicker:false,timePickerOnly:false,timeWheelStep:1,yearPicker:true,yearsPerPage:20,startDay:1,rtl:false,startView:"days",openLastView:false,pickOnly:false,canAlwaysGoUp:["months","days"],updateAll:false,weeknumbers:false,months_abbr:null,days_abbr:null,years_title:function(a,b){var f=a.get("year");return f+"-"+(f+b.yearsPerPage-1)},months_title:function(a,b){return a.get("year")},days_title:function(a,b){return a.format("%b %Y")},time_title:function(a,b){return(b.pickOnly=="time")?Locale.get("DatePicker.select_a_time"):a.format("%d %B, %Y")}},initialize:function(f,a){this.parent(f,a);this.setOptions(a);a=this.options;["year","month","day","time"].some(function(g){if(a[g+"PickerOnly"]){a.pickOnly=g;return true}return false});if(a.pickOnly){a[a.pickOnly+"Picker"]=true;a.startView=a.pickOnly}var b=["days","months","years"];["month","year","decades"].some(function(g,u){return(a.startView==g)&&(a.startView=b[u])});a.canAlwaysGoUp=a.canAlwaysGoUp?Array.from(a.canAlwaysGoUp):[];if(a.minDate){if(!(a.minDate instanceof Date)){a.minDate=Date.parse(a.minDate)}a.minDate.clearTime()}if(a.maxDate){if(!(a.maxDate instanceof Date)){a.maxDate=Date.parse(a.maxDate)}a.maxDate.clearTime()}if(!a.format){a.format=(a.pickOnly!="time")?Locale.get("Date.shortDate"):"";if(a.timePicker){a.format=(a.format)+(a.format?" ":"")+Locale.get("Date.shortTime")}}this.addEvent("attached",function(F,E){if(!this.currentView||!a.openLastView){this.currentView=a.startView}this.date=p(new Date(),a.minDate,a.maxDate);var D=E.get("tag"),C;if(D=="input"){C=E}else{var g=this.toggles.indexOf(E);if(this.inputs[g]){C=this.inputs[g]}}this.getInputDate(C);this.input=C;this.setColumns(this.originalColumns)}.bind(this),true)},getInputDate:function(b){this.date=new Date();if(!b){return}var f=Date.parse(b.get("value"));if(f==null||!f.isValid()){var a=b.retrieve("datepicker:value");if(a){f=Date.parse(a)}}if(f!=null&&f.isValid()){this.date=f}},constructPicker:function(){this.parent();if(!this.options.rtl){this.previous=new Element("div.previous[html=&#171;]").inject(this.header);this.next=new Element("div.next[html=&#187;]").inject(this.header)}else{this.next=new Element("div.previous[html=&#171;]").inject(this.header);this.previous=new Element("div.next[html=&#187;]").inject(this.header)}},hidePrevious:function(b,a){this[b?"next":"previous"].setStyle("display",a?"block":"none");return this},showPrevious:function(a){return this.hidePrevious(a,true)},setPreviousEvent:function(a,b){this[b?"next":"previous"].removeEvents("click");if(a){this[b?"next":"previous"].addEvent("click",a)}return this},hideNext:function(){return this.hidePrevious(true)},showNext:function(){return this.showPrevious(true)},setNextEvent:function(a){return this.setPreviousEvent(a,true)},setColumns:function(z,f,B,g){var a=this.parent(z),b;if((f||this.currentView)&&(b="render"+(f||this.currentView).capitalize())&&this[b]){this[b](B||this.date.clone(),g)}return a},renderYears:function(H,b){var N=this.options,I=N.columns,a=N.yearsPerPage,J=[],G=[];this.dateElements=[];H=H.clone().decrement("year",H.get("year")%a);var M=H.clone().decrement("year",Math.floor((I-1)/2)*a);for(var K=I;K--;){var O=M.clone();G.push(O);J.push(l.years(j.years(N,O.clone()),N,this.date.clone(),this.dateElements,function(r){if(N.pickOnly=="years"){this.select(r)}else{this.renderMonths(r,"fade")}this.date=r}.bind(this)));M.increment("year",a)}this.setColumnsContent(J,b);this.setTitle(G,N.years_title);var f=(N.minDate&&H.get("year")<=N.minDate.get("year")),g=(N.maxDate&&(H.get("year")+N.yearsPerPage)>=N.maxDate.get("year"));this[(f?"hide":"show")+"Previous"]();this[(g?"hide":"show")+"Next"]();this.setPreviousEvent(function(){this.renderYears(H.decrement("year",a),"left")}.bind(this));this.setNextEvent(function(){this.renderYears(H.increment("year",a),"right")}.bind(this));this.setTitleEvent(null);this.currentView="years"},renderMonths:function(J,b){var O=this.options,f=O.columns,K=[],I=[],Q=J.clone().decrement("year",Math.floor((f-1)/2));this.dateElements=[];for(var N=f;N--;){var P=Q.clone();I.push(P);K.push(l.months(j.months(O,P.clone()),O,this.date.clone(),this.dateElements,function(r){if(O.pickOnly=="months"){this.select(r)}else{this.renderDays(r,"fade")}this.date=r}.bind(this)));Q.increment("year",1)}this.setColumnsContent(K,b);this.setTitle(I,O.months_title);var S=J.get("year"),a=(O.minDate&&S<=O.minDate.get("year")),g=(O.maxDate&&S>=O.maxDate.get("year"));this[(a?"hide":"show")+"Previous"]();this[(g?"hide":"show")+"Next"]();this.setPreviousEvent(function(){this.renderMonths(J.decrement("year",f),"left")}.bind(this));this.setNextEvent(function(){this.renderMonths(J.increment("year",f),"right")}.bind(this));var M=O.yearPicker&&(O.pickOnly!="months"||O.canAlwaysGoUp.contains("months"));var R=(M)?function(){this.renderYears(J,"fade")}.bind(this):null;this.setTitleEvent(R);this.currentView="months"},renderDays:function(H,O){var N=this.options,J=N.columns,I=[],b=[],g=H.clone().decrement("month",Math.floor((J-1)/2));this.dateElements=[];for(var f=J;f--;){_date=g.clone();b.push(_date);I.push(l.days(j.days(N,_date.clone()),N,this.date.clone(),this.dateElements,function(r){if(N.pickOnly=="days"||!N.timePicker){this.select(r)}else{this.renderTime(r,"fade")}this.date=r}.bind(this)));g.increment("month",1)}this.setColumnsContent(I,O);this.setTitle(b,N.days_title);var M=H.format("%Y%m").toInt(),Q=(N.minDate&&M<=N.minDate.format("%Y%m")),a=(N.maxDate&&M>=N.maxDate.format("%Y%m"));this[(Q?"hide":"show")+"Previous"]();this[(a?"hide":"show")+"Next"]();this.setPreviousEvent(function(){this.renderDays(H.decrement("month",J),"left")}.bind(this));this.setNextEvent(function(){this.renderDays(H.increment("month",J),"right")}.bind(this));var K=N.pickOnly!="days"||N.canAlwaysGoUp.contains("days");var P=(K)?function(){this.renderMonths(H,"fade")}.bind(this):null;this.setTitleEvent(P);this.currentView="days"},renderTime:function(g,f){var z=this.options;this.setTitle(g,z.time_title);var a=this.originalColumns=z.columns;this.currentView=null;if(a!=1){this.setColumns(1)}this.setContent(l.time(z,g.clone(),function(r){this.select(r)}.bind(this)),f);this.hidePrevious().hideNext().setPreviousEvent(null).setNextEvent(null);var B=z.pickOnly!="time"||z.canAlwaysGoUp.contains("time");var b=(B)?function(){this.setColumns(a,"days",g,"fade")}.bind(this):null;this.setTitleEvent(b);this.currentView="time"},select:function(a,u){this.date=a;var g=a.format(this.options.format),f=a.strftime(),b=(!this.options.updateAll&&!u&&this.input)?[this.input]:this.inputs;b.each(function(r){r.set("value",g).store("datepicker:value",f).fireEvent("change")},this);this.fireEvent("select",[a].concat(b));this.close();return this}});var j={years:function(a,b){var f=[];for(var g=0;g<a.yearsPerPage;g++){f.push(+b);b.increment("year",1)}return f},months:function(a,b){var f=[];b.set("month",0);for(var g=0;g<=11;g++){f.push(+b);b.increment("month",1)}return f},days:function(a,b){var f=[];b.set("date",1);while(b.get("day")!=a.startDay){b.set("date",b.get("date")-1)}for(var g=0;g<42;g++){f.push(+b);b.increment("day",1)}return f}};var l={years:function(J,a,G,b,E){var H=new Element("table.years"),I=new Date(),f=[],g,F;J.each(function(z,u){var B=new Date(z),r=B.get("year");if(u%4===0){f.push(new Element("tr"));f[f.length-1].inject(H)}F=".year.year"+u;if(r==I.get("year")){F+=".today"}if(r==G.get("year")){F+=".selected"}g=new Element("td"+F,{text:r}).inject(f[f.length-1]);b.push({element:g,time:z});if(o("year",B,a)){g.addClass("unavailable")}else{g.addEvent("click",E.pass(B))}});return H},months:function(J,O,K,I,R){var S=new Date(),f=S.get("month"),N=S.get("year"),b=K.get("year"),M=new Element("table.months"),g=O.months_abbr||Locale.get("Date.months_abbr"),Q=[],P,a;J.each(function(u,r){var z=new Date(u),B=z.get("year");if(r%3===0){Q.push(new Element("tr"));Q[Q.length-1].inject(M)}a=".month.month"+(r+1);if(r==f&&B==N){a+=".today"}if(r==K.get("month")&&B==b){a+=".selected"}P=new Element("td"+a,{text:g[r]}).inject(Q[Q.length-1]);I.push({element:P,time:u});if(o("month",z,O)){P.addClass("unavailable")}else{P.addEvent("click",R.pass(z))}});return M},days:function(V,ad,Z,b,ab){var f=new Date(V[14]).get("month"),P=new Date().toDateString(),af=Z.toDateString(),Y=ad.weeknumbers,T=new Element("table.days"+(Y?".weeknumbers":""),{role:"grid","aria-labelledby":this.titleID}),R=new Element("thead").inject(T),U=new Element("tbody").inject(T),a=new Element("tr.titles").inject(R),aa=ad.days_abbr||Locale.get("Date.days_abbr"),S,Q,ae,ac,g,W=ad.rtl?"top":"bottom";if(Y){new Element("th.title.day.weeknumber",{text:Locale.get("DatePicker.week")}).inject(a)}for(S=ad.startDay;S<(ad.startDay+7);S++){new Element("th.title.day.day"+(S%7),{text:aa[(S%7)],role:"columnheader"}).inject(a,W)}V.each(function(z,r){var u=new Date(z);if(r%7==0){ac=new Element("tr.week.week"+(Math.floor(r/7))).set("role","row").inject(U);if(Y){new Element("th.day.weeknumber",{text:u.get("week"),scope:"row",role:"rowheader"}).inject(ac)}}g=u.toDateString();Q=".day.day"+u.get("day");if(g==P){Q+=".today"}if(u.get("month")!=f){Q+=".otherMonth"}ae=new Element("td"+Q,{text:u.getDate(),role:"gridcell"}).inject(ac,W);if(g==af){ae.addClass("selected").set("aria-selected","true")}else{ae.set("aria-selected","false")}b.push({element:ae,time:z});if(o("date",u,ad)){ae.addClass("unavailable")}else{ae.addEvent("click",ab.pass(u.clone()))}});return T},time:function(D,a,B){var f=new Element("div.time"),b=(a.get("minutes")/D.timeWheelStep).round()*D.timeWheelStep;if(b>=60){b=0}a.set("minutes",b);var g=new Element("input.hour[type=text]",{title:Locale.get("DatePicker.use_mouse_wheel"),value:a.format("%H"),events:{click:function(r){r.target.focus();r.stop()},mousewheel:function(u){u.stop();g.focus();var r=g.get("value").toInt();r=(u.wheel>0)?((r<23)?r+1:0):((r>0)?r-1:23);a.set("hours",r);g.set("value",a.format("%H"))}.bind(this)},maxlength:2}).inject(f);new Element("div.separator[text=:]").inject(f);var C=new Element("input.minutes[type=text]",{title:Locale.get("DatePicker.use_mouse_wheel"),value:a.format("%M"),events:{click:function(r){r.target.focus();r.stop()},mousewheel:function(u){u.stop();C.focus();var r=C.get("value").toInt();r=(u.wheel>0)?((r<59)?(r+D.timeWheelStep):0):((r>0)?(r-D.timeWheelStep):(60-D.timeWheelStep));if(r>=60){r=0}a.set("minutes",r);C.set("value",a.format("%M"))}.bind(this)},maxlength:2}).inject(f);new Element("input.ok",{type:"submit",value:Locale.get("DatePicker.time_confirm_button"),events:{click:function(r){r.stop();a.set({hours:g.get("value").toInt(),minutes:C.get("value").toInt()});B(a.clone())}}}).inject(f);return f}};Picker.Date.defineRenderer=function(b,a){l[b]=a;return this};Picker.Date.getRenderer=function(a){return l[a]};var p=function(a,f,b){if(f&&a<f){return f}if(b&&a>b){return b}return a};var o=function(J,G,M){var F=M.minDate,H=M.maxDate,b=M.availableDates,g,K,f,I;if(!F&&!H&&!b){return false}G.clearTime();if(J=="year"){g=G.get("year");return((F&&g<F.get("year"))||(H&&g>H.get("year"))||((b!=null&&!M.invertAvailable)&&(b[g]==null||Object.getLength(b[g])==0||Object.getLength(Object.filter(b[g],function(r){return(r.length>0)}))==0)))}if(J=="month"){g=G.get("year");K=G.get("month")+1;I=G.format("%Y%m").toInt();return((F&&I<F.format("%Y%m").toInt())||(H&&I>H.format("%Y%m").toInt())||((b!=null&&!M.invertAvailable)&&(b[g]==null||b[g][K]==null||b[g][K].length==0)))}g=G.get("year");K=G.get("month")+1;f=G.get("date");var a=(F&&G<F)||(H&&G>H);if(b!=null){a=a||b[g]==null||b[g][K]==null||!b[g][K].contains(f);if(M.invertAvailable){a=!a}}return a}})();var dropDownMenu=new Class({Implements:[Events,Options],getOptions:function(){return{selection:false}},initialize:function(f,g){this.setOptions(this.getOptions(),g);this.element=f;this.init(f)},init:function(b){$A($(b).childNodes).each((function(a){if(a.nodeName.toLowerCase()=="li"){if(!($(a).getElements("ul").length>0)){$(a).addEvent("click",(function(g){}).bind(this))}$A($(a).childNodes).each((function(g){if(g.nodeName.toLowerCase()=="ul"){$(g).hide();$(g).addEvent("click",(function(f){}).bind(this));a.addEvent("mouseenter",function(){g.show();return false});a.addEvent("mouseleave",function(){g.hide()})}}).bind(this))}}).bind(this));return this},select:function(b){this.unselect();var b=$(b);b.addClass("active")},unselect:function(){$(this.element).getElements("a").each((function(b){$(b).removeClass("active")}).bind(this))},hide:function(){$(this.element).getElements("li ul").each((function(b){$(b).hide()}).bind(this))}});var MooTreeIcon=["I","L","Lminus","Lplus","Rminus","Rplus","T","Tminus","Tplus","_closed","_doc","_open","minus","plus"];var MooTreeControl=new Class({initialize:function(f,g){g.control=this;this.parentid=g.div=f.div;this.root=new MooTreeNode(g);this.index=new Object();this.enabled=true;this.theme=f.theme||"mootree.gif";this.loader=f.loader||{icon:"mootree_loader.gif",text:"Loading...",color:"#a0a0a0"};this.selected=null;this.mode=f.mode;this.grid=f.grid;this.onExpand=f.onExpand||new Function();this.onSelect=f.onSelect||new Function();this.onClick=f.onClick||new Function();this.onDblClick=f.onDblClick||new Function();this.root.update(true);this.labelFunction=f.labelFunction;$(f.div).addEvent("mouseleave",this.onLeaveNode.bind(this));this.hovernode=null},insert:function(b){b.control=this;return this.root.insert(b)},select:function(f,g){if(!g){this.onClick(f)}f.onClick();if(this.selected===f){return}if(this.selected){this.selected.select(false);this.onSelect(this.selected,false)}this.selected=f;f.select(true);if(!g){this.onSelect(f,true)}},clear:function(){this.selected=null;this.root.clear()},expand:function(){this.root.toggle(true,true)},collapse:function(){this.root.toggle(true,false)},get:function(b){return this.index[b]||null},adopt:function(f,g){if(g===undefined){g=this.root}this.disable();this._adopt(f,g);g.update(true);$(f).destroy();this.enable()},_adopt:function(Q,J){e=$(Q);var K=0,H=e.getChildren();for(K=0;K<H.length;K++){if(H[K].nodeName=="LI"){var P={text:""},I="",N=null,M=null;var O=0,R=0,F=null,S=H[K].getChildren();for(O=0;O<S.length;O++){switch(S[O].nodeName){case"A":for(R=0;R<S[O].childNodes.length;R++){F=S[O].childNodes[R];switch(F.nodeName){case"#text":P.text+=F.nodeValue;break;case"#comment":I+=F.nodeValue;break}}P.data=S[O].getProperties("href","target","title","name");break;case"UL":M=S[O];break}}if(P.label!=""){P.data.url=P.data.href;if(I!=""){var z=I.split(";");for(R=0;R<z.length;R++){var G=z[R].trim().split(":");if(G.length==2){P[G[0].trim()]=G[1].trim()}}}N=J.insert(P);if(M){this._adopt(M,N)}}}}},disable:function(){this.enabled=false},enable:function(){this.enabled=true;this.root.update(true,true)},onEnterNode:function(b){this.hovernode=b;b.div.main.addClass("mooTree_hover")},onLeaveNode:function(b){if(this.hovernode){this.hovernode.div.main.removeClass("mooTree_hover");this.hovernode=null}}});var MooTreeNode=new Class({initialize:function(b){this.text=b.text;this.id=b.id||null;this.nodes=new Array();this.parent=null;this.last=true;this.control=b.control;this.selected=false;this.color=b.color||null;this.data=b.data||{};this.onExpand=b.onExpand||new Function();this.onSelect=b.onSelect||new Function();this.onClick=b.onClick||new Function();this.onDblClick=b.onDblClick||new Function();this.open=b.open?true:false;this.icon=b.icon;this.openicon=b.openicon||this.icon;if(this.id){this.control.index[this.id]=this}this.div={main:new Element("div").addClass("mooTree_node"),indent:new Element("div"),gadget:new Element("div"),icon:new Element("div"),text:new Element("div").addClass("mooTree_text"),sub:new Element("div")};this.div.main.adopt(this.div.indent);this.div.main.adopt(this.div.gadget);this.div.main.adopt(this.div.icon);this.div.main.adopt(this.div.text);$(b.div).adopt(this.div.main);$(b.div).adopt(this.div.sub);this.div.gadget._node=this;this.div.gadget.onclick=this.div.gadget.ondblclick=function(){this._node.toggle()};this.div.icon._node=this.div.text._node=this;this.div.icon.onclick=this.div.text.onclick=function(){this._node.control.select(this._node)};this.div.icon.ondblclick=this.div.text.ondblclick=function(){this._node.control.onDblClick(this._node)};this.div.main.addEvent("mouseenter",this.onMouseEnter.bind(this));this.div.main.addEvent("mouseleave",this.onMouseLeave.bind(this))},onMouseEnter:function(b){this.control.onEnterNode(this)},onMouseLeave:function(b){this.control.onLeaveNode(this)},insert:function(j){j.div=this.div.sub;j.control=this.control;var g=new MooTreeNode(j);g.parent=this;var l=this.nodes;if(l.length){l[l.length-1].last=false}l.push(g);g.update();if(l.length==1){this.update()}if(l.length>1){l[l.length-2].update(true)}return g},remove:function(){var b=this.parent;this._remove();b.update(true)},_remove:function(){var f=this.nodes;while(f.length){f[f.length-1]._remove()}delete this.control.index[this.id];this.div.main.destroy();this.div.sub.destroy();if(this.parent){var g=this.parent.nodes;g.erase(this);if(g.length){g[g.length-1].last=true}}},clear:function(){this.control.disable();while(this.nodes.length){this.nodes[this.nodes.length-1].remove()}this.control.enable()},update:function(B,r){var o=true;if(!this.control.enabled){this.invalidated=true;o=false}if(r){if(!this.invalidated){o=false}else{this.invalidated=false}}if(o){var p;this.div.main.className="mooTree_node"+(this.selected?" mooTree_selected":"");var u=this,z="";while(u.parent){u=u.parent;z=this.getImg(u.last||!this.control.grid?"":"I")+z}this.div.indent.innerHTML=z;p=this.div.text;p.empty();if(this.control.labelFunction){p.innerHTML=this.control.labelFunction(this)}else{p.innerHTML=this.text}if(this.color){p.style.color=this.color}this.div.icon.innerHTML=this.getImg(this.nodes.length?(this.open?(this.openicon||this.icon||"_open"):(this.icon||"_closed")):(this.icon||(this.control.mode=="folders"?"_closed":"_doc")));this.div.gadget.innerHTML=this.getImg((this.control.grid?(this.control.root==this?(this.nodes.length?"R":""):(this.last?"L":"T")):"")+(this.nodes.length?(this.open?"minus":"plus"):""));this.div.sub.style.display=this.open?"block":"none"}if(B){this.nodes.forEach(function(a){a.update(true,r)})}},getImg:function(u){var p='<div class="mooTree_img"';if(u!=""){var l=this.control.theme;var r=MooTreeIcon.indexOf(u);if(r==-1){var o=u.split("#");l=o[0];r=(o.length==2?parseInt(o[1])-1:0)}p+=' style="background-image:url('+l+"); background-position:-"+(r*18)+'px 0px;"'}p+="></div>";return p},toggle:function(g,f){this.open=(f===undefined?!this.open:f);this.update();this.onExpand(this.open);this.control.onExpand(this,this.open);if(g){this.nodes.forEach(function(a){a.toggle(true,this.open)},this)}},select:function(b){this.selected=b;this.update();this.onSelect(b)},load:function(j,l){if(this.loading){return}this.loading=true;this.toggle(false,true);this.clear();this.insert(this.control.loader);var f=function(){new Request({method:"GET",url:j,onSuccess:this._loaded.bind(this),onFailure:this._load_err.bind(this)}).send(j,l||"")}.bind(this).delay(20)},_loaded:function(f,g){this.control.disable();this.clear();this._import(g.documentElement);this.control.enable();this.loading=false},_import:function(D){var C=D.childNodes;for(var u=0;u<C.length;u++){if(C[u].tagName=="node"){var z={data:{}};var a=C[u].attributes;for(var B=0;B<a.length;B++){switch(a[B].name){case"text":case"id":case"icon":case"openicon":case"color":case"open":z[a[B].name]=a[B].value;break;default:z.data[a[B].name]=a[B].value}}var r=this.insert(z);if(r.data.load){r.open=false;r.insert(this.control.loader);r.onExpand=function(b){this.load(this.data.load);this.onExpand=new Function()}}if(C[u].childNodes.length){r._import(C[u])}}}},_load_err:function(b){window.alert("Error loading: "+this.text)}});var Roar=new Class({Implements:[Options,Events,Chain],options:{duration:5000,position:"upperLeft",container:null,bodyFx:null,itemFx:null,margin:{x:10,y:10},offset:10,className:"roar",onShow:$empty,onHide:$empty,onRender:$empty},initialize:function(b){this.setOptions(b);this.items=[];this.container=$(this.options.container)||document},alert:function(p,u,l){var r=Array.link(arguments,{title:String.type,message:String.type,options:Object.type});var o=[new Element("h3",{html:$pick(r.title,"")})];if(r.message){o.push(new Element("p",{html:r.message}))}return this.inject(o,r.options)},inject:function(H,u){if(!this.body){this.render()}u=u||{};var F=[-this.options.offset,0];var B=this.items.getLast();if(B){F[0]=B.retrieve("roar:offset");F[1]=F[0]+B.offsetHeight+this.options.offset}var C={opacity:1};C[this.align.y]=F;var z=new Element("div",{"class":this.options.className,opacity:0}).adopt(new Element("div",{"class":"roar-bg",opacity:0.7}),H);z.setStyle(this.align.x,0).store("roar:offset",F[1]).set("morph",$merge({unit:"px",link:"cancel",onStart:Chain.prototype.clearChain,transition:Fx.Transitions.Back.easeOut},this.options.itemFx));var E=this.remove.create({bind:this,arguments:[z],delay:10});this.items.push(z.addEvent("click",E));if(this.options.duration){var D=false;var G=(function(){G=null;if(!D){E()}}).delay(this.options.duration);z.addEvents({mouseover:function(){D=true},mouseout:function(){D=false;if(!G){E()}}})}z.inject(this.body).morph(C);return this.fireEvent("onShow",[z,this.items.length])},remove:function(g){var j=this.items.indexOf(g);if(j==-1){return this}this.items.splice(j,1);g.removeEvents();var l={opacity:0};l[this.align.y]=g.getStyle(this.align.y).toInt()-g.offsetHeight-this.options.offset;g.morph(l).get("morph").chain(g.destroy.bind(g));return this.fireEvent("onHide",[g,this.items.length]).callChain(g)},empty:function(){while(this.items.length){this.remove(this.items[0])}return this},render:function(){this.position=this.options.position;if($type(this.position)=="string"){var j={x:"center",y:"center"};this.align={x:"left",y:"top"};if((/left|west/i).test(this.position)){j.x="left"}else{if((/right|east/i).test(this.position)){this.align.x=j.x="right"}}if((/upper|top|north/i).test(this.position)){j.y="top"}else{if((/bottom|lower|south/i).test(this.position)){this.align.y=j.y="bottom"}}this.position=j}this.body=new Element("div",{"class":"roar-body"}).inject(document.body);if(Browser.Engine.trident4){this.body.addClass("roar-body-ugly")}this.moveTo=this.body.setStyles.bind(this.body);this.reposition();if(this.options.bodyFx){var l=new Fx.Morph(this.body,$merge({unit:"px",chain:"cancel",transition:Fx.Transitions.Circ.easeOut},this.options.bodyFx));this.moveTo=l.start.bind(l)}var g=this.reposition.bind(this);window.addEvents({scroll:g,resize:g});this.fireEvent("onRender",this.body)},reposition:function(){var p=document.getCoordinates(),j=document.getScroll(),o=this.options.margin;p.left+=j.x;p.right+=j.x;p.top+=j.y;p.bottom+=j.y;var l=($type(this.container)=="element")?this.container.getCoordinates():p;this.moveTo({left:(this.position.x=="right")?(Math.min(l.right,p.right)-o.x):(Math.max(l.left,p.left)+o.x),top:(this.position.y=="bottom")?(Math.min(l.bottom,p.bottom)-o.y):(Math.max(l.top,p.top)+o.y)})}});(function(ah,am,aw,R,aq,O){var al=this;var au=Math.floor(Math.random()*100)*100;var b=Function.prototype;var a=/^(http.?:\/\/([^\/\s]+))/;var f=/[\-\w]+\/\.\.\//;var M=/([^:])\/\//g;var P="";var av={};var ag=ah.easyXDM;var u="easyXDM_";var K;function I(U,T){var S=typeof U[T];return S=="function"||(!!(S=="object"&&U[T]))||S=="unknown"}function r(S,T){return !!(typeof(S[T])=="object"&&S[T])}function g(S){return Object.prototype.toString.call(S)==="[object Array]"}var B,E;if(I(ah,"addEventListener")){B=function(T,U,S){T.addEventListener(U,S,false)};E=function(T,U,S){T.removeEventListener(U,S,false)}}else{if(I(ah,"attachEvent")){B=function(U,T,S){U.attachEvent("on"+T,S)};E=function(U,T,S){U.detachEvent("on"+T,S)}}else{throw new Error("Browser not supported")}}var D=false,Q=[],af;if("readyState" in am){af=am.readyState;D=af=="complete"||(~navigator.userAgent.indexOf("AppleWebKit/")&&(af=="loaded"||af=="interactive"))}else{D=!!am.body}function j(){j=b;D=true;for(var S=0;S<Q.length;S++){Q[S]()}Q.length=0}if(!D){if(I(ah,"addEventListener")){B(am,"DOMContentLoaded",j)}else{B(am,"readystatechange",function(){if(am.readyState=="complete"){j()}});if(am.documentElement.doScroll&&ah===top){(function ao(){if(D){return}try{am.documentElement.doScroll("left")}catch(S){R(ao,1);return}j()}())}}B(ah,"load",j)}function N(T,S){if(D){T.call(S);return}Q.push(function(){T.call(S)})}function at(){var T=parent;if(P!==""){for(var U=0,S=P.split(".");U<S.length;U++){T=T[S[U]]}}return T.easyXDM}function an(S){ah.easyXDM=ag;P=S;if(P){u="easyXDM_"+P.replace(".","_")+"_"}return av}function F(S){return S.match(a)[2]}function ap(S){return S.match(a)[1]}function H(S){S=S.replace(M,"$1/");if(!S.match(/^(http||https):\/\//)){var T=(S.substring(0,1)==="/")?"":aw.pathname;if(T.substring(T.length-1)!=="/"){T=T.substring(0,T.lastIndexOf("/")+1)}S=aw.protocol+"//"+aw.host+T+S}while(f.test(S)){S=S.replace(f,"")}return S}function aj(V,S){var U="",Y=V.indexOf("#");if(Y!==-1){U=V.substring(Y);V=V.substring(0,Y)}var T=[];for(var W in S){if(S.hasOwnProperty(W)){T.push(W+"="+O(S[W]))}}return V+((V.indexOf("?")===-1)?"?":"&")+T.join("&")+U}var l=(function(){var S={},T,V=aw.search.substring(1).split("&"),U=V.length;while(U--){T=V[U].split("=");S[T[0]]=aq(T[1])}return S}());function p(S){return typeof S==="undefined"}function ai(){var S={};var T={a:[1,2,3]},U='{"a":[1,2,3]}';if(JSON&&typeof JSON.stringify==="function"&&JSON.stringify(T).replace((/\s/g),"")===U){return JSON}if(Object.toJSON){if(Object.toJSON(T).replace((/\s/g),"")===U){S.stringify=Object.toJSON}}if(typeof String.prototype.evalJSON==="function"){T=U.evalJSON();if(T.a&&T.a.length===3&&T.a[2]===3){S.parse=function(V){return V.evalJSON()}}}if(S.stringify&&S.parse){ai=function(){return S};return S}return null}function o(U,V,W){var T;for(var S in V){if(V.hasOwnProperty(S)){if(S in U){T=V[S];if(typeof T==="object"){o(U[S],T,W)}else{if(!W){U[S]=V[S]}}}else{U[S]=V[S]}}}return U}function ak(){var S=am.createElement("iframe");S.name=u+"TEST";o(S.style,{position:"absolute",left:"-2000px",top:"0px"});am.body.appendChild(S);K=!(S.contentWindow===ah.frames[S.name]);am.body.removeChild(S)}function G(S){if(p(K)){ak()}var T;if(K){T=am.createElement('<iframe name="'+S.props.name+'"/>')}else{T=am.createElement("IFRAME");T.name=S.props.name}T.id=T.name=S.props.name;delete S.props.name;if(S.onLoad){B(T,"load",S.onLoad)}if(typeof S.container=="string"){S.container=am.getElementById(S.container)}if(!S.container){T.style.position="absolute";T.style.left="-2000px";T.style.top="0px";S.container=am.body}T.border=T.frameBorder=0;S.container.insertBefore(T,S.container.firstChild);o(T,S.props);return T}function z(T,S){if(typeof T=="string"){T=[T]}var V,U=T.length;while(U--){V=T[U];V=new RegExp(V.substr(0,1)=="^"?V:("^"+V.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"));if(V.test(S)){return true}}return false}function ar(Y){var U=Y.protocol,W;Y.isHost=Y.isHost||p(l.xdm_p);if(!Y.props){Y.props={}}if(!Y.isHost){Y.channel=l.xdm_c;Y.secret=l.xdm_s;Y.remote=l.xdm_e;U=l.xdm_p;if(Y.acl&&!z(Y.acl,Y.remote)){throw new Error("Access denied for "+Y.remote)}}else{Y.remote=H(Y.remote);Y.channel=Y.channel||"default"+au++;Y.secret=Math.random().toString(16).substring(2);if(p(U)){if(ap(aw.href)==ap(Y.remote)){U="4"}else{if(I(ah,"postMessage")||I(am,"postMessage")){U="1"}else{if(I(ah,"ActiveXObject")&&I(ah,"execScript")){U="3"}else{if(navigator.product==="Gecko"&&"frameElement" in ah&&navigator.userAgent.indexOf("WebKit")==-1){U="5"}else{if(Y.remoteHelper){Y.remoteHelper=H(Y.remoteHelper);U="2"}else{U="0"}}}}}}}switch(U){case"0":o(Y,{interval:100,delay:2000,useResize:true,useParent:false,usePolling:false},true);if(Y.isHost){if(!Y.local){var Z=aw.protocol+"//"+aw.host,V=am.body.getElementsByTagName("img"),aa;var S=V.length;while(S--){aa=V[S];if(aa.src.substring(0,Z.length)===Z){Y.local=aa.src;break}}if(!Y.local){Y.local=ah}}var T={xdm_c:Y.channel,xdm_p:0};if(Y.local===ah){Y.usePolling=true;Y.useParent=true;Y.local=aw.protocol+"//"+aw.host+aw.pathname+aw.search;T.xdm_e=Y.local;T.xdm_pa=1}else{T.xdm_e=H(Y.local)}if(Y.container){Y.useResize=false;T.xdm_po=1}Y.remote=aj(Y.remote,T)}else{o(Y,{channel:l.xdm_c,remote:l.xdm_e,useParent:!p(l.xdm_pa),usePolling:!p(l.xdm_po),useResize:Y.useParent?false:Y.useResize})}W=[new av.stack.HashTransport(Y),new av.stack.ReliableBehavior({}),new av.stack.QueueBehavior({encode:true,maxLength:4000-Y.remote.length}),new av.stack.VerifyBehavior({initiate:Y.isHost})];break;case"1":W=[new av.stack.PostMessageTransport(Y)];break;case"2":W=[new av.stack.NameTransport(Y),new av.stack.QueueBehavior(),new av.stack.VerifyBehavior({initiate:Y.isHost})];break;case"3":W=[new av.stack.NixTransport(Y)];break;case"4":W=[new av.stack.SameOriginTransport(Y)];break;case"5":W=[new av.stack.FrameElementTransport(Y)];break}W.push(new av.stack.QueueBehavior({lazy:Y.lazy,remove:true}));return W}function J(S){var T,W={incoming:function(Y,Z){this.up.incoming(Y,Z)},outgoing:function(Z,Y){this.down.outgoing(Z,Y)},callback:function(Y){this.up.callback(Y)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var V=0,U=S.length;V<U;V++){T=S[V];o(T,W,true);if(V!==0){T.down=S[V-1]}if(V!==U-1){T.up=S[V+1]}}return T}function C(S){S.up.down=S.down;S.down.up=S.up;S.up=S.down=null}o(av,{version:"2.4.10.103",query:l,stack:{},apply:o,getJSONObject:ai,whenReady:N,noConflict:an});av.DomHelper={on:B,un:E,requiresJSON:function(S){if(!r(ah,"JSON")){am.write('<script type="text/javascript" src="'+S+'"><\/script>')}}};(function(){var S={};av.Fn={set:function(U,T){S[U]=T},get:function(V,U){var T=S[V];if(U){delete S[V]}return T}}}());av.Socket=function(S){var U=J(ar(S).concat([{incoming:function(W,V){S.onMessage(W,V)},callback:function(V){if(S.onReady){S.onReady(V)}}}])),T=ap(S.remote);this.origin=ap(S.remote);this.destroy=function(){U.destroy()};this.postMessage=function(V){U.outgoing(V,T)};U.init()};av.Rpc=function(W,V){if(V.local){for(var T in V.local){if(V.local.hasOwnProperty(T)){var S=V.local[T];if(typeof S==="function"){V.local[T]={method:S}}}}}var U=J(ar(W).concat([new av.stack.RpcBehavior(this,V),{callback:function(Y){if(W.onReady){W.onReady(Y)}}}]));this.origin=ap(W.remote);this.destroy=function(){U.destroy()};U.init()};av.stack.SameOriginTransport=function(V){var W,T,S,U;return(W={outgoing:function(aa,Y,Z){S(aa);if(Z){Z()}},destroy:function(){if(T){T.parentNode.removeChild(T);T=null}},onDOMReady:function(){U=ap(V.remote);if(V.isHost){o(V.props,{src:aj(V.remote,{xdm_e:aw.protocol+"//"+aw.host+aw.pathname,xdm_c:V.channel,xdm_p:4}),name:u+V.channel+"_provider"});T=G(V);av.Fn.set(V.channel,function(Y){S=Y;R(function(){W.up.callback(true)},0);return function(Z){W.up.incoming(Z,U)}})}else{S=at().Fn.get(V.channel,true)(function(Y){W.up.incoming(Y,U)});R(function(){W.up.callback(true)},0)}},init:function(){N(W.onDOMReady,W)}})};av.stack.PostMessageTransport=function(S){var Z,U,W,Y;function V(aa){if(aa.origin){return aa.origin}if(aa.uri){return ap(aa.uri)}if(aa.domain){return aw.protocol+"//"+aa.domain}throw"Unable to retrieve the origin of the event"}function T(aa){var ab=V(aa);if(ab==Y&&aa.data.substring(0,S.channel.length+1)==S.channel+" "){Z.up.incoming(aa.data.substring(S.channel.length+1),ab)}}return(Z={outgoing:function(aa,ac,ab){W.postMessage(S.channel+" "+aa,ac||Y);if(ab){ab()}},destroy:function(){E(ah,"message",T);if(U){W=null;U.parentNode.removeChild(U);U=null}},onDOMReady:function(){Y=ap(S.remote);if(S.isHost){B(ah,"message",function aa(ab){if(ab.data==S.channel+"-ready"){W=("postMessage" in U.contentWindow)?U.contentWindow:U.contentWindow.document;E(ah,"message",aa);B(ah,"message",T);R(function(){Z.up.callback(true)},0)}});o(S.props,{src:aj(S.remote,{xdm_e:aw.protocol+"//"+aw.host,xdm_c:S.channel,xdm_p:1}),name:u+S.channel+"_provider"});U=G(S)}else{B(ah,"message",T);W=("postMessage" in ah.parent)?ah.parent:ah.parent.document;W.postMessage(S.channel+"-ready",Y);R(function(){Z.up.callback(true)},0)}},init:function(){N(Z.onDOMReady,Z)}})};av.stack.FrameElementTransport=function(V){var W,T,S,U;return(W={outgoing:function(aa,Y,Z){S.call(this,aa);if(Z){Z()}},destroy:function(){if(T){T.parentNode.removeChild(T);T=null}},onDOMReady:function(){U=ap(V.remote);if(V.isHost){o(V.props,{src:aj(V.remote,{xdm_e:aw.protocol+"//"+aw.host+aw.pathname+aw.search,xdm_c:V.channel,xdm_p:5}),name:u+V.channel+"_provider"});T=G(V);T.fn=function(Y){delete T.fn;S=Y;R(function(){W.up.callback(true)},0);return function(Z){W.up.incoming(Z,U)}}}else{ah.parent.location=l.xdm_e+"#";S=ah.frameElement.fn(function(Y){W.up.incoming(Y,U)});W.up.callback(true)}},init:function(){N(W.onDOMReady,W)}})};av.stack.NixTransport=function(W){var S,U,T,V,Y;return(S={outgoing:function(aa,ab,Z){T(aa);if(Z){Z()}},destroy:function(){Y=null;if(U){U.parentNode.removeChild(U);U=null}},onDOMReady:function(){V=ap(W.remote);if(W.isHost){try{if(!I(ah,"getNixProxy")){ah.execScript("Class NixProxy\n    Private m_parent, m_child, m_Auth\n\n    Public Sub SetParent(obj, auth)\n        If isEmpty(m_Auth) Then m_Auth = auth\n        SET m_parent = obj\n    End Sub\n    Public Sub SetChild(obj)\n        SET m_child = obj\n        m_parent.ready()\n    End Sub\n\n    Public Sub SendToParent(data, auth)\n        If m_Auth = auth Then m_parent.send(CStr(data))\n    End Sub\n    Public Sub SendToChild(data, auth)\n        If m_Auth = auth Then m_child.send(CStr(data))\n    End Sub\nEnd Class\nFunction getNixProxy()\n    Set GetNixProxy = New NixProxy\nEnd Function\n","vbscript")}Y=getNixProxy();Y.SetParent({send:function(ab){S.up.incoming(ab,V)},ready:function(){R(function(){S.up.callback(true)},0)}},W.secret);T=function(ab){Y.SendToChild(ab,W.secret)}}catch(aa){throw new Error("Could not set up VBScript NixProxy:"+aa.message)}o(W.props,{src:aj(W.remote,{xdm_e:aw.protocol+"//"+aw.host+aw.pathname+aw.search,xdm_c:W.channel,xdm_s:W.secret,xdm_p:3}),name:u+W.channel+"_provider"});U=G(W);U.contentWindow.opener=Y}else{ah.parent.location=l.xdm_e+"#";try{Y=ah.opener}catch(Z){throw new Error("Cannot access window.opener")}Y.SetChild({send:function(ab){al.setTimeout(function(){S.up.incoming(ab,V)},0)}});T=function(ab){Y.SendToParent(ab,W.secret)};R(function(){S.up.callback(true)},0)}},init:function(){N(S.onDOMReady,S)}})};av.stack.NameTransport=function(Z){var aa;var ad,ac,Y,T,U,V,S;function ae(az){var ay=Z.remoteHelper+(ad?"#_3":"#_2")+Z.channel;ac.contentWindow.sendMessage(az,ay)}function ab(){if(ad){if(++T===2||!ad){aa.up.callback(true)}}else{ae("ready");aa.up.callback(true)}}function ax(ay){aa.up.incoming(ay,V)}function W(){if(U){R(function(){U(true)},0)}}return(aa={outgoing:function(az,aA,ay){U=ay;ae(az)},destroy:function(){ac.parentNode.removeChild(ac);ac=null;if(ad){Y.parentNode.removeChild(Y);Y=null}},onDOMReady:function(){ad=Z.isHost;T=0;V=ap(Z.remote);Z.local=H(Z.local);if(ad){av.Fn.set(Z.channel,function(az){if(ad&&az==="ready"){av.Fn.set(Z.channel,ax);ab()}});S=aj(Z.remote,{xdm_e:Z.local,xdm_c:Z.channel,xdm_p:2});o(Z.props,{src:S+"#"+Z.channel,name:u+Z.channel+"_provider"});Y=G(Z)}else{Z.remoteHelper=Z.remote;av.Fn.set(Z.channel,ax)}ac=G({props:{src:Z.local+"#_4"+Z.channel},onLoad:function ay(){E(ac,"load",ay);av.Fn.set(Z.channel+"_load",W);(function az(){if(typeof ac.contentWindow.sendMessage=="function"){ab()}else{R(az,50)}}())}})},init:function(){N(aa.onDOMReady,aa)}})};av.stack.HashTransport=function(Y){var ab;var aA=this,ax,Z,T,ac,ay,aa,ad;var az,W;function V(aB){if(!ad){return}var aC=Y.remote+"#"+(ay++)+"_"+aB;((ax||!az)?ad.contentWindow:ad).location=aC}function ae(aB){ac=aB;ab.up.incoming(ac.substring(ac.indexOf("_")+1),W)}function U(){if(!aa){return}var aD=aa.location.href,aC="",aB=aD.indexOf("#");if(aB!=-1){aC=aD.substring(aB)}if(aC&&aC!=ac){ae(aC)}}function S(){Z=setInterval(U,T)}return(ab={outgoing:function(aC,aB){V(aC)},destroy:function(){ah.clearInterval(Z);if(ax||!az){ad.parentNode.removeChild(ad)}ad=null},onDOMReady:function(){ax=Y.isHost;T=Y.interval;ac="#"+Y.channel;ay=0;az=Y.useParent;W=ap(Y.remote);if(ax){Y.props={src:Y.remote,name:u+Y.channel+"_provider"};if(az){Y.onLoad=function(){aa=ah;S();ab.up.callback(true)}}else{var aC=0,aD=Y.delay/50;(function aB(){if(++aC>aD){throw new Error("Unable to reference listenerwindow")}try{aa=ad.contentWindow.frames[u+Y.channel+"_consumer"]}catch(aE){}if(aa){S();ab.up.callback(true)}else{R(aB,50)}}())}ad=G(Y)}else{aa=ah;S();if(az){ad=parent;ab.up.callback(true)}else{o(Y,{props:{src:Y.remote+"#"+Y.channel+new Date(),name:u+Y.channel+"_consumer"},onLoad:function(){ab.up.callback(true)}});ad=G(Y)}}},init:function(){N(ab.onDOMReady,ab)}})};av.stack.ReliableBehavior=function(W){var S,U;var T=0,V=0,Y="";return(S={incoming:function(aa,Z){var ab=aa.indexOf("_"),ac=aa.substring(0,ab).split(",");aa=aa.substring(ab+1);if(ac[0]==T){Y="";if(U){U(true)}}if(aa.length>0){S.down.outgoing(ac[1]+","+T+"_"+Y,Z);if(V!=ac[1]){V=ac[1];S.up.incoming(aa,Z)}}},outgoing:function(aa,Z,ab){Y=aa;U=ab;S.down.outgoing(V+","+(++T)+"_"+aa,Z)}})};av.stack.QueueBehavior=function(U){var Y,Z=[],ac=true,V="",ab,S=0,T=false,W=false;function aa(){if(U.remove&&Z.length===0){C(Y);return}if(ac||Z.length===0||ab){return}ac=true;var ad=Z.shift();Y.down.outgoing(ad.data,ad.origin,function(ae){ac=false;if(ad.callback){R(function(){ad.callback(ae)},0)}aa()})}return(Y={init:function(){if(p(U)){U={}}if(U.maxLength){S=U.maxLength;W=true}if(U.lazy){T=true}else{Y.down.init()}},callback:function(ad){ac=false;var ae=Y.up;aa();ae.callback(ad)},incoming:function(ax,ae){if(W){var ay=ax.indexOf("_"),ad=parseInt(ax.substring(0,ay),10);V+=ax.substring(ay+1);if(ad===0){if(U.encode){V=aq(V)}Y.up.incoming(V,ae);V=""}}else{Y.up.incoming(ax,ae)}},outgoing:function(ay,ae,az){if(U.encode){ay=O(ay)}var ad=[],ax;if(W){while(ay.length!==0){ax=ay.substring(0,S);ay=ay.substring(ax.length);ad.push(ax)}while((ax=ad.shift())){Z.push({data:ad.length+"_"+ax,origin:ae,callback:ad.length===0?az:null})}}else{Z.push({data:ay,origin:ae,callback:az})}if(T){Y.down.init()}else{aa()}},destroy:function(){ab=true;Y.down.destroy()}})};av.stack.VerifyBehavior=function(U){var T,S,W,Y=false;function V(){S=Math.random().toString(16).substring(2);T.down.outgoing(S)}return(T={incoming:function(aa,Z){var ab=aa.indexOf("_");if(ab===-1){if(aa===S){T.up.callback(true)}else{if(!W){W=aa;if(!U.initiate){V()}T.down.outgoing(aa)}}}else{if(aa.substring(0,ab)===W){T.up.incoming(aa.substring(ab+1),Z)}}},outgoing:function(aa,Z,ab){T.down.outgoing(S+"_"+aa,Z,ab)},callback:function(Z){if(U.initiate){V()}}})};av.stack.RpcBehavior=function(Z,T){var V,ab=T.serializer||ai();var aa=0,Y={};function S(ac){ac.jsonrpc="2.0";V.down.outgoing(ab.stringify(ac))}function W(ae,ac){var ad=Array.prototype.slice;return function(){var ax=arguments.length,az,ay={method:ac};if(ax>0&&typeof arguments[ax-1]==="function"){if(ax>1&&typeof arguments[ax-2]==="function"){az={success:arguments[ax-2],error:arguments[ax-1]};ay.params=ad.call(arguments,0,ax-2)}else{az={success:arguments[ax-1]};ay.params=ad.call(arguments,0,ax-1)}Y[""+(++aa)]=az;ay.id=aa}else{ay.params=ad.call(arguments,0)}if(ae.namedParams&&ay.params.length===1){ay.params=ay.params[0]}S(ay)}}function U(ac,aA,ax,aB){if(!ax){if(aA){S({id:aA,error:{code:-32601,message:"Procedure not found."}})}return}var az,ae;if(aA){az=function(aC){az=b;S({id:aA,result:aC})};ae=function(aC,aD){ae=b;var aE={id:aA,error:{code:-32099,message:aC}};if(aD){aE.error.data=aD}S(aE)}}else{az=ae=b}if(!g(aB)){aB=[aB]}try{var ad=ax.method.apply(ax.scope,aB.concat([az,ae]));if(!p(ad)){az(ad)}}catch(ay){ae(ay.message)}}return(V={incoming:function(ax,ae){var ad=ab.parse(ax);if(ad.method){if(T.handle){T.handle(ad,S)}else{U(ad.method,ad.id,T.local[ad.method],ad.params)}}else{var ac=Y[ad.id];if(ad.error){if(ac.error){ac.error(ad.error)}}else{if(ac.success){ac.success(ad.result)}}delete Y[ad.id]}},init:function(){if(T.remote){for(var ac in T.remote){if(T.remote.hasOwnProperty(ac)){Z[ac]=W(T.remote[ac],ac)}}}V.down.init()},destroy:function(){for(var ac in T.remote){if(T.remote.hasOwnProperty(ac)&&Z.hasOwnProperty(ac)){delete Z[ac]}}V.down.destroy()}})};al.easyXDM=av})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);(function(){function o(a){a=parseFloat(a);if(isNaN(a)){a=0}if(a>100){a=100}if(a<0){a=0}this.vals.value=a;this.vals.dark.empty();this.vals.light.empty();this.vals.dark.appendText(a+"%");this.vals.light.appendText(a+"%");var b=parseInt(this.vals.width*(a/100));this.vals.dark.setStyle("clip","rect(0,"+b+"px,"+this.vals.height+"px,0)");this.vals.light.setStyle("clip","rect(0,"+this.vals.width+"px,"+this.vals.height+"px,"+b+"px)")}function l(f){var a=$(f);if(!a){return}if(!a.parentNode){return setTimeout(function(){l(f)},1)}a.setStyle("width","100%");var b=a.offsetWidth;a.vals.dark.setStyle("width",b);a.vals.light.setStyle("width",b);a.vals.width=b;a.setValue(a.vals.value)}var p=0;var j=new Class({initialize:function(u,b){var a={id:"progressbar_"+(p++),value:$pick(u,0),width:0,height:0,darkbg:"#006",darkfg:"#fff",lightbg:"#fff",lightfg:"#000"},f;if(b&&$type(b)=="object"){$extend(a,b)}if(a.height<12){a.height=12}var g=new Element("div",{id:a.id,"class":"progressbar_wrapper",styles:{"-moz-border-radius":"4px 4px 4px 4px",padding:1,border:"1px solid #ccc",width:a.width,height:a.height,position:"relative"}});g.vals=a;g.vals.dark=new Element("div",{id:a.id+"_dark","class":"progressbar_dark",styles:{"-moz-border-radius":"4px 4px 4px 4px",width:a.width,height:a.height,background:a.darkbg,color:a.darkfg,position:"absolute","text-align":"center",left:1,top:1,"line-height":a.height-2}});g.vals.light=new Element("div",{id:a.id+"_light","class":"progressbar_light",styles:{"-moz-border-radius":"4px 4px 4px 4px",width:a.width,height:a.height,background:a.lightbg,color:a.lightfg,position:"absolute","text-align":"center",left:1,top:1,"line-height":a.height-2}});g.appendChild(g.vals.dark);g.appendChild(g.vals.light);g.setValue=o;if(a.width){g.setValue(a.value)}else{f=g.id;setTimeout(function(){l(f)},1)}return g},setValue:function(a){o(a);return this}});window.ProgressBar=j}());(function(B,I,G){var M={},E,H,D;function J(a){if(M.logging&&B.console&&B.console.log){B.console.log(a)}}M.Util={};M.Util.backgroundImage=function(a){if(/data:image\/.*;base64,/i.test(a)||/^(-webkit|-moz|linear-gradient|-o-)/.test(a)){return a}if(a.toLowerCase().substr(0,5)==='url("'){a=a.substr(5);a=a.substr(0,a.length-2)}else{a=a.substr(4);a=a.substr(0,a.length-1)}return a};M.Util.Bounds=function C(f){var a,b={};if(f.getBoundingClientRect){a=f.getBoundingClientRect();b.top=a.top;b.bottom=a.bottom||(a.top+a.height);b.left=a.left;b.width=a.width||(a.right-a.left);b.height=a.height||(a.bottom-a.top);return b}};M.Util.getCSS=function(f,b){var a;function g(o,j){var r=f.runtimeStyle&&f.runtimeStyle[o],l,p=f.style;if(!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(j)&&/^-?\d/.test(j)){l=p.left;if(r){f.runtimeStyle.left=f.currentStyle.left}p.left=o==="fontSize"?"1em":(j||0);j=p.pixelLeft+"px";p.left=l;if(r){f.runtimeStyle.left=r}}if(!/^(thin|medium|thick)$/i.test(j)){return Math.round(parseFloat(j))+"px"}return j}if(B.getComputedStyle){if(E!==f){H=I.defaultView.getComputedStyle(f,null)}a=H[b];if(b==="backgroundPosition"){a=(a.split(",")[0]||"0 0").split(" ");a[0]=(a[0].indexOf("%")===-1)?g(b+"X",a[0]):a[0];a[1]=(a[1]===G)?a[0]:a[1];a[1]=(a[1].indexOf("%")===-1)?g(b+"Y",a[1]):a[1]}}else{if(f.currentStyle){if(b==="backgroundPosition"){a=[g(b+"X",f.currentStyle[b+"X"]),g(b+"Y",f.currentStyle[b+"Y"])]}else{a=g(b,f.currentStyle[b]);if(/^(border)/i.test(b)&&/^(medium|thin|thick)$/i.test(a)){switch(a){case"thin":a="1px";break;case"medium":a="0px";break;case"thick":a="5px";break}}}}}return a};M.Util.BackgroundPosition=function(l,j,f){var a=M.Util.getCSS(l,"backgroundPosition"),o,g,p,b;if(a.length===1){b=a;a=[];a[0]=b;a[1]=b}if(a[0].toString().indexOf("%")!==-1){p=(parseFloat(a[0])/100);g=((j.width*p)-(f.width*p))}else{g=parseInt(a[0],10)}if(a[1].toString().indexOf("%")!==-1){p=(parseFloat(a[1])/100);o=((j.height*p)-(f.height*p))}else{o=parseInt(a[1],10)}return{top:o,left:g}};M.Util.Extend=function(f,a){for(var b in f){if(f.hasOwnProperty(b)){a[b]=f[b]}}return a};M.Util.Children=function(a){var b;try{b=(a.nodeName&&a.nodeName.toUpperCase()==="IFRAME")?a.contentDocument||a.contentWindow.document:(function(g){var j=[];if(g!==null){(function(l,p){var o=l.length,r=0;if(typeof p.length==="number"){for(var u=p.length;r<u;r++){l[o++]=p[r]}}else{while(p[r]!==G){l[o++]=p[r++]}}l.length=o;return l})(j,g)}return j})(a.childNodes)}catch(f){J("html2canvas.Util.Children failed with exception: "+f.message);b=[]}return b};(function(){M.Generate={};var a=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z-]+)([\w\d\.\s,%\(\)]+)\)$/];M.Generate.parseGradient=function(T,f){var r,U,S=a.length,g,u,o,b,V,p;for(U=0;U<S;U+=1){g=T.match(a[U]);if(g){break}}if(g){switch(g[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":r={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]};o=g[2].match(/\w+/g);if(o){b=o.length;for(U=0;U<b;U+=1){switch(o[U]){case"top":r.y0=0;r.y1=f.height;break;case"right":r.x0=f.width;r.x1=0;break;case"bottom":r.y0=f.height;r.y1=0;break;case"left":r.x0=0;r.x1=f.width;break}}}if(r.x0===null&&r.x1===null){r.x0=r.x1=f.width/2}if(r.y0===null&&r.y1===null){r.y0=r.y1=f.height/2}o=g[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(o){b=o.length;V=1/Math.max(b-1,1);for(U=0;U<b;U+=1){p=o[U].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(p[2]){u=parseFloat(p[2]);if(p[3]==="%"){u/=100}else{u/=f.width}}else{u=U*V}r.colorStops.push({color:p[1],stop:u})}}break;case"-webkit-gradient":r={type:g[2]==="radial"?"circle":g[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]};o=g[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/);if(o){r.x0=(o[1]*f.width)/100;r.y0=(o[2]*f.height)/100;r.x1=(o[3]*f.width)/100;r.y1=(o[4]*f.height)/100}o=g[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g);if(o){b=o.length;for(U=0;U<b;U+=1){p=o[U].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/);u=parseFloat(p[2]);if(p[1]==="from"){u=0}if(p[1]==="to"){u=1}r.colorStops.push({color:p[3],stop:u})}}break;case"-moz-linear-gradient":r={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]};o=g[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(o){r.x0=(o[1]*f.width)/100;r.y0=(o[2]*f.height)/100;r.x1=f.width-r.x0;r.y1=f.height-r.y0}o=g[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g);if(o){b=o.length;V=1/Math.max(b-1,1);for(U=0;U<b;U+=1){p=o[U].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/);if(p[2]){u=parseFloat(p[2]);if(p[3]){u/=100}}else{u=U*V}r.colorStops.push({color:p[1],stop:u})}}break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":r={type:"circle",x0:0,y0:0,x1:f.width,y1:f.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]};o=g[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(o){r.cx=(o[1]*f.width)/100;r.cy=(o[2]*f.height)/100}o=g[3].match(/\w+/);p=g[4].match(/[a-z-]*/);if(o&&p){switch(p[0]){case"farthest-corner":case"cover":case"":var j=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.cy,2));var z=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.y1-r.cy,2));var l=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.y1-r.cy,2));var W=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.cy,2));r.rx=r.ry=Math.max(j,z,l,W);break;case"closest-corner":var j=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.cy,2));var z=Math.sqrt(Math.pow(r.cx,2)+Math.pow(r.y1-r.cy,2));var l=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.y1-r.cy,2));var W=Math.sqrt(Math.pow(r.x1-r.cx,2)+Math.pow(r.cy,2));r.rx=r.ry=Math.min(j,z,l,W);break;case"farthest-side":if(o[0]==="circle"){r.rx=r.ry=Math.max(r.cx,r.cy,r.x1-r.cx,r.y1-r.cy)}else{r.type=o[0];r.rx=Math.max(r.cx,r.x1-r.cx);r.ry=Math.max(r.cy,r.y1-r.cy)}break;case"closest-side":case"contain":if(o[0]==="circle"){r.rx=r.ry=Math.min(r.cx,r.cy,r.x1-r.cx,r.y1-r.cy)}else{r.type=o[0];r.rx=Math.min(r.cx,r.x1-r.cx);r.ry=Math.min(r.cy,r.y1-r.cy)}break}}o=g[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(o){b=o.length;V=1/Math.max(b-1,1);for(U=0;U<b;U+=1){p=o[U].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(p[2]){u=parseFloat(p[2]);if(p[3]==="%"){u/=100}else{u/=f.width}}else{u=U*V}r.colorStops.push({color:p[1],stop:u})}}break}}return r};M.Generate.Gradient=function(f,b){var V=I.createElement("canvas"),g=V.getContext("2d"),l,j,S,z,T;V.width=b.width;V.height=b.height;l=M.Generate.parseGradient(f,b);T=new Image();if(l){if(l.type==="linear"){j=g.createLinearGradient(l.x0,l.y0,l.x1,l.y1);for(S=0,z=l.colorStops.length;S<z;S+=1){try{j.addColorStop(l.colorStops[S].stop,l.colorStops[S].color)}catch(u){J(["failed to add color stop: ",u,"; tried to add: ",l.colorStops[S],"; stop: ",S,"; in: ",f])}}g.fillStyle=j;g.fillRect(0,0,b.width,b.height);T.src=V.toDataURL()}else{if(l.type==="circle"){j=g.createRadialGradient(l.cx,l.cy,0,l.cx,l.cy,l.rx);for(S=0,z=l.colorStops.length;S<z;S+=1){try{j.addColorStop(l.colorStops[S].stop,l.colorStops[S].color)}catch(u){J(["failed to add color stop: ",u,"; tried to add: ",l.colorStops[S],"; stop: ",S,"; in: ",f])}}g.fillStyle=j;g.fillRect(0,0,b.width,b.height);T.src=V.toDataURL()}else{if(l.type==="ellipse"){var U=I.createElement("canvas"),W=U.getContext("2d"),o=Math.max(l.rx,l.ry),p=o*2,r;U.width=U.height=p;j=W.createRadialGradient(l.rx,l.ry,0,l.rx,l.ry,o);for(S=0,z=l.colorStops.length;S<z;S+=1){try{j.addColorStop(l.colorStops[S].stop,l.colorStops[S].color)}catch(u){J(["failed to add color stop: ",u,"; tried to add: ",l.colorStops[S],"; stop: ",S,"; in: ",f])}}W.fillStyle=j;W.fillRect(0,0,p,p);g.fillStyle=l.colorStops[S-1].color;g.fillRect(0,0,V.width,V.height);r=new Image();r.onload=function(){g.drawImage(r,l.cx-l.rx,l.cy-l.ry,2*l.rx,2*l.ry);T.src=V.toDataURL()};r.src=U.toDataURL()}}}}return T};M.Generate.ListAlpha=function(b){var f="",g;do{g=b%26;f=String.fromCharCode((g)+64)+f;b=b/26}while((b*26)>26);return f};M.Generate.ListRoman=function(f){var g=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],l=[1000,900,500,400,100,90,50,40,10,9,5,4,1],b="",j,o=g.length;if(f<=0||f>=4000){return f}for(j=0;j<o;j+=1){while(f>=l[j]){f-=l[j];b+=g[j]}}return b}})();M.Parse=function(aV,aU){B.scroll(0,0);var aD={rangeBounds:false,svgRendering:aU.svgRendering&&(function(){var P=new Image(),O=I.createElement("canvas"),Q=(O.getContext===G)?false:O.getContext("2d");if(Q===false){return false}O.width=O.height=10;P.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{Q.drawImage(P,0,0);O.toDataURL()}catch(N){return false}J("html2canvas: Parse: SVG powered rendering available");return true})()},au=((aU.elements===G)?I.body:aU.elements[0]),aw=false,aT=0,aP={},aH=au.ownerDocument,aK=new RegExp("("+aU.ignoreElements+")"),aZ=aH.body,az,o,aA,aN,aW,f,aR,ay,z,aG;function a(){return{width:Math.max(Math.max(aH.body.scrollWidth,aH.documentElement.scrollWidth),Math.max(aH.body.offsetWidth,aH.documentElement.offsetWidth),Math.max(aH.body.clientWidth,aH.documentElement.clientWidth)),height:Math.max(Math.max(aH.body.scrollHeight,aH.documentElement.scrollHeight),Math.max(aH.body.offsetHeight,aH.documentElement.offsetHeight),Math.max(aH.body.clientHeight,aH.documentElement.clientHeight))}}aV=aV||{};if(aH.createRange){az=aH.createRange();if(az.getBoundingClientRect){o=aH.createElement("boundtest");o.style.height="123px";o.style.display="block";aZ.appendChild(o);az.selectNode(o);aA=az.getBoundingClientRect();aN=aA.height;if(aN===123){aD.rangeBounds=true}aZ.removeChild(o)}}var g=M.Util.getCSS;function b(P,O){var N=parseInt(g(P,O),10);return(isNaN(N))?0:N}function u(N,S,P,O,R,Q){if(Q!=="transparent"){N.setVariable("fillStyle",Q);N.fillRect(S,P,O,R);aT+=1}}function aJ(N,O){switch(O){case"lowercase":return N.toLowerCase();case"capitalize":return N.replace(/(^|\s|:|-|\(|\))([a-z])/g,function(Q,R,P){if(Q.length>0){return R+P.toUpperCase()}});case"uppercase":return N.toUpperCase();default:return N}}function aL(N){return N.replace(/^\s*/g,"").replace(/\s*$/g,"")}function aC(R,P){if(aP[R+"-"+P]!==G){return aP[R+"-"+P]}var U=aH.createElement("div"),T=aH.createElement("img"),S=aH.createElement("span"),Q,O,N;U.style.visibility="hidden";U.style.fontFamily=R;U.style.fontSize=P;U.style.margin=0;U.style.padding=0;aZ.appendChild(U);T.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=";T.width=1;T.height=1;T.style.margin=0;T.style.padding=0;T.style.verticalAlign="baseline";S.style.fontFamily=R;S.style.fontSize=P;S.style.margin=0;S.style.padding=0;S.appendChild(aH.createTextNode("Hidden Text"));U.appendChild(S);U.appendChild(T);Q=(T.offsetTop-S.offsetTop)+1;U.removeChild(S);U.appendChild(aH.createTextNode("Hidden Text"));U.style.lineHeight="normal";T.style.verticalAlign="super";O=(T.offsetTop-U.offsetTop)+1;N={baseline:Q,lineWidth:1,middle:O};aP[R+"-"+P]=N;aZ.removeChild(U);return N}function aX(O,Q,N,P){if(aL(O).length>0){P.fillText(O,Q,N);aT+=1}}function at(ag,Y,am){var U=am.ctx,Q=g(ag,"fontFamily"),aa=g(ag,"fontSize"),S=g(ag,"color"),N=g(ag,"textDecoration"),ao=g(ag,"textAlign"),ai=g(ag,"letterSpacing"),al,ae,T,ah,W,Z=g(ag,"fontWeight"),aj=g(ag,"fontStyle"),O=g(ag,"fontVariant"),R=false,an,ac,V=0,ap,P,ab,ak,ad,af;Y.nodeValue=aJ(Y.nodeValue,g(ag,"textTransform"));ae=aL(Y.nodeValue);if(ae.length>0){if(N!=="none"){T=aC(Q,aa)}ao=ao.replace(["-webkit-auto"],["auto"]);if(aU.letterRendering===false&&/^(left|right|justify|auto)$/.test(ao)&&/^(normal|none)$/.test(ai)){ah=Y.nodeValue.split(/(\b| )/)}else{ah=Y.nodeValue.split("")}switch(parseInt(Z,10)){case 401:Z="bold";break;case 400:Z="normal";break}U.setVariable("fillStyle",S);U.setVariable("font",aj+" "+O+" "+Z+" "+aa+" "+Q);if(R){U.setVariable("textAlign","right")}else{U.setVariable("textAlign","left")}ap=Y;for(P=0,W=ah.length;P<W;P+=1){ac=null;if(aD.rangeBounds){if(N!=="none"||aL(ah[P]).length!==0){ac=ah[P];if(aH.createRange){ab=aH.createRange();ab.setStart(Y,V);ab.setEnd(Y,V+ac.length)}else{ab=aZ.createTextRange()}if(ab.getBoundingClientRect()){al=ab.getBoundingClientRect()}else{al={}}}}else{if(typeof ap.nodeValue!=="string"){continue}an=ap.splitText(ah[P].length);ak=ap.parentNode;ad=aH.createElement("wrapper");af=ap.cloneNode(true);ad.appendChild(ap.cloneNode(true));ak.replaceChild(ad,ap);al=M.Util.Bounds(ad);ac=ap.nodeValue;ap=an;ak.replaceChild(af,ad)}if(ac!==null){aX(ac,al.left,al.bottom,U)}switch(N){case"underline":u(U,al.left,Math.round(al.top+T.baseline+T.lineWidth),al.width,1,S);break;case"overline":u(U,al.left,al.top,al.width,1,S);break;case"line-through":u(U,al.left,Math.ceil(al.top+T.middle+T.lineWidth),al.width,1,S);break}V+=ah[P].length}}}function aS(R,Q){var N=aH.createElement("boundelement"),P,O;N.style.display="inline";P=R.style.listStyleType;R.style.listStyleType="none";N.appendChild(aH.createTextNode(Q));R.insertBefore(N,R.firstChild);O=M.Util.Bounds(N);R.removeChild(N);R.style.listStyleType=P;return O}function p(P){var Q=-1,O=1,N=P.parentNode.childNodes;if(P.parentNode){while(N[++Q]!==P){if(N[Q].nodeType===1){O++}}return O}else{return -1}}function aI(N,R,W){var Y=g(N,"listStylePosition"),Q,S,T=g(N,"listStyleType"),V,P,O,U=g(N,"fontWeight");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(T)){V=p(N);switch(T){case"decimal":P=V;break;case"decimal-leading-zero":if(V.toString().length===1){P=V="0"+V.toString()}else{P=V.toString()}break;case"upper-roman":P=M.Generate.ListRoman(V);break;case"lower-roman":P=M.Generate.ListRoman(V).toLowerCase();break;case"lower-alpha":P=M.Generate.ListAlpha(V).toLowerCase();break;case"upper-alpha":P=M.Generate.ListAlpha(V);break}P+=". ";O=aS(N,P);switch(U){case 401:U="bold";break;case 400:U="normal";break}f.setVariable("fillStyle",g(N,"color"));f.setVariable("font",g(N,"fontVariant")+" "+U+" "+g(N,"fontStyle")+" "+g(N,"fontSize")+" "+g(N,"fontFamily"));if(Y==="inside"){f.setVariable("textAlign","left");Q=W.left}else{return}S=O.bottom;aX(P,Q,S,f)}}function l(N){var O=aV[N];if(O&&O.succeeded===true){return O.img}else{return false}}function aF(N,P){var S=Math.max(N.left,P.left),R=Math.max(N.top,P.top),Q=Math.min((N.left+N.width),(P.left+P.width)),O=Math.min((N.top+N.height),(P.top+P.height));return{left:S,top:R,width:Q-S,height:O-R}}function aE(N,P){var O;if(!P){O=K(0);return O}if(N!=="auto"){aw=true;O=K(N);P.children.push(O);return O}return P}function av(ad,aa,O,ab){var Q=O.left,R=O.top,ac=O.width,Y=O.height,P,N,T,V,S,Z,U,W=(function(ag){var ae=[],af=["Top","Right","Bottom","Left"],ah;for(ah=0;ah<4;ah+=1){ae.push({width:b(ag,"border"+af[ah]+"Width"),color:g(ag,"border"+af[ah]+"Color")})}return ae}(ad));for(P=0;P<4;P+=1){N=W[P];if(N.width>0){T=Q;V=R;S=ac;Z=Y-(W[2].width);switch(P){case 0:Z=W[0].width;break;case 1:T=Q+ac-(W[1].width);S=W[1].width;break;case 2:V=(V+Y)-(W[2].width);Z=W[2].width;break;case 3:S=W[3].width;break}U={left:T,top:V,width:S,height:Z};if(ab){U=aF(U,ab)}if(U.width>0&&U.height>0){u(aa,T,V,U.width,U.height,N.color)}}}return W}function aB(Y,O,R){var Q=aH.createElement("valuewrap"),P=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"],U,V,W,S,N;for(U=0,S=P.length;U<S;U+=1){N=P[U];try{Q.style[N]=g(Y,N)}catch(T){J("html2canvas: Parse: Exception caught in renderFormValue: "+T.message)}}Q.style.borderColor="black";Q.style.borderStyle="solid";Q.style.display="block";Q.style.position="absolute";if(/^(submit|reset|button|text|password)$/.test(Y.type)||Y.nodeName==="SELECT"){Q.style.lineHeight=g(Y,"height")}Q.style.top=O.top+"px";Q.style.left=O.left+"px";if(Y.nodeName==="SELECT"){V=Y.options[Y.selectedIndex].text}else{V=Y.value}W=aH.createTextNode(V);Q.appendChild(W);aZ.appendChild(Q);at(Y,W,R);aZ.removeChild(Q)}function r(R,N,T,U,S,W,P,Q,O,V){R.drawImage(N,T,U,S,W,P,Q,O,V);aT+=1}function aO(P,T,R,S,N,Q,V,O){var U=0,W=0;if(V-R>0){U=V-R}if(O-S>0){W=O-S}r(P,T,U,W,N-U,Q-W,R+U,S+W,N-U,Q-W)}function aQ(P,W,U,S,T,R,V){var Q,O=Math.min(W.width,R),N;U.top=U.top-Math.ceil(U.top/W.height)*W.height;for(N=(T+U.top);N<V+T;){if(Math.floor(N+W.height)>V+T){Q=(V+T)-N}else{Q=W.height}aO(P,W,S+U.left,N,O,Q,S,T);N=Math.floor(N+W.height)}}function aM(P,W,U,S,T,R,V){var Q=Math.min(W.height,V),O,N;U.left=U.left-Math.ceil(U.left/W.width)*W.width;for(N=(S+U.left);N<R+S;){if(Math.floor(N+W.width)>R+S){O=(R+S)-N}else{O=W.width}aO(P,W,N,(T+U.top),O,Q,S,T);N=Math.floor(N+W.width)}}function j(O,Q,aa){var W=g(O,"backgroundImage"),P=g(O,"backgroundRepeat").split(",")[0],Z,T,ae,ac,U,V,R,S,ab,Y,N,ad;if(!/data:image\/.*;base64,/i.test(W)&&!/^(-webkit|-moz|linear-gradient|-o-)/.test(W)){W=W.split(",")[0]}if(typeof W!=="undefined"&&/^(1|none)$/.test(W)===false){W=M.Util.backgroundImage(W);Z=l(W);T=M.Util.BackgroundPosition(O,Q,Z);if(Z){switch(P){case"repeat-x":aM(aa,Z,T,Q.left,Q.top,Q.width,Q.height);break;case"repeat-y":aQ(aa,Z,T,Q.left,Q.top,Q.width,Q.height);break;case"no-repeat":ac=Q.width-T.left;ab=Q.height-T.top;U=T.left;V=T.top;R=T.left+Q.left;S=T.top+Q.top;if(U<0){U=Math.abs(U);R+=U;ac=Math.min(Q.width,Z.width-U)}else{ac=Math.min(ac,Z.width);U=0}if(V<0){V=Math.abs(V);S+=V;ab=Math.min(Q.height,Z.height-V)}else{ab=Math.min(ab,Z.height);V=0}if(ab>0&&ac>0){r(aa,Z,U,V,ac,ab,R,S,ac,ab)}break;default:T.top=T.top-Math.ceil(T.top/Z.height)*Z.height;for(ae=(Q.top+T.top);ae<Q.height+Q.top;){Y=Math.min(Z.height,(Q.height+Q.top)-ae);if(Math.floor(ae+Z.height)>Y+ae){N=(Y+ae)-ae}else{N=Z.height}if(ae<Q.top){ad=Q.top-ae;ae=Q.top}else{ad=0}aM(aa,Z,T,Q.left,ae,Q.width,N);if(ad>0){T.top+=ad}ae=Math.floor(ae+Z.height)-ad}break}}else{J("html2canvas: Error loading background:"+W)}}}function ax(W,ak){var af=M.Util.Bounds(W),Z=af.left,aa=af.top,U=af.width,P=af.height,T,ab=g(W,"backgroundColor"),V=g(W,"position"),ad,aj=g(W,"opacity"),ag,ah,ai,R,S,Y,N,O,ac,ae;if(!ak){aR=a();ak={opacity:1}}else{aR={}}ad=aE(g(W,"zIndex"),ak.zIndex);ag={ctx:F(aR.width||U,aR.height||P),zIndex:ad,opacity:aj*ak.opacity,cssPosition:V};if(ak.clip){ag.clip=M.Util.Extend({},ak.clip)}if(aU.useOverflow===true&&/(hidden|scroll|auto)/.test(g(W,"overflow"))===true&&/(BODY)/i.test(W.nodeName)===false){if(ag.clip){ag.clip=aF(ag.clip,af)}else{ag.clip=af}}ah=ad.children.push(ag);R=ad.children[ah-1].ctx;R.setVariable("globalAlpha",ag.opacity);ai=av(W,R,af,false);ag.borders=ai;if(aK.test(W.nodeName)&&aU.iframeDefault!=="transparent"){if(aU.iframeDefault==="default"){ab="#efefef"}else{ab=aU.iframeDefault}}S={left:Z+ai[3].width,top:aa+ai[0].width,width:U-(ai[1].width+ai[3].width),height:P-(ai[0].width+ai[2].width)};if(ag.clip){S=aF(S,ag.clip)}if(S.height>0&&S.width>0){u(R,S.left,S.top,S.width,S.height,ab);j(W,S,R)}switch(W.nodeName){case"IMG":Y=W.getAttribute("src");T=l(Y);var Q=50;while(!T&&Q>0){T=l(Y);Q--;J("Retry for image '"+Y+"' number "+(5-Q))}if(T){N=b(W,"paddingLeft");O=b(W,"paddingTop");ac=b(W,"paddingRight");ae=b(W,"paddingBottom");r(R,T,0,0,T.width,T.height,Z+N+ai[3].width,aa+O+ai[0].width,af.width-(ai[1].width+ai[3].width+N+ac),af.height-(ai[0].width+ai[2].width+O+ae))}else{J("html2canvas: Error loading <img>:"+Y)}break;case"INPUT":if(/^(text|url|email|submit|button|reset)$/.test(W.type)&&W.value.length>0){aB(W,af,ag)}break;case"TEXTAREA":if(W.value.length>0){aB(W,af,ag)}break;case"SELECT":if(W.options.length>0){aB(W,af,ag)}break;case"LI":aI(W,ag,S);break;case"CANVAS":N=b(W,"paddingLeft");O=b(W,"paddingTop");ac=b(W,"paddingRight");ae=b(W,"paddingBottom");r(R,W,0,0,W.width,W.height,Z+N+ai[3].width,aa+O+ai[0].width,af.width-(ai[1].width+ai[3].width+N+ac),af.height-(ai[0].width+ai[2].width+O+ae));break}return ad.children[ah-1]}function aY(P,S){if(g(P,"display")!=="none"&&g(P,"visibility")!=="hidden"){S=ax(P,S)||S;f=S.ctx;if(!aK.test(P.nodeName)){var O=M.Util.Children(P),R,N,Q;for(R=0,Q=O.length;R<Q;R+=1){N=O[R];if(N.nodeType===1){aY(N,S)}else{if(N.nodeType===3){at(P,N,S)}}}}}}aW=ax(au,null);if(aD.svgRendering){(function(R){var Q=new Image(),N=a(),O="";function P(T){var U=M.Util.Children(T),Y=U.length,Z,W,S,aa,V;for(V=0;V<Y;V+=1){aa=U[V];if(aa.nodeType===3){O+=aa.nodeValue.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}else{if(aa.nodeType===1){if(!/^(script|meta|title)$/.test(aa.nodeName.toLowerCase())){O+="<"+aa.nodeName.toLowerCase();if(aa.hasAttributes()){Z=aa.attributes;S=Z.length;for(W=0;W<S;W+=1){O+=" "+Z[W].name+'="'+Z[W].value+'"'}}O+=">";P(aa);O+="</"+aa.nodeName.toLowerCase()+">"}}}}}P(R);Q.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='"+N.width+"' height='"+N.height+"'>","<foreignObject width='"+N.width+"' height='"+N.height+"'>","<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>",O.replace(/\#/g,"%23"),"</html>","</foreignObject>","</svg>"].join("");Q.onload=function(){aW.svgRender=Q}})(I.documentElement)}for(ay=0,z=au.children,aG=z.length;ay<aG;ay+=1){aY(z[ay],aW)}aW.backgroundColor=g(I.documentElement,"backgroundColor");return aW};function K(a){return{zindex:a,children:[]}}M.Preload=function(aa){var u={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:false},g,f,j,Y=0,ab=aa.elements[0]||I.body,a=ab.ownerDocument,z=a.images,r=z.length,W=a.createElement("a"),U=(function(N){return(N.crossOrigin!==G)})(new Image()),o;W.href=B.location.href;g=W.protocol+W.host;function b(N){W.href=N;W.href=W.href;var O=W.protocol+W.host;return(O===g)}function Z(){J("html2canvas: start: images: "+u.numLoaded+" / "+u.numTotal+" (failed: "+u.numFailed+")");if(!u.firstRun&&u.numLoaded>=u.numTotal){J("Finished loading images: # "+u.numTotal+" (failed: "+u.numFailed+")");if(typeof aa.complete==="function"){aa.complete(u)}}}function p(S,N,R){var P,Q=aa.proxy,O;W.href=S;S=W.href;P="html2canvas_"+(Y++);R.callbackname=P;if(Q.indexOf("?")>-1){Q+="&"}else{Q+="?"}Q+="url="+encodeURIComponent(S)+"&callback="+P;O=a.createElement("script");B[P]=function(ac){if(ac.substring(0,6)==="error:"){R.succeeded=false;u.numLoaded++;u.numFailed++;Z()}else{l(N,R);N.src=ac}B[P]=G;try{delete B[P]}catch(T){}O.parentNode.removeChild(O);O=null;delete R.script;delete R.callbackname};O.setAttribute("type","text/javascript");O.setAttribute("src",Q);R.script=O;B.document.body.appendChild(O)}function V(R){var Q=M.Util.Children(R),O,af,S,N,P=false;try{var ag=Q.length;for(O=0;O<ag;O+=1){V(Q[O])}}catch(ae){}try{P=R.nodeType}catch(T){P=false;J("html2canvas: failed to access some element's nodeType - Exception: "+T.message)}if(P===1||P===G){try{af=M.Util.getCSS(R,"backgroundImage")}catch(ae){J("html2canvas: failed to get background-image - Exception: "+ae.message)}if(af&&af!=="1"&&af!=="none"){if(/^(-webkit|-o|-moz|-ms|linear)-/.test(af)){N=M.Generate.Gradient(af,M.Util.Bounds(R));if(N!==G){u[af]={img:N,succeeded:true};u.numTotal++;u.numLoaded++;Z()}}else{S=M.Util.backgroundImage(af.match(/data:image\/.*;base64,/i)?af:af.split(",")[0]);f.loadImage(S)}}}}function l(O,N){O.onload=function(){if(N.timer!==G){B.clearTimeout(N.timer)}u.numLoaded++;N.succeeded=true;O.onerror=O.onload=null;Z()};O.onerror=function(P){console.log("img error",P);if(O.crossOrigin==="anonymous"){B.clearTimeout(N.timer);if(aa.proxy){var Q=O.src;O=new Image();N.img=O;O.src=Q;p(O.src,O,N);return}}u.numLoaded++;u.numFailed++;N.succeeded=false;O.onerror=O.onload=null;Z()}}f={loadImage:function(N){var P,O;if(N&&u[N]===G){P=new Image();if(N.match(/data:image\/.*;base64,/i)){P.src=N.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,"");O=u[N]={img:P};u.numTotal++;l(P,O)}else{if(b(N)||aa.allowTaint===true){O=u[N]={img:P};u.numTotal++;l(P,O);P.src=N}else{if(U&&!aa.allowTaint&&aa.useCORS){P.crossOrigin="anonymous";O=u[N]={img:P};u.numTotal++;l(P,O);P.src=N;P.customComplete=function(){if(!this.img.complete){this.timer=B.setTimeout(this.img.customComplete,100)}else{this.img.onerror()}}.bind(O);P.customComplete()}else{if(aa.proxy){O=u[N]={img:P};u.numTotal++;p(N,P,O)}}}}}},cleanupDOM:function(N){var P,Q;if(!u.cleanupDone){if(N&&typeof N==="string"){J("html2canvas: Cleanup because: "+N)}else{J("html2canvas: Cleanup after timeout: "+aa.timeout+" ms.")}for(Q in u){if(u.hasOwnProperty(Q)){P=u[Q];if(typeof P==="object"&&P.callbackname&&P.succeeded===G){B[P.callbackname]=G;try{delete B[P.callbackname]}catch(O){}if(P.script&&P.script.parentNode){P.script.setAttribute("src","about:blank");P.script.parentNode.removeChild(P.script)}u.numLoaded++;u.numFailed++;J("html2canvas: Cleaned up failed img: '"+Q+"' Steps: "+u.numLoaded+" / "+u.numTotal)}}}if(B.stop!==G){B.stop()}else{if(I.execCommand!==G){I.execCommand("Stop",false)}}if(I.close!==G){I.close()}u.cleanupDone=true;if(!(N&&typeof N==="string")){Z()}}},renderingDone:function(){if(o){B.clearTimeout(o)}}};if(aa.timeout>0){o=B.setTimeout(f.cleanupDOM,aa.timeout)}J("html2canvas: Preload starts: finding background-images");u.firstRun=true;V(ab);J("html2canvas: Preload: Finding images");for(j=0;j<r;j+=1){f.loadImage(z[j].getAttribute("src"))}u.firstRun=false;J("html2canvas: Preload: Done.");if(u.numTotal===u.numLoaded){Z()}return f};function F(b,f){var a=[];return{storage:a,width:b,height:f,fillRect:function(){a.push({type:"function",name:"fillRect","arguments":arguments})},drawImage:function(){a.push({type:"function",name:"drawImage","arguments":arguments})},fillText:function(){a.push({type:"function",name:"fillText","arguments":arguments})},setVariable:function(j,g){a.push({type:"variable",name:j,"arguments":g})}}}M.Renderer=function(b,f){var g=[];function a(r){var V=[],p=[],o=r.children,l,S,W,j,u,T,z,U;for(l=0,u=o.length;l<u;l+=1){T=o[l];if(T.children&&T.children.length>0){V.push(T);p.push(T.zindex)}else{g.push(T)}}p.sort(function(N,O){return N-O});for(S=0,W=p.length;S<W;S+=1){j=p[S];for(z=0,U=V.length;z<=U;z+=1){if(V[z].zindex===j){T=V.splice(z,1);a(T[0]);break}}}}a(b.zIndex);if(typeof f._renderer._create!=="function"){throw new Error("Invalid renderer defined")}return f._renderer._create(b,f,I,g,M)};D=function(a,f){var l,g,j={logging:false,elements:a,proxy:"http://html2canvas.appspot.com/",timeout:0,useCORS:false,allowTaint:false,svgRendering:false,iframeDefault:"default",ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:true,letterRendering:false,flashcanvas:G,width:null,height:null,taintTest:true,renderer:"Canvas"},b;j=M.Util.Extend(f,j);if(typeof j.renderer==="string"&&M.Renderer[j.renderer]!==G){j._renderer=M.Renderer[j.renderer](j)}else{if(typeof j.renderer==="function"){j._renderer=j.renderer(j)}else{throw ("Unknown renderer")}}M.logging=j.logging;j.complete=function(o){if(typeof j.onpreloaded==="function"){if(j.onpreloaded(o)===false){return}}l=M.Parse(o,j);if(typeof j.onparsed==="function"){if(j.onparsed(l)===false){return}}g=M.Renderer(l,j);if(typeof j.onrendered==="function"){j.onrendered(g)}};B.setTimeout(function(){M.Preload(j)},0);return{render:function(p,o){return M.Renderer(p,M.Util.Extend(o,j))},parse:function(p,o){return M.Parse(p,M.Util.Extend(o,j))},preload:function(o){return M.Preload(M.Util.Extend(o,j))},log:J}};D.log=J;D.Renderer={Canvas:G};M.Renderer.Canvas=function(g){g=g||{};var j=I,b=g.canvas||j.createElement("canvas"),p=false,f=false,o=false,a,r=2880;if(b.getContext){J("html2canvas: Renderer: using canvas renderer");o=true}else{if(g.flashcanvas!==G){p=true;J("html2canvas: Renderer: canvas not available, using flashcanvas");var l=j.createElement("script");l.src=g.flashcanvas;l.onload=(function(u,O){var z;if(u.onload===G){if(u.onreadystatechange!==G){z=function(){if(u.readyState!=="loaded"&&u.readyState!=="complete"){B.setTimeout(z,250)}else{O()}};B.setTimeout(z,250)}else{J("html2canvas: Renderer: Can't track when flashcanvas is loaded")}}else{return O}})(l,function(){if(typeof B.FlashCanvas!=="undefined"){J("html2canvas: Renderer: Flashcanvas initialized");B.FlashCanvas.initElement(b);o=true;if(f!==false){a._create.apply(null,f)}}});j.body.appendChild(l)}}a={_create:function(ah,ao,at,ay,z){if(!o){f=arguments;return b}var u=b.getContext("2d"),ap,ax,aq,au,am,al,ag=I.createElement("canvas"),aj=(ag.getContext!==G),ak,ai,aw=(aj)?ag.getContext("2d"):{},ar=[],an;b.width=b.style.width=(!p)?ao.width||ah.ctx.width:Math.min(r,(ao.width||ah.ctx.width));b.height=b.style.height=(!p)?ao.height||ah.ctx.height:Math.min(r,(ao.height||ah.ctx.height));an=u.fillStyle;u.fillStyle=ah.backgroundColor;u.fillRect(0,0,b.width,b.height);u.fillStyle=an;if(ao.svgRendering&&ah.svgRender!==G){u.drawImage(ah.svgRender,0,0)}else{for(ax=0,aq=ay.length;ax<aq;ax+=1){ap=ay.splice(0,1)[0];ap.canvasPosition=ap.canvasPosition||{};u.textBaseline="bottom";if(ap.clip){u.save();u.beginPath();u.rect(ap.clip.left,ap.clip.top,ap.clip.width,ap.clip.height);u.clip()}if(ap.ctx.storage){for(au=0,ak=ap.ctx.storage.length;au<ak;au+=1){ai=ap.ctx.storage[au];switch(ai.type){case"variable":u[ai.name]=ai["arguments"];break;case"function":if(ai.name==="fillRect"){if(!p||ai["arguments"][0]+ai["arguments"][2]<r&&ai["arguments"][1]+ai["arguments"][3]<r){u.fillRect.apply(u,ai["arguments"])}}else{if(ai.name==="fillText"){if(!p||ai["arguments"][1]<r&&ai["arguments"][2]<r){u.fillText.apply(u,ai["arguments"])}}else{if(ai.name==="drawImage"){if(ai["arguments"][8]>0&&ai["arguments"][7]){if(aj&&ao.taintTest){if(ar.indexOf(ai["arguments"][0].src)===-1){aw.drawImage(ai["arguments"][0],0,0);try{aw.getImageData(0,0,1,1)}catch(av){ag=at.createElement("canvas");aw=ag.getContext("2d");continue}ar.push(ai["arguments"][0].src)}}u.drawImage.apply(u,ai["arguments"])}}}}break;default:}}}if(ap.clip){u.restore()}}}J("html2canvas: Renderer: Canvas renderer done - returning canvas obj");aq=ao.elements.length;if(aq===1){if(typeof ao.elements[0]==="object"&&ao.elements[0].nodeName!=="BODY"&&p===false){al=z.Util.Bounds(ao.elements[0]);am=at.createElement("canvas");am.width=al.width;am.height=al.height;u=am.getContext("2d");u.drawImage(b,al.left,al.top,al.width,al.height,0,0,al.width,al.height);b=null;return am}}return b}};return a};B.html2canvas=D}(window,document));(function(b){b.fn.html2canvas=function(z){if(z&&z.profile&&window.console&&window.console.profile){console.profile()}var B=new Date(),r,a=null,u=false,C=B.getTime();z=z||{};z.onrendered=z.onrendered||function(f){var j=b(f),g=new Date();if(z&&z.profile&&window.console&&window.console.profileEnd){console.profileEnd()}j.css({position:"absolute",left:0,top:0}).appendTo(document.body);j.siblings().toggle();b(window).click(function(){j.toggle().siblings().toggle();D("Canvas Render "+(j.is(":visible")?"visible":"hidden"))});D("Screenshot created in "+((g.getTime()-C))+" ms<br />",4000);try{j[0].toDataURL()}catch(l){if(j[0].nodeName.toLowerCase()==="canvas"){alert("Canvas is tainted, unable to read data")}}};r=html2canvas(this,z);function D(f,g){window.clearTimeout(u);u=window.setTimeout(function(){a.fadeOut(function(){a.remove();a=null})},g||2000);if(a){a.remove()}a=b("<div />").html(f).css({margin:0,padding:10,background:"#000",opacity:0.7,position:"fixed",top:10,right:10,fontFamily:"Tahoma",color:"#fff",fontSize:12,borderRadius:12,width:"auto",height:"auto",textAlign:"center",textDecoration:"none",display:"none"}).appendTo(document.body).fadeIn();r.log(f)}}})(jQuery);jQuery.download=function(l,p,o){if(l&&p){var j=jQuery("<form />",{action:l,target:"_blank",method:(o||"get")});jQuery.each(p,function(a,f){var b=jQuery("<input />",{type:"hidden",name:a,value:f}).appendTo(j)});jQuery("body").append(j);return j.submit().remove()}throw new Error("$.download(url, data) - url or data invalid")};var SWFUpload;if(SWFUpload==undefined){SWFUpload=function(b){this.initSWFUpload(b)}}SWFUpload.prototype.initSWFUpload=function(f){try{this.customSettings={};this.settings=f;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(g){delete SWFUpload.instances[this.movieName];throw g}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(j){if(typeof(j)!=="string"||j.match(/^https?:\/\//i)||j.match(/^\//)){return j}var l=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var g=window.location.pathname.lastIndexOf("/");if(g<=0){path="/"}else{path=window.location.pathname.substr(0,g)+"/"}return path+j};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(f,g){this.settings[f]=(this.settings[f]==undefined)?g:this.settings[f]};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+new Date().getTime()}if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)}delete this.ensureDefault};SWFUpload.prototype.loadFlash=function(){var g,f;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}g=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(g==undefined){throw"Could not find the placeholder element: "+this.settings.button_placeholder_id}f=document.createElement("div");f.innerHTML=this.getFlashHTML();g.parentNode.replaceChild(f.firstChild,g);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement()}};SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var f=this.buildParamString();var g=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(g),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(f),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var l=this.settings.post_params;var g=[];if(typeof(l)==="object"){for(var j in l){if(l.hasOwnProperty(j)){g.push(encodeURIComponent(j.toString())+"="+encodeURIComponent(l[j].toString()))}}}return g.join("&amp;")};SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var o=null;o=this.getMovieElement();if(o&&typeof(o.CallFunction)==="unknown"){for(var u in o){try{if(typeof(o[u])==="function"){o[u]=null}}catch(p){}}try{o.parentNode.removeChild(o)}catch(l){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true}catch(r){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",(this.settings.button_placeholder?"Set":"Not Set"),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(g,l,j){if(l==undefined){return(this.settings[g]=j)}else{return(this.settings[g]=l)}};SWFUpload.prototype.getSetting=function(b){if(this.settings[b]!=undefined){return this.settings[b]}return""};SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement();var returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>");returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue)}return returnValue};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(b){this.callFlash("StartUpload",[b])};SWFUpload.prototype.cancelUpload=function(g,f){if(f!==false){f=true}this.callFlash("CancelUpload",[g,f])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(b){this.callFlash("SetStats",[b])};SWFUpload.prototype.getFile=function(b){if(typeof(b)==="number"){return this.callFlash("GetFileByIndex",[b])}else{return this.callFlash("GetFile",[b])}};SWFUpload.prototype.addFileParam=function(j,g,l){return this.callFlash("AddFileParam",[j,g,l])};SWFUpload.prototype.removeFileParam=function(g,f){this.callFlash("RemoveFileParam",[g,f])};SWFUpload.prototype.setUploadURL=function(b){this.settings.upload_url=b.toString();this.callFlash("SetUploadURL",[b])};SWFUpload.prototype.setPostParams=function(b){this.settings.post_params=b;this.callFlash("SetPostParams",[b])};SWFUpload.prototype.addPostParam=function(g,f){this.settings.post_params[g]=f;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(b){delete this.settings.post_params[b];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(g,f){this.settings.file_types=g;this.settings.file_types_description=f;this.callFlash("SetFileTypes",[g,f])};SWFUpload.prototype.setFileSizeLimit=function(b){this.settings.file_size_limit=b;this.callFlash("SetFileSizeLimit",[b])};SWFUpload.prototype.setFileUploadLimit=function(b){this.settings.file_upload_limit=b;this.callFlash("SetFileUploadLimit",[b])};SWFUpload.prototype.setFileQueueLimit=function(b){this.settings.file_queue_limit=b;this.callFlash("SetFileQueueLimit",[b])};SWFUpload.prototype.setFilePostName=function(b){this.settings.file_post_name=b;this.callFlash("SetFilePostName",[b])};SWFUpload.prototype.setUseQueryString=function(b){this.settings.use_query_string=b;this.callFlash("SetUseQueryString",[b])};SWFUpload.prototype.setRequeueOnError=function(b){this.settings.requeue_on_error=b;this.callFlash("SetRequeueOnError",[b])};SWFUpload.prototype.setHTTPSuccess=function(b){if(typeof b==="string"){b=b.replace(" ","").split(",")}this.settings.http_success=b;this.callFlash("SetHTTPSuccess",[b])};SWFUpload.prototype.setAssumeSuccessTimeout=function(b){this.settings.assume_success_timeout=b;this.callFlash("SetAssumeSuccessTimeout",[b])};SWFUpload.prototype.setDebugEnabled=function(b){this.settings.debug_enabled=b;this.callFlash("SetDebugEnabled",[b])};SWFUpload.prototype.setButtonImageURL=function(b){if(b==undefined){b=""}this.settings.button_image_url=b;this.callFlash("SetButtonImageURL",[b])};SWFUpload.prototype.setButtonDimensions=function(l,j){this.settings.button_width=l;this.settings.button_height=j;var g=this.getMovieElement();if(g!=undefined){g.style.width=l+"px";g.style.height=j+"px"}this.callFlash("SetButtonDimensions",[l,j])};SWFUpload.prototype.setButtonText=function(b){this.settings.button_text=b;this.callFlash("SetButtonText",[b])};SWFUpload.prototype.setButtonTextPadding=function(f,g){this.settings.button_text_top_padding=g;this.settings.button_text_left_padding=f;this.callFlash("SetButtonTextPadding",[f,g])};SWFUpload.prototype.setButtonTextStyle=function(b){this.settings.button_text_style=b;this.callFlash("SetButtonTextStyle",[b])};SWFUpload.prototype.setButtonDisabled=function(b){this.settings.button_disabled=b;this.callFlash("SetButtonDisabled",[b])};SWFUpload.prototype.setButtonAction=function(b){this.settings.button_action=b;this.callFlash("SetButtonAction",[b])};SWFUpload.prototype.setButtonCursor=function(b){this.settings.button_cursor=b;this.callFlash("SetButtonCursor",[b])};SWFUpload.prototype.queueEvent=function(g,l){if(l==undefined){l=[]}else{if(!(l instanceof Array)){l=[l]}}var j=this;if(typeof this.settings[g]==="function"){this.eventQueue.push(function(){this.settings[g].apply(this,l)});setTimeout(function(){j.executeNextEvent()},0)}else{if(this.settings[g]!==null){throw"Event handler "+g+" is unknown or is not a function"}}};SWFUpload.prototype.executeNextEvent=function(){var b=this.eventQueue?this.eventQueue.shift():null;if(typeof(b)==="function"){b.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(B){var u=/[$]([0-9a-f]{4})/i;var r={};var z;if(B!=undefined){for(var p in B.post){if(B.post.hasOwnProperty(p)){z=p;var o;while((o=u.exec(z))!==null){z=z.replace(o[0],String.fromCharCode(parseInt("0x"+o[1],16)))}r[z]=B.post[p]}}B.post=r}return B};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(b){return false}};SWFUpload.prototype.flashReady=function(){var b=this.getMovieElement();if(!b){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(b);this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.cleanUp=function(l){try{if(this.movieElement&&typeof(l.CallFunction)==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var p in l){try{if(typeof(l[p])==="function"){l[p]=null}}catch(j){}}}}catch(o){}window.__flash__removeCallback=function(b,a){try{if(b){b[a]=null}}catch(f){}}};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(b){b=this.unescapeFilePostParams(b);this.queueEvent("file_queued_handler",b)};SWFUpload.prototype.fileQueueError=function(j,l,g){j=this.unescapeFilePostParams(j);this.queueEvent("file_queue_error_handler",[j,l,g])};SWFUpload.prototype.fileDialogComplete=function(g,l,j){this.queueEvent("file_dialog_complete_handler",[g,l,j])};SWFUpload.prototype.uploadStart=function(b){b=this.unescapeFilePostParams(b);this.queueEvent("return_upload_start_handler",b)};SWFUpload.prototype.returnUploadStart=function(g){var f;if(typeof this.settings.upload_start_handler==="function"){g=this.unescapeFilePostParams(g);f=this.settings.upload_start_handler.call(this,g)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}if(f===undefined){f=true}f=!!f;this.callFlash("ReturnUploadStart",[f])};SWFUpload.prototype.uploadProgress=function(j,l,g){j=this.unescapeFilePostParams(j);this.queueEvent("upload_progress_handler",[j,l,g])};SWFUpload.prototype.uploadError=function(j,l,g){j=this.unescapeFilePostParams(j);this.queueEvent("upload_error_handler",[j,l,g])};SWFUpload.prototype.uploadSuccess=function(g,j,l){g=this.unescapeFilePostParams(g);this.queueEvent("upload_success_handler",[g,j,l])};SWFUpload.prototype.uploadComplete=function(b){b=this.unescapeFilePostParams(b);this.queueEvent("upload_complete_handler",b)};SWFUpload.prototype.debug=function(b){this.queueEvent("debug_handler",b)};SWFUpload.prototype.debugMessage=function(p){if(this.settings.debug){var l,o=[];if(typeof p==="object"&&typeof p.name==="string"&&typeof p.message==="string"){for(var j in p){if(p.hasOwnProperty(j)){o.push(j+": "+p[j])}}l=o.join("\n")||"";o=l.split("\n");l="EXCEPTION: "+o.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(l)}else{SWFUpload.Console.writeLine(p)}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(o){var j,l;try{j=document.getElementById("SWFUpload_Console");if(!j){l=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(l);j=document.createElement("textarea");j.id="SWFUpload_Console";j.style.fontFamily="monospace";j.setAttribute("wrap","off");j.wrap="off";j.style.overflow="auto";j.style.width="700px";j.style.height="350px";j.style.margin="5px";l.appendChild(j)}j.value+=o+"\n";j.scrollTop=j.scrollHeight-j.clientHeight}catch(p){alert("Exception: "+p.name+" Message: "+p.message)}};var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.prototype.initSettings=function(b){return function(){if(typeof(b)==="function"){b.call(this)}this.refreshCookies(false)}}(SWFUpload.prototype.initSettings);SWFUpload.prototype.refreshCookies=function(u){if(u===undefined){u=true}u=!!u;var D=this.settings.post_params;var F,z=document.cookie.split(";"),G=z.length,E,B,H,C;for(F=0;F<G;F++){E=z[F];while(E.charAt(0)===" "){E=E.substring(1,E.length)}B=E.indexOf("=");if(B>0){H=E.substring(0,B);C=E.substring(B+1);D[H]=C}}if(u){this.setPostParams(D)}}}var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.queue={};SWFUpload.prototype.initSettings=(function(b){return function(){if(typeof(b)==="function"){b.call(this)}this.queueSettings={};this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler;this.settings.upload_complete_handler=SWFUpload.queue.uploadCompleteHandler;this.settings.upload_start_handler=SWFUpload.queue.uploadStartHandler;this.settings.queue_complete_handler=this.settings.queue_complete_handler||null}})(SWFUpload.prototype.initSettings);SWFUpload.prototype.startUpload=function(b){this.queueSettings.queue_cancelled_flag=false;this.callFlash("StartUpload",[b])};SWFUpload.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=true;this.stopUpload();var b=this.getStats();while(b.files_queued>0){this.cancelUpload();b=this.getStats()}};SWFUpload.queue.uploadStartHandler=function(g){var f;if(typeof(this.queueSettings.user_upload_start_handler)==="function"){f=this.queueSettings.user_upload_start_handler.call(this,g)}f=(f===false)?false:true;this.queueSettings.queue_cancelled_flag=!f;return f};SWFUpload.queue.uploadCompleteHandler=function(j){var p=this.queueSettings.user_upload_complete_handler;var o;if(j.filestatus===SWFUpload.FILE_STATUS.COMPLETE){this.queueSettings.queue_upload_count++}if(typeof(p)==="function"){o=(p.call(this,j)===false)?false:true}else{if(j.filestatus===SWFUpload.FILE_STATUS.QUEUED){o=false}else{o=true}}if(o){var l=this.getStats();if(l.files_queued>0&&this.queueSettings.queue_cancelled_flag===false){this.startUpload()}else{if(this.queueSettings.queue_cancelled_flag===false){this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]);this.queueSettings.queue_upload_count=0}else{this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0}}}}}var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.speed={};SWFUpload.prototype.initSettings=(function(b){return function(){if(typeof(b)==="function"){b.call(this)}this.ensureDefault=function(g,a){this.settings[g]=(this.settings[g]==undefined)?a:this.settings[g]};this.fileSpeedStats={};this.speedSettings={};this.ensureDefault("moving_average_history_size","10");this.speedSettings.user_file_queued_handler=this.settings.file_queued_handler;this.speedSettings.user_file_queue_error_handler=this.settings.file_queue_error_handler;this.speedSettings.user_upload_start_handler=this.settings.upload_start_handler;this.speedSettings.user_upload_error_handler=this.settings.upload_error_handler;this.speedSettings.user_upload_progress_handler=this.settings.upload_progress_handler;this.speedSettings.user_upload_success_handler=this.settings.upload_success_handler;this.speedSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.settings.file_queued_handler=SWFUpload.speed.fileQueuedHandler;this.settings.file_queue_error_handler=SWFUpload.speed.fileQueueErrorHandler;this.settings.upload_start_handler=SWFUpload.speed.uploadStartHandler;this.settings.upload_error_handler=SWFUpload.speed.uploadErrorHandler;this.settings.upload_progress_handler=SWFUpload.speed.uploadProgressHandler;this.settings.upload_success_handler=SWFUpload.speed.uploadSuccessHandler;this.settings.upload_complete_handler=SWFUpload.speed.uploadCompleteHandler;delete this.ensureDefault}})(SWFUpload.prototype.initSettings);SWFUpload.speed.fileQueuedHandler=function(b){if(typeof this.speedSettings.user_file_queued_handler==="function"){b=SWFUpload.speed.extendFile(b);return this.speedSettings.user_file_queued_handler.call(this,b)}};SWFUpload.speed.fileQueueErrorHandler=function(j,l,g){if(typeof this.speedSettings.user_file_queue_error_handler==="function"){j=SWFUpload.speed.extendFile(j);return this.speedSettings.user_file_queue_error_handler.call(this,j,l,g)}};SWFUpload.speed.uploadStartHandler=function(b){if(typeof this.speedSettings.user_upload_start_handler==="function"){b=SWFUpload.speed.extendFile(b,this.fileSpeedStats);return this.speedSettings.user_upload_start_handler.call(this,b)}};SWFUpload.speed.uploadErrorHandler=function(j,l,g){j=SWFUpload.speed.extendFile(j,this.fileSpeedStats);SWFUpload.speed.removeTracking(j,this.fileSpeedStats);if(typeof this.speedSettings.user_upload_error_handler==="function"){return this.speedSettings.user_upload_error_handler.call(this,j,l,g)}};SWFUpload.speed.uploadProgressHandler=function(j,l,g){this.updateTracking(j,l);j=SWFUpload.speed.extendFile(j,this.fileSpeedStats);if(typeof this.speedSettings.user_upload_progress_handler==="function"){return this.speedSettings.user_upload_progress_handler.call(this,j,l,g)}};SWFUpload.speed.uploadSuccessHandler=function(f,g){if(typeof this.speedSettings.user_upload_success_handler==="function"){f=SWFUpload.speed.extendFile(f,this.fileSpeedStats);return this.speedSettings.user_upload_success_handler.call(this,f,g)}};SWFUpload.speed.uploadCompleteHandler=function(b){b=SWFUpload.speed.extendFile(b,this.fileSpeedStats);SWFUpload.speed.removeTracking(b,this.fileSpeedStats);if(typeof this.speedSettings.user_upload_complete_handler==="function"){return this.speedSettings.user_upload_complete_handler.call(this,b)}};SWFUpload.speed.extendFile=function(g,j){var l;if(j){l=j[g.id]}if(l){g.currentSpeed=l.currentSpeed;g.averageSpeed=l.averageSpeed;g.movingAverageSpeed=l.movingAverageSpeed;g.timeRemaining=l.timeRemaining;g.timeElapsed=l.timeElapsed;g.percentUploaded=l.percentUploaded;g.sizeUploaded=l.bytesUploaded}else{g.currentSpeed=0;g.averageSpeed=0;g.movingAverageSpeed=0;g.timeRemaining=0;g.timeElapsed=0;g.percentUploaded=0;g.sizeUploaded=0}return g};SWFUpload.prototype.updateTracking=function(C,F){var z=this.fileSpeedStats[C.id];if(!z){this.fileSpeedStats[C.id]=z={}}F=F||z.bytesUploaded||0;if(F<0){F=0}if(F>C.size){F=C.size}var E=(new Date()).getTime();if(!z.startTime){z.startTime=(new Date()).getTime();z.lastTime=z.startTime;z.currentSpeed=0;z.averageSpeed=0;z.movingAverageSpeed=0;z.movingAverageHistory=[];z.timeRemaining=0;z.timeElapsed=0;z.percentUploaded=F/C.size;z.bytesUploaded=F}else{if(z.startTime>E){this.debug("When backwards in time")}else{var D=(new Date()).getTime();var B=z.lastTime;var r=D-B;var u=F-z.bytesUploaded;if(u===0||r===0){return z}z.lastTime=D;z.bytesUploaded=F;z.currentSpeed=(u*8)/(r/1000);z.averageSpeed=(z.bytesUploaded*8)/((D-z.startTime)/1000);z.movingAverageHistory.push(z.currentSpeed);if(z.movingAverageHistory.length>this.settings.moving_average_history_size){z.movingAverageHistory.shift()}z.movingAverageSpeed=SWFUpload.speed.calculateMovingAverage(z.movingAverageHistory);z.timeRemaining=(C.size-z.bytesUploaded)*8/z.movingAverageSpeed;z.timeElapsed=(D-z.startTime)/1000;z.percentUploaded=(z.bytesUploaded/C.size*100)}}return z};SWFUpload.speed.removeTracking=function(l,j){try{j[l.id]=null;delete j[l.id]}catch(g){}};SWFUpload.speed.formatUnits=function(C,G,H,B){var F,D,I,J;if(C===0){return"0 "+H[H.length-1]}if(B){D=C;J=H.length>=G.length?H[G.length-1]:"";for(F=0;F<G.length;F++){if(C>=G[F]){D=(C/G[F]).toFixed(2);J=H.length>=F?" "+H[F]:"";break}}return D+J}else{var E=[];var z=C;for(F=0;F<G.length;F++){I=G[F];J=H.length>F?" "+H[F]:"";D=z/I;if(F<G.length-1){D=Math.floor(D)}else{D=D.toFixed(2)}if(D>0){z=z%I;E.push(D+J)}}return E.join(" ")}};SWFUpload.speed.formatBPS=function(g){var l=[1073741824,1048576,1024,1],j=["Gbps","Mbps","Kbps","bps"];return SWFUpload.speed.formatUnits(g,l,j,true)};SWFUpload.speed.formatTime=function(l){var j=[86400,3600,60,1],g=["d","h","m","s"];return SWFUpload.speed.formatUnits(l,j,g,false)};SWFUpload.speed.formatBytes=function(l){var g=[1073741824,1048576,1024,1],j=["GB","MB","KB","bytes"];return SWFUpload.speed.formatUnits(l,g,j,true)};SWFUpload.speed.formatPercent=function(b){return b.toFixed(2)+" %"};SWFUpload.speed.calculateMovingAverage=function(E){var C=[],K,F=0,D=0,H=0,M=0,I=0;var G;var J=0,O=0;K=E.length;if(K>=8){for(G=0;G<K;G++){C[G]=E[G];F+=C[G]}D=F/K;for(G=0;G<K;G++){H+=Math.pow((C[G]-D),2)}M=H/K;I=Math.sqrt(M);for(G=0;G<K;G++){C[G]=(C[G]-D)/I}var N=2;for(G=0;G<K;G++){if(C[G]<=N&&C[G]>=-N){O++;J+=E[G]}}}else{O=K;for(G=0;G<K;G++){J+=E[G]}}return J/O}}var swfobject=function(){var b="undefined",Q="object",n="Shockwave Flash",p="ShockwaveFlash.ShockwaveFlash",P="application/x-shockwave-flash",m="SWFObjectExprInst",j=window,K=document,T=navigator,o=[],N=[],i=[],d=[],J,Z=null,M=null,l=null,e=false,A=false;var h=function(){var v=typeof K.getElementById!=b&&typeof K.getElementsByTagName!=b&&typeof K.createElement!=b,AC=[0,0,0],x=null;if(typeof T.plugins!=b&&typeof T.plugins[n]==Q){x=T.plugins[n].description;if(x&&!(typeof T.mimeTypes!=b&&T.mimeTypes[P]&&!T.mimeTypes[P].enabledPlugin)){x=x.replace(/^.*\s+(\S+\s+\S+$)/,"$1");AC[0]=parseInt(x.replace(/^(.*)\..*$/,"$1"),10);AC[1]=parseInt(x.replace(/^.*\.(.*)\s.*$/,"$1"),10);AC[2]=/r/.test(x)?parseInt(x.replace(/^.*r(.*)$/,"$1"),10):0}}else{if(typeof j.ActiveXObject!=b){var y=null,AB=false;try{y=new ActiveXObject(p+".7")}catch(t){try{y=new ActiveXObject(p+".6");AC=[6,0,21];y.AllowScriptAccess="always"}catch(t){if(AC[0]==6){AB=true}}if(!AB){try{y=new ActiveXObject(p)}catch(t){}}}if(!AB&&y){try{x=y.GetVariable("$version");if(x){x=x.split(" ")[1].split(",");AC=[parseInt(x[0],10),parseInt(x[1],10),parseInt(x[2],10)]}}catch(t){}}}}var AD=T.userAgent.toLowerCase(),r=T.platform.toLowerCase(),AA=/webkit/.test(AD)?parseFloat(AD.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,q=false,z=r?/win/.test(r):/win/.test(AD),w=r?/mac/.test(r):/mac/.test(AD);
/*@cc_on q=true;@if(@_win32)z=true;@elif(@_mac)w=true;@end@*/
return{w3cdom:v,pv:AC,webkit:AA,ie:q,win:z,mac:w}}();var L=function(){if(!h.w3cdom){return}f(H);if(h.ie&&h.win){try{K.write("<script id=__ie_ondomload defer=true src=//:><\/script>");J=C("__ie_ondomload");if(J){I(J,"onreadystatechange",S)}}catch(q){}}if(h.webkit&&typeof K.readyState!=b){Z=setInterval(function(){if(/loaded|complete/.test(K.readyState)){E()}},10)}if(typeof K.addEventListener!=b){K.addEventListener("DOMContentLoaded",E,null)}R(E)}();function S(){if(J.readyState=="complete"){J.parentNode.removeChild(J);E()}}function E(){if(e){return}if(h.ie&&h.win){var v=a("span");try{var u=K.getElementsByTagName("body")[0].appendChild(v);u.parentNode.removeChild(u)}catch(w){return}}e=true;if(Z){clearInterval(Z);Z=null}var q=o.length;for(var r=0;r<q;r++){o[r]()}}function f(q){if(e){q()}else{o[o.length]=q}}function R(r){if(typeof j.addEventListener!=b){j.addEventListener("load",r,false)}else{if(typeof K.addEventListener!=b){K.addEventListener("load",r,false)}else{if(typeof j.attachEvent!=b){I(j,"onload",r)}else{if(typeof j.onload=="function"){var q=j.onload;j.onload=function(){q();r()}}else{j.onload=r}}}}}function H(){var t=N.length;for(var q=0;q<t;q++){var u=N[q].id;if(h.pv[0]>0){var r=C(u);if(r){N[q].width=r.getAttribute("width")?r.getAttribute("width"):"0";N[q].height=r.getAttribute("height")?r.getAttribute("height"):"0";if(c(N[q].swfVersion)){if(h.webkit&&h.webkit<312){Y(r)}W(u,true)}else{if(N[q].expressInstall&&!A&&c("6.0.65")&&(h.win||h.mac)){k(N[q])}else{O(r)}}}}else{W(u,true)}}}function Y(t){var q=t.getElementsByTagName(Q)[0];if(q){var w=a("embed"),y=q.attributes;if(y){var v=y.length;for(var u=0;u<v;u++){if(y[u].nodeName=="DATA"){w.setAttribute("src",y[u].nodeValue)}else{w.setAttribute(y[u].nodeName,y[u].nodeValue)}}}var x=q.childNodes;if(x){var z=x.length;for(var r=0;r<z;r++){if(x[r].nodeType==1&&x[r].nodeName=="PARAM"){w.setAttribute(x[r].getAttribute("name"),x[r].getAttribute("value"))}}}t.parentNode.replaceChild(w,t)}}function k(w){A=true;var u=C(w.id);if(u){if(w.altContentId){var y=C(w.altContentId);if(y){M=y;l=w.altContentId}}else{M=G(u)}if(!(/%$/.test(w.width))&&parseInt(w.width,10)<310){w.width="310"}if(!(/%$/.test(w.height))&&parseInt(w.height,10)<137){w.height="137"}K.title=K.title.slice(0,47)+" - Flash Player Installation";var z=h.ie&&h.win?"ActiveX":"PlugIn",q=K.title,r="MMredirectURL="+j.location+"&MMplayerType="+z+"&MMdoctitle="+q,x=w.id;if(h.ie&&h.win&&u.readyState!=4){var t=a("div");x+="SWFObjectNew";t.setAttribute("id",x);u.parentNode.insertBefore(t,u);u.style.display="none";var v=function(){u.parentNode.removeChild(u)};I(j,"onload",v)}U({data:w.expressInstall,id:m,width:w.width,height:w.height},{flashvars:r},x)}}function O(t){if(h.ie&&h.win&&t.readyState!=4){var r=a("div");t.parentNode.insertBefore(r,t);r.parentNode.replaceChild(G(t),r);t.style.display="none";var q=function(){t.parentNode.removeChild(t)};I(j,"onload",q)}else{t.parentNode.replaceChild(G(t),t)}}function G(v){var u=a("div");if(h.win&&h.ie){u.innerHTML=v.innerHTML}else{var r=v.getElementsByTagName(Q)[0];if(r){var w=r.childNodes;if(w){var q=w.length;for(var t=0;t<q;t++){if(!(w[t].nodeType==1&&w[t].nodeName=="PARAM")&&!(w[t].nodeType==8)){u.appendChild(w[t].cloneNode(true))}}}}}return u}function U(AG,AE,t){var q,v=C(t);if(v){if(typeof AG.id==b){AG.id=t}if(h.ie&&h.win){var AF="";for(var AB in AG){if(AG[AB]!=Object.prototype[AB]){if(AB.toLowerCase()=="data"){AE.movie=AG[AB]}else{if(AB.toLowerCase()=="styleclass"){AF+=' class="'+AG[AB]+'"'}else{if(AB.toLowerCase()!="classid"){AF+=" "+AB+'="'+AG[AB]+'"'}}}}}var AD="";for(var AA in AE){if(AE[AA]!=Object.prototype[AA]){AD+='<param name="'+AA+'" value="'+AE[AA]+'" />'}}v.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+AF+">"+AD+"</object>";i[i.length]=AG.id;q=C(AG.id)}else{if(h.webkit&&h.webkit<312){var AC=a("embed");AC.setAttribute("type",P);for(var z in AG){if(AG[z]!=Object.prototype[z]){if(z.toLowerCase()=="data"){AC.setAttribute("src",AG[z])}else{if(z.toLowerCase()=="styleclass"){AC.setAttribute("class",AG[z])}else{if(z.toLowerCase()!="classid"){AC.setAttribute(z,AG[z])}}}}}for(var y in AE){if(AE[y]!=Object.prototype[y]){if(y.toLowerCase()!="movie"){AC.setAttribute(y,AE[y])}}}v.parentNode.replaceChild(AC,v);q=AC}else{var u=a(Q);u.setAttribute("type",P);for(var x in AG){if(AG[x]!=Object.prototype[x]){if(x.toLowerCase()=="styleclass"){u.setAttribute("class",AG[x])}else{if(x.toLowerCase()!="classid"){u.setAttribute(x,AG[x])}}}}for(var w in AE){if(AE[w]!=Object.prototype[w]&&w.toLowerCase()!="movie"){F(u,w,AE[w])}}v.parentNode.replaceChild(u,v);q=u}}}return q}function F(t,q,r){var u=a("param");u.setAttribute("name",q);u.setAttribute("value",r);t.appendChild(u)}function X(r){var q=C(r);if(q&&(q.nodeName=="OBJECT"||q.nodeName=="EMBED")){if(h.ie&&h.win){if(q.readyState==4){B(r)}else{j.attachEvent("onload",function(){B(r)})}}else{q.parentNode.removeChild(q)}}}function B(t){var r=C(t);if(r){for(var q in r){if(typeof r[q]=="function"){r[q]=null}}r.parentNode.removeChild(r)}}function C(t){var q=null;try{q=K.getElementById(t)}catch(r){}return q}function a(q){return K.createElement(q)}function I(t,q,r){t.attachEvent(q,r);d[d.length]=[t,q,r]}function c(t){var r=h.pv,q=t.split(".");q[0]=parseInt(q[0],10);q[1]=parseInt(q[1],10)||0;q[2]=parseInt(q[2],10)||0;return(r[0]>q[0]||(r[0]==q[0]&&r[1]>q[1])||(r[0]==q[0]&&r[1]==q[1]&&r[2]>=q[2]))?true:false}function V(v,r){if(h.ie&&h.mac){return}var u=K.getElementsByTagName("head")[0],t=a("style");t.setAttribute("type","text/css");t.setAttribute("media","screen");if(!(h.ie&&h.win)&&typeof K.createTextNode!=b){t.appendChild(K.createTextNode(v+" {"+r+"}"))}u.appendChild(t);if(h.ie&&h.win&&typeof K.styleSheets!=b&&K.styleSheets.length>0){var q=K.styleSheets[K.styleSheets.length-1];if(typeof q.addRule==Q){q.addRule(v,r)}}}function W(t,q){var r=q?"visible":"hidden";if(e&&C(t)){C(t).style.visibility=r}else{V("#"+t,"visibility:"+r)}}function g(s){var r=/[\\\"<>\.;]/;var q=r.exec(s)!=null;return q?encodeURIComponent(s):s}var D=function(){if(h.ie&&h.win){window.attachEvent("onunload",function(){var w=d.length;for(var v=0;v<w;v++){d[v][0].detachEvent(d[v][1],d[v][2])}var t=i.length;for(var u=0;u<t;u++){X(i[u])}for(var r in h){h[r]=null}h=null;for(var q in swfobject){swfobject[q]=null}swfobject=null})}}();return{registerObject:function(u,q,t){if(!h.w3cdom||!u||!q){return}var r={};r.id=u;r.swfVersion=q;r.expressInstall=t?t:false;N[N.length]=r;W(u,false)},getObjectById:function(v){var q=null;if(h.w3cdom){var t=C(v);if(t){var u=t.getElementsByTagName(Q)[0];if(!u||(u&&typeof t.SetVariable!=b)){q=t}else{if(typeof u.SetVariable!=b){q=u}}}}return q},embedSWF:function(x,AE,AB,AD,q,w,r,z,AC){if(!h.w3cdom||!x||!AE||!AB||!AD||!q){return}AB+="";AD+="";if(c(q)){W(AE,false);var AA={};if(AC&&typeof AC===Q){for(var v in AC){if(AC[v]!=Object.prototype[v]){AA[v]=AC[v]}}}AA.data=x;AA.width=AB;AA.height=AD;var y={};if(z&&typeof z===Q){for(var u in z){if(z[u]!=Object.prototype[u]){y[u]=z[u]}}}if(r&&typeof r===Q){for(var t in r){if(r[t]!=Object.prototype[t]){if(typeof y.flashvars!=b){y.flashvars+="&"+t+"="+r[t]}else{y.flashvars=t+"="+r[t]}}}}f(function(){U(AA,y,AE);if(AA.id==AE){W(AE,true)}})}else{if(w&&!A&&c("6.0.65")&&(h.win||h.mac)){A=true;W(AE,false);f(function(){var AF={};AF.id=AF.altContentId=AE;AF.width=AB;AF.height=AD;AF.expressInstall=w;k(AF)})}}},getFlashPlayerVersion:function(){return{major:h.pv[0],minor:h.pv[1],release:h.pv[2]}},hasFlashPlayerVersion:c,createSWF:function(t,r,q){if(h.w3cdom){return U(t,r,q)}else{return undefined}},removeSWF:function(q){if(h.w3cdom){X(q)}},createCSS:function(r,q){if(h.w3cdom){V(r,q)}},addDomLoadEvent:f,addLoadEvent:R,getQueryParamValue:function(v){var u=K.location.search||K.location.hash;if(v==null){return g(u)}if(u){var t=u.substring(1).split("&");for(var r=0;r<t.length;r++){if(t[r].substring(0,t[r].indexOf("="))==v){return g(t[r].substring((t[r].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(A&&M){var q=C(m);if(q){q.parentNode.replaceChild(M,q);if(l){W(l,true);if(h.ie&&h.win){M.style.display="block"}}M=null;l=null;A=false}}}}}();var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.onload=function(){};swfobject.addDomLoadEvent(function(){if(typeof(SWFUpload.onload)==="function"){SWFUpload.onload.call(window)}});SWFUpload.prototype.initSettings=(function(b){return function(){if(typeof(b)==="function"){b.call(this)}this.ensureDefault=function(g,a){this.settings[g]=(this.settings[g]==undefined)?a:this.settings[g]};this.ensureDefault("minimum_flash_version","9.0.28");this.ensureDefault("swfupload_pre_load_handler",null);this.ensureDefault("swfupload_load_failed_handler",null);delete this.ensureDefault}})(SWFUpload.prototype.initSettings);SWFUpload.prototype.loadFlash=function(b){return function(){var a=swfobject.hasFlashPlayerVersion(this.settings.minimum_flash_version);if(a){this.queueEvent("swfupload_pre_load_handler");if(typeof(b)==="function"){b.call(this)}}else{this.queueEvent("swfupload_load_failed_handler")}}}(SWFUpload.prototype.loadFlash);SWFUpload.prototype.displayDebugInfo=function(b){return function(){if(typeof(b)==="function"){b.call(this)}this.debug(["SWFUpload.SWFObject Plugin settings:","\n","\t","minimum_flash_version:                      ",this.settings.minimum_flash_version,"\n","\t","swfupload_pre_load_handler assigned:     ",(typeof(this.settings.swfupload_pre_load_handler)==="function").toString(),"\n","\t","swfupload_load_failed_handler assigned:     ",(typeof(this.settings.swfupload_load_failed_handler)==="function").toString(),"\n",].join(""))}}(SWFUpload.prototype.displayDebugInfo)}function swfUploadPreLoad(){var g=this;var f=function(){document.getElementById("divLoadingContent").style.display="";var a=function(){document.getElementById("divLoadingContent").style.display="none";document.getElementById("divLongLoading").style.display=""};this.customSettings.loadingTimeout=setTimeout(function(){a.call(g)},15*1000)};this.customSettings.loadingTimeout=setTimeout(function(){f.call(g)},1*1000)}function swfUploadLoaded(){var b=this;clearTimeout(this.customSettings.loadingTimeout);document.getElementById("divLoadingContent").style.display="none";document.getElementById("divLongLoading").style.display="none";document.getElementById("divAlternateContent").style.display="none";document.getElementById("btnCancel").onclick=function(){b.cancelQueue()}}function swfUploadLoadFailed(){clearTimeout(this.customSettings.loadingTimeout);document.getElementById("divLoadingContent").style.display="none";document.getElementById("divLongLoading").style.display="none";document.getElementById("divAlternateContent").style.display=""}function fileQueued(l){try{var j=new FileProgress(l,this.customSettings.progressTarget);j.setStatus("Pending...");j.toggleCancel(true,this)}catch(g){this.debug(g)}}function fileQueueError(u,p,r){giscloud.log.push("upload_error",{type:"flash",msg:r,errorcode:p});try{if(p===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("You have attempted to queue too many files.\n"+(r===0?"You have reached the upload limit.":"You may select "+(r>1?"up to "+r+" files.":"one file.")));return}var o=new FileProgress(u,this.customSettings.progressTarget);o.setError();o.toggleCancel(false);switch(p){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:o.setStatus("File is too big.");this.debug("Error Code: File too big, File name: "+u.name+", File size: "+u.size+", Message: "+r);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:o.setStatus("Cannot upload Zero Byte files.");this.debug("Error Code: Zero byte file, File name: "+u.name+", File size: "+u.size+", Message: "+r);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:o.setStatus("Invalid File Type.");this.debug("Error Code: Invalid File Type, File name: "+u.name+", File size: "+u.size+", Message: "+r);break;default:if(u!==null){o.setStatus("Unhandled Error")}this.debug("Error Code: "+p+", File name: "+u.name+", File size: "+u.size+", Message: "+r);break}}catch(l){this.debug(l)}}function fileDialogComplete(j,l){try{if(j>0){document.getElementById(this.customSettings.cancelButtonId).disabled=false}giscloud.log.push("upload_start",{type:"flash",count:j});this.startUpload()}catch(g){this.debug(g)}}function uploadStart(l){try{giscloud.log.push("upload_file",{type:"flash",file:l.name});var j=new FileProgress(l,this.customSettings.progressTarget);j.setStatus("Uploading...");j.toggleCancel(true,this)}catch(g){}return true}function uploadProgress(B,r,u){try{var z=Math.ceil((r/u)*100);var p=new FileProgress(B,this.customSettings.progressTarget);p.setProgress(z);p.setStatus("Uploading...")}catch(o){this.debug(o)}}function uploadSuccess(o,j){try{var l=new FileProgress(o,this.customSettings.progressTarget);l.setComplete();l.setStatus("Complete.");l.toggleCancel(false)}catch(p){this.debug(p)}}function uploadError(u,p,r){try{giscloud.log.push("upload_error",{type:"flash",msg:r,errorcode:p});var o=new FileProgress(u,this.customSettings.progressTarget);o.setError();o.toggleCancel(false);switch(p){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:o.setStatus("Upload Error: "+r);this.debug("Error Code: HTTP Error, File name: "+u.name+", Message: "+r);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:o.setStatus("Upload Failed.");this.debug("Error Code: Upload Failed, File name: "+u.name+", File size: "+u.size+", Message: "+r);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:o.setStatus("Server (IO) Error");this.debug("Error Code: IO Error, File name: "+u.name+", Message: "+r);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:o.setStatus("Security Error");this.debug("Error Code: Security Error, File name: "+u.name+", Message: "+r);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:o.setStatus("Upload limit exceeded.");this.debug("Error Code: Upload Limit Exceeded, File name: "+u.name+", File size: "+u.size+", Message: "+r);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:o.setStatus("Failed Validation.  Upload skipped.");this.debug("Error Code: File Validation Failed, File name: "+u.name+", File size: "+u.size+", Message: "+r);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:if(this.getStats().files_queued===0){document.getElementById(this.customSettings.cancelButtonId).disabled=true}o.setStatus("Cancelled");o.setCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:o.setStatus("Stopped");break;default:o.setStatus("Unhandled Error: "+p);this.debug("Error Code: "+p+", File name: "+u.name+", File size: "+u.size+", Message: "+r);break}}catch(l){this.debug(l)}}function uploadComplete(b){if(this.getStats().files_queued===0){document.getElementById(this.customSettings.cancelButtonId).disabled=true}giscloud.log.push("upload_file_completed",{type:"flash",file:b.name})}function queueComplete(f){var g=document.getElementById("divStatus");g.innerHTML=f+" file"+(f===1?"":"s")+" uploaded.";giscloud.log.push("upload_completed",{type:"flash",uploaded:f})}function FileProgress(B,r){this.fileProgressID=B.id;this.opacity=100;this.height=0;this.fileProgressWrapper=document.getElementById(this.fileProgressID);if(!this.fileProgressWrapper){this.fileProgressWrapper=document.createElement("div");this.fileProgressWrapper.className="progressWrapper";this.fileProgressWrapper.id=this.fileProgressID;this.fileProgressElement=document.createElement("div");this.fileProgressElement.className="progressContainer";var p=document.createElement("a");p.className="progressCancel";p.href="#";p.style.visibility="hidden";p.appendChild(document.createTextNode(" "));var o=document.createElement("div");o.className="progressName";o.appendChild(document.createTextNode(B.name));var u=document.createElement("div");u.className="progressBarInProgress";var z=document.createElement("div");z.className="progressBarStatus";z.innerHTML="&nbsp;";this.fileProgressElement.appendChild(p);this.fileProgressElement.appendChild(o);this.fileProgressElement.appendChild(z);this.fileProgressElement.appendChild(u);this.fileProgressWrapper.appendChild(this.fileProgressElement);document.getElementById(r).appendChild(this.fileProgressWrapper)}else{this.fileProgressElement=this.fileProgressWrapper.firstChild;this.reset()}this.height=this.fileProgressWrapper.offsetHeight;this.setTimer(null)}FileProgress.prototype.setTimer=function(b){this.fileProgressElement.FP_TIMER=b};FileProgress.prototype.getTimer=function(b){return this.fileProgressElement.FP_TIMER||null};FileProgress.prototype.reset=function(){this.fileProgressElement.className="progressContainer";this.fileProgressElement.childNodes[2].innerHTML="&nbsp;";this.fileProgressElement.childNodes[2].className="progressBarStatus";this.fileProgressElement.childNodes[3].className="progressBarInProgress";this.fileProgressElement.childNodes[3].style.width="0%";this.appear()};FileProgress.prototype.setProgress=function(b){this.fileProgressElement.className="progressContainer green";this.fileProgressElement.childNodes[3].className="progressBarInProgress";this.fileProgressElement.childNodes[3].style.width=b+"%";this.appear()};FileProgress.prototype.setComplete=function(){this.fileProgressElement.className="progressContainer blue";this.fileProgressElement.childNodes[3].className="progressBarComplete";this.fileProgressElement.childNodes[3].style.width="";var b=this;this.setTimer(setTimeout(function(){b.disappear()},10000))};FileProgress.prototype.setError=function(){this.fileProgressElement.className="progressContainer red";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width="";var b=this;this.setTimer(setTimeout(function(){b.disappear()},5000))};FileProgress.prototype.setCancelled=function(){this.fileProgressElement.className="progressContainer";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width="";var b=this;this.setTimer(setTimeout(function(){b.disappear()},2000))};FileProgress.prototype.setStatus=function(b){this.fileProgressElement.childNodes[2].innerHTML=b};FileProgress.prototype.toggleCancel=function(g,l){this.fileProgressElement.childNodes[0].style.visibility=g?"visible":"hidden";if(l){var j=this.fileProgressID;this.fileProgressElement.childNodes[0].onclick=function(){l.cancelUpload(j);return false}}};FileProgress.prototype.appear=function(){if(this.getTimer()!==null){clearTimeout(this.getTimer());this.setTimer(null)}if(this.fileProgressWrapper.filters){try{this.fileProgressWrapper.filters.item("DXImageTransform.Microsoft.Alpha").opacity=100}catch(b){this.fileProgressWrapper.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=100)"}}else{this.fileProgressWrapper.style.opacity=1}this.fileProgressWrapper.style.height="";this.height=this.fileProgressWrapper.offsetHeight;this.opacity=100;this.fileProgressWrapper.style.display=""};FileProgress.prototype.disappear=function(){var p=15;var u=4;var l=30;if(this.opacity>0){this.opacity-=p;if(this.opacity<0){this.opacity=0}if(this.fileProgressWrapper.filters){try{this.fileProgressWrapper.filters.item("DXImageTransform.Microsoft.Alpha").opacity=this.opacity}catch(r){this.fileProgressWrapper.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+this.opacity+")"}}else{this.fileProgressWrapper.style.opacity=this.opacity/100}}if(this.height>0){this.height-=u;if(this.height<0){this.height=0}this.fileProgressWrapper.style.height=this.height+"px"}if(this.height>0||this.opacity>0){var o=this;this.setTimer(setTimeout(function(){o.disappear()},l))}else{this.fileProgressWrapper.style.display="none";this.setTimer(null)}};LIVEVALIDATION={};LIVEVALIDATION.wrongLengthMessage="Must be __A1_ characters long!";LIVEVALIDATION.tooShortMessage="Must not be less than __A1_ characters long!";LIVEVALIDATION.tooLongMessage="Must not be more than __A1_ characters long!";LIVEVALIDATION.invalidEmail="Must be a valid email address!";LIVEVALIDATION.notValid="Not valid!";LIVEVALIDATION.notEmpty="Can't be empty!";LIVEVALIDATION.inTheList="Must be included in the list!";LIVEVALIDATION.notInTheList="Must not be included in the list!";LIVEVALIDATION.notMatch="Does not match!";LIVEVALIDATION.mustAccepted="Must be accepted!";LIVEVALIDATION.notANumberMessage="Must be a number!";LIVEVALIDATION.notAnIntegerMessage="Must be an integer!";LIVEVALIDATION.wrongNumberMessage="Must be __A1_!";LIVEVALIDATION.tooLowMessage="Must not be less than __A1_!";LIVEVALIDATION.tooHighMessage="Must not be more than __A1_!";var LiveValidation=function(f,g){this.initialize(f,g)};LiveValidation.VERSION="1.3 standalone";LiveValidation.TEXTAREA=1;LiveValidation.TEXT=2;LiveValidation.PASSWORD=3;LiveValidation.CHECKBOX=4;LiveValidation.SELECT=5;LiveValidation.FILE=6;LiveValidation.massValidate=function(u){var r=true;for(var l=0,o=u.length;l<o;++l){var p=u[l].validate();if(r){r=p}}return r};LiveValidation.prototype={validClass:"LV_valid",invalidClass:"LV_invalid",messageClass:"LV_validation_message",validFieldClass:"LV_valid_field",invalidFieldClass:"LV_invalid_field",initialize:function(r,u){var o=this;if(!r){throw new Error("LiveValidation::initialize - No element reference or element id has been provided!")}this.element=r.nodeName?r:document.getElementById(r);if(!this.element){throw new Error("LiveValidation::initialize - No element with reference or id of '"+r+"' exists!")}this.validations=[];this.elementType=this.getElementType();this.form=this.element.form;var l=u||{};this.validMessage=l.validMessage||"";var p=l.insertAfterWhatNode||this.element;this.insertAfterWhatNode=p.nodeType?p:document.getElementById(p);this.onValid=l.onValid||function(){this.insertMessage(this.createMessageSpan());this.addFieldClass()};this.onInvalid=l.onInvalid||function(){this.insertMessage(this.createMessageSpan());this.addFieldClass()};this.onlyOnBlur=l.onlyOnBlur||false;this.wait=l.wait||0;this.onlyOnSubmit=l.onlyOnSubmit||false;if(this.form){this.formObj=LiveValidationForm.getInstance(this.form);this.formObj.addField(this)}this.oldOnFocus=this.element.onfocus||function(){};this.oldOnBlur=this.element.onblur||function(){};this.oldOnClick=this.element.onclick||function(){};this.oldOnChange=this.element.onchange||function(){};this.oldOnKeyup=this.element.onkeyup||function(){};this.element.onfocus=function(a){o.doOnFocus(a);return o.oldOnFocus.call(this,a)};if(!this.onlyOnSubmit){switch(this.elementType){case LiveValidation.CHECKBOX:this.element.onclick=function(a){o.validate();return o.oldOnClick.call(this,a)};case LiveValidation.SELECT:case LiveValidation.FILE:this.element.onchange=function(a){o.validate();return o.oldOnChange.call(this,a)};break;default:if(!this.onlyOnBlur){this.element.onkeyup=function(a){o.deferValidation();return o.oldOnKeyup.call(this,a)}}this.element.onblur=function(a){o.doOnBlur(a);return o.oldOnBlur.call(this,a)}}}},destroy:function(){if(this.formObj){this.formObj.removeField(this);this.formObj.destroy()}this.element.onfocus=this.oldOnFocus;if(!this.onlyOnSubmit){switch(this.elementType){case LiveValidation.CHECKBOX:this.element.onclick=this.oldOnClick;case LiveValidation.SELECT:case LiveValidation.FILE:this.element.onchange=this.oldOnChange;break;default:if(!this.onlyOnBlur){this.element.onkeyup=this.oldOnKeyup}this.element.onblur=this.oldOnBlur}}this.validations=[];this.removeMessageAndFieldClass()},add:function(g,f){this.validations.push({type:g,params:f||{}});return this},remove:function(l,r){var p=false;for(var u=0,o=this.validations.length;u<o;u++){if(this.validations[u].type==l){if(this.validations[u].params==r){p=true;break}}}if(p){this.validations.splice(u,1)}return this},deferValidation:function(f){if(this.wait>=300){this.removeMessageAndFieldClass()}var g=this;if(this.timeout){clearTimeout(g.timeout)}this.timeout=setTimeout(function(){g.validate()},g.wait)},doOnBlur:function(b){this.focused=false;this.validate(b)},doOnFocus:function(b){this.focused=true;this.removeMessageAndFieldClass()},getElementType:function(){switch(true){case (this.element.nodeName.toUpperCase()=="TEXTAREA"):return LiveValidation.TEXTAREA;case (this.element.nodeName.toUpperCase()=="INPUT"&&this.element.type.toUpperCase()=="TEXT"):return LiveValidation.TEXT;case (this.element.nodeName.toUpperCase()=="INPUT"&&this.element.type.toUpperCase()=="PASSWORD"):return LiveValidation.PASSWORD;case (this.element.nodeName.toUpperCase()=="INPUT"&&this.element.type.toUpperCase()=="CHECKBOX"):return LiveValidation.CHECKBOX;case (this.element.nodeName.toUpperCase()=="INPUT"&&this.element.type.toUpperCase()=="FILE"):return LiveValidation.FILE;case (this.element.nodeName.toUpperCase()=="SELECT"):return LiveValidation.SELECT;case (this.element.nodeName.toUpperCase()=="INPUT"):throw new Error("LiveValidation::getElementType - Cannot use LiveValidation on an "+this.element.type+" input!");default:throw new Error("LiveValidation::getElementType - Element must be an input, select, or textarea!")}},doValidations:function(){this.validationFailed=false;for(var l=0,j=this.validations.length;l<j;++l){var g=this.validations[l];switch(g.type){case Validate.Presence:case Validate.Confirmation:case Validate.Acceptance:this.displayMessageWhenEmpty=true;this.validationFailed=!this.validateElement(g.type,g.params);break;default:this.validationFailed=!this.validateElement(g.type,g.params);break}if(this.validationFailed){return false}}this.message=this.validMessage;return true},validateElement:function(o,u){var r=(this.elementType==LiveValidation.SELECT)?this.element.options[this.element.selectedIndex].value:this.element.value;if(o==Validate.Acceptance){if(this.elementType!=LiveValidation.CHECKBOX){throw new Error("LiveValidation::validateElement - Element to validate acceptance must be a checkbox!")}r=this.element.checked}var p=true;try{o(r,u)}catch(l){if(l instanceof Validate.Error){if(r!==""||(r===""&&this.displayMessageWhenEmpty)){this.validationFailed=true;this.message=l.message;p=false}}else{throw l}}finally{return p}},validate:function(){if(!this.element.disabled){var b=this.doValidations();if(b){this.onValid(this,this.message);return true}else{this.onInvalid(this,this.message);return false}}else{return true}},enable:function(){this.element.disabled=false;return this},disable:function(){this.element.disabled=true;this.removeMessageAndFieldClass();return this},createMessageSpan:function(){var g=document.createElement("span");var f=document.createTextNode(this.message);g.appendChild(f);return g},insertMessage:function(f){this.removeMessage();if((this.displayMessageWhenEmpty&&(this.elementType==LiveValidation.CHECKBOX||this.element.value==""))||this.element.value!=""){var g=this.validationFailed?this.invalidClass:this.validClass;f.className+=" "+this.messageClass+" "+g;if(this.insertAfterWhatNode.nextSibling){this.insertAfterWhatNode.parentNode.insertBefore(f,this.insertAfterWhatNode.nextSibling)}else{this.insertAfterWhatNode.parentNode.appendChild(f)}}},addFieldClass:function(){this.removeFieldClass();if(!this.validationFailed){if(this.displayMessageWhenEmpty||this.element.value!=""){if(this.element.className.indexOf(this.validFieldClass)==-1){this.element.className+=" "+this.validFieldClass}}}else{if(this.element.className.indexOf(this.invalidFieldClass)==-1){this.element.className+=" "+this.invalidFieldClass}}},removeMessage:function(){var g;var f=this.insertAfterWhatNode;while(f.nextSibling){if(f.nextSibling.nodeType===1){g=f.nextSibling;break}f=f.nextSibling}if(g&&g.className.indexOf(this.messageClass)!=-1){this.insertAfterWhatNode.parentNode.removeChild(g)}},removeFieldClass:function(){if(this.element.className.indexOf(this.invalidFieldClass)!=-1){this.element.className=this.element.className.split(this.invalidFieldClass).join("")}if(this.element.className.indexOf(this.validFieldClass)!=-1){this.element.className=this.element.className.split(this.validFieldClass).join(" ")}},removeMessageAndFieldClass:function(){this.removeMessage();this.removeFieldClass()}};var LiveValidationForm=function(b){this.initialize(b)};LiveValidationForm.instances={};LiveValidationForm.getInstance=function(g){var f=Math.random()*Math.random();if(!g.id){g.id="formId_"+f.toString().replace(/\./,"")+new Date().valueOf()}if(!LiveValidationForm.instances[g.id]){LiveValidationForm.instances[g.id]=new LiveValidationForm(g)}return LiveValidationForm.instances[g.id]};LiveValidationForm.prototype={initialize:function(f){this.name=f.id;this.element=f;this.fields=[];this.oldOnSubmit=this.element.onsubmit||function(){};var g=this;this.element.onsubmit=function(a){return(LiveValidation.massValidate(g.fields))?g.oldOnSubmit.call(this,a||window.event)!==false:false}},addField:function(b){this.fields.push(b)},removeField:function(p){var o=[];for(var j=0,l=this.fields.length;j<l;j++){if(this.fields[j]!==p){o.push(this.fields[j])}}this.fields=o},destroy:function(b){if(this.fields.length!=0&&!b){return false}this.element.onsubmit=this.oldOnSubmit;LiveValidationForm.instances[this.name]=null;return true}};var Validate={Presence:function(g,l){var l=l||{};var j=l.failureMessage||LIVEVALIDATION.notEmpty;if(g===""||g===null||g===undefined){Validate.fail(j)}return true},Numericality:function(M,F){var K=M;var M=Number(M);var F=F||{};var E=((F.minimum)||(F.minimum==0))?F.minimum:null;var H=((F.maximum)||(F.maximum==0))?F.maximum:null;var G=((F.is)||(F.is==0))?F.is:null;var D=F.notANumberMessage||LIVEVALIDATION.notANumberMessage;var C=F.notAnIntegerMessage||LIVEVALIDATION.notAnIntegerMessage;var B=F.wrongNumberMessage||LIVEVALIDATION.wrongNumberMessage.replace("__A1_",G);var J=F.tooLowMessage||LIVEVALIDATION.tooLowMessage.replace("__A1_",E);var I=F.tooHighMessage||LIVEVALIDATION.tooHighMessage.replace("__A1_",H);if(!isFinite(M)){Validate.fail(D)}if(F.onlyInteger&&(/\.0+$|\.$/.test(String(K))||M!=parseInt(M))){Validate.fail(C)}switch(true){case (G!==null):if(M!=Number(G)){Validate.fail(B)}break;case (E!==null&&H!==null):Validate.Numericality(M,{tooLowMessage:J,minimum:E});Validate.Numericality(M,{tooHighMessage:I,maximum:H});break;case (E!==null):if(M<Number(E)){Validate.fail(J)}break;case (H!==null):if(M>Number(H)){Validate.fail(I)}break}return true},Format:function(u,p){var u=String(u);var p=p||{};var o=p.failureMessage||LIVEVALIDATION.notValid;var l=p.pattern||/./;var r=p.negate||false;if(!r&&!l.test(u)){Validate.fail(o)}if(r&&l.test(u)){Validate.fail(o)}return true},Email:function(g,l){var l=l||{};var j=l.failureMessage||LIVEVALIDATION.invalidEmail;Validate.Format(g,{failureMessage:j,pattern:/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i});return true},Length:function(z,F){var z=String(z);var F=F||{};var B=((F.minimum)||(F.minimum==0))?F.minimum:null;var E=((F.maximum)||(F.maximum==0))?F.maximum:null;var D=((F.is)||(F.is==0))?F.is:null;var u=F.wrongLengthMessage||LIVEVALIDATION.wrongLengthMessage.replace("__A1_",D);var r=F.tooShortMessage||LIVEVALIDATION.tooShortMessage.replace("__A1_",B);var C=F.tooLongMessage||LIVEVALIDATION.tooLongMessage.replace("__A1_",E);switch(true){case (D!==null):if(z.length!=Number(D)){Validate.fail(u)}break;case (B!==null&&E!==null):Validate.Length(z,{tooShortMessage:r,minimum:B});Validate.Length(z,{tooLongMessage:C,maximum:E});break;case (B!==null):if(z.length<Number(B)){Validate.fail(r)}break;case (E!==null):if(z.length>Number(E)){Validate.fail(C)}break;default:throw new Error("Validate::Length - Length(s) to validate against must be provided!")}return true},Inclusion:function(j,E){var E=E||{};var C=E.failureMessage||LIVEVALIDATION.inTheList;var D=(E.caseSensitive===false)?false:true;if(E.allowNull&&j==null){return true}if(!E.allowNull&&j==null){Validate.fail(C)}var G=E.within||[];if(!D){var K=[];for(var H=0,J=G.length;H<J;++H){var M=G[H];if(typeof M=="string"){M=M.toLowerCase()}K.push(M)}G=K;if(typeof j=="string"){j=j.toLowerCase()}}var I=false;for(var F=0,J=G.length;F<J;++F){if(G[F]==j){I=true}if(E.partialMatch){if(j.indexOf(G[F])!=-1){I=true}}}if((!E.negate&&!I)||(E.negate&&I)){Validate.fail(C)}return true},Exclusion:function(g,f){var f=f||{};f.failureMessage=f.failureMessage||LIVEVALIDATION.notInTheList;f.negate=true;Validate.Inclusion(g,f);return true},Confirmation:function(p,o){if(!o.match){throw new Error("Validate::Confirmation - Error validating confirmation: Id of element to match must be provided!")}var o=o||{};var j=o.failureMessage||LIVEVALIDATION.notMatch;var l=o.match.nodeName?o.match:document.getElementById(o.match);if(!l){throw new Error("Validate::Confirmation - There is no reference with name of, or element with id of '"+o.match+"'!")}if(p!=l.value){Validate.fail(j)}return true},Acceptance:function(g,l){var l=l||{};var j=l.failureMessage||LIVEVALIDATION.mustAccepted;if(!g){Validate.fail(j)}return true},Custom:function(r,p){var p=p||{};var l=p.against||function(){return true};var o=p.args||{};var u=p.failureMessage||LIVEVALIDATION.notValid;if(!l(r,o)){Validate.fail(u)}return true},now:function(o,r,u){if(!o){throw new Error("Validate::now - Validation function must be provided!")}var p=true;try{o(r,u||{})}catch(l){if(l instanceof Validate.Error){p=false}else{throw l}}finally{return p}},fail:function(b){throw new Validate.Error(b)},Error:function(b){this.message=b;this.name="ValidationError"}};var comet={technique:/(Firefox|Safari)/i.test(navigator.userAgent)?1:/MSIE/i.test(navigator.userAgent)?2:3,open:function(j,g,l){this.push=g||new Function;this.disconnected=l||new Function;this.URL=j;this.active=true;switch(this.technique){case 1:if(!this.transport){this.transport=new XMLHttpRequest()}this.eventID=0;this.transport.open("GET",this.URL,true);this.transport.onreadystatechange=g;this.transport.send(null);break;case 2:if(!this.transport){this.transport=new ActiveXObject("htmlfile")}this.transport.open();this.transport.write("<html><body></body></html>");this.transport.close();this.transport.parentWindow.push=this.push;this.transport.body.innerHTML='<iframe id="SimpleComet" src="'+this.URL+'"></iframe>';setTimeout(this.scope(this.checkFrame,this),500);break;case 3:if(!this.transport){this.transport=document.createElement("iframe")}this.transport.style.display="none";this.transport.src=this.URL;this.transport.onload=this.scope(this.close,this);document.body.appendChild(this.transport);break}},close:function(){if(!this.active){return}else{this.active=false}switch(this.technique){case 1:if(this.transport.readyState!=4){this.transport.abort()}break;case 2:this.transport.body.removeChild(this.transport.getElementById("SimpleComet"));break;case 3:this.transport.src="about:blank";document.body.removeChild(this.transport);break}this.disconnected()},XHRcallback:function(){if(this.transport.readyState==4){this.close();return}var b=this.transport.responseText.match(/<comet>(.+?)<\/comet>/g);while(b&&b[this.eventID]){this.push(b[this.eventID].substring(7,b[this.eventID].length-8));this.eventID++}},checkFrame:function(){if(!this.transport.getElementById("SimpleComet")){return}if(this.transport.getElementById("SimpleComet").readyState=="complete"){this.close();return}setTimeout(this.scope(this.checkFrame,this),500)},scope:function(f,g){return function(){return f.apply(g)}}};Request.Comet=new Class({Implements:[Options,Events],tunnel:null,type:0,options:{url:"",name:"MooComet",onPush:$empty},initialize:function(b){this.setOptions(b);this.type=(Browser.Engine.trident?3:(Browser.Engine.presto?2:1));if(this.type>1){this.options.url=this.options.url+(this.options.url.search("\\?")>-1?"&":"?")+"cometType="+this.type+"&cometName="+this.options.name}if(this.type==3){this.tunnel=new ActiveXObject("htmlfile")}else{if(this.type==2){this.tunnel=document.createElement("event-source")}else{this.tunnel=new Request.Comet.XHR(this.options);this.tunnel.addCallback(this.onChange.bind(this),{readyState:false,status:false})}}return this},cancel:function(){if(this.type==3){this.tunnel.body.innerHTML="<iframe src='about:blank'></iframe>"}else{if(this.type==2){document.body.removeChild(this.tunnel)}else{this.tunnel.cancel()}}return this},send:function(){if(this.type==3){this.tunnel.open();this.tunnel.write("<html><body></body></html>");this.tunnel.close();this.tunnel.parentWindow._cometObject=this;this.tunnel.body.innerHTML="<iframe onload='alert(2);' src='"+this.options.url+"'></iframe>"}else{if(this.type==2){this.tunnel.setAttribute("src",this.options.url);document.body.appendChild(this.tunnel);this.tunnel.addEventListener(this.options.name,this.onChange.bind(this),false)}else{this.tunnel.send({data:{cometType:1,cometName:this.options.name}})}}return this},onChange:function(o,j,p){if(p==4){this.fireEvent("fail");return}var l=null;if(this.type==2){l=arguments[0].data}else{l=o.split("<end />");l=l[l.length-1]}this.fireEvent("onPush",l)}});Request.Comet.XHR=new Class({Extends:Request,callbacks:[],check:function(){return true},addCallback:function(f,g){g=$extend({fn:$empty,readyState:4,status:200},g);this.callbacks.push($extend(g,{fn:f}));return this},onStateChange:function(){this.status=0;$try(function(){this.status=this.xhr.status},this);this.response={text:this.xhr.responseText,xml:this.xhr.responseXML};this.callbacks.forEach(function(b){if(b.readyState!=false&&b.readyState!=this.xhr.readyState){return}if(b.status!=false&&b.status!=this.status){return}b.fn(this.processScripts(this.response.text),this.response.xml,this.xhr.readyState)},this)}});var gcLayer=new Class({Implements:[Events,Options],options:function(){return{multipleSelection:true,forprint:false}},initialize:function(j,p){this.setOptions(p);this.container=typeof(j)=="string"?$(j):j;this.ul=this.container.getElement(".gclayer");if(!this.ul){this.ul=new Element("ul",{});this.ul.addClass("gclayer");this.ul.inject(this.container)}this.maxFeatureCount=0;this.selected=this.beforeLastSelected=new Array();var o=this.container.getElement(".gcheader .layer_eye");var l=this.container.getElement(".gcheader .lockicon");if(o&&l){o.addEvent("click",this.onGlobalEyeClick.bind(this));l.addEvent("click",this.onGlobalLockClick.bind(this))}this.empty()},onGlobalEyeClick:function(O){if(!fnm.isVisible()){return}var G=this.getBackgroundPositionX(O.target).toInt();var C;if(!G||G==0){C=false;this.setBackgroundPosition(O.target,-17)}else{C=true;this.setBackgroundPosition(O.target,0)}var K=[];for(var M=0;M<fnl.getLayersNum();M++){var E=fnl.getLayer(M);K.push(E.id);var N=E.grp?"layer_group_"+E.grp:"layer"+E.id;var I=fnw.getLayerByName(N);if(!I){continue}if(C){I.enable()}else{I.disable()}if(E.textfield||E.label){var N="llayer"+E.id;var I=fnw.getLayerByName(N);if(!I){continue}E.visible=C;if(C){I.enable()}else{I.disable()}}}var D=this.ul.getElements("li");for(var M=0;M<D.length;M++){var F=D[M];var J=F.getElement(".layer_eye");this.setBackgroundPosition(J,C?0:-17)}var H=K.join();if(!layerStateAID[H]){layerStateAID[H]={}}$clear(layerStateAID[H].intVisID);layerStateAID[H].intVisID=saveLayerState.delay(1000,this,[H,"visible",C])},isLocked:function(r){var z=this.ul.getElements("li");for(var u=0;u<z.length;u++){var o=z[u];var p=o.getElement(".layer_eye");var B=this.getBackgroundPositionX(p).toInt();return !(!B||B==0)}return false},onGlobalLockClick:function(O){if(!fnm.isVisible()){return}var G=this.getBackgroundPositionX(O.target).toInt();var C;if(!G||G==0){C=false;this.setBackgroundPosition(O.target,-9)}else{C=true;this.setBackgroundPosition(O.target,0)}var K=[];for(var M=0;M<fnl.getLayersNum();M++){var E=fnl.getLayer(M);K.push(E.id);var N=E.grp?"layer_group_"+E.grp:"layer"+E.id;var I=fnw.getLayerByName(N);if(!I){continue}E.lock=C;I.setSelectable(C)}var D=this.ul.getElements("li");for(var M=0;M<D.length;M++){var F=D[M];var J=F.getElement(".lockicon");this.setBackgroundPosition(J,C?0:-9)}var H=K.join();if(!layerStateAID[H]){layerStateAID[H]={}}$clear(layerStateAID[H].intLockID);layerStateAID[H].intLockID=saveLayerState.delay(1000,this,[H,"lock",!C])},onItemOrderChange:function(b){this.fireEvent("orderchange",{target:this})},onVisibiltyIconClick:function(K){var H=K.target;if(fnm.isVisible()){var D=this.getLiParent(K.target);var E=D.retrieve("grp");var N=(E!=null)?"layer_group_"+E:((D.retrieve("label")?"l":"")+"layer"+H.getParent().retrieve("id"));var G=fnw.getLayerByName(N);var M=fnw.getLayerByName("l"+N);var C;if(G.isEnabled()){G.enable();if(M){M.enable()}this.setBackgroundPosition(H,0);C=true}else{G.disable();if(M){M.disable()}this.setBackgroundPosition(H,-17);C=false}if(E!=null){var O=[];for(var I=0;I<fnl.getLayersNum();I++){var J=fnl.getLayer(I);if(J.raster=="t"){O.push(J.id)}}var F=O.join()}else{var F=N.substr(5)}if(!layerStateAID[F]){layerStateAID[F]={}}$clear(layerStateAID[F].intVisID);layerStateAID[F].intVisID=saveLayerState.delay(1000,this,[F,"visible",C])}},onLockIconClick:function(u){var D=u.target;var C="layer"+D.getParent().retrieve("id");var r=C.substr(5);var p=fnw.getLayerByName(C);if(p){var z;var B=fnl.getLayerById(r);if(p.getSelectable()){p.setSelectable(false);B.lock="t";this.setBackgroundPosition(D,-9);z=true}else{p.setSelectable(true);B.lock="f";this.setBackgroundPosition(D,0);z=false}if(!layerStateAID[r]){layerStateAID[r]={}}$clear(layerStateAID[r].intLockID);layerStateAID[r].intLockID=saveLayerState.delay(1000,this,[r,"lock",z])}},setBackgroundPosition:function(g,j){if(!g){return}if(!Browser.Engine.trident){var l=g.getStyle("background-position").split(" ")}if(Browser.Engine.trident){g.style.backgroundPositionX=j+"px"}else{g.style.backgroundPosition=j+"px "+l[1]}},getBackgroundPositionX:function(g){if(!Browser.Engine.trident){var f=g.getStyle("background-position").split(" ");return f[0]}else{return g.style.backgroundPositionX}},getVisibilityIcon:function(f){var g=new Element("div");g.addClass("layer_eye");if(f.visible!="t"){this.setBackgroundPosition(g,-17)}g.addEvent("click",this.onVisibiltyIconClick.bind(this));return g},getLockIcon:function(f){var g=new Element("div");g.addClass("lockicon");if(f.lock=="t"){g.style.backgroundPosition="-9px 0px"}if(f.tip=="file"||f.atype=="buffer"||f.tip=="raster"||f.tip=="tile"){g.setStyle("visibility","hidden")}else{g.addEvent("click",this.onLockIconClick.bind(this))}return g},empty:function(b){this.ul.empty();this.ul.set("html",'<li style="font-size:9px; margin-left:10px; color:#777777">No layer</li>');this.removeSelection()},showLoader:function(b){this.ul.empty();this.ul.showLoader()},hideLoader:function(b){this.ul.hideLoader()},setData:function(j){if(!j){return}this.hideLoader();this.ul.empty();this.maxFeatureCount=0;for(var l=0;l<j.length;l++){var p=j[l];if(p.tip=="folder"){continue}if(this.options.forprint&&p.visible!="t"){}else{this.addItem(p,l,j.length)}}var o=$("group_raster");if(o){}this.itemsSort=new Sortables([o,this.ul],{constrain:true,clone:true,onComplete:this.onItemOrderChange.bind(this),revert:true,control:true})},onSubItemsMouseEnter:function(b){this.itemsSort.detach()},onSubItemsMouseEnter:function(b){this.itemsSort.attach()},disposeItem:function(g){if(g){if(g.getParent().getElements("li").length==1){if(g.hasClass("1level")){this.empty()}else{var f=this.getLiParent(g.getParent());f.dispose();if(this.ul.getElements("li").length==0){this.empty()}}}else{g.dispose()}}},removeItem:function(o){var j=this.ul.getElements("li");for(var p=0;p<j.length;p++){var l=j[p];if(l.retrieve("id")==o){l.highlight("#FFFFFF","#FFc0d0");this.disposeItem.delay(200,this,l)}}},getTitle:function(g,j){var l;if(g.tip=="pg"){l="ID: "+g.id+", Type: 'postgis', Table: '"+j.src+"'";if(g.datasource_id){l+=" Datasource ID: "+g.datasource_id}}else{l="ID: "+g.id+", Type: '"+g.tip+"', Source: '"+j.src+"'"}return l},addLabelItem:function(F,E){var B=new Element("li");B.addClass("1level");var I=getSourceObject(F.source);B.store("id",F.id);B.store("label",true);B.setProperty("id","llayer-"+F.id);B.setProperty("title",this.getTitle(F,I));var J="";var D=F.name+" label";var C=new Element("span",{id:"lspan-"+F.id,html:D,style:J});C.addClass("label");C.store("id","layer"+F.id);C.addEvent("click",this.onItemClick.bind(this));C.addEvent("dblclick",this.onItemDblClick.bind(this));C.inject(B);B.inject(this.ul,"top");var G=this.getVisibilityIcon(F);var H=this.getLockIcon(F);H.visibility(false);var z=this.getIcon({tip:"label"});z.inject(B,"top");H.inject(B,"top");G.inject(B,"top")},addItem:function(M,ab){var W=new Element("li");W.addClass("1level");var T=getSourceObject(M.source);var P="";var Y=M.name;if(M.grp!=null){W.store("grp",M.grp)}if(M.raster=="t"){Y="<span class='comment' style='font-size:9px;'>Raster</span>"}else{W.store("id",M.id);W.setProperty("id","layer-"+M.id);if(M.error){W.addClass("error");W.setProperty("title",M.error)}else{W.setProperty("title",this.getTitle(M,T))}}var O=new Element("span",{id:"lspan-"+M.id,html:Y,style:P});O.addClass("label");O.store("id","layer"+M.id);O.addEvent("click",this.onItemClick.bind(this));O.addEvent("dblclick",this.onItemDblClick.bind(this));if((M.tip=="point"||M.tip=="line"||M.tip=="polygon"||M.tip=="geometry")&&M.count!=null){var N=new Element("span",{html:" ("+M.count.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")+")",style:"color:#bbbbbb;font-size:9px;"});this.maxFeatureCount=(M.count>this.maxFeatureCount)?M.count:this.maxFeatureCount}var Z="group_raster";var K=$(Z);if(M.raster!="t"||!K){O.inject(W);W.inject(this.ul);if(N){N.inject(O)}}if(M.raster!="t"){if(!this.options.forprint){var R=this.getVisibilityIcon(M);var ae=this.getLockIcon(M)}var af=this.getIcon(M);var V=JSON.decode(M.styles);if(V&&(V.length>1||V[0].label)){var aa=this.getSubIcon(M.tip,V,W);aa.setStyle("padding-left",32);aa.store("id",M.id);aa.addEvent("click",this.onItemClick.bind(this));aa.addEvent("dblclick",this.onItemDblClick.bind(this))}af.inject(W,"top");if(!this.options.forprint){ae.inject(W,"top");R.inject(W,"top")}}else{var ad=this.getImg2("");var S=new Element("div");S.addClass("minus");S.inject(W,"top");S.addEvent("click",this.toggleRasterGroup.bind(this));var Q=new Element("div");Q.addClass("emptyicon");Q.inject(W,"top");if(!this.options.forprint){var R=this.getVisibilityIcon(M);R.inject(W,"top")}var Z="group_raster";if(!K){K=new Element("ul",{id:Z});K.addClass("sublayers");K.inject(W);W.store("rastergroup",true)}var ac=new Element("li",{id:"layer-"+M.id,title:this.getTitle(M,T)});ac.store("id",M.id);if(M.grp){ac.store("grp",M.grp)}ac.inject(K);var V=JSON.decode(M.styles);if(V&&V.length>1){var aa=this.getSubIcon(M.tip,V,ac);aa.store("id",M.id);aa.addEvent("click",this.onItemClick.bind(this));aa.addEvent("dblclick",this.onItemDblClick.bind(this))}var U=new Element("span",{id:"lspan-"+M.id,text:M.name});U.addClass("label");O.store("id","layer"+M.id);U.inject(ac,"top");if(N){N.inject(U)}var af=this.getIcon(M);af.inject(ac,"top");U.addEvent("click",this.onItemClick.bind(this));U.addEvent("dblclick",this.onItemDblClick.bind(this))}},serialize:function(){var l=this.ul.getElements("li");var p=[];for(var j=0;j<l.length;j++){var o=l[j].retrieve("id");if(o){p.push(o)}}return p},removeSelection:function(){this.ul.getElements("li.selected").each(function(f,g){f.removeClass("selected")},this);this.beforeLastSelected=this.selected;this.selected=[];this.fireEvent("removeselection")},selectAll:function(){this.removeSelection();var j=this.ul.getElements("li");for(var p=0;p<j.length;p++){var l=j[p];var o=l.retrieve("id");if(o!=null){l.addClass("selected");this.selected.push(o)}}},setSelection:function(B,r){this.removeSelection();var z=this.ul.getElements("li");for(var u=0;u<z.length;u++){var p=z[u];for(var j=0;j<B.length;j++){if(B[j]==p.retrieve("id")){p.addClass("selected");this.selected.push(Number(B[j]))}}}this.selected.unique();if(B.length>0&&!r){this.fireEvent("itemclick",B[0])}},getSelection:function(){return this.selected},getLiByID:function(o){var j=this.ul.getElements("li");for(var p=0;p<j.length;p++){var l=j[p];if(o==l.retrieve("id")){return l}}return null},getLiParent:function(g){var f=$(g);while(f&&(f.get("tag")!="li")){f=f.getParent()}return f},onItemClick:function(l){var o=this.getLiParent(l.target);var p=o.retrieve("id");if(!o.retrieve("id")&&!o.retrieve("rastergroup")){o=this.getLiParent(o.getParent())}p=o.retrieve("id");if(o&&p){var r={};r.grp=o.retrieve("grp");r.id=p;if((!l.control&&!l.shift)||!this.options.multipleSelection){this.removeSelection()}else{this.beforeLastSelected=this.selected}var u=false;if((l.control||l.shift)&&this.selected.contains(r.id,true)){this.getLiByID(r.id).removeClass("selected");u=true}if(!u){$("layer-"+r.id).addClass("selected");this.selected.push(Number(r.id));this.selected.unique()}this.fireEvent("itemclick",r)}},onItemDblClick:function(g){var j=this.getLiParent(g.target);if(!j.retrieve("id")&&!j.retrieve("rastergroup")){j=this.getLiParent(j.getParent())}if(j){var l={};l.grp=j.retrieve("grp");l.id=j.retrieve("id");this.fireEvent("itemdblclick",l)}},getImg:function(f){var g=10;return new Element("img",{src:fno.liveSite+"assets/icon.php?p="+encodeURI(f.url),width:g,height:g})},getImg2:function(f){if(this.options.forprint){var g=new Element("img",{style:"position: relative"});g.src=fno.liveSite+"assets/images/image.gif";g.addClass("legendicon");return g}else{var g=new Element("div",{style:"position: relative"})}g.addClass("legendicon");switch(f){case"raster":g.addClass("raster");break;case"wms":g.addClass("server");break;case"tile":g.addClass("server");break;case"wmts":g.addClass("server");break;default:g.addClass("emptyicon")}return g},getIcon:function(F){if(this.options.forprint){var B=new Element("img",{style:"position: relative"})}else{var B=new Element("div",{style:"position: relative"})}B.addClass("legendicon");var D=10;if(F.styles){var z=JSON.decode(F.styles)}var r="";if(F.textfield||F.label){r="&label=1"}switch(F.tip){case"raster":if(this.options.forprint){B.src=fno.liveSite+"assets/images/image.gif"}else{B.addClass("raster")}break;case"label":B.addClass("labelicon");break;case"wms":case"wmts":case"tile":if(this.options.forprint){B.src=fno.liveSite+"assets/images/world.gif"}else{B.addClass("server")}break;case"point":if(z.length==1&&!z[0].label){z[0].label=r;if(z[0].url&&z[0].url!="undefined"){this.getImg(z[0]).inject(B)}}else{B.addClass("emptyicon")}break;case"line":if(z.length==1&&!z[0].label){var C=z[0];B.setStyle("background-image","url("+fno.liveSite+"assets/icon.php?type=line&color="+C.color+(r)+")")}else{B.addClass("emptyicon")}break;case"polygon":case"geometry":if(z.length==1&&!z[0].label){var C=z[0];var u=fno.liveSite+"assets/icon.php?type=polygon&color="+C.color+"&border="+C.bordercolor+(r);if(!this.options.forprint){B.setStyle("background-image","url("+u+")")}else{B.src=u}}else{B.addClass("emptyicon")}break;case"analysis":if(F.atype=="buffer"){var E=JSON.decode(F.params);var u=fno.liveSite+"assets/icon.php?type=polygon&color="+E.fillcolor+"&border="+E.bordercolor;if(this.options.forprint){B.src=u}else{B.setStyle("background-image","url("+u+")")}}break}return B},getSubIcon:function(O,D,J){var G=new Element("ul");G.addClass("features");G.inject(J);var r=10;for(var N=0;N<D.length;N++){var I=D[N];var E;if(!I.label){E=I.expression}else{E=I.label}var K=new Element("li");K.inject(G);var H=new Element("span",{text:E});H.inject(K);switch(O){case"point":if(I.url&&I.url!="undefined"){this.getImg(I).inject(K,"top")}break;case"line":var M=fno.liveSite+"assets/icon.php?type=line&color="+I.color;if(this.options.forprint){var F=new Element("img",{style:"position: relative",src:M})}else{var F=new Element("div",{style:"position: relative"});F.setStyle("background-image","url("+M+")")}F.addClass("legendicon");F.inject(K,"top");break;case"polygon":case"geometry":var M=fno.liveSite+"assets/icon.php?type=polygon&color="+I.color+"&border="+I.bordercolor;if(this.options.forprint){var F=new Element("img",{style:"position: relative",src:M})}else{var F=new Element("div",{style:"position: relative"});F.setStyle("background-image","url("+M+")")}F.addClass("legendicon");F.inject(K,"top");break}}return G},toggleRasterGroup:function(g){var f=$("group_raster");f.toggle();if(f.isVisible()){g.target.addClass("minus");g.target.removeClass("plus")}else{g.target.addClass("plus");g.target.removeClass("minus")}},unique:function(a,o){function r(b,f){return b-f}var p=o?r:function(){};a.sort(p);for(var u=1;u<a.length;u++){if(a[u-1]==a[u]){a.splice(u,1);u--}}return a}});var gcLayerTree=new Class({Extends:omModule,options:{editLayerOnDblClick:true,lockLayerSelection:false,multipleSelection:true,forprint:false,url:fno.liveSite+"modules_gc/layer/clayer.php",module:"layer"},types:{folder:{openIcon:"mif-tree-open-folder",closeIcon:"mif-tree-close-folder"},rasterfolder:{openIcon:"mif-tree-open-folder",closeIcon:"mif-tree-close-folder"},basemapfolder:{openIcon:"mif-tree-open-folder",closeIcon:"mif-tree-close-folder"},bla:{closeIconUrl:"http://unstable.giscloud.com/assets/icon.php?type=polygon&color=undefined&border=48,204,0"},raster:{openIcon:"tree-icon-image",closeIcon:"tree-icon-image"},wms:{openIcon:"tree-icon-world",closeIcon:"tree-icon-world"},wmts:{openIcon:"tree-icon-world",closeIcon:"tree-icon-world"},giscloud:{openIcon:"tree-icon-world",closeIcon:"tree-icon-world"},tile:{openIcon:"tree-icon-world",closeIcon:"tree-icon-world"},fleet:{openIcon:"tree-icon-fleet",closeIcon:"tree-icon-fleet"},feature:{dragDisabled:true},dragdisabled:{dragDisabled:true}},initialize:function(o,r,B){this.setOptions(B);this.container=typeof(o)=="string"?$(o):o;this.treecontainer=this.container.getElement(".tree-container");this.last_selected_lid=null;this.gclayer=r;this.tree=new Mif.Tree({container:this.treecontainer,initialize:function(){new Mif.Tree.Drag(this,{onDrag:function(){if(this.current.type.contains("mapnik")){if(!(((this.target.type.contains("rasterfolder")||this.target.type.contains("basemapfolder"))&&this.where=="inside")||this.target.type.contains("mapnik")&&["before","after"].contains(this.where))){this.where="notAllowed";return}}else{if(this.current.type.contains("rasterfolder")||this.current.type.contains("basemapfolder")){if((this.where=="inside"&&!this.target.isRoot())||!this.target.getParent().isRoot()){this.where="notAllowed";return}}else{if(this.target&&!this.target.type.contains("folder")&&this.where=="inside"){this.where="notAllowed";return}if(this.target&&(this.target.getParent().type.contains("rasterfolder")||this.target.getParent().type.contains("basemapfolder"))){this.where="notAllowed";return}}}},onStart:function(){this.isparentchanged=this.current.getParent();return false},onComplete:function(){},onDrop:function(a){var g=this.current.parentNode;var b=this;if(this.isparentchanged.data!==g.data){var f=g.isRoot()?"null":g.data.id;this.tree.parentOwner.changeParent(this.current.data.id,f,function(){b.tree.parentOwner.orderChange(a);b.tree.parentOwner.fireEvent("orderchange",a)})}else{this.tree.parentOwner.orderChange(a);this.tree.parentOwner.fireEvent("orderchange",a)}},modifier:null})},beforeRename:this.beforeRename.bind(this),types:this.types,forest:true,dfltType:"folder",height:18});this.tree.parentOwner=this;this.tree.initCheckbox("deps");this.tree.addEvent("select",this.onSelect.bind(this));this.tree.addEvent("dblclick",this.onDblClick.bind(this));this.tree.addEvent("lock",this.onLockClick.bind(this));this.tree.addEvent("rename",this.onRename.bind(this));this.tree.addEvent("switch",this.onCheckBoxChange.bind(this));this.tree.addEvent("load",this.onLoad.bind(this));this.tree.addEvent("toggle",this.onToggle.bind(this));if(this.options.forprint){this.container.getElement(".gcheader").hide();this.treecontainer.setStyle("height","inherit")}else{var u=this.container.getElement(".gcheader .gc-plus12");if(u){u.addEvent("click",this.gclayer.newLayer.bind(this.gclayer));this.container.getElement(".gcheader .gc-rename12").addEvent("click",this.rename.bind(this));this.container.getElement(".gcheader .gc-edit12").addEvent("click",this.editLayer.bind(this));this.container.getElement(".gcheader .gc-folder12").addEvent("click",this.newFolder.bind(this));this.container.getElement(".gcheader .gc-minus12").addEvent("click",this.gclayer.deleteSelectedLayer.bind(this.gclayer))}this.container.getElement(".gcheader .gc-zoom12").addEvent("click",this.zoomToLayer.bind(this))}var z=this.container.getElement(".gcheader .layer_eye");var p=this.container.getElement(".gcheader .lockicon");if(z&&p){z.addEvent("click",this.onGlobalEyeClick.bind(this));p.addEvent("click",this.onGlobalLockClick.bind(this))}this.loader=this.container.getElement(".overlay")},toolbar:function(C,z){if(!C||!C.length){return}var p=this.container.getElement(".gcheader .gc-plus12"),u=this.container.getElement(".gcheader .gc-rename12"),B=this.container.getElement(".gcheader .gc-edit12"),r=this.container.getElement(".gcheader .gc-folder12"),D=this.container.getElement(".gcheader .gc-minus12");if(C.contains("addlayer")&&p){if(z){p.show()}else{p.hide()}}if(C.contains("renamelayer")&&p){if(z){u.show()}else{u.hide()}}if(C.contains("editlayer")&&p){if(z){B.show()}else{B.hide()}}if(C.contains("addfolder")&&p){if(z){r.show()}else{r.hide()}}if(C.contains("deletelayer")&&p){if(z){D.show()}else{D.hide()}}},orderChange:function(J){var P=this.serialize();if(fnm.isVisible()){var Q=[];var D=[];var H=[];var G=0;var O;for(var K=0;K<P.length;K++){var M=P[K];if(M.data.id){Q.push(M.data.id)}if(M.type=="folder"||M.data.render_method==5){continue}if(M.data.grp>=1){O="layer_group_"+M.data.grp}else{if(M.data.raster!="t"&&M.data.id){O="layer"+M.data.id;if(M.data.styles){for(var E=0;E<M.data.styles.length;E++){if(M.data.styles[E].labelfield||M.data.styles[E].textfield){H.push(M.data.id);break}}}}else{continue}}var I=fnw.getLayerByName(O);if(I&&typeof I.refId!=="undefined"){D.push(I.refId)}}for(var K=0;K<H.length;K++){O="llayer"+H[K];var I=fnw.getLayerByName(O);if(I&&typeof I.refId!=="undefined"){D.splice(0,0,I.refId)}}var N=J.data;if(N.sourcetype!="gcmap"){fnw.setLayersOrder(D)}var F=this;if(user.id>=0){fnl.saveOrder(Q.join(),currentMapID,J,function(a){F.gclayer.onSaveLayersOrderComplete(a,J)})}}},serialize:function(){var b=[];if(!this.tree.root){return b}this.tree.root.recursive(function(){if(this.data){b.push(this)}});return b},getLayers:function(l){var g=[];if(!this.tree.root){return g}var j=["buffer","raster","wms","wmts"];if(l&&!l.tile){j.push("tile")}this.tree.root.recursive(function(){if(this.data&&this.data.tip&&!(j.contains(this.data.tip)||this.type.contains("feature")||this.type.contains("folder")||this.data.raster=="t")&&(!(l&&l.pgOnly)||(this.data.source&&this.data.source.indexOf('"type":"pg"')>-1))){g.push(this.data)}});return g},onChangeParentComplete:function(b){this.hideLoader();if(!b){om.showError("There was an error.");return}if(b.result=="yes"){}else{om.showError(b.msg)}},changeParent:function(j,l,o){var p={module:this.options.module,task:"savestate",property:"parent",value:l,lid:j};this.showLoader();this.call(p,"savestate",(function(){this.onChangeParentComplete.apply(this,arguments);if(typeof o==="function"){o.apply(this,arguments)}}).bind(this))},onLoad:function(b){this.hideLoader()},onToggle:function(g){console.log(g);var l=fn.getMap();if(l.owner==user.id){var j=g.data.id;if(!layerStateAID[j]){layerStateAID[j]={}}$clear(layerStateAID[j].intOpenedID);layerStateAID[j].intOpenedID=this.gclayer.saveLayerState.delay(1000,this,[j,"opened",g.state.open])}else{this.saveLayersStates()}this.fireEvent("toggle",{target:this,node:g})},load:function(b){this.showLoader();this.tree.load({url:fno.liveSite+"modules_gc/layer/clayer.php?mid="+b+"&module=layer&task=treelist"})},expand:function(){if(this.tree&&this.tree.root){this.tree.root.recursive(function(){this.toggle()})}},hideLoader:function(){this.loader.hide()},showLoader:function(){this.loader.show();this.loader.showLoader()},unselect:function(b){if(!this.options.lockLayerSelection){if(this.tree.root){this.tree.unselectAll()}if(!b){this.fireEvent("unselect")}}},setSelection:function(z,B){this.tree.unselectAll();var u=z.length;if(!(u>0)){return}var p=is_numeric(z[0]);if(!p&&typeof z[0]!="object"){return}for(var C=0;C<u;C++){var r=z[C];if(p){var D=this.getNodeById(r)}else{if(r.data){var D=this.getNodeById(r.data.id)}}this.tree.select(D,{control:true},B)}},saveLayersStates:function(){if(!this.tree.root){return}var l=fn.getMap();if(l.owner!=user.id){var g={};this.tree.root.recursive(function(){var a=this.data;if(a){g[a.id]={v:(a.visible=="t"?true:false),l:(a.lock=="t"?true:false),o:this.state.open}}});var j=JSON.encode(g);console.log(g);giscloud.options.create({resource:"users",id:user.id},{name:"MAP_"+currentMapID+"_LAYERS_STATES",value:j}).done(function(){user.options["MAP_"+currentMapID+"_LAYERS_STATES"]=j})}return g},selectByName:function(l,g){if(!this.tree.root){return}this.tree.unselectAll();var j=this.tree;this.tree.root.recursive(function(){if(this.data&&this.data.name==l){j.select(this,{control:true},g)}})},selectByID:function(l,g){if(!this.tree.root){return}this.tree.unselectAll();var j=this.tree;this.tree.root.recursive(function(){if(this.data&&this.data.id==l){j.select(this,{control:true},g)}})},getByName:function(o,p){if(!this.tree.root){return}var l=this.tree,j;this.tree.root.recursive(function(){if(this.data&&this.data.name==o){j=this}});return j},getSelected:function(){return this.tree.selected},getSelection:function(){return this.tree.selected2},getNodeById:function(f){var g=null;if(!this.tree.root){return g}this.tree.root.recursive(function(){if(this.data&&this.data.id==f){g=this}});return g},empty:function(g){this.tree.$index=null;this.tree.mouse.node=false;var l=this.tree.selected;if(l){this.tree.selected=false;l.select(false)}if(this.tree.forest){var j=this.tree.wrapper.getElement(".mif-tree-children-root")}else{var j=this.tree.root.getDOM("node")}if(j){j.destroy()}this.tree.updateHover();if(this.tree.root){this.tree.root.recursive(function(){var a=this.id;delete Mif.ids[a]})}this.tree.$draw=false;this.unselect(g)},selectAll:function(){if(!this.tree.root){return}this.tree.root.recursive(function(){if(this.data){this.select(this)}})},setSize:function(g,f){if(f){this.treecontainer.setStyle("height",f)}},onSelect:function(l){var o=this.tree.selected.data;if(this.last_selected_lid==o.id){return}this.last_selected_lid=o.id;if(fnm.isVisible()){var p=(o.grp>=1)?"layer_group_"+o.grp:"layer"+o.id;var j=fnw.getLayerByName(p);if(j){$("alphaSlider").visibility(true);this.gclayer.alphasl.set(j.getAlpha())}else{$("alphaSlider").visibility(false)}}this.fireEvent("select",{layer:o,flayer:j})},onDblClick:function(b){if(this.options.editLayerOnDblClick){this.gclayer.editSelectedLayer()}this.fireEvent("dblclick",b)},onLockClick:function(f,g){this.onLockIconClick(f,g)},initTree:function(){new Mif.Tree.Drag(this.tree,{onDrag:this.onDragging.bind(this),onStart:this.onStartDrag.bind(this),onComplete:this.onDragComplete.bind(this),modifier:null})},onDragging:function(b){},onStartDrag:function(b){},onDragComplete:function(b){},onRenameComplete:function(b){this.hideLoader();if(!b){om.showError("There was an error.");return}if(b.result=="yes"){om.showConfirm(b.msg)}else{om.showError(b.msg)}},onRename:function(p,l,j){var o={module:this.options.module,task:"rename",newname:l,lid:p.data.id};this.showLoader();this.call(o,"rename",this.onRenameComplete.bind(this))},beforeRename:function(l,g,j){if(g!=j){this.tree.renameComplete()}else{this.tree.renameCancel()}},rename:function(){if(!editable){alert(gclang.mmod.no_edit_permission);return}var b=this.tree.selected;if(!b){return}if(["feature","rasterfolder"].contains(b.type)){alert("You can not rename this item");return}b.rename()},removeItem:function(b){if(!this.tree.root){return}this.tree.root.recursive(function(){if(this.data&&this.data.id==b){this.remove()}})},deleteNode:function(){var b=tree.selected;if(!b){return}if(b.type=="feature"){alert("You can not delete this node");return}if(b.children.length>0&&!confirm("Delete children?")){return}this.tree.remove(b)},lockAll:function(){if(!this.tree.root){return}this.tree.root.recursive(function(){this.icon2Click(null,true)})},setData:function(b){if(!b){return}this.tree.load({json:b});jQuery("#layerlist .mif-tree-checkbox").each(function(a,g){jQuery(g).attr("title",gclang.Show_hide_the_layer)});jQuery("#layerlist .mif-tree-icon2").each(function(a,g){jQuery(g).attr("title",gclang.Lock_unlock_the_layer)})},addItem:function(f,g){},onCheckBoxChange:function(g,f){this.onVisibiltyIconClick(g,f)},onVisibiltyIconClick:function(node,state,noSave){var that=this;if(fnm.isVisible()){node.recursive(function(){var node=this,lid,lids,layergrp,layername,layer,labellayer,value,data;if(node.children&&node.children.length>0&&(node.data.tip==="folder"||node.type.contains("rasterfolder"))){}else{if(node.data.render_method===5){geomrenderer.visibility(node.data.id,state)}else{if(node.type!=="folder"&&node.data.tip!=="folder"&&node.type[0]!=="feature"){layergrp=node.data.grp;layername=(layergrp>=1)?"layer_group_"+layergrp:("layer"+node.data.id);layer=fnw.getLayerByName(layername);labellayer=fnw.getLayerByName("l"+layername);if(state){if(layer){layer.enable()}if(labellayer){labellayer.enable()}value=true}else{if(layer){layer.disable()}if(labellayer){labellayer.disable()}value=false}if(layergrp!=null){lids=[];for(var i=0;i<fnl.getLayersNum();i++){data=fnl.getLayer(i);if(data.raster=="t"){lids.push(data.id)}}lid=lids.join()}else{lid=node.data.id}}}}if(!noSave&&lid){var map=fn.getMap();if(map.owner==user.id){if(!layerStateAID[lid]){layerStateAID[lid]={}}$clear(layerStateAID[lid].intVisID);layerStateAID[lid].intVisID=that.gclayer.saveLayerState.delay(1000,null,[lid,"visible",value,null,function(evt){node.data.visible=eval(evt.newvalue)?"t":"f"}])}else{node.data.visible=value?"t":"f";that.saveLayersStates()}}})}},onLockIconClick:function(C,u){var z=C.data.id;var p="layer"+z;var r=fnw.getLayerByName(p);if(r){var B;if(r.getSelectable()){r.setSelectable(false);C.data.lock="t";B=true}else{r.setSelectable(true);C.data.lock="f";B=false}if(!layerStateAID[z]){layerStateAID[z]={}}$clear(layerStateAID[z].intLockID);var D=fn.getMap();if(D.owner==user.id){layerStateAID[z].intLockID=this.gclayer.saveLayerState.delay(1000,null,[z,"lock",B])}else{C.data.lock=B?"t":"f";this.saveLayersStates()}}},newFolder:function(){if(!editable){alert(gclang.mmod.no_edit_permission);return}var C="New Folder",u,B,p;var z={property:{name:C,type:"folder"},data:{visible:"t",name:C}};if(!this.tree.root||!this.tree.root.getFirst()){this.showLoader();this.call({module:this.options.module,task:"newfolder",newname:C,mid:currentMapID,plid:null},"newfolder",(function(){this.hideLoader();gcapp.gclayer.loadLayerList()}).bind(this))}else{u=this.tree.selected;B=(u&&u.type==="folder")?u:this.tree.root.getFirst()||this.tree.root;p=(u&&u.type==="folder")?"inside":"before";this.newfoldernode=this.tree.add(z,B,p);var r=u?(u.type==="folder"?u.data.id:null):null;var D={module:this.options.module,task:"newfolder",newname:C,mid:currentMapID,plid:r};this.showLoader();this.call(D,"newfolder",this.onNewFolderComplete.bind(this))}},onNewFolderComplete:function(b){this.hideLoader();if(!b){this.newfoldernode.remove();om.showError("There was an error.");return}if(b.result=="yes"){this.newfoldernode.data.id=b.lid;om.showConfirm(b.msg)}else{this.newfoldernode.remove();om.showError(b.msg)}},editLayer:function(g){var f=this.tree.selected;if(!f){alert(gclang.lmod.no_selection);return}this.gclayer.editLayerByNode(f)},visibility:function(r,u){var B=this.getNodeById(r),z=B.data;if(!B){return}B["switch"](u?"checked":"unchecked",true);B.data.visible=u?"t":"f";var o=z.grp==1?"layer_group_"+z.grp:"layer"+z.id;var p=fnw.getLayerByName(o);if(!p){return}if(u){p.enable()}else{p.disable()}},toggle:function(o,l,j){var p=this.getNodeById(o);if(!p){return}if(l!=undefined){p.toggle(l,j)}else{p.toggle(undefined,j)}},lock:function(r,o){var z=this.getNodeById(r),u=z.data;if(!z){return}z.icon2Click(null,true,!o);z.data.lock=o?"t":"f";var B=u.grp==1?"layer_group_"+u.grp:"layer"+u.id;var p=fnw.getLayerByName(B);if(!p){return}p.setSelectable(!o)},zoomToLayer:function(){if(!fnm.isVisible()){alert(gclang.mmod.not_visible);return}var r=this.tree.selected;if(!r){alert(gclang.lmod.no_selection);return}if(["folder","rasterfolder","basemapfolder"].contains(r.type)){var l=1000000000;var p={xMin:l,yMin:l,xMax:-l,yMax:-l};r.recursive(function(){var a=this.data;if(this.type!="folder"&&a&&a.id){if(a.xmin<p.xMin){p.xMin=a.xmin}if(a.ymin<p.yMin){p.yMin=a.ymin}if(a.xmax>p.xMax){p.xMax=a.xmax}if(a.ymax>p.yMax){p.yMax=a.ymax}}});if(p.xMin!=l){fnw.setViewBoundAnim(p.xMin,p.yMin,p.xMax,p.yMax)}return}if(r.data.grp==2){fnw.setViewBoundAnim(r.data.xmin,r.data.ymin,r.data.xmax,r.data.ymax)}else{var u=(r.data.grp==1)?"layer_group_"+r.data.grp:"layer"+r.data.id;var o=fnw.getLayerByName(u);if(o){var p=o.getBound();fnw.setViewBoundAnim(p.xMin,p.yMin,p.xMax,p.yMax)}}},onGlobalEyeClick:function(K){if(!fnm.isVisible()){return}var E=$(K.target).hasClass("unchecked");$(K.target).toggleClass("unchecked");var O;if(!E){O=false}else{O=true}var D=[];var M=this.serialize();for(var H=0;H<M.length;H++){var I=M[H];var C=I.data;if(C.id){D.push(C.id)}if(["folder","rasterfolder"].contains(I.type)){continue}I["switch"](O?"checked":"unchecked",true);var J=C.grp==1?"layer_group_"+C.grp:"layer"+C.id;var G=fnw.getLayerByName(J);if(!G){continue}C.visible=O?"t":"f";if(O){G.enable()}else{G.disable()}if(C.textfield||C.label){var J="llayer"+C.id;var G=fnw.getLayerByName(J);if(!G){continue}C.visible=O?"t":"f";if(O){G.enable()}else{G.disable()}}}var N=fn.getMap();if(N.owner==user.id){var F=D.join();if(!layerStateAID[F]){layerStateAID[F]={}}$clear(layerStateAID[F].intVisID);layerStateAID[F].intVisID=this.gclayer.saveLayerState.delay(1000,this,[F,"visible",O])}else{this.saveLayersStates()}},onGlobalLockClick:function(K){if(!fnm.isVisible()){return}var E=this.getBackgroundPositionX(K.target).toInt();var O;if(!E||E==0){O=false;this.setBackgroundPosition(K.target,-9)}else{O=true;this.setBackgroundPosition(K.target,0)}var D=[];var M=this.serialize();for(var H=0;H<M.length;H++){var I=M[H];var C=I.data;if(["file","buffer","raster","raster","tile"].contains(I.data.tip)||["feature","rasterfolder"].contains(I.type)||(I.data&&I.data.raster=="t")){continue}if(C.id){D.push(C.id)}I.icon2Click(null,true,O);var J=C.grp==1?"layer_group_"+C.grp:"layer"+C.id;var G=fnw.getLayerByName(J);if(!G){continue}C.lock=O?"f":"t";G.setSelectable(O)}var N=fn.getMap();if(N.owner==user.id){var F=D.join();if(!layerStateAID[F]){layerStateAID[F]={}}$clear(layerStateAID[F].intLockID);layerStateAID[F].intLockID=this.gclayer.saveLayerState.delay(1000,this,[F,"lock",!O])}else{this.saveLayersStates()}},setBackgroundPosition:function(g,j){if(!g){return}if(!Browser.Engine.trident){var l=g.getStyle("background-position").split(" ")}if(Browser.Engine.trident){g.style.backgroundPositionX=j+"px"}else{g.style.backgroundPosition=j+"px "+l[1]}},getBackgroundPositionX:function(g){if(!Browser.Engine.trident){var f=g.getStyle("background-position").split(" ");return f[0]}else{return g.style.backgroundPositionX}}});var gcAnalysisModul=new Class({Extends:omModule,options:{id:"analysismodule"},initialize:function(b){this.setOptions(this.options,b)},newAnalysis:function(u){if(!fnm.isVisible()){alert(gclang.mmod.not_visible);return}if(!editable){alert(gclang.mmod.no_edit_permission);return}if(!(currentMapID>=0)){alert(gclang.mmod.no_selection);return}var B=0;var r=llist.getLayers();for(var o=0;o<r.length;o++){var z=r[o];if(z.sourcetype=="pg"){B++;break}}if(B==0){alert(gclang.lmod.analysis_warning1);return}var p={mid:currentMapID};if(u>0){p.layerid=u}},newQuery:function(){if(!(currentMapID>=0)){alert(gclang.mmod.no_selection);return}if(!fnm.isVisible()){alert(gclang.mmod.not_visible);return}formManager.close("ssf");querywizard=formManager.open({fid:"ssf",overlay:false,minimize:true,title:gclang.qyfrm.title,dragable:true,width:620,height:420,url:fno.liveSite+"modules_gc/analysis/querywizard.php",data:{mid:currentMapID},buttons:[{html:gclang.select,click:"spatialFilterOk();","class":"bluebutton"},{html:gclang.close,click:"spatialFilterCancel();"},{html:gclang.clear,click:"spatialFilterClear();"}],onClose:function(){onQueryFormClose()}})}});gcanalysismodule=new gcAnalysisModul();var gcAnalysisType={BUFFER:{code:1,url:"form_buffer.php",height:320,overlay:false,dragable:true,neededit:true,title:gclang.analysis.buffer_title},NEAR:{code:6,url:"/analysis/form_near",height:270,overlay:false,dragable:true,neededit:true,title:"Near"},INTERSECT:{code:2,url:"form_intersect.php",height:280,overlay:false,dragable:true,title:gclang.analysis.intersect_title},HOTSPOT:{code:3,url:"form_hotspot.php",height:220,overlay:false,dragable:true,neededit:true,title:gclang.analysis.hotspot_title},RADIUSCOVERAGE:{code:4,url:"form_radius_coverage.php",height:240,overlay:false,dragable:true,neededit:true,title:gclang.analysis.radius_coverage_title},AREA:{code:5,url:"form_gis_area.php",height:210,overlay:false,dragable:true,title:gclang.analysis.gis_area_title},COVERAGEELIGIBILITY:{code:4,url:"form_coverage_eligibility.php",height:360,width:350,overlay:false,dragable:true,title:gclang.analysis.coverage_eligilibity_title}};var gcAnalysis=new Class({Extends:omModule,Implements:[Events,Options],options:{url:fno.liveSite+"modules_gc/analysis/canalysis.php",module:"analysis"},initialize:function(b){},open:function(f){if(flashnavigator.html5&&f==gcAnalysisType.RADIUSCOVERAGE){gcapp.html5MissingFunctionality();return false}if(this.form){this.form.close()}if(f.neededit&&!editable){alert(gclang.mmod.no_edit_permission);return}var g=(f.code>=6)?f.url:(fno.liveSite+"modules_gc/analysis/"+f.url);this.form=formManager.open({fid:"analysisform"+f.code,overlay:f.overlay,minimize:true,dragable:f.dragable,title:f.title,width:f.width?f.width:500,height:f.height?f.height:340,url:g,data:{mid:currentMapID,update:f.neededit?"yes":null}});return this.form},edit:function(b){for(atip in gcAnalysisType){if(atip.toLowerCase()==b.atype){this.open(gcAnalysisType[atip],true)}}},analysis:function(g,l){if(!g){return false}if(g.getstats){var j=fno.cgiApp+"?"+Hash.toQueryString(g);giscloud.log.push("analysis_getstats",g);new Request.JSON({url:j,onComplete:l}).get()}else{g.module=this.options.module;g.task="analysis";giscloud.log.push("analysis_start",g);this.call(g,"analysis",l)}},save:function(g,f){if(!g){return}g.module=this.options.module;g.task="saveanalysis";giscloud.log.push("analysis_save",g);this.call(g,"saveanalysis",f)},getAnalyis:function(l,g){if(!l){return}var j={module:this.options.module,task:"getanalysis",layerid:l};giscloud.log.push("analysis_get",j);this.call(j,"getanalyis",g)}});gcanalysis=new gcAnalysis();var gcImport=new Class({Extends:omModule,options:{id:"analysismodule"},initialize:function(b){this.setOptions(this.options,b)},importData:function(){importwizard=formManager.open({fid:"csvimportform",oneInstance:true,title:"Import wizard",width:500,height:450,minimize:true,url:fno.liveSite+"layer/import_form",data:{},buttons:[{html:"Close",click:"importwizard.close();"}]})}});var gcimport=new gcImport();function onSaveUser(b){userform.enable();om.hideLoader();om.showMessage(b.msg);if($("userform").task.value=="new"&&b.result=="yes"&&b.id){$("userform").task.value="update";$("userform").userid.value=b.id;if(refreshUserList){refreshUserList()}}if(b.result=="yes"){userform.close()}}function uf_RandomPasswordClick(b){$("passwordform").type=$("passwordform2").type="text";$("passwordform").value=$("passwordform2").value=getRandomString(8)}function saveUser(){if(!LiveValidation.massValidate([firstnameVal])){gcapp.userform.usrtabs.showTab(0);return}if(!LiveValidation.massValidate([usernameVal,password2Val])){gcapp.userform.usrtabs.showTab(1);return}var j=$("passwordform");if(j&&j.value.length>0&&passwordVal&&!LiveValidation.massValidate([passwordVal])){gcapp.userform.usrtabs.showTab(1);return}var l=om.getFormValues("form-user-roles");var o=om.getFormValues("userform");o.feature_count_limit=jQuery("#user_featureslimit").val();o.storage_raster_limit=(parseInt(jQuery("#user_rasterlimit").val())*1024*1024)||0;o.roles=l?l:"";o.premium1ts=gcapp.userform.premium1ts;o.premium2ts=gcapp.userform.premium2ts;o.module="user";if(user.id>0&&o.password&&o.password2&&o.password.length>0&&o.password2.length>0){if(!o.passwordc||!(o.passwordc.length>0)){alert("If you want to change your password please enter the current password as well.");return}}userform.disable();om.showLoader("Saving..");var p=new Request.JSONP({url:fno.liveSiteUser+"/user/update",onComplete:onSaveUser,data:o}).send()}function uf_premiumDetails(){var b=$("usrform_plan_select");if(b.options[b.selectedIndex].value*1>0){$("usrform_plan_details").show()}else{$("usrform_plan_details").hide()}}function cancelPremium(){if(confirm("Are You Sure?")){window.location.href="mailto:info@giscloud.com?subject=Cancel GIS Cloud Subscription"}}var gcFleetLayer=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/fleet/cfleet.php",module:"fleet",interval:5,lid:null,source:null,fuid:null,mid:null},initialize:function(g){this.setOptions(this.options,g);this.cflids=[];var f=JSON.decode(this.options.source);this.options.fuid=f.fleetuserid;this.options.interval=is_numeric(f.interval)&&f.interval>=5?f.interval:5;this.getPositions()},getPositions:function(){var b={};b.module=this.options.module;b.task="getpositions";b.fuid=this.options.fuid;b.mid=fn.getMap().mid;b.__NOLOADER=true;this.call(b,null,this.onGetPositions.bind(this))},onGetPositions:function(j){var l;for(l=0;l<this.cflids;l++){canvas.remove(this.cflids[l])}for(l=0;l<4;l++){var o=j[l];var p={};p.color=p.linecolor=16760576;p.alpha=40;p.linealpha=100;p.fillcolor=65280;p.width=1;p.icon="http://cdn1.iconfinder.com/data/icons/fugue/icon/car--arrow.png";p.geom="POINT("+o.x+" "+o.y+")";this.cflids.push(canvas.deserializeGeometryOpenGIS(p))}}});var GeometryRenderer=new Class({Implements:[Options,Events],options:{url:fno.liveSite+"modules_gc/geometry/cgeometry.php",module:"geometry"},initialize:function(f,g){this.setOptions(this.options,g);this.cfids={};this.selection},drawLayer:function(b){fnl.getPostGISLayer(b,this.onGetLayerGeometry.bind(this))},onGetLayerGeometry:function(E,C){if(!C){return}if(C.result=="no"){om.showError(C.msg);return}var H=E.id;this.cfids[H]=[];var G=0;var B,D;for(B=0;B<C.classes.length;B++){var j=C.classes[B];var F={linecolor:3355443,fillcolor:Math.random()*16777215};if(j.url){F.icon=fno.liveSite+"assets/icon.php?p="+encodeURI(j.url)}else{if(j.symbol&&j.symbol.type){F.icon=fno.liveSite+"assets/icon.php?"+Hash.toQueryString(j.symbol)}}G+=j.count;for(D=0;D<j.count;D++){var f=j.features[D];this.drawPoint(H,f.fid,f.geom,F)}}this.fireEvent("layerrender",{lid:H,count:G,layerdata:E,data:C})},drawPoint:function(z,r,p,B){if(!p){return}var u={};u.color=u.linecolor=B.linecolor;u.linealpha=100;u.fillcolor=B.fillcolor;if(B.icon){u.icon=B.icon}u.width=5;u.id=1;u.geom=p;var o=canvas.deserializeGeometryOpenGIS(u);this.cfids[z].push({fid:r,gid:o})},removeAll:function(){if(!canvas){return}var f=this.cfids;var g;for(lid in f){for(g=0;g<f[lid].length;g++){canvas.remove(f[lid][g].gid)}}},getFeatureByGID:function(f){var l=this.cfids;var j;for(lid in l){for(j=0;j<l[lid].length;j++){if(l[lid][j].gid==f){return{lid:lid,fid:l[lid][j].fid}}}}},getGIDByFID:function(o,p){var f=this.cfids;var l;if(p){for(l=0;l<f[p].length;l++){if(f[p][l].fid==o){return{lid:p,gid:f[p][l].gid}}}}else{var p;for(p in f){for(l=0;l<f[p].length;l++){if(f[p][l].fid==o){return{lid:p,gid:f[p][l].gid}}}}}},visibility:function(p,r){var o,u=this.cfids[p];if(!u){return}for(o=0;o<u.length;o++){var f=u[o];canvas.setGeometryVisible(f.gid,r?"true":false)}},clearSelection:function(){if(!this.selection){return}var g;for(g=0;g<this.selection.fids.length;g++){var f=this.getGIDByFID(this.selection.fids[g],this.selection.lid);if(!f){f=this.getGIDByFID(this.selection.fids[g])}if(f){canvas.setFilter(f.gid,{})}}this.selection=null},select:function(u,p,l){this.clearSelection();var o;for(o=0;o<u.length;o++){var r=this.getGIDByFID(u[o],l);if(!r){r=this.getGIDByFID(u[o])}canvas.setFilter(r.gid,{type:"glowfilter",color:65280,strength:2,blurX:7,blurY:7})}this.selection={lid:r.lid,fids:Array.clone(u)}}});var geomrenderer=new GeometryRenderer();function onLevelsInvalid(g,f){if(g){g.addFieldClass()}$("stylelevelsmess").red(f)}function onLevelsValid(g,f){if(g){g.addFieldClass()}$("stylelevelsmess").empty()}function showGeometryFields(){om.show($("color-item"));om.show($("bordercolor-item"));om.show($("borderwidth-item"));om.show($("width-item"));om.show($("cap-item"));om.show($("scale-item"));om.hide($("fontsize-item"));om.hide($("fontname-item"));om.hide($("outline-item"))}function typeStyleLayerChange(){switch($("tip").value){case"line":showGeometryFields();$("iconstyle-item").hide();break;case"polygon":showGeometryFields();$("iconstyle-item").hide();break;case"geometry":showGeometryFields();$("iconstyle-item").show();break;case"point":om.hide($("color-item"));om.hide($("bordercolor-item"));om.hide($("borderwidth-item"));om.hide($("width-item"));om.hide($("cap-item"));om.hide($("scale-item"));om.hide($("fontsize-item"));om.hide($("fontname-item"));om.hide($("outline-item"));$("iconstyle-item").show();break;case"label":om.hide($("bordercolor-item"));om.hide($("borderwidth-item"));om.hide($("width-item"));om.hide($("cap-item"));om.hide($("scale-item"));om.show($("fontsize-item"));om.show($("fontname-item"));om.show($("outline-item"));$("iconstyle-item").hide();break;case"raster":break}}function onIconURLBrowseSelect(g){if(!g){return}if(!g.files){return}if(!g.files.length){return}var f=g.files[0].path.replace(/ /g,"%20");$("iconurlpreview").store("symbol",null);$("iconurlpreview").store("url",g.files[0].path);setDivStyle("point",$("iconurlpreview"),{url:f});gcstyleform.iconGallery.unselect()}function onCustomMarkerClose(b){if(!b||!b.type){return}$("iconurlpreview").store("url",null);$("iconurlpreview").store("symbol",b);setDivStyle("point",$("iconurlpreview"),{symbol:b});gcstyleform.iconGallery.unselect()}function onCustomMarkerClick(){symbolform=formManager.open({title:"Symbol",width:550,height:330,url:fno.liveSite+"modules_gc/layer/form_symbol.php",buttons:[{html:"Ok","class":"bluebutton",click:"csymbolform.ok();"},{html:gclang.cancel,click:"symbolform.close()"}]});symbolform.fdata=$("iconurlpreview").retrieve("symbol");symbolform.addEvent("close",onCustomMarkerClose);return symbolform}function onIconBrowseClick(){iconBrowse=formManager.fileBrowser({upload:true,selectmode:true,showimages:true,extensions:[gcFileExt.Icons],postgis:false});iconBrowse.addEvent("close",onIconURLBrowseSelect)}function sf_IconClearClick(b){$("iconurlpreview").store("url",null);$("iconurlpreview").store("symbol",null);setDivStyle("point",$("iconurlpreview"),{url:null});gcstyleform.iconGallery.unselect()}function sf_RandomColorClick(g){var f=getTwoRandomStyles();styleform.fdata.color=f[0].color;setDivStyle(null,$("color"),{color:styleform.fdata.color});styleform.fdata.bordercolor=f[1].color;setDivStyle(null,$("bordercolor"),{color:styleform.fdata.bordercolor})}function styf_clearStyle(b){b=$(b);if(!b){null}b.setStyle("background-color","white");b.addClass("nocolor")}function st_styleFormDOMReady(){styledata=styleform.fdata;omnilist.populate("stylemerged",{field:"name",data:layerform.attributes,dontempty:true,filter:["gis_area","gis_length"]});if(styledata){var sc_color=styledata.color?styledata.color.split(","):null;var sc_bordercolor=styledata.bordercolor?styledata.bordercolor.split(","):null;var sc_outline=styledata.outline?styledata.outline.split(","):null;var sc_fontcolor=styledata.fontcolor?styledata.fontcolor.split(","):null;var newlayer=false;if(styledata.galleryIcon){setDivStyle("point",$("iconurlpreview"),{url:styledata.galleryIcon,raw:true})}else{if(styledata.url){setDivStyle("point",$("iconurlpreview"),{url:styledata.url});$("iconurlpreview").store("url",styledata.url)}if(styledata.symbol){setDivStyle("point",$("iconurlpreview"),{symbol:styledata.symbol});$("iconurlpreview").store("symbol",styledata.symbol)}}$("fontsize").value=styledata.fontsize?styledata.fontsize:11;$("fontname").value=styledata.fontname?styledata.fontname:null;om.setSelectValue($("labelf"),styledata.labelfield);om.setSelectValue($("textfield"),styledata.textfield);om.setSelectValue($("labelplacement"),styledata.labelplacement);$("ldx").value=styledata.ldx?styledata.ldx:"";$("ldy").value=styledata.ldy?styledata.ldy:"";$("margin").value=styledata.margin?styledata.margin:"";jQuery("#style-overlap-degree").slider("value",eval(styledata.iconsoverlap));$("style_clustering_cb").checked=eval(styledata.clustering);$("width").value=styledata.width>=0?styledata.width:"0";$("borderwidth").value=styledata.borderwidth>=0?styledata.borderwidth:"0";$("cap").checked=eval(styledata.cap);$("dashed").value=styledata.dashed?styledata.dashed:null;$("stylelinescale").checked=eval(styledata.scale);$("styfrm_level_rd").checked=true;om.setSelectValue("stylemerged",styledata.merged?styledata.merged:"");$("featureclass").value=styledata.featureclass?styledata.featureclass:"";$("stylelevels_from").value=styledata.fromlevel?styledata.fromlevel:"";$("stylelevels_to").value=styledata.tolevel?styledata.tolevel:""}else{var hue=Math.round(Math.random()*359);var sc_bordercolor=$HSB(hue,80,80);var sc_color=$HSB(hue,20,80);var sc_outline=$HSB(255,255,255);var sc_fontcolor=$HSB(0,0,0);var newlayer=true;$("width").value=0;$("borderwidth").value=0;$("cap").checked=false;$("dashed").value="";jQuery("#style-overlap-degree").slider("value",2);$("fontsize").value=11;$("fontname").value="";$("styfrm_level_rd").checked=true;om.setSelectValue("stylemerged","");$("featureclass").value="";$("stylelevels_from").value="";$("stylelevels_to").value=""}borderwidthVal=new LiveValidation("borderwidth",{insertAfterWhatNode:$("sf_invalid_val")});borderwidthVal.add(Validate.Numericality,{onlyInteger:true,minimum:0});widthVal=new LiveValidation("width",{insertAfterWhatNode:$("sf_invalid_val")});widthVal.add(Validate.Numericality,{onlyInteger:true,minimum:0});fontsizeVal=new LiveValidation("fontsize",{insertAfterWhatNode:$("sf_invalid_val")});fontsizeVal.add(Validate.Numericality,{onlyInteger:true,minimum:0});stylelevelsFromVal=new LiveValidation("stylelevels_from",{insertAfterWhatNode:$("sf_invalid_val")});stylelevelsFromVal.add(Validate.Numericality,{onlyInteger:true,minimum:0,onInvalid:onLevelsInvalid,onValid:onLevelsValid});stylelevelsToVal=new LiveValidation("stylelevels_to",{insertAfterWhatNode:$("sf_invalid_val")});stylelevelsToVal.add(Validate.Numericality,{onlyInteger:true,minimum:0,onInvalid:onLevelsInvalid,onValid:onLevelsValid});var layer_type=tipcomboObj.getValue();var param={id:"ccolor",imgPath:"/libs/colorpicker/images/",overlay:false,onComplete:function(color){styleform.fdata.color=color.rgb.join();$("color").setStyle("background-color",color.hex);$("color").removeClass("nocolor")},onChange:function(color){color=color.rgb.rgbToHex();if(layer_type=="line"){if($("borderwidth").value>0){redrawMapLayer("innerstrokecolor",color)}else{redrawMapLayer("strokecolor",color)}}else{if(layer_type=="polygon"){redrawMapLayer("fillcolor",color)}}},onCancel:function(e){if(!sc_color){return}var color=sc_color.rgbToHex();if(layer_type=="line"){if($("borderwidth").value>0){redrawMapLayer("innerstrokecolor",color)}else{redrawMapLayer("strokecolor",color)}}else{if(layer_type=="polygon"){redrawMapLayer("fillcolor",color)}}}};if(sc_color){param.startColor=sc_color}else{styf_clearStyle("color")}mrcolor=new MooRainbow("color",param);if(sc_color){styleform.fdata.color=sc_color.join();$("color").setStyle("background-color",sc_color.rgbToHex())}var param={id:"bcolor",imgPath:"/libs/colorpicker/images/",overlay:false,onComplete:function(color){styleform.fdata.bordercolor=color.rgb.join();$("bordercolor").setStyle("background-color",color.hex);$("bordercolor").removeClass("nocolor")},onChange:function(color){if(layer_type=="polygon"||(layer_type=="line"&&$("borderwidth").value>0)){redrawMapLayer("strokecolor",color.rgb.rgbToHex())}},onCancel:function(e){if(!sc_bordercolor){return}var color=sc_bordercolor.rgbToHex();if(layer_type=="polygon"||(layer_type=="line"&&$("borderwidth").value>0)){redrawMapLayer("strokecolor",color)}}};if(sc_bordercolor){param.startColor=sc_bordercolor}else{styf_clearStyle("bordercolor")}mrbordercolor=new MooRainbow("bordercolor",param);if(sc_bordercolor){styleform.fdata.bordercolor=sc_bordercolor.join();$("bordercolor").setStyle("background-color",sc_bordercolor.rgbToHex())}var param={id:"fcolor",imgPath:"/libs/colorpicker/images/",onComplete:function(color){styleform.fdata.fontcolor=color.rgb.join();$("fontcolor").setStyle("background-color",color.hex);$("fontcolor").removeClass("nocolor")}};if(sc_fontcolor){param.startColor=sc_fontcolor}else{styf_clearStyle("fontcolor")}mrfontcolor=new MooRainbow("fontcolor",param);if(sc_fontcolor){styleform.fdata.fontcolor=sc_fontcolor.join();$("fontcolor").setStyle("background-color",sc_fontcolor.rgbToHex())}var param={id:"ocolor",imgPath:"/libs/colorpicker/images/",onComplete:function(color){styleform.fdata.outline=color.rgb.join();$("outline").setStyle("background-color",color.hex);$("outline").removeClass("nocolor")}};if(sc_outline){param.startColor=sc_outline}else{styf_clearStyle("outline")}mroutlinecolor=new MooRainbow("outline",param);if(sc_outline){styleform.fdata.outline=sc_outline.join();$("outline").setStyle("background-color",sc_outline.rgbToHex())}$("random_color_bt").addEvent("click",sf_RandomColorClick);$("iconurl_clear_bt").addEvent("click",sf_IconClearClick);$("iconurl_browse_bt").addEvent("click",onIconBrowseClick);$("iconurl_custommarker_bt").addEvent("click",onCustomMarkerClick);$("iconurlpreview").addEvent("click",onIconBrowseClick);$("clear_color_bt").addEvent("click",function(){delete styleform.fdata.color;styf_clearStyle("color")});$("clear_border_color_bt").addEvent("click",function(){delete styleform.fdata.bordercolor;$("borderwidth").value=0;styf_clearStyle("bordercolor")});$("clear_font_color_bt").addEvent("click",function(){styf_clearStyle("fontcolor");delete styleform.fdata.fontcolor});$("clear_outline_color_bt").addEvent("click",function(){styf_clearStyle("outline");delete styleform.fdata.outline})}function redrawMapLayer(p,l){if(!flashnavigator.hasCanvas){return}var o=fnw.getLayerByName("layer"+$("layerid").value);if(o){var u=o.getRules();if(u){var r=u[u.length-1-window.active_expression_index];if(r){r[p]=l;o.redraw()}}}}var gcCSV=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/layer/gcCSV.php",module:"csv"},initialize:function(b){},importCSV:function(g,f){if(!g){return}g.module=this.options.module;g.task="import";this.call(g,"import",f)},getData:function(g,f){if(!g){return}g.module=this.options.module;g.task="getdata";this.call(g,"getdata",f)},editline:function(g,f){if(!g){return}g.module=this.options.module;g.task="editline";this.call(g,"editline",f)}});var CSV=new gcCSV();var CMobileInput=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/dynamiclayer/cdynamiclayer.php",module:"dynamiclayer"},initialize:function(f,g){this.setOptions(this.options,g);this.attributes=[];this.selectedDev=-1;this.selectedItem=null;this.table_cols=null},init:function(){if(!$("layerid")){return}$("refreshmobilenewdev_bt").addEvent("click",function(g){var f=prompt("Please enter Device ID: ");if(f){mod_mobileinput.addDev(f)}});$("refreshmobiledeldev_bt").addEvent("click",function(j){var l=confirm("Are you sure?");if(l){var g=$("mobileinput_device").value;mod_mobileinput.delDev(g)}});this.call({module:"dynamiclayer",task:"getfields",lid:$("layerid").value,__NOLOADER:true},"getfields",this.onFields.bind(this));this.refreshDevList(-1)},selectMenuItem:function(b){if(this.selectedItem){this.selectedItem.childNodes[0].setStyle("background","#ffffff")}this.selectedItem=b;b.childNodes[0].setStyle("background","#E0F0FF")},onURLBrowseSelect:function(B){if(!B){return}if(!B.files){return}if(!B.files.length){return}var z=B.files[0].path.replace(/ /g,"%20");if(mod_mobileinput.selecteItemIsMain){$("mb_input_mitem_img_mainmenu").src="/assets/icon.php?p="+z}else{if(mod_mobileinput.selectedItem){var r=mod_mobileinput.selectedItem.id.replace("mb_input_mitem_","");$("mb_input_mitem_img_"+r).src="/assets/icon.php?p="+z;var p=$("mb_input_mitem_label_"+r);var u=p.get("text");var o=$("layerid").value;mod_mobileinput.call({module:"dynamiclayer",task:"update_menu_item",lid:o,item:r,img:z,label:u,__NOLOADER:true},"update_menu_item")}}},urlBrowse:function(){iconBrowse=formManager.fileBrowser({upload:true,nooverlay:true,selectmode:true,showimages:true,extensions:[gcFileExt.Icons],postgis:false});iconBrowse.addEvent("close",this.onURLBrowseSelect)},changeItem:function(j){this.selecteItemIsMain=j;if(j){var l=$("mb_input_mitem_label_mainmenu");var p=prompt("Label:",l.get("text"));if(p){l.set("text",p);this.urlBrowse()}return}if(this.selectedItem){var o=this.selectedItem.id.replace("mb_input_mitem_","");var l=$("mb_input_mitem_label_"+o);var p=prompt("Label:",l.get("text"));if(p){$("mb_input_mitem_label_"+o).set("text",p);this.urlBrowse()}}},onItemAdd:function(l){var o=mod_mobileinput.newItemMenuId;var a=$("mb_input_mitems_"+o);var p=new Element("a");p.id="mb_input_mitem_"+l.id;p.href="#";p.onclick="mod_mobileinput.selectMenuItem(this); return false;";p.innerHTML='<div style="margin:0px;padding1:0;"><img id="mb_input_mitem_img_'+l.id+'" src="/assets/icon.php?p='+mod_mobileinput.newItemImg+'" /><span id="mb_input_mitem_label_'+l.id+'">'+mod_mobileinput.newItemLabel+"</span></div>";p.inject(a);a.scrollTo(0,a.getScrollSize().y)},onURLBrowseAddSelect:function(g){if(!g){return}if(!g.files){return}if(!g.files.length){return}var l=g.files[0].path.replace(/ /g,"%20");var j=$("layerid").value;mod_mobileinput.newItemImg=l;mod_mobileinput.call({module:"dynamiclayer",task:"add_menu_item",lid:j,menu_id:mod_mobileinput.newItemMenuId,img:l,label:mod_mobileinput.newItemLabel,__NOLOADER:false},"add_menu_item",mod_mobileinput.onItemAdd.bind(mod_mobileinput))},urlBrowseForAdd:function(){var b=formManager.fileBrowser({upload:true,nooverlay:true,selectmode:true,showimages:true,extensions:[gcFileExt.Icons],postgis:false});b.addEvent("close",this.onURLBrowseAddSelect)},addItem:function(g){var f=prompt("Label:");if(f){this.newItemMenuId=g;this.newItemLabel=f;this.urlBrowseForAdd()}},onItemDel:function(){if(this.selectedItem){this.selectedItem.dispose()}},deleteItem:function(){if(this.selectedItem&&confirm("Are You sure?")){var b=this.selectedItem.id.replace("mb_input_mitem_","");mod_mobileinput.call({module:"dynamiclayer",task:"del_menu_item",item:b,__NOLOADER:false},"del_menu_item",mod_mobileinput.onItemDel.bind(mod_mobileinput))}},setMenus:function(F){var E=$("mobile_menus");var B=new Element("div");B.id="mobile_input_menu_main";B.innerHTML='<div class="label" style="width:135px">Main Menu</div><div class="div_texbox" style="margin-left:0px;"><div class="custommenucont" style="margin-left:135px" ><div style="overflow:none;max-height:27px;height:27px;width:200px;border:1px solid #ddd;float:left;"><div style="margin:0px;padding1:0;"><img width="16" height="16" id="mb_input_mitem_img_mainmenu" src="" /><span class="span1"  id="mb_input_mitem_label_mainmenu"></span></div></div><div style="height:60px;margin-left:10px;"><ul class="auxmenu" style="display: block; float:right" >	<li><a href="#" style="text-decoration:underline" onclick="mod_mobileinput.changeItem(true);return false;">Change</a></li>		</ul></div></div></div>';B.inject(E);for(var C=0;C<F.length;C++){var z=F[C];if(z.id==-1){$("mb_input_mitem_label_mainmenu").set("text",z.menu);$("mb_input_mitem_img_mainmenu").src="/assets/icon.php?p="+z.icon}else{var B=new Element("div");mid=z.id;var u='<div class="label" style="width:135px;padding-top:18px">Menu Level '+C+'</div><div class="div_texbox" style="margin-left:0px;"><div class="custommenucont"  style="margin-left:135px"><div class="custommenucont1">Store in 	<select id="mobileinput_store_field_map_'+mid+'" name="mobileinput_store_field_map_'+mid+'">';for(var D=0;D<this.table_cols.length;D++){if(this.table_cols[D]==this.field_map["field_map_"+mid]){u+='<option selected="selected" value="'+this.table_cols[D]+'">'+this.table_cols[D]+"</option>"}else{u+='<option value="'+this.table_cols[D]+'">'+this.table_cols[D]+"</option>"}}u+='</select>	</div>	<div id="mb_input_mitems_'+mid+'" style="overflow-y:scroll;max-height:60px;height:60px;width:200px;border:1px solid #ddd;float:left;">';for(var r=0;r<z.items.length;r++){u+='<a id="mb_input_mitem_'+z.items[r].id+'" href="#" onclick="mod_mobileinput.selectMenuItem(this); return false;" ><div style="margin:0px;padding1:0;"><img id="mb_input_mitem_img_'+z.items[r].id+'" src="/assets/icon.php?p='+z.items[r].icon+'" /><span id="mb_input_mitem_label_'+z.items[r].id+'">'+z.items[r].label+"</span></div></a>"}u+='</div>	<div style="height:60px;margin-left:10px;"><ul class="auxmenu" style="display: block; float:right" ><li><a href="#" style="text-decoration:underline" onclick="mod_mobileinput.addItem('+mid+');return false;">Add</a></li><li>|</li><li><a href="#" style="text-decoration:underline" onclick="mod_mobileinput.changeItem();return false;">Change</a></li><li>|</li><li><a href="#" style="text-decoration:underline"  onclick="mod_mobileinput.deleteItem();return false;">Delete</a></li></ul></div></div></div><br />';B.innerHTML=u;B.id="mobile_input_menu_"+mid;B.inject(E)}}},onFields:function(u){var f=$("mobileinput_store_imei");if(!f){return}f.options.length=0;var z=new Array();for(var r in u.field_map){z[u.field_map[r].property]=u.field_map[r].field}var B=u.cols;this.table_cols=B;this.field_map=z;B.unshift("<none>");for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];if(B[r]==z.imei){o.selected="selected"}o.inject(f)}var f=$("mobileinput_store_audio");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];if(B[r]==z.audio){o.selected="selected"}o.inject(f)}var f=$("mobileinput_store_time");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];if(B[r]==z.time){o.selected="selected"}o.inject(f)}var f=$("mobileinput_store_video");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];if(B[r]==z.video){o.selected="selected"}o.inject(f)}var f=$("mobileinput_store_image");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];if(B[r]==z.image){o.selected="selected"}o.inject(f)}var f=$("mobileinput_store_comment");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];if(B[r]==z.comment){o.selected="selected"}o.inject(f)}var f=$("mobileinput_store_category");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];if(B[r]==z.category){o.selected="selected"}o.inject(f)}var f=$("mobileinput_store_accuracy");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];if(B[r]==z.accuracy){o.selected="selected"}o.inject(f)}var f=$("mobileinput_id5_field");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];o.inject(f)}var f=$("mobileinput_id6_field");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];o.inject(f)}var f=$("mobileinput_id7_field");if(!f){return}f.options.length=0;for(r=0;r<B.length;r++){var o=new Element("option");o.innerHTML=B[r];o.value=B[r];o.inject(f)}},onDevList:function(u){if(!$("layerid")){return}var o=$("mobileinput_device");if(!o){return}o.options.length=0;var r=new Element("option");r.innerHTML="Disabled";r.value=-1;r.selected="selected";r.inject(o);var B=$("layerid").value;var p=0;this.devicesids=[];for(i=0;i<u.length;i++){var z=new Element("option");z.innerHTML=u[i].imei;z.value=u[i].id;this.devicesids.push(u[i].id);if((u[i].lid==B&&(this.selectedDev==-1))||(this.selectedDev==u[i].id)){z.selected="selected";r.selected=false}z.inject(o)}$("mobileinput_devices").value=this.devicesids.join()},getSelectedDevices:function(){var j=$("mobileinput_device");var l=new Array();var g;for(g=0;g<j.options.length;g++){if(j.options[g].selected){l.push(j.options[g].value)}}return l.join()},addDev:function(b){this.call({module:"dynamiclayer",task:"adddev",imei:b,__NOLOADER:true},"adddev",this.onAddOrDelDev.bind(this))},onAddOrDelDev:function(b){this.refreshDevList(b.id)},delDev:function(b){if(!b){alert("Please select mobile device that you want to delete.");return}this.call({module:"dynamiclayer",task:"deldev",phoneid:b,__NOLOADER:true},"deldev",this.onAddOrDelDev.bind(this))},refreshDevList:function(f){var g=$("layerid").value;this.selectedDev=f;this.call({module:"dynamiclayer",task:"getdevlist",lid:g,__NOLOADER:true},"getdevlist",this.onDevList.bind(this))}});var mod_mobileinput=new CMobileInput();window.addEvent("domready",function(){});var PCManager=new Class({Implements:[Options,Events],commet:null,options:{url:fno.liveSite+"modules_gc/pcm/cpcm.php",reconnecttime:120000,sleeptime:1},initialize:function(f,g){this.setOptions(this.options,g);this.container=$(f);this.isopen=false;this.tskcont=this.container.getElement(".tskcont");this.conntime=null;this.interval=null;this.isopen=false;this.setConnectionState(0);this.container.fade("hide");this.disconnectbind=null;this.events={};this.morph=new Fx.Morph($("pcmarrow"),{transition:Fx.Transitions.Sine.easeOut,duration:"normal"});$("pcm_connect_bt").addEvent("click",this.connect.bind(this))},toggle:function(){this.isopen=!this.isopen;this.container.fade("toggle");if(this.isopen){}else{}},show:function(){if(!this.isopen){this.toggle()}},resize:function(){var b=this.container.getSize();this.container.setStyle("bottom",-b.y)},setConnectionState:function(b){if(b==1){this.connected=true;$("pcm_bt").setStyle("background-color","transparent");$("pcm_bt").fade("in")}else{if(b==0){this.connected=false;$("pcm_bt").setStyle("background-color","#E20000");$("pcm_bt").fade(0.3)}else{if(b==2){$("pcm_bt").setStyle("background-color","#e2e200")}}}},connect:function(o){if(!o){this.disconnect()}var l=Hash.toQueryString({module:"pcm",task:"status",sleeptime:this.options.sleeptime});var j=this.options.url+"?"+l;this.comet=new Request.Comet({url:j,onPush:this.onPush.bind(this)}).send();this.comet.addEvent("fail",this.onCometFail.bind(this));if(this.interval){$clear(this.interval)}this.interval=this.connect.periodical(this.options.reconnecttime,this);this.intervalDisconnect=this.onDisconnectInterval.periodical(this.options.sleeptime*3000,this);var p=new Date();this.lastmsg=p.getTime();this.disconnectbind=this.disconnect.bind(this);window.addEvent("unload",this.disconnectbind);this.tskcont.innerHTML="";this.tskcont.showLoader()},onCometFail:function(){this.disconnect()},onDisconnectInterval:function(j){var l=new Date();var g=l.getTime();if((g-this.lastmsg)>this.options.sleeptime*3000){$clear(this.interval);$clear(this.intervalDisconnect);this.disconnect();return}},onPush:function(l){var j=l.toString();var o=JSON.decode(j);var p=new Date();this.lastmsg=p.getTime();if(o&&o.length>0){omnilist.embed(this.tskcont,{data:o,labelFunction:this.labelFunction.bind(this),link:false});this.setConnectionState(2)}else{if(o&&o.msg){this.setConnectionState(1);this.tskcont.innerHTML=o.msg}else{this.setConnectionState(1);this.tskcont.innerHTML="No active tasks."}}},disconnect:function(f,g){if(this.interval){$clear(this.interval)}$clear(this.intervalDisconnect);if(this.comet){this.comet.cancel()}window.removeEvent("unload",this.disconnectbind);this.tskcont.hideLoader();this.tskcont.innerHTML="No connection";this.setConnectionState(0)},onAdd:function(f,g){if(f.result=="yes"){this.events[f.aid]=g;this.newTaskNotification()}},add:function(l,p){var o={module:"pcm",task:"run",url:urlencode(l)};var j=new Request.JSON({url:this.options.url,data:o,onComplete:this.onAdd.create({bind:this,event:true,arguments:p})});j.send();$("pcm_bt").highlight("#00e200")},onKill:function(b){if(b&&b.msg){om.showMessage(b.msg)}},kill:function(j){var l={module:"pcm",task:"kill",pid:j};var g=new Request.JSON({url:this.options.url,data:l,onComplete:this.onKill.bind(this)}).send()},onStop:function(b){if(b&&b.msg){om.showMessage(b.msg)}},stop:function(l){if(!confirm("Are you sure?")){return}var g={module:"pcm",task:"stop",id:l};var j=new Request.JSON({url:this.options.url,data:g,onComplete:this.onStop.bind(this)}).send()},labelFunction:function(g,j){if(parseInt(g.flag)==3){g.output=g.output.replace(/&lt;/g,"<");g.output=g.output.replace(/&gt;/g,">");g.output=g.output.replace(/&quot;/g,'"');g.output=g.output.replace(/&sq;/g,"'");if(g.type<300){g.output=JSON.decode(g.output)}var l=this.events[g.id];if(l){l(g.output);delete this.events[g.id]}$("pcm_bt").highlight("#e20")}g.d=g.d.replace(/&sq;/g,"'");return g.d+" "+(g.p?g.p:"")+" <a onclick='PCM.stop("+g.id+");' href='javascript:void(0);' title='Stop task' >Stop</a>"},newTaskNotification:function(){var b=window.getSize().y;$("pcmarrow").setStyles({top:b-400,left:"20px",opacity:1,display:"block"});this.morph.start({top:b-80,opacity:0})}});var gcdatagrid;var editmode=false;var selectionarea_fnw_obj=null;var formatTimestamp=function(o){var j=new Date(o),p=j.getTimezoneOffset()/-60,l=j.toLocaleDateString()+" "+j.toLocaleTimeString().substring(0,j.toLocaleTimeString().lastIndexOf(":"))+" GMT"+(p>0?"+":"")+p;return l};var gcDataGrid=new Class({Extends:omModule,options:{jqgrid:false,showRowEditColumn:false,memoryCache:true,defaultURL:fno.liveSite+"modules_gc/layer/clayer.php",url:fno.liveSite+"modules_gc/layer/clayer.php",qsParams:{},position:true,where:null,filtering:!Browser.ie,selection_filter:false,contextMenu:true,showThumbs:false,sortOn:null,sortBy:"ASC"},initialize:function(b){this.setOptions(this.options,b);this.__filters={};gcapp.addEvent("ready",this.appReady.bind(this));window.addEvent("domready",this.domReady.bind(this))},domReady:function(){},appReady:function(){if(gcapp.dataPanel){gcapp.dataPanel.addEvent("onExpand",this.onParentPanelExpand.bind(this))}var o=$("datagrid_pad");if(!o){return}o.empty();if(this.options.jqgrid){var j=new Element("table",{id:"layerdata_table"});j.inject(o)}else{var p=new Element("div",{id:"layerdata_table"});p.inject(o)}var l=this;if(gcapp.selo){gcapp.selo.addEvent("change",function(){if(l.options.filtering&&l.options.selection_filter){l.showLayerData(null,true)}})}this.initDataGrid();gcproject.addEvent("getmapdata",function(){if($("datagrid_map_sync")){$("datagrid_map_sync").checked=false;l.selectionFilterChange()}})},refresh:function(b){if(this.datagrid){this.datagrid.refresh(b)}},getSelectedIndices:function(){if(!this.datagrid){return}return this.datagrid.getSelectedIndices()},getDataByRow:function(b){if(!this.datagrid){return}return this.datagrid.getDataByRow(b)},setPerPage:function(b){if(!this.datagrid){return}this.datagrid.options.perPage=b},setOption:function(g,f){if(!this.datagrid){return}this.datagrid.options[g]=f},addDataGridEvent:function(g,f){if(!this.datagrid){return}this.datagrid.addEvent(g,f)},setURL:function(b){if(!this.datagrid){return}this.datagrid.options.url=b},setColumnModel:function(b){if(!this.datagrid){return}if(b){this.datagrid.setColumnModel(b)}else{this.datagrid.options.columnModel=null}},removeAll:function(b){this.currentsrchash=null;this.last_req_params=null;this.removeAllFilters(true);if(this.datagrid){this.datagrid.removeAll(b)}},onParentPanelExpand:function(b){if(gcapp&&gcapp.gclayer){gcapp.gclayer.showLayerData()}},layerDataClick:function(){if(!fnm.isVisible()||!this.datagrid){return}var N=this.datagrid.getSelectedIndices();if(N.length==0){return}var I=this.datagrid.getDataByRow(N[0]);if(this.options.position){gcapp.gcmap.smartSetLocation(I)}var K=fnl.getSelectedLayers();if(K&&K.length>0){var M=K[0];var P=getSourceObject(M.source);var O=I.__id;var G="layer"+M.id+"||"+O;var Q={fids:[O],lid:M.id};if(!this.options.selection_filter){}var H=null;gcapp.selo.selectOnMap(Q,true,H,this.options.selection_filter);giscloud.log.push("datapanel_row_click",{mid:currentMapID,lid:M.id,fid:O});if(gcapp.gcmap.marker.clear){gcapp.gcmap.marker.clear()}var F={__id:O,__created:I.__created,__modified:I.__modified,__owner:I.__owner,__owner_username:I.__owner_username,__xmin:I.__xmin,__ymin:I.__ymin,__xmax:I.__xmax,__ymax:I.__ymax,data:{},meta:{columns:[]}};var E=this.datagrid.options.columnModel;var D;for(var J=0;J<E.length;J++){if(!E[J].hidden){D=E[J].dataIndex;switch(D){case"__id":case"FID":F.meta.columns.push({field:"FID",alias:E[J].header});break;case"__owner":case"OWNER":F.meta.columns.push({field:"OWNER",alias:E[J].header});break;case"__created":case"CREATED":F.meta.columns.push({field:"CREATED",alias:E[J].header});break;case"__modified":case"MODIFIED":F.meta.columns.push({field:"MODIFIED",alias:E[J].header});break;default:F.data[E[J].header]=I[D];F.meta.columns.push({field:D,alias:E[J].header})}}}gcapp.selo.showRecordInfo(F)}},layerDataDoubleClick:function(o){var r,B,u=o.row,z=(u!=null)&&this.datagrid.getDataByRow(u),p=z&&((z.__id!=null)?z.__id:z.FID);if(p!=null){r=fnl.getSelectedLayers();B=r&&r.length&&r[0];if(B.sourcetype==="pg"&&B.use_info_window==="t"&&gcapp.isEditable(B)){giscloud.ui.customForm.open({layerId:B.id,featureId:p}).done(function(a){a.on({"submitStart.gc-custom-form":giscloud.ui.customForm.disable,"submitSuccess.gc-custom-form":function(){giscloud.layers.reset(giscloud.ui.map.mapId,[B.id]).done(function(){giscloud.ui.map.reloadMap();gcdatagrid.refresh()},giscloud.ui.customForm.close)},"submitFailure.gc-custom-form":giscloud.ui.customForm.enable})})}}},lydata_onEditAttribute:function(f,g){if(!f){om.showError("There was an error.");return}if(f.result=="yes"){om.showConfirm(f.msg);if(g){this.datagrid.refresh()}}else{om.showError(f.msg);this.datagrid.refresh()}},lydata_beforeEdit:function(g){if(g.value&&g.value.toString().indexOf("fn.showMedia")>0){g.preventEdit();alert("Can't edit media fields use attach file option instead.");var f=g.value.match(/(?=\[')(.*?)(?=\s*'\])/gi);f=f[0].substr(2).split(",")}},lydata_onEditComplete:function(j){var g=j.columnModel.dataIndex,l=this.datagrid.getDataByRow(j.row);this.editAttribute(j.row,g,l[g])},editAttribute:function(D,p,u,r){var z=fnl.getSelectedLayers(true);var B=this.datagrid.getDataByRow(D);var C=this;gcedit.editAttribute(z,{lid:z.id,fid:(B.__id!==undefined)?B.__id:B.id,pkey:z.pkey,attribute:p,value:u},function(a){C.lydata_onEditAttribute(a,r)})},processAPIData:function(E){var D,F,j,M,G,I,J;if(!E){return}for(D=0;D<E.length;D++){j=E[D];M=j.data;delete j.data;if(E.meta&&E.meta.columns){for(F=0;F<E.meta.columns.length;F++){G=E.meta.columns[F];if(G.field==="OWNER"){j.__owner=j.__owner_username}else{if(G.field==="CREATED"){J=isNaN(j.__created)?j.__created:formatTimestamp(j.__created*1000);j.__created=J}else{if(G.field==="MODIFIED"){J=isNaN(j.__created)?j.__modified:formatTimestamp(j.__modified*1000);j.__modified=J}else{if(G.alias){j[G.field]=M[G.alias]}else{j[G.field]=M[G.field]}}}}}}else{Object.append(j,M)}E[D]=j}if(E.meta&&E.meta.columns){var C={};if(this.datagrid.options.columnModel){var H=this.datagrid.options.columnModel;for(var D=0;D<H.length;D++){C[H[D].dataIndex]=H[D]}}this.datagrid.options.columnModel=[];for(D=0;D<E.meta.columns.length;D++){if(E.meta.columns[D].field==="FID"){this.datagrid.options.columnModel.push({header:E.meta.columns[D].alias||"FID",dataIndex:"__id",editable:false,noDropDown:true,sort:C.__id?C.__id.sort:null,filtered:C.__id?C.__id.filtered:null})}else{if(E.meta.columns[D].field==="OWNER"){this.datagrid.options.columnModel.push({header:E.meta.columns[D].alias||"OWNER",dataIndex:"__owner",editable:false,sort:C.__owner?C.__owner.sort:null,filtered:C.__owner?C.__owner.filtered:null})}else{if(E.meta.columns[D].field==="CREATED"){this.datagrid.options.columnModel.push({header:E.meta.columns[D].alias||"CREATED",dataIndex:"__created",editable:false,sort:C.__created?C.__created.sort:null,filtered:C.__created?C.__created.filtered:null})}else{if(E.meta.columns[D].field==="MODIFIED"){this.datagrid.options.columnModel.push({header:E.meta.columns[D].alias||"MODIFIED",dataIndex:"__modified",editable:false,sort:C.__modified?C.__modified.sort:null,filtered:C.__modified?C.__modified.filtered:null})}else{this.datagrid.options.columnModel.push({header:E.meta.columns[D].alias||E.meta.columns[D].field,dataIndex:E.meta.columns[D].field,editable:true,sort:C[E.meta.columns[D].field]?C[E.meta.columns[D].field].sort:null,filtered:C[E.meta.columns[D].field]?C[E.meta.columns[D].field].filtered:null})}}}}}}this.datagrid.setColumnProperty("__id","noDropDown",true);if(this.options.showRowEditColumn&&this.datagrid.options.columnModel){this.datagrid.options.columnModel.splice(0,0,{header:"&nbsp;",width:70,labelFunction:function(b,f,a){return'<a class="deletebutton small" onclick="return gcapp.deleteMe('+f+')">'+gclang.Delete+'</a><a class="linkbutton small" onclick="return gcapp.editRowInfo('+f+')">'+gclang.Edit+"</a>"}})}var K=fnl.getSelectedLayers(true);for(var D in this.datagrid.options.columnModel){if(!this.datagrid.options.columnModel[D].labelFunction){this.datagrid.options.columnModel[D].labelFunction=function(f,a,b){return GISCLOUD.FileFormats.formatRecordValue(f[b.dataIndex],K.id,{dataIndex:b.dataIndex,thumb:gcdatagrid.options.showThumbs})}}}delete E.meta;return E},beforeGridRender:function(b){this.datagrid.options.data=this.processAPIData(this.datagrid.options.data)},lydata_onLoadData:function(l){var o=fnl.getSelectedLayers(true);if(!o){return}o.pkey=l.pkey;giscloud.log.push("datapanel_data_loaded",{mid:currentMapID,lid:o.id});this.datagrid.setColumnProperty("__id","editable",false);this.datagrid.setColumnProperty("ogc_fid","editable",false);this.datagrid.setColumnProperty("__xmin","editable",false);this.datagrid.setColumnProperty("__ymin","editable",false);this.datagrid.setColumnProperty("__xmax","editable",false);this.datagrid.setColumnProperty("__ymax","editable",false);for(var j in this.datagrid.options.columnModel){if(!this.datagrid.options.columnModel[j].labelFunction){this.datagrid.options.columnModel[j].labelFunction=function(a,b,f){return GISCLOUD.FileFormats.formatRecordValue(a[f.dataIndex],o.id)}}}var p=this;this.export_menu=new giscloud.contextMenu({selector:"#datagrid_export_csv",trigger:"left",items:{view:{name:"Export current view only"},all:{name:"Export all features"}}});jQuery(this.export_menu).click(function(b,a){if(a.action=="all"){p.downloadCSV(true)}else{p.downloadCSV(false)}});if(this.options.contextMenu){if(this.datagrid.options.editable){this.contextmenu=new giscloud.contextMenu({selector:"#layerdata_table .td",items:{edit:{name:"Edit"},attach:{name:"Attach media file"},sep1:"---------",clear:{name:"Clear"}}});jQuery(this.contextmenu).click(function(b,g){var f=g.target.getParent().retrieve("row");var u=g.target.retrieve("column_model");switch(g.action){case"edit":p.datagrid.edit({row:f,dataIndex:u.dataIndex});break;case"attach":var a=formManager.fileBrowser({upload:true,selectmode:true,extensions:[gcFileExt.Media,gcFileExt.All]});a.addEvent("close",function(r){if(!r||!r.files||!r.files.length){return}var B=r.files[0];p.datagrid.setDataByRowAndColumn(f,u.dataIndex,B.name);p.editAttribute(f,u.dataIndex,"file://"+B.relpath.substring(1),true)});break;case"clear":if(confirm("Are you sure?")){p.datagrid.setDataByRowAndColumn(f,u.dataIndex,"");p.editAttribute(f,u.dataIndex,null)}break}})}else{if(this.contextmenu){this.contextmenu.disable()}}}},lydata_onAutoColumModel:function(j){this.datagrid.setColumnProperty("__id","header","FID");this.datagrid.setColumnProperty("__id","width",40);j.target.setColumnProperty("__created","hidden",true);j.target.setColumnProperty("__modified","hidden",true);j.target.setColumnProperty("_layerid","hidden",true);j.target.setColumnProperty("__owner","hidden",true);j.target.setColumnProperty("__id_a","hidden",true);j.target.setColumnProperty("__id_b","hidden",true);j.target.setColumnProperty("__xmin","hidden",true);j.target.setColumnProperty("__ymin","hidden",true);j.target.setColumnProperty("__xmax","hidden",true);j.target.setColumnProperty("__ymax","hidden",true);var l=fnl.getSelectedLayers(true);for(var g in j.columnModel){if(!j.columnModel[g].labelFunction){j.columnModel[g].labelFunction=function(b,f,a){return GISCLOUD.FileFormats.formatRecordValue(b[a.dataIndex],l.id)}}}},initDataGrid:function(l){if(!this.datagrid){if(this.options.jqgrid){}else{var p=fno.gcinit_auth.logged?'<div id="datagrid_export_csv" class="gc-icon12 gc-pointer gc-download12" title="Export attribute data to CSV" ></div><div class="btnseparator"></div>':"";var o=(this.options.filtering?'<div class="btnseparator"></div><div class="datagrid_bottom_menu" >'+p+'<label><input onchange="gcdatagrid.selectionFilterChange();" style="margin:4px 0 0 4px;" id="datagrid_map_sync" type="checkbox" /> Show only selected</label></div>':"");this.datagrid=new omniGrid("layerdata_table",{method:"post",showNoData:true,columnHeaderDropdown:this.options.filtering,multipleSelection:false,showHeader:true,sortHeader:true,alternaterows:false,pagination:true,editondblclick:true,filterInput:false,outerBorder:false,smartRefresh:true,width:"100%",height:"100%",bottomHtml:o});if(this.options.showThumbs){$("layerdata_table").addClass("gc-omnigrid-thumbs")}this.datagrid.md5=giscloud.md5;this.datagrid.addEvent("click",this.layerDataClick.bind(this));this.datagrid.addEvent("dblclick",this.layerDataDoubleClick.bind(this));this.datagrid.addEvent("loaddata",this.lydata_onLoadData.bind(this));this.datagrid.addEvent("beforerender",this.beforeGridRender.bind(this));this.datagrid.addEvent("autocolummodel",this.lydata_onAutoColumModel.bind(this));this.datagrid.addEvent("beforeedit",this.lydata_beforeEdit.bind(this));this.datagrid.addEvent("editcomplete",this.lydata_onEditComplete.bind(this));this.datagrid.addEvent("dropdown-show",this.datagridDropdownOpen.bind(this));var j=this;this.datagrid.addEvent("beforerequest",function(a){if(gcapp.selo.selection&&j.options.selection_filter){a.data.fids=gcapp.selo.selection.fids.join()}if(j.options.where){a.data.where=j.options.where}if(a.data.sorton&&a.data.sortby){a.data.order_by=a.data.sorton+":"+a.data.sortby;delete a.data.sorton;delete a.data.sortby}j.last_req_params=a.data})}}},downloadCSV:function(g){var j=fnl.getSelectedLayers(true);if(!this.last_req_params||!j){return}this.last_req_params._method="GET";this.last_req_params.format="yes";if(g){this.last_req_params.perpage=100000}else{this.last_req_params.perpage=this.datagrid.options.perPage}var l=this;(function(p){var f="/rest/1/layers/"+j.id+"/features.csv";var a=l.last_req_params;var b=p('<form target="_blank" method="POST" action="'+f+'">');p.each(a,function(o,u){b.append('<input type="hidden" name="'+o+'" value="'+u+'">')});b.appendTo(p(window.body));b.submit()})(jQuery)},datagridDropdownOpen:function(l){var p=l.columnModel.dataIndex,o=this,j=fnl.getSelectedLayers(true);giscloud.ui.columns.filterDropdown(l.dropdown,{layer_id:j.id,column:p}).one("done",function(){o.datagrid.positionDropDown()}).one("item-click",function(a,b){if(b.value){o.addFilter(p,b.value)}else{o.removeFilter(p)}})},addField:function(f,g){if(!f||!g){return}this.__filters[g]={layer_id:f,fieldOnly:true};this.applyFilters(true)},removeField:function(f,g){if(!f||!column){return}for(column in this.__filters){filter=this.__filters[column];if(filter.fieldOnly&&filter.layer_id==f&&column==g){delete this.__filters[column];break}}this.applyFilters(true)},removeAllFields:function(){for(column in this.__filters){filter=this.__filters[column];if(filter.fieldOnly){delete this.__filters[column]}}this.applyFilters()},addFilter:function(g,f){if(!g){return}this.__filters[g]={value:f};this.applyFilters()},removeFilter:function(b){if(!b){return}delete this.__filters[b];this.applyFilters()},removeAllFilters:function(b){if(!this.datagrid){return}for(column in this.__filters){filter=this.__filters[column];if(!filter.fieldOnly){delete this.__filters[column]}}if(b){this.datagrid.removeColumnFilterClass();this.options.where=null}else{this.applyFilters()}},applyFilters:function(H){if(!this.options.filtering){return}var F=fnl.getSelectedLayers(true);if((!F||F.sourcetype=="tile")&&!H){return}var E={},G,C="",D,K,M=this,J=false,I;for(column in this.__filters){K=this.__filters[column];I=K.layer_id?K.layer_id:F.id;if(!E[I]){E[I]=[]}E[I].push(column);if(!K.fieldOnly){C+=column+"='"+K.value+"' AND "}else{J=true}}if(C||!H){this.datagrid.removeColumnFilterClass();this.options.where=C?C.substr(0,C.length-5):null;for(column in this.__filters){K=this.__filters[column];if(K.fieldOnly){continue}this.datagrid.setColumnFilterClass(column,true)}}if(Object.getLength(E)){for(I in E){G=E[I];var B={attributes:G.join()};if(this.options.selection_filter&&I==F.id){B.filter=function(a){for(column in M.__filters){K=M.__filters[column];if(K.fieldOnly){continue}if(a[column]!=K.value){return false}}return true}}giscloud.ui.map.filterFeatures(I,B)}}else{giscloud.ui.map.filterFeatures(F.id,null)}if(C||!H){this.datagrid.options.page=1;this.refresh()}},selectionFilterChange:function(g){var f=$("datagrid_map_sync");if(!f){return}this.options.selection_filter=f.checked;if(!g){this.applyFilters()}},lydata_onExpandPanel:function(){},lydata_onPanelResize:function(){if(this.datagrid){this.datagrid.refreshHeight()}this.fireEvent("resize",{target:this})},showLayerData:function(u,p){if(!u){u=fnl.getSelectedLayers(true)}if(!u){return}if((gcapp.dataPanel&&!gcapp.dataPanel.isOpen())||!this.datagrid){return}var o={target:this,layerdata:u};this.fireEvent("beforeshowdata",o);if(o.preventDefault){return}var r=getSourceObject(u.source);var l=giscloud.md5(r.type+r.src+u.id);if(this.currentsrchash==l&&!p){return}this.currentsrchash=l;this.datagrid.options.columnModel=null;this.removeAllFilters(true);giscloud.log.push("datapanel_data_show",{mid:currentMapID,lid:u.id});if(r.type=="pg"&&!u.error){if(this.datagrid){this.datagrid.options.sortOn=this.options.sortOn?this.options.sortOn:null;this.datagrid.options.sortBy=this.options.sortBy?this.options.sortBy:null;this.datagrid.options.url=this.prepareDataURL(r,u);this.datagrid.options.editable=gcapp.isEditable(u);this.datagrid.options.page=1;this.datagrid.refresh()}}else{if(["file","wfs"].contains(r.type)&&u.tip!="raster"){if(this.datagrid){this.datagrid.options.filterInput=false;this.datagrid.options.sortOn=this.options.sortOn?this.options.sortOn:null;this.datagrid.options.sortBy=this.options.sortBy?this.options.sortBy:null;this.datagrid.options.url=this.prepareDataURL(r,u,true);this.datagrid.options.editable=false;this.datagrid.options.page=1;this.datagrid.refresh()}}else{if(this.datagrid){this.datagrid.options.url=null;this.removeAll(true)}}}},prepareDataURL:function(o,p,j){if(this.options.qsParams){this.options.qsParams.src=JSON.encode(o);this.options.qsParams.proj4=fn.getMap().proj4;this.options.qsParams.lid=p.id;this.options.qsParams.mid=currentMapID;this.options.qsParams.layerid=o.layerid;if(!this.options.memoryCache){this.options.qsParams.cache=false}if(p.encoding&&p.encoding.length>0){this.options.qsParams.enc=p.encoding}}var l=this.options.qsParams?"?"+Hash.toQueryString(this.options.qsParams):"";return this.options.url+l},getAutoColumnModel:function(p){if(!p||!(p.length>0)){return}var j=[];for(var o in p[0]){var l=typeof(p[0][o])=="number"?"number":"string";j.push({name:o,index:o,jsonmap:o,dataType:l,editable:true})}return j}});(function(b){giscloud.contextMenu=function(r){var p=this;var u=function(){p.menu=b.contextMenu({selector:r.selector,trigger:r.trigger?r.trigger:"right",callback:function(f,g){a(p.last,f)},build:function(g,f){p.last=f.currentTarget;return true},items:r.items})},o=function(){u();return p},a=function(f,g){b(p).trigger("click",{action:g,target:f})};p.disable=function(){var g=b(r.selector),f=b(r.selector+".context-menu-active");if(g.length){g.contextMenu(false)}if(f.length){f.contextMenu("hide")}};p.enable=function(){var f=b(r.selector);if(f.length){f.contextMenu(true)}};return o()}})(jQuery);var fnw=null;var canvas=null;var __FIRSTINIT=false;var safeLoadMapData=null;var gcFlashMap=new Class({Extends:omModule,options:{url:fno.liveSite+"",module:"",form:null,preventXMLLoad:false,showMouseCoordinates:true,dontShowInfo:false},initialize:function(b){this.setOptions(this.options,b);window.addEvent("domready",this.domReady.bind(this))},domReady:function(){if(formManager.hasOverlay()){formManager.hideFlashContent()}var f=this;if(gcapp.gctoolbar&&gcapp.gctoolbar.cordcheck){var g=new giscloud.ui.ProjectionPicker(jQuery("#toolbar_cord_picker"),{no_title:true,hidden_fields:false});jQuery("#toolbar_cord_picker").on("select",function(b,a){f.onMapProjectionSelect(a)})}this.coordInline=new omniEdit("coordinatesnum",{});this.coordInline.addEvent("editcomplete",this.inlineCoordinatesChange.bind(this));flashnavigator.include("slider,scalebar,marker,canvas,tooltip,printer,bitmap");giscloud.ui.map=new giscloud.Viewer("flashcontent").init(this.mapReady.bind(this))},onMapProjectionSelect:function(f){if(!f||!f.proj4){return}var g=fn.getMap();g.units_proj4=f.proj4;this.updateProj4();giscloud.maps.byId(currentMapID).done(function(a){a.units_proj4=f.proj4;a.update()});this.coordInline.set("")},showMessage:function(g){var f=jQuery("<div/>");f.addClass("gc-map-overlay-text");f.html(g);jQuery("#mapPanel_pad").append(f)},getCurrentLevel:function(f){var g=fnw.getLayerByName("layer"+f);if(g){return g.getCurrentLevel()}var g=fnw.getLayerByName("llayer"+f);if(g){return g.getCurrentLevel()}return"-1"},getLevelResolution:function(f){var g=fnw.getLayerByName("layer"+f);if(!g){return}return g.getLevelResolution(lev)},smartSetLocation:function(o){var p,l,b;p=fnw.getLayer(0);if(p){l=p.getCurrentLevel()}if(l>10){b=fnw.getViewBound();if(Math.abs(o.__xmax-o.__xmin)>Math.abs(b.xMax-b.xMin)||Math.abs(o.__ymax-o.__ymin)>Math.abs(b.yMax-b.yMin)){fnw.setViewBoundAnim(o.__xmin,o.__ymin,o.__xmax,o.__ymax)}else{fnw.setLocation((o.__xmax*1+o.__xmin*1)/2,(o.__ymax*1+o.__ymin*1)/2)}}else{fnw.setViewBoundAnim(o.__xmin,o.__ymin,o.__xmax,o.__ymax)}},mapReady:function(){if(!gcapp.isReady()){this.mapReady.delay(50);return}if(1){fnw=giscloud.ui.map.instance;if(flashnavigator.html5){gcapp.leaflet=fnw.exposeLeaflet();this.addNonCommercialAttributionMessage(gcapp.leaflet)}tooltip=new fnTooltip(fnw);this.slider=new fnSlider(fnw);this.marker=new fnMarker(fnw);if(fno.gcinit_renderingmode){fnw.renderingMode(fno.gcinit_renderingmode)}if(fno.gcinit_animatemap){fnw.disableAnimation}fnw.addEventListener("load",this.onLoad.bind(this));fnw.addEventListener("reload",this.onReload.bind(this));fnw.addEventListener("areaselection",this.onAreaSelection.bind(this));fnw.addEventListener("mousedown",this.onFnwMouseDown.bind(this));giscloud.ui.map.bind("reloaded",this.setLayersStates.bind(this));fnw.addEventListener("object_click",this.objectClick.bind(this));fnw.addEventListener("object_dblclick",this.objectDblClick.bind(this));fnw.addEventListener("object_over",this.objectOver.bind(this));fnw.addEventListener("object_out",this.objectOut.bind(this));if(this.options.showMouseCoordinates){this.toggleMouseCoordinates(null,true)}if(!fno.mobilephone){fnw.addEventListener("scalechange",this.onScaleChange.bind(this))}if(fno.fnwdebug){fnw.addEventListener("debug",function(b){console.log(b.msg)})}__FIRSTINIT=true}if(safeLoadMapData){fn.showMap(safeLoadMapData.callback,true);safeLoadMapData=null}this.fireEvent("ready",{target:this,viewer:fnw,flash:true})},onAreaSelection:function(b){if(gcapp.selo){gcapp.selo.onAreaSelection(b)}},onScaleChange:function(j){var g=Math.round(fnw.convertScale(j.zoom));j.scale=g;var l=$("scale");if(l){$("scale").set("text","1:"+g)}this.fireEvent("scalechange",j)},onMouseMove:function(g){if(!this.coordInline.isEdit()&&this.options.showMouseCoordinates){if(this.proj_src&&this.proj_dest&&this.proj_src.defData!=this.proj_dest.defData){var f=new Proj4js.Point(g.x,g.y);Proj4js.transform(this.proj_src,this.proj_dest,f)}else{var f={x:g.x,y:g.y}}this.coordInline.set(Format.round(f.x,4)+", "+Format.round(f.y,4))}},toggleMouseCoordinates:function(g,f){if(this.options.showMouseCoordinates&&!f){if(this.onMouseMoveBind){fnw.removeEventListener("mousemove",this.onMouseMoveBind)}this.coordInline.set("");this.options.showMouseCoordinates=false}else{this.onMouseMoveBind=this.onMouseMove.bind(this);fnw.addEventListener("mousemove",this.onMouseMoveBind);this.options.showMouseCoordinates=true}},modifyObject:function(z,r,B,o){var u=B?"layer"+B+"||":null;var p;if(flashnavigator.html5){p="selectcolor"}else{p=65280}if(r&&z.length<1000){fnw.modifyObject(z.join(),{color:p,alpha:100,from_color:13421772,glow:{color:65280,strength:2,blurX:10,blurY:10}},u?u:"",true)}else{fnw.modifyObject(z.join(),{color:p,from_color:13421772},u?u:"",true)}if(o){geomrenderer.select(z,r,B)}},modifyObjectForInfoTool:function(b){fnw.modifyObject([],{color:16760576,alpha:100,from_color:13421772,glow:{color:65280,strength:200,blurX:2,blurY:2,inner:false}},"",true,b)},getPopupContent:function(u,B,r){var p,o,z=giscloud.exposeJQuery();p=z("<div/>");o=z("<table/>",{"class":"gc-info-popup-content-table"}).appendTo(p);o.append.apply(o,z.map(u,function(a,g){var b=/^(((\S+)?)(@|mailto\:|(news|(ht|f)tp(s?))\:\/\/)\S+)$/i,f=/^<a href=['"]javascript:;['"] onclick=['"]fn\.showMedia\(\{url:\[['"][\w:\/.]+['"]\][\w, :]+\}\);return false;["']\s+>[\w<> ='"-\/]+<\/a>$/;a=(a==null)?"null":a;a=GISCLOUD.FileFormats.formatRecordValue(a,r,{dataIndex:g,thumb:gcdatagrid.options.showThumbs});return z("<tr/>").append(z("<td/>",{"class":"gc-info-key-cell",title:g}).text(g),z("<td/>",{"class":"gc-info-value-cell",title:a}).html(a))}));p.append(z("<input/>",{type:"hidden",name:"edit-layer-id",val:B.layerId}),z("<input/>",{type:"hidden",name:"edit-feature-id",val:B.featureId}),z("<a/>",{"class":"gc-info-edit-link",title:gclang.Edit,text:gclang.Edit,href:"javascript:;"}),z("<br/>"));return p.html()},poiClick:function(H){var K=H&&H.originalEvent,O=K&&K.object&&K.object.cl,E=O&&K.bounds,J=this.getPopupContent;if(gcapp.gctoolbar.active=="SelectTool"){return}if(this.options.dontShowInfo){return}var G=fnl.getLayerById(H.lid);if(!G){return}var M=getSourceObject(G.source);if($("infotable")){$("infotable").innerHTML="";$("infotable").showLoader()}var F=null;var D=fn.getMap();if(D&&D.proj4&&D.proj4.length>4){F=D.proj4}var C={target:this,lid:H.lid,fid:H.fid,source:M,layerdata:G,proj4:F,originalEvent:H};this.fireEvent("beforegetfeatureinfo",C);if(C.preventDefault){return}if(O&&E){E=new giscloud.Bounds(E.xmin,E.ymin,E.xmax,E.ymax);if(!E.valid()){return}giscloud.features.byBounds(H.lid,E,{format:true}).done(function(g){var f,a,b=giscloud.exposeJQuery();if(!g||g.length===0){return}if(g.length===1){a=G.name;f=J(g[0].data,{layerId:H.lid,featureId:g[0].id},H.lid)}else{a=G.name+": "+g.length;f=b("<div/>").append(b.map(g,function(j){return J(j.data,{layerId:H.lid,featureId:j.id},H.lid)})).html()}gcapp.gcmap.marker.clear();gcapp.gcmap.marker.add(H.x,H.y,"#0097C6",a,f,null,true)});return}om.showLoader();if(M.type=="pg"){var I=G.encoding?G.encoding:"utf-8";fnl.getPostGISRecord(G.source,H.fid,F,I,H.lid,currentMapID,null,gcapp.selo.showRecordInfo.bind(gcapp.selo))}else{var N=(M.type=="file")?(fno.resources+M.src):M.url;fnm.getFeatureInfo(H.lid,N,M.layerid,H.fid,F,G.encoding,null,gcapp.selo.showRecordInfo.bind(gcapp.selo));$("exportresult").hide()}},onCanvasObjectClick:function(g){gcapp.selo.onCanvasObjectClick(g);var f=geomrenderer.getFeatureByGID(g.name);f.id="layer"+f.lid+"||"+f.fid;f.key=g.key;f.gid=g.name;this.objectClick(f)},setLayersStates:function(r){var p=user.options["MAP_"+currentMapID+"_LAYERS_STATES"];p=p?JSON.decode(p):null;var u=fnl.getLayers();for(var z in p){if(!z){continue}var B=p[z];var o=fnl.getLayerById(z);if(!o){continue}if(B){if(!["folder","giscloud"].contains(o.tip)){gcapp.gclayer.llist.visibility(o.id,B.v);gcapp.gclayer.llist.lock(o.id,B.l)}gcapp.gclayer.llist.toggle(o.id,B.o,true)}}},onLoad:function(E){fn.setWorkspace(fn.currentWorkspace);fn.setMap(fn.currentMap);fnm.activemapid=(E&&E.id)?E.id:null;geomrenderer.removeAll();canvas=new fnCanvas(fnw);canvas.addEventListener("click",this.onCanvasObjectClick.bind(this));if(gcapp.selo){gcapp.selo.removeAreaSelectionGeometry()}printer=new fnPrinter(fnw);bitmap=new fnBitmap(fnw);fnw.disableSelection();var F=fn.getMap();if(gcapp.gclayer){var z=fnl.getLayers(null,true);for(var D=0;D<z.length;D++){var B=z[D],C;if(B&&B.tip=="fleet"){continue}if(B.render_method==5){geomrenderer.drawLayer(B);continue}var r=fnl.getLayerById(B.id);if(!r){continue}if(F.owner==user.id){gcapp.gclayer.llist.lock(B.id,B.lock=="t");gcapp.gclayer.llist.toggle(B.id,B.opened=="t",true)}}giscloud.ui.map.layersLoading.done(this.setLayersStates.bind(this));if(gcapp.gclayer&&gcapp.gclayer.llist.maxFeatureCount>2000){fnw.disableAnimation()}else{fnw.enableAnimation()}}if(!gcedit){gcedit=new gcEdit()}else{if(E&&E.type=="load"){gcedit.reset()}var u=gcapp.gctoolbar.active;gcapp.gctoolbar.setTool(u,true)}if(flashnavigator.html5){gcapp.gctoolbar.setTool("InfoTool")}this.fireEvent("loadmap",{target:this})},updateProj4:function(f){var g=fn.getMap();if(g&&g.units_proj4){Proj4js.defs["EPSG:UNITS"]=g.units_proj4;this.proj_dest=new Proj4js.Proj("EPSG:UNITS")}else{this.proj_dest=null}if(g&&g.proj4){Proj4js.defs["EPSG:CURRENT"]=g.proj4;this.proj_src=new Proj4js.Proj("EPSG:CURRENT")}else{this.proj_src=null}},onReload:function(r){if(!canvas){canvas=new fnCanvas(fnw);canvas.addEventListener("click",this.onCanvasObjectClick.bind(this))}geomrenderer.removeAll();var u=fnl.getLayers(null,true),z=fn.getMap();for(var o=0;o<u.length;o++){var B=u[o];if(B&&B.tip=="fleet"){continue}if(B.render_method==5){geomrenderer.drawLayer(B);continue}var p=fnl.getLayerById(B.id);if(!p){continue}if(z.owner==user.id){gcapp.gclayer.llist.lock(B.id,B.lock=="t");gcapp.gclayer.llist.toggle(B.id,B.opened=="t",true)}}if(window.gcdatagrid){}this.fireEvent("reloadmap",{target:this})},newGeometry:function(){var b=map.canvas.addGeometry("line");map.canvas.setAttributeGeometry(b,"color","0xFF00FF");map.canvas.editGeometry(b)},onLocationSelect:function(b){},onReverseGeoComplete:function(j){if(!j){om.showError("There was an error.");return}if(j.result=="yes"){if(!j.data||!(j.data.length>0)){return}var l=j.data[0];var g={};g.color=g.linecolor=RGB2Color(255,0,0);g.alpha=40;g.linealpha=100;g.fillcolor=RGB2Color(226,0,0);g.width=0.1;g.id=1;g.geom=l.geom;g.depth=1;canvas.deserializeGeometryOpenGIS(g)}else{om.showError(j.msg)}},onFnwMouseDown:function(g){var f=fnl.getSelectedLayers(true);if(f&&f.raster=="t"&&gcapp.gctoolbar.active=="SelectTool"){gcedit.reverseGeo(g,onReverseGeoComplete)}this.last_mousedown_x=g.x;this.last_mousedown_y=g.y;this.fireEvent("mapclick",{target:this,x:g.x,y:g.y})},objectDblClick:function(j){var l=j.id.split("||");var p={lid:l[0].substring(5),fid:l[1]};fnw.setLocation(this.last_mousedown_x,this.last_mousedown_y);var o={target:this,lid:p.lid,fid:p.fid,originalEvent:j};this.fireEvent("objectdblclick",o)},objectClick:function(l){var o=l.id.split("||");var r={lid:o[0].substring(5),fid:o[1],x:isNaN(l.x)?this.last_mousedown_x:l.x,y:isNaN(l.y)?this.last_mousedown_y:l.y,originalEvent:l};var p={target:this,lid:r.lid,fid:r.fid,originalEvent:l};this.fireEvent("objectclick",p);if(gcapp.gctoolbar.active=="SelectTool"||gcapp.gctoolbar.active=="InfoTool"&&fnw._currentTool!="editmode"){if(gcapp.gclayer){gcapp.gclayer.llist.setSelection([r.lid])}if(fns){fns.lastSelection=r}l.ctrlKey=l.key==17;gcapp.selo.multipleSelectionLogic(l,r);this.poiClick(r);var u=gcdatagrid.options.selection_filter&&gcapp.gctoolbar.active=="InfoTool";gcapp.selo.selectOnMap(gcapp.selo.selection,true,l.gid,u)}},objectOver:function(b){},objectOut:function(b){},onTileStartLoading:function(){if($("tileloader")){$("tileloader").showLoader()}},onTileStopLoading:function(){if($("tileloader")){$("tileloader").hideLoader()}},inlineCoordinatesChange:function(u){if(Validate.now(Validate.Format,u.newvalue,{pattern:/^[-+]?[0-9]+[.]?([0-9]*)[\s]*[,][\s]*[-+]?[0-9]+[.]?([0-9]*)?$/i})){var l=u.newvalue.split(",");var o=trim(l[0]);var p=trim(l[1]);if(this.proj_src&&this.proj_dest&&this.proj_src.defData!=this.proj_dest.defData){var r=new Proj4js.Point(o*1,p*1,0);Proj4js.transform(this.proj_dest,this.proj_src,r);o=r.x;p=r.y}giscloud.log.push("mapviewer_set_coordinates",{mid:currentMapID,x:o,y:p});fnw.setLocation(o,p)}else{this.coordInline.set(u.oldvalue)}},unload:function(){if(fnw){fnw.unload()}},reloadMap:function(b){fnw.reload(null,b)},loadMap:function(g,f){if(this.options.preventXMLLoad){return}giscloud.ui.map.loadMap(g,f)},addNonCommercialAttributionMessage:function(){var b;if(!gcapp.leaflet){return}if(user&&user.subscriptions&&user.subscriptions.length){b=jQuery.grep(user.subscriptions,function(a){return a.app_instance_id===fno.app_instance_id});if(b&&b.length&&b[0]&&b[0].type==="10"){gcapp.leaflet.attributionControl.addAttribution(gclang.For_non_commercial_use_only)}}},removeNonCommercialAttributionMessage:function(){var b;if(!gcapp.leaflet){return}if(user&&user.subscriptions&&user.subscriptions.length){b=jQuery.grep(user.subscriptions,function(a){return a.app_instance_id===fno.app_instance_id});if(b&&b.length&&b[0]&&b[0].type!=="10"){gcapp.leaflet.attributionControl.removeAttribution(gclang.For_non_commercial_use_only)}}}});var gcRightPanel=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/search/csearch.php",module:"search",form:null},initialize:function(b){this.setOptions(this.options,b);$("panelTabs2Link").addEvent("click",this.showSearchTab.bind(this));$("panelTabs1Link").addEvent("click",this.showInfoTab.bind(this));this.addEvent("resize",this.onResize.bind(this));this.onResize()},showSearchTab:function(){$("searchtab").removeClass("hidden");$("infotab").addClass("hidden");$("panelTabs1Link").removeClass("selected");$("panelTabs2Link").addClass("selected")},showInfoTab:function(){$("searchtab").addClass("hidden");$("infotab").removeClass("hidden");$("panelTabs1Link").addClass("selected");$("panelTabs2Link").removeClass("selected")},onResize:function(){var b=$("rightpanel").getSize();if(gcapp.gcsearch){gcapp.gcsearch.onResize()}if(gcapp.selo){gcapp.selo.onResize()}}});var cm3=[{header:"ID",dataIndex:"id",hidden:true},{header:gclang.searchtab.object,dataIndex:"cols",width:120},{header:gclang.layer,dataIndex:"layername",width:80}];var cm4=[{header:"ID",dataIndex:"id",hidden:true},{header:"Layer",dataIndex:"name",width:190}];var gcSearch=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/search/csearch.php",module:"search",pagination:true,defaultText:gclang.search,hideContainer:false,fields:null,form:null},initialize:function(g){if(!$("resulttable")){return}this.setOptions(this.options,g);this.searchResultGrid=new omniGrid("resulttable",{height:400,width:"100%",pagination:this.options.pagination});this.searchResultGrid.options.dataProvider=fns;this.searchResultGrid.addEvent("click",this.onResultClick.bind(this));this.searchResultGrid.addEvent("mouseover",this.onResultOver.bind(this));this.layerTable=new omniGrid("layerselecttable",{columnModel:cm4,alternaterows:false,showHeader:false,selectable:true});this.layerTable.addEvent("click",this.layerClick.bind(this));if($("showlayersbutton")){$("showlayersbutton").addEvent("click",function(a){a.preventDefault();gcapp.gcsearch.showSearchLayers()})}if($("searchablelayers")){$("searchablelayers").hide()}if($("start_search_bt")){$("start_search_bt").addEvent("click",this.startSearch.bind(this))}if($("search_clear_bt")){$("search_clear_bt").addEvent("click",this.clearSearchBt.bind(this))}if($("quicksearch_clear_bt")){$("quicksearch_clear_bt").addEvent("click",this.clearSearchBt.bind(this))}if($("search")){$("search").addEvent("keyup",this.onSearchInputKeyUp.bind(this));$("search").addEvent("focus",this.clearSearch.bind(this));$("search").addEvent("blur",this.restoreSearch.bind(this))}var f=$("quicksearch");if(f){f.addEvent("keyup",this.onSearchInputKeyUp.bind(this));f.addEvent("focus",this.clearSearch.bind(this));f.addEvent("blur",this.restoreSearch.bind(this))}if($("resultcount")){$("resultcount").set("html","&nbsp")}if($("exportresult")){$("exportresult").hide()}this.onResize();fnl.addEvent("setdata",this.updateSearch.bind(this));gcapp.addEvent("ready",this.appReady.bind(this))},appReady:function(){},onResize:function(){if(!$("rightpanel")){return}var f=$("rightpanel").getSize(),g=$("searchcontrols").getSize();this.searchResultGrid.setSize(f.x-1,f.y-g.y-10)},focus:function(){(function(){var b=jQuery("#quicksearch");if(b){b.focus()}}).delay(100)},exportResult:function(){var f=this.searchResultGrid.getSelectedIndices();if(f.length==0){alert("There is no selected row.");return}var g=this.searchResultGrid.getDataByRow(f[0]);if(g){fnl.exportToCSV(g)}},clearSearch:function(g){var f=$(g.target);if(f.value==this.options.defaultText+"..."){f.value=""}},restoreSearch:function(g){var f=$(g.target);if(f.value==""){f.value=this.options.defaultText+"...";$("resultcount").set("html","&nbsp")}},getQuery:function(){var b=$("quicksearch");return(b.value==this.options.defaultText+"...")?"":b.value},showSearchLayers:function(){$("searchablelayers").toggle()},onResultClick:function(j){var o=this.searchResultGrid.getDataByRow(j.row),l={target:this,data:o};this.fireEvent("searchclick",l);if(l.preventDefault){return}gcapp.gcmap.smartSetLocation({__xmin:o.__xmin,__ymin:o.__ymin,__xmax:o.__xmax,__ymax:o.__ymax});var p="layer"+o.__layer_id+"||"+o.__id;gcapp.gcmap.modifyObject([p],true)},onResultOver:function(g){var f=this.searchResultGrid.getDataByRow(g.row)},onSearchInputKeyUp:function(g){$("search").value=g.target.value;var l=$("quicksearch"),j;if(l){l.value=g.target.value}j={value:g.target.value,key:g.key,target:this};this.fireEvent("searchchange",j);if(j.preventDefault){return}if(g.key=="enter"){this.startSearch()}},onSearchComplete:function(f,g){this.refreshSearchResult(f,g);om.hideLoader()},startSearch:function(B){B&&B.preventDefault&&B.preventDefault();if(!fnm.isVisible()){alert("Map is not visible.");return}var u=$("search").value;var G=[];var z=this.layerTable.getSelectedIndices();var E,D;for(var C=0;C<z.length;C++){D=this.layerTable.getDataByRow(z[C]);var H=getSourceObject(D.source);var F={lid:D.id,lyrname:D.name};G.push(F)}var B={value:u,target:this,preventDefault:false,layers:G};this.fireEvent("search",B);if(B.preventDefault){return}if(!G.length){om.showMessage("No searchable layers could be found.");return}if(u.length>0&&u!=this.options.defaultText+"..."){this.clearSearchResult();if(G.length==0){return}om.showLoader();giscloud.log.push("search_start",{mid:currentMapID,search:u});fns.search(G,u,null,this.onSearchComplete.bind(this))}else{if(this.searchResultGrid){this.clearSearchResult()}}},clearSearchBt:function(g){g&&g.preventDefault&&g.preventDefault();if($("search")){$("search").value=this.options.defaultText+"..."}var f=$("quicksearch");if(f){f.value=$("search").value}this.clearSearchResult();this.fireEvent("searchclear",{target:this})},clearSearchResult:function(){if(this.searchResultGrid){this.searchResultGrid.removeAll()}$("resultcount").set("html","&nbsp");gcapp.selo.clearSelection();if(this.options.hideContainer){$("searchtab").addClass("hidden")}this.__open=false},refreshSearchResult:function(o,j){if(!o){return}if(o.result=="no"){om.showMessage(o.msg);return}if(gcapp.rightcolumn){gcapp.rightcolumn.expand()}if(gcapp.rpanel){gcapp.rpanel.showSearchTab()}else{$("searchtab").removeClass("hidden")}gcapp.selo.hideInfoTable();giscloud.log.push("search_ended",{mid:currentMapID,results:o.data?o.data.length:null});gcapp.selo.clearSelection();var l=[];for(var p=0;p<o.data.length;p++){l.push(o.data[p].oid)}gcapp.gcmap.modifyObject(l,true);this.searchResultGrid.setData(o,j);if(o.total>=0){$("resultcount").set("text",gclang.searchtab.nr_of_results+": "+o.total)}},layerClick:function(b){this.startSearch()},updateSearch:function(){var l=[];var r=fnl.getLayers();for(var u=0;u<r.length;u++){var p=r[u];var o=p.sourcetype;if((o=="file"&&p.tip!="raster")||(o=="pg"&&p.tip!="analysis")){l.push(p)}}this.layerTable.setData({data:l});this.layerTable.selectAll()}});var info_table_cmu=[{header:"Field name",dataIndex:"fieldName",dataType:"string",hidden:true},{header:gclang.general.attribute,dataIndex:"name",dataType:"string",width:90},{header:gclang.general.value,dataIndex:"value",dataType:"string",width:155,editable:true,labelFunction:null}];var formatTimestamp=function(o){var j,p,l;if(isNaN(o)){return o}j=new Date(o);p=j.getTimezoneOffset()/-60;l=j.toLocaleDateString()+" "+j.toLocaleTimeString().substring(0,j.toLocaleTimeString().lastIndexOf(":"))+" GMT"+(p>0?"+":"")+p;return l};var gcSelection=new Class({Extends:omModule,options:{module:"",form:null,editable:true,showGISFields:false,visibleFields:null,parentColumn:null,classes:{tableClass:"gc-info-popup-content-table",valueClass:"gc-info-value-cell",keyClass:"gc-info-key-cell",editLinkClass:"gc-info-edit-link"},aggregateFunc:function(f,g){return f+g}},initialize:function(b){this.setOptions(b);this.clearSelectionNumbers()},onResize:function(){var b=$("rightpanel").getSize();if(this.info_table){this.info_table.refreshHeight(true,$("infotable").getParent(".panel"))}},onInvertSelection:function(b){if(!b){giscloud.log.push("layer_selection_invert_completed",{error:"Unknown error"});return}if(b.lid&&b.fids){giscloud.log.push("layer_selection_invert_completed",{mid:currentMapID,lid:b.lid,count:b.fids.length})}else{giscloud.log.push("layer_selection_invert_completed",{mid:currentMapID})}this.selectOnMap(b,true)},emailSelection:function(){if(fnm.isVisible()){this.emailform=formManager.open({title:"Email selected features",fid:"email_feature_form",oneInstance:true,minimize:true,width:600,height:190,url:fno.liveSite+"feature/form_email",buttons:[{html:"Close",onclick:"gcapp.emailseloform.close();","class":"button"}]})}},invertSelection:function(){if(fnm.isVisible()){if(!this.selection||this.selection.length==0){alert(gclang.lmod.no_feature_selection);return}giscloud.log.push("layer_selection_invert",{mid:currentMapID,lid:this.selection.lid,count:this.selection.fids.length});fnl.invertSelection(JSON.encode(this.selection),this.onInvertSelection.bind(this))}},onDeleteSelectedFeatures:function(b){if(!b){giscloud.log.push("feature_delete_completed",{error:"Unknown error"});return}if(b.msg){om.showMessage(b.msg)}if(b.result=="yes"){this.clearSelection();fn.showMap();gcproject.reload(false,true);gcdatagrid.refresh()}},deleteSelectedFeatures:function(){if(fnm.isVisible()){if(!this.selection){alert(gclang.mmod.no_feature_selection);return}var b=this.selection.fids.length;if(b>0){if(confirm(gclang.lmod.feature_delete_confirm.replace("__COUNT__",b))){gcedit.deleteFeatures(this.selection,this.onDeleteSelectedFeatures.bind(this))}}else{alert(gclang.mmod.no_feature_selection)}}},clearSelection:function(){if(fnm.isVisible()){fnw.modifyObject("",{color:16760576,orig_color:13421772},"",true);this.removeAreaSelectionGeometry();this.selection=null;this.clearSelectionNumbers()}this.fireEvent("clear");var b=gcapp.gctoolbar.numselfeatures;if(b){b.set("html","")}this.hideInfoTable()},removeAreaSelectionGeometry:function(){if(selectionarea_fnw_obj){canvas.remove(selectionarea_fnw_obj);selectionarea_fnw_obj=null}},clearSelectionNumbers:function(){this.selection_minx=1000000000000000;this.selection_maxx=-1000000000000000;this.selection_miny=1000000000000000;this.selection_maxy=-1000000000000000;this.selectionfullinfo={}},getAllSelectionInfo:function(){var o={},u,r;o.minx=1000000000000000;o.miny=1000000000000000;o.maxx=-1000000000000000;o.maxy=-1000000000000000;var p=this.selectionCount();if(p<1){return null}for(u in this.selectionfullinfo){if(!this.selectionfullinfo.hasOwnProperty(u)){continue}var B=this.selectionfullinfo[u];if(!B||!this.selection.fids.contains(u)){continue}for(r in B){if(B.hasOwnProperty(r)&&r!=="xmin"&&r!=="ymin"&&r!=="xmax"&&r!=="ymax"){if(o[r]==null){o[r]=B[r]}else{o[r]=this.options.aggregateFunc(o[r],B[r])}}}o.minx=Math.min(B.xmin,o.minx);o.maxx=Math.max(B.xmax,o.maxx);o.miny=Math.min(B.ymin,o.miny);o.maxy=Math.max(B.ymax,o.maxy)}var z=[];z.push({fieldName:"objects",name:gclang.nrFeatures,value:p});for(r in o){if(o.hasOwnProperty(r)&&r!=="minx"&&r!=="miny"&&r!=="maxx"&&r!=="maxy"){z.push({fieldName:r,name:r,value:o[r]})}}z.push({fieldName:"xmin",name:"xmin",value:o.minx});z.push({fieldName:"ymin",name:"ymin",value:o.miny});z.push({fieldName:"xmax",name:"xmax",value:o.maxx});z.push({fieldName:"ymax",name:"ymax",value:o.maxy});return z},selectOnMap:function(p,o,j,l){gcapp.gctoolbar.setSelectionInfo(gclang.tools.selected_objects+": "+p.fids.length);if(this.reference_form&&this.reference_form.list){this.reference_form.list()}gcapp.gcmap.modifyObject(p.fids,o,p.lid,j);if(!l){this.selection=p;this.fireEvent("change",{selection:this.selection})}},selectionCount:function(){return this.selection&&this.selection.fids?this.selection.fids.length:0},showSelection:function(b){},showQuerySelection:function(f){if(f.result!="yes"||!f.data){om.hideLoader();return}var g=f.data[0].fids;if(!g||g.length==0){om.showMessage("There are no selected objects.");return}this.selectOnMap(f.data[0],true);om.hideLoader()},showRecordInfo:function(Z){if(gcapp.gcmap.options.dontShowInfo){return}var Y={},aw;if($("infotable")){$("infotable").hideLoader()}om.hideLoader();if(!Z){return}if(Z.code>0){om.showError(Z.msg);return}function ab(a){return(a.charAt(0).toUpperCase()+a.substr(1).toLowerCase())}var ad=[];var an=Z.count?Z.count:this.selectionCount();var ax={};ax.uid=Z.__id;ax.xmin=Z.__xmin;ax.ymin=Z.__ymin;ax.xmax=Z.__xmax;ax.ymax=Z.__ymax;var W,aA=Z.data;for(W in aA){if(aA.hasOwnProperty(W)&&typeof aA[W]==="number"){ax[W]=aA[W]}}this.selectionfullinfo[Z.__id]=ax;if(an>1){ad=this.getAllSelectionInfo()}else{var ae;if(this.options.visibleFields){var av;var ac=this.options.visibleFields.length;for(ae=0;ae<ac;ae++){var az=this.options.visibleFields[ae];var ai=az.dataIndex=="id"?Z[az.dataIndex]:Z.data[az.dataIndex];if(typeof(az.labelFunction)=="function"){ai=az.labelFunction(ai,Z)}ad.push({name:az.header,value:ai})}}else{var ag=null,az,am,V;if(Z.meta&&Z.meta.columns){for(ae=0;ae<Z.meta.columns.length;ae++){if(Z.meta.columns[ae].field==="FID"){ag={alias:Z.meta.columns[ae].alias,order:ae}}else{az=Z.meta.columns[ae].field;am=Z.meta.columns[ae].alias;if(am){Y[am]=az}if(Z.format){Z.data2=Z.data2||{};Z.data2[am||az]=Z.data[az]}if(az==="OWNER"){Z.data[am||az]=Z.__owner_username||Z.__owner}else{if(az==="CREATED"){V=isNaN(Z.__created)?Z.__created:formatTimestamp(Z.__created*1000);Z.data[am||az]=V}else{if(az==="MODIFIED"){V=isNaN(Z.__modified)?Z.__modified:formatTimestamp(Z.__modified*1000);Z.data[am||az]=V}}}}}}else{ad.push({fieldName:"id",name:"FID",value:is_numeric(Z.__id)?Z.__id:Z.id})}if(Z.format){Z.data=Z.data2}for(ae in Z.data){if(!Z.data.hasOwnProperty(ae)){continue}if(ae!="wkb_geometry"){aw=Y[ae]||ae;if(an==1){ad.push({fieldName:aw,name:ae,value:Z.data[ae]})}}}if(ag){ad.splice(ag.order||0,0,{fieldName:"FID",name:ag.alias||"FID",value:is_numeric(Z.__id)?Z.__id:Z.id})}}if(this.options.showGISFields){ad.push({name:"LEFT",value:Z.__xmin});ad.push({name:"RIGHT",value:Z.__xmax});ad.push({name:"TOP",value:Z.__ymax});ad.push({name:"BOTTOM",value:Z.__ymin})}}var at=fnl.getSelectedLayers(true);var ao=false;var aq;if(Z.layerId){aq=Z.layerId}else{if(at){var au=getSourceObject(at.source);if(au.type=="pg"){ao=gcapp.isEditable(at)}aq=at.id||at[0].id}else{aq=fns.lastSelection.lid}}giscloud.log.push("show_feature_info",{mid:currentMapID,lid:aq||"?",fid:is_numeric(Z.__id)?Z.__id:Z.id});ao=this.options.editable&&ao&&(an<=1);var aa=fnl.getLayerById(aq);var ah=this.getPopupContent(ad,ak,aa.id),aj={target:this,preventDefault:false,content:ah,data:Z,layername:aa.name,lid:aq,fid:Z.__id,editable:ao};this.fireEvent("beforeshowrecordinfo",aj);if(aj.preventDefault){return}if(an===1&&aa){if(aa.use_info_window!=="f"||fn.getMap().options.FORCE_INFO_WINDOW==1||user.options.FORCE_INFO_WINDOW==1){var ar,af,ak;if(fns&&fns.lastSelection&&fns.lastSelection.fid===Z.__id.toString()&&fns.lastSelection.lid===aa.id){ar=fns.lastSelection.x;af=fns.lastSelection.y}else{ar=(Z.__xmin+Z.__xmax)/2;af=(Z.__ymin+Z.__ymax)/2}ak=ao?{layerId:aa.id,featureId:Z.__id}:false;gcapp.gcmap.marker.clear();gcapp.gcmap.marker.add(ar,af,null,aa.name,ah,null,true);return}}else{console.log("showRecordInfo error");return}if(at){var al=at.id;info_table_cmu[2].labelFunction=function(a){return GISCLOUD.FileFormats.formatRecordValue(a.value,al)}}if(!$("infotable")){return}var ay={columnModel:info_table_cmu,editable:ao,editondblclick:true,alternaterows:false,showHeader:true,sortHeader:false,outerBorder:false,height:jQuery("#infotable").parents(".panel").height()-29,width:"100%"};if((fno.viewerSite!==fno.liveSite)&&ao){var ap=this;jQuery("#infotab_formeditlink").empty().append(jQuery("<a/>",{"class":"linkbutton",href:"javascript:;",text:gclang.Edit_attributes,click:function(){giscloud.ui.customForm.editFeature(aq,Z.__id).done(function(){var a="layers/"+aq+"/features/"+Z.__id+".json";giscloud.rest.get(a,{format:true}).done(function(b){giscloud.ui.map.reloadMap();gcdatagrid.refresh();ap.showRecordInfo(b)})})}}),jQuery("<a/>",{"class":"linkbutton",href:"javascript:;",text:gclang.Edit_geometry,click:function(){giscloud.ui.edit.editFeature({layerId:aq,featureId:Z.__id}).done(function(){giscloud.ui.map.reloadMap()})}}));jQuery("#infotable").css("top",jQuery("#infotab_formeditlink").outerHeight())}else{jQuery("#infotable").css("top",0);jQuery("#infotab_formeditlink").empty()}this.info_table=new omniGrid("infotable",ay);this.info_table.addEvent("editcomplete",this.infotbl_onEditComplete.bind(this));this.info_table.addEvent("beforeedit",this.infotbl_onBeforeEdit.bind(this));this.info_table.setData({data:ad});this.initContextMenu();if($("infotable")){om.show("infotable")}if(gcapp.options.mochaui){$("resultcount").set("html","&nbsp");om.show("infotab_formeditlink")}if(gcapp.gctoolbar.active=="InfoTool"&&gcapp.options.mochaui){if(this.options.parentColumn){this.options.parentColumn.expand();this.options.parentColumn.columnExpand()}gcapp.rpanel.showInfoTab()}if(gcapp.options.mochaui){this.info_table.refreshHeight(true,$("infotable").getParent(".panel"))}else{this.info_table.refreshHeight(true)}if(fno.richmedia&&gcapp.options.mochaui){om.show("infotabtools")}this.fireEvent("showrecordinfo",{target:this,datagrid:this.info_table,data:Z,lid:aq})},initContextMenu:function(){var b=this;if(this.info_table.options.editable){this.contextmenu=new giscloud.contextMenu({selector:"#infotable .td",items:{edit:{name:"Edit"},attach:{name:"Attach media file"},sep1:"---------",clear:{name:"Clear"}}});jQuery(this.contextmenu).click(function(a,p){var o=p.target.getParent().retrieve("row");var r=p.target.retrieve("column_model");switch(p.action){case"edit":b.info_table.edit({row:o,dataIndex:r.dataIndex});break;case"attach":var u=formManager.fileBrowser({upload:true,selectmode:true,extensions:[gcFileExt.Media,gcFileExt.All]});u.addEvent("close",function(g){if(!g||!g.files||!g.files.length){return}var f=g.files[0];b.info_table.setDataByRowAndColumn(o,r.dataIndex,f.name);b.editAttribute(o,null,"file://"+f.relpath.substring(1),true)});break;case"clear":if(confirm("Are you sure?")){b.info_table.setDataByRowAndColumn(o,r.dataIndex,"");b.editAttribute(o,null,"")}break}})}else{if(this.contextmenu){this.contextmenu.disable()}}},getPopupContent:function(u,B,r){var z=giscloud.exposeJQuery(),D,C;var p=this.options.classes;D=z("<div/>"),tbody=z("<tbody/>"),C=z("<table/>",{"class":p.tableClass}).append(tbody).appendTo(D);tbody.append.apply(C,z.map(u,function(g){var f=g.name||g.fieldName,o=g.value,l,j=/^\s*mailto\:\s*([\S]+)\s*$/i,a=/^(((\S+)?)(@|mailto\:|(news|(ht|f)tp(s?))\:\/\/)\S+)$/i,b=/^<a href=['"]javascript:;['"] onclick=['"]fn\.showMedia\(\{url:\[['"][\w:\/.]+['"]\][\w, :]+\}\);return false;["']\s+>[\w<> ='"-\/]+<\/a>$/i;if((g.name==="undefined"||g.fieldName==="undefined")&&g.value===undefined){return null}f=(f==null)?"null":f;o=(o==null)?"null":o;if(b.test(o)){return z("<tr/>").append(z("<td/>",{"class":p.keyClass,title:f}).html(f),z("<td/>",{"class":p.valueClass}).append(z(o)))}else{l=GISCLOUD.FileFormats.formatRecordValue(o,r,{dataIndex:g.fieldName,thumb:gcdatagrid.options.showThumbs});if(l===o){return z("<tr/>").append(z("<td/>",{"class":p.keyClass,title:f}).html(f),z("<td/>",{"class":p.valueClass,title:o}).html(o))}else{return z("<tr/>").append(z("<td/>",{"class":p.keyClass,title:f}).html(f),z("<td/>",{"class":p.valueClass,title:o}).html(l))}}}));if(B){D.append(z("<input/>",{type:"hidden",name:"edit-layer-id",val:B.layerId}),z("<input/>",{type:"hidden",name:"edit-feature-id",val:B.featureId}),z("<a/>",{"class":p.editLinkClass,title:gclang.Edit,text:gclang.Edit,href:"javascript:;"}))}return D.html()},infotbl_returnChanges:function(){var b=this.info_table.getDataByRow(this.infotlb_oldvalue.row);b.value=this.infotlb_oldvalue.oldvalue;this.info_table.setDataByRow(this.infotlb_oldvalue.row,b);this.infotlb_oldvalue=null},infotbl_onBeforeEdit:function(b){if(b.data.fieldName==="FID"||b.data.fieldName==="CREATED"||b.data.fieldName==="MODIFIED"||b.data.fieldName==="OWNER"){b.preventEdit()}},infotbl_onEditAttributeServerComplete:function(f,g){if(!f){this.infotbl_returnChanges();om.showError("There was an error.");return}if(f.result=="yes"){om.showConfirm(f.msg);if(f.affected==1){gcapp.gcmap.reloadMap()}}else{this.infotbl_returnChanges();om.showError(f.msg)}},infotbl_onEditComplete:function(g){var f=this.info_table.getDataByRow(g.row);this.infotlb_oldvalue=g;this.editAttribute(g.row,f.fieldName,f.value,false,g.value)},editAttribute:function(J,B,C,E,H){var I=fnl.getSelectedLayers(true),G=this.info_table.getDataByRow(J),z=["__id","id","ogc_fid","gis_area","gis_length","xmin","ymin","xmax","ymax"],F=this;var D=G.name.toUpperCase();if(z.contains(D)){G.value=H;this.info_table.setDataByRow(evt.row,G);alert("You can not change '"+D+"' attribute.");return}gcedit.editAttribute(I,{lid:this.selection.lid,fid:this.selection.fids[0],pkey:I.pkey,attribute:B?B:G.fieldName,value:C},function(a){F.infotbl_onEditAttributeServerComplete(a,E)})},hideInfoTable:function(){om.hide("infotable");om.hide("exportresult");om.hide("infotab_formeditlink");if(fno.richmedia){om.hide("infotabtools")}if(fnm.isVisible()){fnw.modifyObject("",{color:16760576,orig_color:13421772},"",true)}},drawSelectedArea:function(b){b.color=b.linecolor=giscloud.Color.rgbToHex(255,0,0,"0x");b.alpha=40;b.linealpha=100;b.fillcolor=giscloud.Color.rgbToHex(226,0,0,"0x");b.width=0.1;b.id=1;b.geom="POLYGON(("+b.xMin+" "+b.yMin+","+b.xMin+" "+b.yMax+","+b.xMax+" "+b.yMax+","+b.xMax+" "+b.yMin+","+b.xMin+" "+b.yMin+"))";b.depth=1;selectionarea_fnw_obj=canvas.deserializeGeometryOpenGIS(b)},onGetFeaturesByBoundComplete:function(o,l){if(!o){giscloud.log.push("layer_select_by_bound_completed",{error:"Unknown error"});return}if(o.result=="no"){giscloud.log.push("layer_select_by_bound_completed",{error:o.msg});om.showError(o.msg);return}if(o.fids){var p=o.fids.split(",");giscloud.log.push("layer_select_by_bound_completed",{count:p.length,lid:o.lid});for(var j=0;j<p.length;j++){this.multipleSelectionLogic(l,{lid:o.lid,fid:p[j]},true)}gcapp.selo.selectOnMap(gcapp.selo.selection,true)}this.removeAreaSelectionGeometry()},multipleSelectionLogic:function(l,B,r){if(!gcapp.selo.selection||(!r&&!l.ctrlKey)||(gcapp.selo.selection&&gcapp.selo.selection.lid!=B.lid)){gcapp.selo.clearSelection();gcapp.selo.selection={fids:[B.fid],lid:B.lid}}else{var u=false;for(var z=0,p=gcapp.selo.selection.fids.length;z<p;z++){if(gcapp.selo.selection.fids[z]===B.fid){if(!r){gcapp.selo.selection.fids.splice(z,1);delete gcapp.selo.selectionfullinfo[B.fid]}u=true}}if(!u){gcapp.selo.selection.fids.push(B.fid)}}},onCanvasObjectClick:function(b){if(b.name==selectionarea_fnw_obj){if(flashnavigator.html5){gcapp.gctoolbar.setTool("InfoTool")}else{gcapp.gctoolbar.setTool("DragTool")}formManager.closeAll();mapcropform=formManager.open({title:gclang.mainmenu.edit_crop,width:400,height:280,url:fno.liveSite+"modules_gc/map/forms/form_crop.php",buttons:[{html:gclang.mainmenu.edit_crop,id:"fcm_crop_bt","class":"bluebutton"}]})}this.removeAreaSelectionGeometry()},onAreaSelection:function(J){var E,B,D,z,H,F;if(gcapp.gctoolbar.active==="crop"){fnm.areaSelectionObject=J;this.drawSelectedArea(J)}else{if(gcapp.gctoolbar.active==="AreaSelection"){E=fnl.getSelectedLayers();if(E.length>0){B=E[0].id}else{alert("Please select layer first.");return}var I=E[0];if(I.lock=="t"){alert("The currently selected layer is locked.");return}if(I.visible!="t"){alert("The currently selected layer is not visible.");return}D=fnw.getLayerByName("layer"+B);z=D.getBound();var H=J.xMin<z.xMin&&J.xMax<z.xMin||J.xMin>z.xMax&&J.xMax>z.xMax;var F=J.yMin<z.yMin&&J.yMax<z.yMin||J.yMin>z.yMax&&J.yMax>z.yMax;if(H||F){alert("You have selected area outside the bound of selected layer.");return}J.xMin=Math.max(J.xMin,z.xMin);J.yMin=Math.max(J.yMin,z.yMin);J.xMax=Math.min(J.xMax,z.xMax);J.yMax=Math.min(J.yMax,z.yMax);if(!J||!J.originalEvent||!J.originalEvent.ctrlKey){this.clearSelection()}var G={lid:B,bound:{xMin:J.xMin,yMin:J.yMin,xMax:J.xMax,yMax:J.yMax}};var C=this;giscloud.log.push("layer_select_by_bound",G);fnl.getFeaturesByBound(G,function(a){C.onGetFeaturesByBoundComplete(a,J.originalEvent)})}}}});var gcMainMenu=new Class({Extends:omModule,options:{},initialize:function(b){this.setOptions(this.options,b)},showGetStarted:function(){if(openMapId==null){fn.loadModule("main",{url:fno.liveSite+"modules_gc/about/getstarted.php"})}},showAboutUs:function(){if(!openMapId){fn.loadModule("main",{url:fno.liveSite+"modules_gc/about/company.php"})}}});gcmainmenu=new gcMainMenu();var fn,fn_workspace,fnm,fnl,geoprocess,fns;var gcApp=new Class({Extends:omModule,options:{mochaui:true,ribbon:true,setRibbonState:true,saveState:("localStorage" in window&&window.localStorage!==null),loginCheckInterval:60000},initialize:function(b){this.setOptions(this.options,b);this.modules=[];this.modulesCount=0;this.modulesPositionCount={left:0};this.__ready=true;this.panels={loading:0,loaded:0,events:[]}},domReady:function(){this.initRPC();this.options.mochaui=$$(".gc-theme-mochaui").length>0;fn=new fnApplication();fn_workspace=new fnWorkspace();fnm=new fnMap();fnl=new fnLayer();geoprocess=new gcGeoprocessing();fns=new fnSearch();if(window.globalNoInterface){return}if(this.options.ribbon&&$("ribbon")){this.ribbonMenu=new omniRibbon("ribbon",{minimized:fno.mobilebrowser});this.ribbonMenu.addEvent("change",this.ribbonMenuTabChange.bind(this))}this.fireEvent("domready");this.initUserInterface();if(fno.gcinit_auth.type>=1&&fno.gcinit_ie!=6&&fno.gcinit_taskmanager){PCM=new PCManager("pcm",{});PCM.connect();$("pcm_bt").addEvent("click",PCM.toggle.bind(PCM))}else{PCM={connected:false}}if(fno.gcinit_getstarted){showGetStarted()}if(fno.gcinit_auth.logged>0){if(Browser.Engine.trident&&Browser.Engine.version==4){if(Cookie.read("gc_ie6warning_viewed")!="yes"){showIE6Warning();Cookie.write("gc_ie6warning_viewed","yes")}}this.startPeriodicalLoginCheck()}if(fno.gcinit_richmedia){}jQuery("#signupcombo .popup").on("click",function(b){b.stopPropagation()}).find("input[type=text], input[type=password]").on("click",function(b){b.stopPropagation()});if(fno.mobilebrowser){jQuery("#rightpanel_wrapper").addClass("rightpanel-mobile")}if(user.options.GISCLOUD_EDITOR&&user.id>0){if(gcapp.announcements){gcapp.announcements.show()}if(!user.options.__GC_APP_EDITOR_FIRST_TIME){giscloud.options.create({resource:"users",id:user.id},{type:50,name:"__GC_APP_EDITOR_FIRST_TIME",value:1,resource_id:user.resource_id})}}},openLink:function(g){var a=jQuery(g.currentTarget);giscloud.log.push("link_click",{href:a.attr("href"),target:a.attr("target")})},setAppState:function(){},ribbonMenuTabChange:function(b){},showAdmin:function(){gcapp.myAppsForm=formManager.open({fid:"myapps",dragable:true,title:gclang.My_Apps,width:660,height:350,url:fno.liveSite+"modules_gc/users/administration.php"});gcapp.administration.refresh()},administration:(new function(l){function g(b,a){var u=b.app_instance.app.domain||b.app_instance.domain;var r={"class":"linkbutton",href:"http://"+u+fn.getPermalinkPath()};if(!a){r.target="_blank"}var f=l("<a/>",r);if(a){f.click(function(o){o.stopPropagation();var p=jQuery("<form>",{action:"https://"+u+"/assets/switch-app",method:"POST"}).append(jQuery("<input>",{name:"sid",value:a,type:"hidden"})).append(jQuery("<input>",{name:"url",value:r.href,type:"hidden"}));p.appendTo(document.body);p.submit();return false})}return l("<tr/>").append(l("<td/>").html(b.id),l("<td/>").html(b.app_instance.name),l("<td/>").html(new Date(b.created*1000).toLocaleDateString()),l("<td/>").append(f.html(u)))}function j(r){var f=document.cookie.match(/PHPSESSID=[^;]+/);if(f&&f[0]){f=f[0].replace("PHPSESSID=","")}else{f=null}for(var a=0,b=r.data.length;a<b;a++){l("#admin-apps-table tbody").append(g(r.data[a],f))}}this.refresh=function(){l("#admin-apps-table tbody").html("");om.rest("users/current/subscriptions",{expand:"app_instance,payment",order_by:"created"}).done(j)}}(giscloud.exposeJQuery())),initRPC:function(){(function(){var l,g,j;if(fno.gcAppAlternativeRestHost){g=fno.gcAppAlternativeRestHost;j=fno.gcAppAlternativeRestHost+"/assets/api/1/gcremote.php?restUrl="+g}else{g=fno.liveSite.replace("http:","https:");j=fno.liveSite.replace("http:","https:")+"assets/api/1/gcremote.php?restUrl="+g}l=new easyXDM.Rpc({remote:j,onReady:function(){window.gcRpc=l}},{remote:{ping:{},execute:{},rest:{},restGet:{},restPost:{},restPut:{},restDelete:{}},local:{restUrl:function(){return g},pingback:function(f,b,a,p){console.log(JSON.stringify({pingOrigin:b,pingTime:p,pingbackOrigin:f,pingbackTime:a,duration:a-p}))}}})})()},startPeriodicalLoginCheck:function(){this.checkIsLogged.periodical(this.options.loginCheckInterval,this)},checkIsLogged:function(){om.rest("session",null,this.onCheckLogin.bind(this),{noloader:true})},onCheckLogin:function(b){if(b&&b.exists!==true){window.location=window.location}},initUserInterface:function(b){if(this.options.mochaui&&$("desktop")){MUI.myChain=new Chain();MUI.myChain.chain(function(){MUI.Desktop.initialize()},function(){MUI.Dock.initialize()}).callChain()}this.fireEvent("uiinit",{target:this});if(!(this.panels.loading>0)){this.__ready=true;this.fireEvent("ready")}},maximize:function(){this.ribbonMenu.maximize();this.ribbonMenu.enable()},minimize:function(){this.ribbonMenu.minimize();this.ribbonMenu.disable()},loadUsersWorkspace:function(b){},showReferenceManager:function(b){if(this.formreferences){this.formreferences.close()}this.formreferences=formManager.open({title:"Reference Manager",width:300,height:400,url:fno.liveSite+"modules_gc/media/form_references.php",data:{},buttons:[{html:"Close",click:"gcapp.formreferences.close();"}]})},dispatchModuleEvent:function(o){for(var u=0;u<this.modulesCount;u++){var l=this.modules[u];var r=l[o];if(r){var p=r.bind(l);p()}}},loadPanel:function(f){if(f.onContentLoaded){this.panels.events.push(f.onContentLoaded)}f.onContentLoaded=function(l,a){this.panels.loading--;this.panels.loaded++;if(this.panels.loading==0){for(var b=0;b<this.panels.events.length;b++){var l=this.panels.events[b];if(typeof(l)=="function"){l()}}this.__ready=true;this.fireEvent("ready")}};f.onContentLoaded=f.onContentLoaded.bind(this,[f.onLoad]);this.panels.loading++;if(this.options.mochaui){return new MUI.Panel(f)}else{var g=$(f.id);if(g){g.set("load",{onSuccess:function(){f.onContentLoaded()}});g.load(f.contentURL)}}},isReady:function(){return this.__ready},isModuleReady:function(b){return(b&&b.isReady())},registerModule:function(b){if(!this.isModuleRegistered(b)){this.modules.push(b);this.modulesCount++;this.modulesPositionCount[b.options.position]++}},unregisterModule:function(l){var g=this.modules.length;for(var j=0;j<g;j++){if(this.modules[j]==l){this.modules.splice(j,1);this.modulesCount--;this.modulesPositionCount[l.options.position]--}}},isModuleRegistered:function(l){var g=this.modules.length;for(var j=0;j<g;j++){if(this.modules[j]==l){return true}}return false},resize:function(){for(var j=0;j<this.modulesCount;j++){var l=this.modules[j];if(l.resize){var o=this.modulesPositionCount[l.options.position];var p=l.resize.bind(l)}}},tabChange:function(g){if(g.tab==2){var f=gcapp.selo.selection;if(f&&f.fids&&f.fids.length==1){poiClick({fid:f.fids[0],lid:f.lid})}}},loadHomeWorkspace:function(b){if(!jQuery("#signupcombo").length){return}if(fno.mobilephone){jQuery("#signupcombo").removeClass("signupcombo-mobile");jQuery("#signupcombo div.combolabel").removeClass("combolabel-mobile")}if(this.signupcombo&&this.signupcombo.close){this.signupcombo.close()}this.homepage.refresh();if(this.ribbonMenu){this.ribbonMenu.tabs.showTab(0)}this.homepage.show();formManager.isflashvisible=false;formManager.hideFlashContent()},gotoMapView:function(b){this.ribbonMenu.tabs.showTab(1);this.loadMapWorkspace()},loadMapWorkspace:function(b){formManager.isflashvisible=true;if(formManager.hasOverlay()){formManager.hideFlashContent()}else{formManager.showFlashContent()}this.homepage.hide()},loadProjectsWorkspace:function(b){gcapp.leftcolumn.hide();gcapp.rightcolumn.hide();gcapp.mappanel.destroy();gcapp.dataPanel.destroy();MUI.closePanel("users")},onResize:function(){if(fnw&&fnw.invalidateSize){fnw.invalidateSize()}this.fireEvent("resize",{target:this})},html5MissingFunctionality:function(){if(confirm("Sorry this option is temporarly unvailable in HTML5 map mode. Do you want to switch to standard mode?")){Cookie.write("gc-html5","off",{duration:365});location.href=fn.getPermalink()}},logout:function(){jQuery.post("/app",{logreq:"logout"},function(b){window.location.href=window.location.href})},checkAndWarnForLogin:function(){if(!fno||!fno.gcinit_auth.logged){alert("To use this feature please log in");return false}return true},refreshDatasources:function(){(function(F){var z=F(".gc-layer-add"),r=z.find(".popup").empty().loader(),D,B,E,u,C;giscloud.datasources.list({type:60}).done(function(a){r.loader("hide");if(a.data.length){z.find(".omnicombo").attr("onclick",null);r.removeClass("gc-hidden");z.find(".arrow").removeClass("gc-hidden");C=F("<ul/>").appendTo(r);F.each(a.data,function(f,b){D=F("<img />").attr("src","/assets/images/icons/erdas_apollo_icon.gif");B=F("<div />").addClass("img").append(D);E=F("<div />").addClass("ribbon-list-label").html(b.name);F("<li/>").append(B).append(E).click(function(){apolloSourceBrowser(b.id)}).appendTo(C)})}else{r.addClass("gc-hidden");z.find(".arrow").addClass("gc-hidden");z.find(".omnicombo").attr("onclick",z.find(".gc-ribbon-32").parent().attr("onclick"))}})})(jQuery)}});var gcapp=new gcApp();gcapp.addEvent("ready",function(){gcapp.setSubscriptionType=function(a){var b={user_id:user.id,owner_id:user.id,app_instance_id:fno.app_instance_id,begins:Math.round(jQuery.now()/1000),ends:null,type:a};return om.rest("users/current/subscriptions",b,null,{method:"POST",secure:false,sessid:giscloud.sessid()}).fail(function(){alert("An error occured trying to set your subscription options. The GIS Cloud app needs to reload. If the problam persists, please contact info@giscloud.com.")}).always(function(){gcapp.check_subscription()})};if(fno.app_instance_id!=null&&fno.giscloud&&user.id>0){if(!user.agreed){showWelcomeForm()}else{if(!user.subscriptions||!user.subscriptions.length){if(user.options.REGISTRATION_DEFAULT_USER_SUBSCRIPTION){gcapp.setSubscriptionType(user.options.REGISTRATION_DEFAULT_USER_SUBSCRIPTION)}else{showChooseSubscriptionForm()}}else{var g=jQuery.grep(user.subscriptions,function(a){return a.app_instance_id===fno.app_instance_id});if(!g||!g.length){if(user.options.REGISTRATION_DEFAULT_USER_SUBSCRIPTION){gcapp.setSubscriptionType(user.options.REGISTRATION_DEFAULT_USER_SUBSCRIPTION)}else{showChooseSubscriptionForm()}}var f=jQuery.grep(g,function(a){return a.ends&&a.ends*1000<jQuery.now()});if(f.length){showSubscriptionEndedForm()}}}}gcapp.name=function(){switch(fno.app_instance_id*1){case fno.gcinit_editor_id:return"Map Editor";break;case fno.gcinit_viewer_id:return"Map Viewer";break;default:return fno.app_instance_id}};gcapp.subscriptionName=function(){if(!(user.id*1>0)){return"Not logged in"}if(!user.active_subscription){return"No active"}switch(user.active_subscription.type*1){case 25:return"Premium Full";break;case 23:return"Premium Bonus Period";break;case 20:return"Premium Trial";break;case 10:return"Free";break;case 30:return"Free Beta";break;default:return"Unknown"}};gcapp.calculateLimits=function(){if(!user.subscriptions){return}var u=user.active_subscription=jQuery.grep(user.subscriptions,function(j){return j.app_instance_id===fno.app_instance_id})[0];if(window.olark){olark("api.visitor.updatePhoneNumber",{phoneNumber:"App: "+gcapp.name()+" Subscription type: "+gcapp.subscriptionName()})}if(!u){return}function a(j,o){var l=parseInt(j,10)||j;if(typeof o==="undefined"){o=0}return(l===0?0:(l||o))}var b=a(user.feature_count_limit),B=(a(user.file_feature_count)+a(user.db_feature_count)),r=a(user.storage_raster),z=a(user.storage_raster_limit);if(u.type*1==10){user.active_subscription.over_limits=!(B<=b&&r<=z&&!(user.private_maps&&user.private_maps.length>0))}else{user.active_subscription.over_limits=!(B<=b&&r<=z)}};gcapp.overlay=function(a){if(a){var b="Please check your subscription plan <br/>to continue using our service.";if($("gc-content")){$("gc-content").overlay(true,false,b)}else{$("mapPanel").overlay(true,false,b);$("mapPanel").setStyle("overflow","hidden");if($("datagrid_pad")){$("datagrid_pad").overlay(true)}}if(gcdatagrid){window.app_overlay_resize=function(){gcapp.overlay(true)};gcapp.addEvent("resize",window.app_overlay_resize)}}else{if($("gc-content")){$("gc-content").overlay(false)}else{if($("mapPanel")){$("mapPanel").overlay(false)}if($("datagrid")){$("datagrid").overlay(false)}}if(window.app_overlay_resize){gcapp.removeEvent("resize",window.app_overlay_resize)}}};gcapp.check_subscription=function(a){var b;if(user.options.GISCLOUD_EDITOR){b=function(){if(formManager.isFullpageOpen("subscription")){showSubscription()}if(a){a()}}}giscloud.includeJs(fno.liveSite+"user/usage?"+Math.random(),b)};gcapp.check_subscription.periodical(120000);gcapp.check_subscription()});(function(l,g,j){Permissions={has:function(a){return l.inArray(a,user.permissions)!=-1}};GOptions={get:function(a){return user.options[a]}}})(jQuery,window,window.document);giscloud.ui=giscloud.ui||{};giscloud.ui.Window=function(b){formManager.open({fid:"abtf",dragable:true,title:b.title,width:b.width,height:b.height,html:b.html})};(function(f,g){giscloud.ui.popup=function(a){var b=f("body").find(".gc-popover"),H=a.content;function G(j){if(j.hasClass("gc-popover-overlay")){om.hideOverlay()}j.remove()}G(b);if(a.closeButton){H+="<br><p class='text-center' ><button class='gc-popover-button btn btn-small' >Got it!</button></p>"}var D="<div class='gc-popover popover bottom "+(a.overlay?"gc-popover-overlay":"")+"' >                         <div class='arrow'></div>                         <h3 class='popover-title'>"+a.title+"</h3>                         <div class='popover-content'>                           <p>"+H+"</p>                         </div>                       </div>";var F=f(D).appendTo(f("body")).fadeIn().css("z-index",2000000);F.find(".gc-popover-button").click(function(){G(F)});var r=a.offset_x||"0",C=a.offset_y||"10";offset=a.offset||r+" "+C;if(a.overlay||a.modal){om.showOverlay(true)}var E={my:"center top",at:"center bottom",collision:"none",offset:offset};F.position(jQuery.extend({of:a.element},E));return F};giscloud.ui.modal=function(r){if(!r){r={}}f(".modal").remove();f(".modal-backdrop").remove();var a=r.content?r.content:"",u=f("body").height()-300;var p=" <div id='myModal' class='modal hide fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>     <div class='modal-header'>         <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>×</button>         <h3 id='myModalLabel'>"+r.title+"</h3>     </div>     <div class='modal-body' style='max-height:"+u+"px' > "+a+"     </div> <div class='modal-footer'>";if(r.buttons){f.each(r.buttons.reverse(),function(j,l){var o=l["class"]=="bluebutton"?"btn-primary":"";if(l.html==gclang.close||l.html==gclang.cancel){p+="<button class='btn' data-dismiss='modal' aria-hidden='true'>"+l.html+"</button>"}else{p+="<button class='btn "+o+"' onclick='"+l.click+"' >"+l.html+"</button>"}})}else{p+="<button class='btn' data-dismiss='modal' aria-hidden='true'>Close</button>"}p+="</div> </div>";var b=f(p).appendTo(f("body")).modal({backdrop:r.overlay,remote:r.url});if(r.draggable){f("#myModal").draggable({handle:".modal-header"}).find(".modal-header").css("cursor","move")}return b}})(jQuery,$);giscloud.ui.confirm=function(C,p){if(!p){p={}}var D=p.fid?p.fid:("__window"+Math.round(Math.random()*1000000)),u=[],z;if(!(p&&p.hide_yes)){u.push({click:function(){if(z.callback_yes){z.callback_yes()}else{z.close()}},"class":"bluebutton",html:p.yes_title||"Yes"})}if(!(p&&p.hide_no)){u.push({click:function(){if(z.callback_no){z.callback_no()}else{z.close()}},html:p.no_title||"No"})}z=formManager.open({overlay:p.overlay,noclosebutton:true,dragable:true,fid:D,width:p.width||500,height:p.height||310,title:p.title||"Confirm",buttons:u,html:"<div style='position:absolute; padding-right:20px; line-height:18px; height: auto; width: auto; white-space: nowrap;' class='gc-window-text' >"+C+"</div>"});z.addEvent("close",function(a){if(a.esc){if(z.callback_no){z.callback_no()}else{z.close()}}});var r=z.container.getElement(".gc-window-text").getSize(),B;B=p.width?p.width:Math.max(r.x+50,200);height=p.height?p.height:Math.max(r.y+100,120);z.resize(B,height);z.yes=function(a){z.callback_yes=function(){if(a){a()}this.close()};return this};z.no=function(a){z.callback_no=function(){if(a){a()}this.close()};return this};return z};(function(M){var N="<a href='javascript:;' onclick='return gcapp.editOk()'>"+gclang.Accept+"</a><a href='javascript:;' onclick='return gcapp.editCancel()'>"+gclang.Reject+"</a>",W=gclang.Editing_feature+"<br/>"+N,O;gcapp.beforeDatagridDelete=null;var P={},K=false;function H(){var a=gcapp.gclayer.llist.getSelected(),b=a&&a.data;if(b&&b.sourcetype==="pg"){return{id:b.id,type:b.tip}}return null}function V(){giscloud.ui.map.selection.clear();gcapp.selo.clearSelection()}function I(a){a=a.toUpperCase();M.each(giscloud.ui.map.layers,function(g,j){var f=j.type.toUpperCase();var b=fnl.getLayerById(j.id);j.selectable((f===a||f===("MULTI"+a))&&b.lock!="t")})}function U(){M.each(giscloud.ui.map.layers,function(a,b){P[b.id]=b.selectable()})}function G(){M.each(giscloud.ui.map.layers,function(a,b){b.selectable(P[b.id]||true)})}function S(){giscloud.ui.map.reloadMap();gcdatagrid.refresh()}function R(){giscloud.ui.greenAlert("Data has been saved successfully...");giscloud.ui.customForm.disable()}function J(){giscloud.ui.greenAlert("Data has been saved successfully",2000);giscloud.layers.reset(giscloud.ui.map.mapId,[currentLayer.id]).done(S,giscloud.ui.customForm.close)}function T(){giscloud.ui.redAlert("Error occured. Please check your input data.",2000);giscloud.ui.customForm.enable()}function Q(){var a,b;if(gcapp.selo.selectionCount()===0){gcapp.cancelClone();return}if(K&&gcapp.selo.selectionCount()>1){giscloud.ui.redAlert("Clone feature geometry & attributes option works only on one object.",3000);gcapp.cancelClone(true);return}a=gcapp.selo.selection.lid;b=gcapp.selo.selection.fids;V();gcapp.gcmap.options.dontShowInfo=false;G();giscloud.ui.greenAlert(gclang.PleaseWait);M.when(K&&giscloud.features.byId(a,b)||null,giscloud.ui.customForm.open({layerId:currentLayer.id})).always(giscloud.ui.alert.hide).done(function(g,f){if(K&&g){f.triggerHandler("setData",g.data)}f.trigger("setFeatureGeometry.gc-custom-form",{feature_ids:b,layer_id:a}).trigger("setRestParams.gc-custom-form",{}).on({"submitStart.gc-custom-form":R,"submitSuccess.gc-custom-form":J,"submitFailure.gc-custom-form":T})})}gcapp.cloneFeatureGeom=function(a){var b=H();K=a;if(b){window.currentLayer=b;giscloud.ui.greenAlert(gclang["clonefeaturegeom_message_"+b.type]+"<br/></br><a href='javascript:;' onclick='gcapp.acceptClone(); return false;'>"+gclang.Accept+"</a><a href='javascript:;' onclick='gcapp.cancelClone(); return false;'>"+gclang.Cancel+"</a>");gcapp.gcmap.options.dontShowInfo=true;gcapp.gcmap.marker.clear();V();U();I(b.type)}else{giscloud.ui.redAlert(gclang.clonefeaturegeom_choose_layer_message,3000)}};gcapp.acceptClone=function(){Q()};gcapp.cancelClone=function(a){if(!a){giscloud.ui.alert.hide()}V();gcapp.gcmap.options.dontShowInfo=false;G()};gcapp.deleteMe=function(o){var b=gcdatagrid.getDataByRow(o),l=b&&b.__id,f=gcapp.gclayer.llist.getSelected(),g=f&&f.data,j=g&&g.id,a;if(l!=null&&j!=null){if(gcapp.beforeDatagridDelete){a=gcapp.beforeDatagridDelete(j,l);if(a===false){return false}else{if(!a.state){a=(new M.Deferred()).resolve()}}}else{a=(new M.Deferred()).resolve()}a.done(function(){gcapp.gcmap.marker.clear();gcapp.gcmap.options.dontShowInfo=true;giscloud.ui.alert.green().show(gclang.PleaseWait);var p=new giscloud.Queue([function(){return giscloud.features.remove(j,l)},function(){return giscloud.layers.reset(giscloud.ui.map.mapId,[j])}]);p.done(function(){giscloud.ui.alert.green().show(gclang.Successfully_deleted_,3000);gcdatagrid.refresh();giscloud.ui.map.reloadMap();gcapp.gcmap.options.dontShowInfo=false})})}return false};gcapp.isEditable=function(b,a){var f=(b.use_info_window!=="t"||a)&&fno.editable&&!b.gcmap_sublayer;if(f&&b.datasource_id){f=(b.dts_owner_id==user.id)||jQuery.inArray("EDIT",b.dts_permissions)>-1;f=(!b.dts_permissions||b.dts_permissions.length==0)?(f||editable):f}else{if(editable){f=f||(editable&&!b.gcmap_sublayer)}}return f};gcapp.editRowInfo=function(l){var b=gcdatagrid.getDataByRow(l),a=b&&b.__id,f=gcapp.gclayer.llist.getSelected(),g=f&&f.data,j=g&&g.id;if(j!=null&&a!=null){giscloud.ui.customForm.editFeature(j,a).done(function(){gcapp.gcmap.marker.clear()})}};gcapp.editMe=function(b,a){if(a!=null&&b!=null){gcedit.getFeatureByID({fid:a,lid:b});giscloud.ui.alert.color("green").show(W)}O=new M.Deferred();return O.promise()};gcapp.editOk=function(){O.resolve();giscloud.ui.alert.hide();gcedit.editFeatureSave();giscloud.ui.map.reloadMap();gcdatagrid.refresh()};gcapp.editCancel=function(){O.reject();giscloud.ui.alert.hide();gcedit.editFeatureCancel();giscloud.ui.map.reloadMap()}}(giscloud.exposeJQuery()));(function(p){var r=null,u,l,o;l=function(a,b){r=b;o.resolveWith(r,[r])};p(document).on("formReady.gc-custom-form",".gc-custom-form",l);gcapp.addEvent("ready",function(){if(!giscloud.ui.map){return}giscloud.ui.map.ready(function(){gcapp.gctoolbar.setTool("InfoTool");if(window.open_feature){var b=open_feature.feature_id;var a=open_feature.layer_id;gcapp.gclayer.llist.selectByID(a);om.showLoader("Positioning...");giscloud.features.byId(a,b).done(function(f){om.hideLoader();var j=f.bounds;var g={__xmin:j.left,__ymin:j.bottom,__xmax:j.right,__ymax:j.top};gcapp.selo.selectOnMap({fids:[b],lid:a},true);gcapp.gcmap.smartSetLocation(g)});window.open_feature=null}gcapp.gcmap.marker.addEventListener("gc-info-popup-edit-click",function(g,f){giscloud.ui.customForm.editFeature(f.layerId,f.featureId).done(function(){gcapp.gcmap.marker.clear()})})})});giscloud.ui.customForm={beforeOpen:null,open:function(f){var a,b;o=new p.Deferred();if(!f.layerId){throw"You need to specify the layer id (layerId) at least."}if(u&&u.close){giscloud.ui.customForm.close()}a="/rest/1/layers/"+f.layerId;if(f.featureId){a+="/features/"+f.featureId}if(f.formId){a+="/forms/"+f.formId}else{a+="/form"}a+="?buttons=none&r="+p.now();u=formManager.open({fid:"custom-form-window",title:(f.featureId?gclang.Edit_feature:gclang.Add_feature),url:a,buttons:[{html:gclang.Save,"class":"bluebutton",click:giscloud.ui.customForm.save},{html:gclang.Cancel,click:giscloud.ui.customForm.close},{html:gclang.Reset,click:giscloud.ui.customForm.reset}]});u.addEvent("close",function(){p(r).triggerHandler("close.gc-custom-form");p(".gc-custom-form").remove();r=null});return o.promise()},editFeature:function(g,b){var f=new p.Deferred(),a;if(giscloud.ui.customForm.beforeOpen){a=giscloud.ui.customForm.beforeOpen(g,b);if(a===false||a==null){return f.reject().promise()}else{if(!a.state){a=new p.Deferred();a.resolve()}}}else{a=new p.Deferred();a.resolve()}a.fail(f.reject).done(function(){giscloud.ui.customForm.open({layerId:g,featureId:b}).done(function(j){j.on({"submitStart.gc-custom-form":giscloud.ui.customForm.disable,"submitSuccess.gc-custom-form":function(){giscloud.layers.reset(giscloud.ui.map.mapId,[g]).done(function(){giscloud.ui.map.reloadMap();gcdatagrid.refresh()},f.resolve,giscloud.ui.customForm.close)},"submitFailure.gc-custom-form":giscloud.ui.customForm.enable})});u.addEvent("close",function(){f.reject()})});return f.promise()},reset:function(){if(u){p(r).triggerHandler("reset.gc-custom-form")}},save:function(){if(u){p(r).triggerHandler("save.gc-custom-form")}},close:function(){if(u){p(r).triggerHandler("close.gc-custom-form");p(".gc-custom-form").remove();u.close();r=null}},enable:function(){if(u){u.enable()}},disable:function(){if(u){u.disable()}},current:function(){return r}}}(giscloud.exposeJQuery()));(function(G,F,D,K){if(!gcapp){return}var E=1,B=5,H="created:DESC",I=user.last_announcement_id,M,J=function(b){var l=G("<div/>"),a=G("<div/>").addClass("gc-anns-content").appendTo(l),g=G("<ul/>").addClass("gc-list gc-no-hover").appendTo(a),o,j,f=Math.ceil(b.total/B);G.each(b.data,function(r,p){o=G("<li/>").html("<h3>"+p.title+"</h3><p>"+p.message+"</p>"+(p.link?"<a href='"+p.link+"' target='_blank' >Read more</a>":""));g.append(o)});if(E<f){a.append("<p class='text-center' ><button class='btn btn-small' style='margin-top:20px;' >Show older</button></p>")}return l.html()},C=function(){E+=1;giscloud.log.push("announcement_show_more",{page:E});giscloud.announcements.list({page:E,perPage:B,order_by:H,from_id:I}).done(function(b){var a=G(".gc-anns-content");a.find(".btn").remove();var f=a.html(a.html()+J(b)).find(".btn");f.click(C)})};gcapp.announcements={show:function(){giscloud.announcements.list({page:E,perPage:B,order_by:H,from_id:I}).done(function(a){M=a.data[0].id;if(!(a.data.length>0)){return}var b=G("<div/>").addClass("announcement").html("<a>Hey, we have new stuff available!</a>").attr("title","Click to see more").click(function(){giscloud.log.push("announcement_show");var f=giscloud.ui.modal({content:J(a),title:"Announcements",overlay:false}).on("hide",function(){gcapp.announcements.remove()}).find(".btn");f.click(C)});G("body").append(b)})},remove:function(){if(!user.last_announcement_id||M>user.last_announcement_id){giscloud.users.update(user.id,{last_announcement_id:M})}giscloud.log.push("announcement_remove",{last_announcement_id:M});gcapp.announcements.hide()},hide:function(){G(".announcement").remove()}}})(jQuery,window,window.document,$);(function(o,p,l,j){p.callWoopra=function(a,b){om.kcall("logs/woopra/search",{username:a},b)}})(jQuery,window,window.document,$);(function(l,g,j){giscloud.dashboard=giscloud.dashboard||{};giscloud.dashboard.open=function(){giscloud.dashboard.close();formManager.fullpage({id:"gc-dashboard",url:"/dashboard",opacity:1,closeButton:(fno.app_instance_id!=fno.gcinit_manager_id)})};giscloud.dashboard.close=function(){formManager.closeFullpage("gc-dashboard")}})(jQuery,window,window.document);var gcSubscription=function(K,N){var H,I,Q,R,O,W,V,S,P,U,G,M,T=function(a){if(typeof a==="number"){return new Date(a*1000)}var f=/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})\.\d*([+\-])(\d{2})/,j=a&&a.match&&a.match(f),b=j&&new Date(parseInt(j[1]),parseInt(j[2])-1,parseInt(j[3]),parseInt(j[4]),parseInt(j[5]),parseInt(j[6])),l=j&&(j[7]==="-"?-1:1)*parseInt(j[8]),g=l&&b&&(l*60)-b.getTimezoneOffset();if(g){b=new Date(b.getTime()+g*60*1000)}return b},J=function(b,a){return gcApp.utils.createProgressBar(b,a)};I=function(){return om.rest("users/current/subscriptions.json",{expand:"app_instance,payment",where:"active = true"}).pipe(function(a){return a.data})};Q=function(a){user.subscriptions=a;gcapp.calculateLimits()};showHideAttribution=function(b){var a=user.active_subscription;if(a.type==="10"){gcapp.gcmap.addNonCommercialAttributionMessage()}else{gcapp.gcmap.removeNonCommercialAttributionMessage()}};H=function(b){var a=b?b:user.active_subscription;switch(a.type){case"10":O();break;case"20":W(a);break;case"23":showCommercialPendingSubscriptionText();break;case"25":V(a);break;case"30":U();break}R();switch(a.type){case"10":S();break;case"20":M(a);break;case"23":showTrialBonusText(a);break;case"25":showPremiumText(a);break;case"30":G();break;default:P()}if(a.type!=="20"){K("#trialstatus").hide("slow")}};getDateString=function(a,b){if(b){a=a.replace("YYYY",b.getFullYear()).replace("MM",b.getMonth()+1).replace("DD",b.getDate())}else{a=a.replace("MM/DD/YYYY","...")}return a};O=function(){K("#subscriptionText").html(gclang.Subscription_non_commercial)};W=function(a){var b=T(a.ends);K("#subscriptionText").html(getDateString(gclang.Subscription_commercial_trial,b))};showCommercialPendingSubscriptionText=function(a){K("#subscriptionText").html(gclang.Subscription_commercial_pending)};V=function(a){var b=T(a.ends);K("#subscriptionText").html(getDateString(gclang.Subscription_commercial,b))};S=function(){K("#usrform_subscription_change_text").html(gclang.Change_subscription_to_commercial);K("#usrform_subscription_submit").html(gclang.Start_a_free_30_day_trial);K("#usrform_subscription_submit").show()};P=function(){K("#usrform_subscription_change_text").html(gclang.Change_subscription_to_non_commercial);K("#usrform_subscription_submit").html(gclang.Switch_to_a_Non_Commercial_License)};M=function(){K("#usrform_subscription_change_text").html(gclang.You_are_on_a_trial);K("#usrform_subscription_submit").html(gclang.Switch_to_a_Non_Commercial_License);K("#usrform_subscription_submit").hide()};showTrialBonusText=function(){K("#usrform_subscription_change_text").html(gclang.You_are_on_a_trial);K("#usrform_subscription_submit").html(gclang.Switch_to_a_Non_Commercial_License)};showPremiumText=function(){K("#usrform_subscription_submit").hide()};U=function(){K("#subscriptionText").html(gclang.Subscription_free_beta)};G=function(){K("#usrform_subscription_change_text").html(gclang.Free_beta_feedback_please);K("#usrform_subscription_change_title").html(gclang.Feedback);K("#usrform_subscription_submit").hide()};R=function(b){var o=b||user,z=gcApp.utils.getIntVal(o.file_feature_count)+gcApp.utils.getIntVal(o.db_feature_count),j=gcApp.utils.getIntVal(o.storage_raster),f=gcApp.utils.getIntVal(o.feature_count_limit),p=gcApp.utils.getIntVal(o.storage_raster_limit),u=Math.round(j/1024/1024),a=Math.round(p/1024/1024),l=Math.floor(z/f*100),B=Math.floor(j/p*100),r=Math.floor((l+B)/2);K("#nrFeaturesText").html(z.format()+" / "+f.format());K("#rasterStorageText").html(u+" / "+a+"MB");K("#user_featureslimit").val(f);K("#user_rasterlimit").val(a);J("nrFeaturesProgressBar",l);J("rasterStorageProgressBar",B);updatePrivateMapsInfo();if(user.active_subscription){var g=user.active_subscription.type*1;if(g==10&&user.active_subscription.over_limits){K("#subsc_notification").html('<p class="lead lightred"  >Your account usage exceeds allowed limits. Please upgrade your plan to a Premium license or continue using under free license with limited storage and without private map. </p><div style="margin:0;" class="" ></div>')}}};updatePrivateMapsInfo=function(){var a=K("#nrPrivateMaps");if(a&&user.private_maps){if(user.active_subscription.type!=10||!user.private_maps.length){a.removeClass("deletebutton").unbind("click")}else{a.addClass("deletebutton").click(function(){fnm.showUserPrivateMaps()})}a.html("You have "+user.private_maps.length+" private map(s).")}};this.justShowUsage=function(a){if(a!=null){om.rest("users/"+a+".json").done(R)}};this.refresh=function(b,a){if(!K("#subscription").length){return}if(b){I().done(function(f){Q(f);if(a){a(function(){H();showHideAttribution()})}})}else{H(user.active_subscription)}};this.submitSubcriptionChange=function(){var b=user.active_subscription,f={user_id:b.user_id,owner_id:b.owner_id,app_instance_id:b.app_instance_id,begins:Math.round(K.now()/1000),ends:null},g=new Date(),a=this;if(b.type==="10"){f.type=20}else{f.type=10}giscloud.log.push("subscription_change",{current:user.active_subscription.type,newsub:f.type,app_instance_id:b.app_instance_id});K("#usrform_subscription_submit").css("visibility","hidden");om.rest("users/current/subscriptions",f,null,{method:"POST",secure:true}).done(function(){K("#usrform_subscription_submit").css("visibility","visible");a.refresh(true,gcapp.check_subscription)}).fail(function(j){K("#usrform_subscription_submit").css("visibility","visible");if(j&&j.message&&j.code){if(j.code==="-23"){if(confirm(gclang[j.message])){f.type=23;om.rest("users/current/subscriptions",f,null,{method:"POST",secure:true}).always(function(){window.location.reload()})}}else{if(j.code==="SUBSCRIPTION_CAN_ONLY_CONTINUE_FREE"){alert(gclang.Can_only_continue_non_commercial)}}}})};if(fno.app_instance_id!=null&&user.type!=2){if(parseInt(user.active_subscription.type)>=20){K("#usrform_subscription_submit").html(gclang.Switch_To_Non_Commercial_License)}else{K("#usrform_subscription_submit").html(gclang.Switch_To_Commercial_License)}K("#usrform_subscription_submit").click(K.proxy(this.submitSubcriptionChange,this))}};var lastLayerHover=null;var layerStateAID={};var layerVisibilityID=null;var layerLockID=null;var layerform;var cm1=[{header:"Visible",dataIndex:"visible",type:"checkbox",width:5},{header:"Selectable",dataIndex:"selectable",type:"checkbox",width:5},{header:"ID",dataIndex:"id",hidden:true},{header:"Updated",dataIndex:"updated",hidden:true},{header:"Tip",dataIndex:"tip",hidden:true},{header:"Name",dataIndex:"name",type:"custom",labelFunction:function(l,g,j){return"43"}}];var gcLayerModul=new Class({Extends:omModule,options:{id:"layermodule",position:"left"},initialize:function(b){this.setOptions(this.options,b);gcapp.registerModule(this);gcapp.addEvent("ready",this.appReady.bind(this))},appReady:function(){this.container=$(this.options.id);this.llist=new gcLayerTree("gclayertree",this);this.llist.addEvent("select",this.showLayerData.bind(this));this.llist.addEvent("unselect",this.unselectLayer.bind(this));this.initLayer();this.onResize();this.__init=true;this.fireEvent("init",{target:this})},isReady:function(){return this.__init},onResize:function(){var b=$("layers-panel").getSize();if(b.y>0){$("layerlist").setStyle("height",b.y-28)}},initLayer:function(){fnl.addEvent("setdata",this.onloadLayerList.bind(this));this.alphasl=new Slider("alphaSlider",$("alphaSlider").getElement(".knob"),{range:[0,101],wheel:true,snap:true,full:242,onComplete:function(b){}});this.alphasl.addEvent("change",this.onAlphaSliderChange.bindWithEvent(this,false));this.alphasl.addEvent("complete",this.onAlphaSliderChange.bindWithEvent(this,true));$("alphaSlider").visibility(false);fn.addEvent("hidemap",function(){$("alphaSlider").visibility(false)})},resize:function(g,f){if(f){this.container.setStyle("height",f);this.llist.setSize(g,f-70)}},editSelectedLayer:function(){var b=this.llist.getSelection();if(b.length==0){alert(gclang.lmod.no_selection);return}this.editLayerByNode(b[0])},editLayerByNode:function(b){if(!b||!b.data||!b.data.id){return}if(b.parentNode&&b.parentNode.data&&b.parentNode.data.sourcetype=="gcmap"){return}if(b.type=="folder"){this.llist.rename();return}if(b.type=="rasterfolder"){alert("Can not edit this node type.");return}this.editLayer(b.data.id)},editLayer:function(b){if(!editable){alert(gclang.mmod.no_edit_permission);return}this.layerChange(b)},newLayer:function(b){if(!fn.getMap()){alert(gclang.mmod.no_selection);return}if(!editable){alert(gclang.mmod.no_edit_permission);return}fnl.unselect();formManager.closeAll();layerform=formManager.open({fid:"newlayerform",title:gclang.lfrm.title,width:640,height:480,url:fno.liveSite+"layer/form",data:{"new":"yes",opentype:b},buttons:[{html:gclang.save,"class":"bluebutton",click:"saveLayer();"},{html:gclang.cancel,click:"clayerform.cancel();"}],onClose:function(){}});layerform.container.hide();return layerform},newFleetLayer:function(){if(!fn.getMap()){alert(gclang.mmod.no_selection);return}if(!editable){alert(gclang.mmod.no_edit_permission);return}fnl.unselect();formManager.closeAll();this.fleetform=formManager.open({title:"Add Vehicle Tracking Layer",width:450,height:280,url:fno.liveSite+"modules_gc/fleet/form_fleet_layer.php",data:{"new":"yes"},buttons:[{html:gclang.save,"class":"bluebutton",click:"gcapp.gcfleet.save();"},{html:gclang.cancel,click:"gcapp.gclayer.fleetform.close();"}]});return this.fleetform},editFleetLayer:function(b){if(!fn.getMap()){alert(gclang.mmod.no_selection);return}if(!editable){alert(gclang.mmod.no_edit_permission);return}formManager.closeAll();this.fleetform=formManager.open({title:"Add Vehicle Tracking Layer",width:450,height:280,url:fno.liveSite+"modules_gc/fleet/form_fleet_layer.php",data:{lid:b.id},buttons:[{html:gclang.save,"class":"bluebutton",click:"gcapp.gcfleet.save();"},{html:gclang.cancel,click:"gcapp.gclayer.fleetform.close();"}]});return this.fleetform},onDuplicateLayer:function(b){om.showMessage(b.msg);gcproject.showMap()},duplicateLayer:function(){if(!editable){alert(gclang.mmod.no_edit_permission);return}var b=this.llist.getSelected();if(!b){alert(gclang.lmod.no_selection);return}if(b.type.contains("folder")||b.type.contains("rasterfolder")||!b.data||!b.data.id){alert("You can not duplicate this item.");return}fnl.duplicateLayer(b.data.id,confirm("Do you want duplicate layer data source as well?"),this.onDuplicateLayer.bind(this))},showSelectedLayer:function(){this.llist.zoomToLayer()},exportLayer:function(r,B){if(!fnm.isVisible()){alert(gclang.mmod.not_visible);return}var z=[];if(r){if(typeof r=="boolean"){var r=fnl.getLayers({});r.each(function(a){z.push(a.id)})}else{if(typeof r=="number"){z.push(r)}else{if(typeof r=="array"){z=r}}}}else{var p=fnl.getSelectedLayers();if(p.length==0){alert(gclang.lmod.no_selection);return}else{if(p.length==1){var u=p[0];if(u.exportable!="t"){alert("You can not export this layer because it has been disabled by the owner.");return}if((u.sourcetype=="pg")||(u.sourcetype=="file")){}else{alert(gclang.lmod.export_warning1);return}z.push(u.id)}else{p.each(function(a){z.push(a.id)})}}}var o=[];z.each(function(a){var b=fnl.getLayerById(a);if((b.sourcetype=="pg")||(b.sourcetype=="file")){o.push(a)}else{return}});if(window.exportwizardform){window.exportwizardform.close()}var u={lid:o.join()};if(B){giscloud.ui.modal({url:fno.liveSite+"modules_gc/layer/export/exportform.php?"+Hash.toQueryString(u),title:gclang.exportfrm.title})}else{exportwizardform=formManager.open({title:gclang.exportfrm.title,width:370,height:400,url:fno.liveSite+"modules_gc/layer/export/exportform.php",data:u,buttons:[{html:gclang.close,click:"exportwizardform.close();"}]})}},onDeleteLayer:function(r,p){om.showMessage(r.msg);if(r.result=="yes"){for(var u=0;u<r.deleted.length;u++){var o=r.deleted[u];fnl.removeLayer(o.id);if(o.grp==1){p=true}else{(fnm.isVisible())}var z=fnw.getLayerByName("layer"+o.id);if(z){fnw.removeLayer({refId:z.refId})}var B=fnw.getLayerByName("llayer"+o.id);if(B){fnw.removeLayer({refId:B.refId})}}if(p){gcapp.gcmap.reloadMap();this.loadLayerList()}}fnl.unselect()},deleteSelectedLayer:function(){if(!editable){alert(gclang.mmod.no_edit_permission);return}var C=this.llist.getSelection();if(C.length==0){alert(gclang.lmod.no_selection);return}for(var B=0;B<C.length;B++){var E=C[B];if(E.parentNode&&E.parentNode.data&&E.parentNode.data.sourcetype=="gcmap"){alert("You can not delete sublayer(s) of the included GIS Cloud map.");return}}var D=confirm(gclang.confirm_continue);if(D!=true){return}var r=false;function F(a){var b=[];for(var f=0;f<a.length;f++){var g=a[f];if(g.data.id){b.push(g.data.id)}if(["giscloud","tile","wms","wmts"].contains(g.data.tip)){r=true}if(g.type=="folder"&&g.hasChildren()){b=b.combine(F(g.children))}}return b}var C=this.llist.getSelection();var z=F(C);var u=this;fnl.deleteLayer(z,function(a){u.onDeleteLayer(a,r)})},selectAllLayers:function(){this.llist.selectAll()},onSaveLayersOrderComplete:function(f,g){if(f.basemap||g.data.sourcetype=="gcmap"){gcapp.gcmap.reloadMap()}},onSortComplete:function(){SaveLayersOrder(false)},showLayerData:function(g){var f=fnl.getSelectedLayers(true);if(f&&f.source){if(gcapp.options.saveState){localStorage["giscloud-last-selected-layer"+currentMapID]=f.id}if($("datagrid_map_sync")){$("datagrid_map_sync").checked=false}gcdatagrid.selectionFilterChange(true);gcdatagrid.showLayerData(f)}},onloadLayerList:function(b){this.llist.hideLoader();if(user.options.LAYER_LIST_EXPAND_ALL){this.llist.expand()}},loadLayerList:function(j,l){if(!currentMapID){return}this.llist.showLoader();var g=null;if(j){g=this.llist.getSelection()}fnl.list(currentMapID,l,g)},saveLayerState:function(r,u,l,o,p){if(fno.gcinit_auth.type>0&&fno.gcinit_auth.fullaccess){if(!editable){return}fnl.saveState(r,u,l,o,p)}},unselectLayer:function(){$("alphaSlider").visibility(false);if(gcdatagrid&&gcdatagrid.datagrid){gcdatagrid.removeAll(true)}},onLayerClick:function(l){if(fnm.isVisible()){var g=(l.grp!=null)?"layer_group_"+l.grp:"layer"+l.id;var j=fnw.getLayerByName(g);if(j){this.alphasl.set(j.getAlpha())}}},onLayerDblClick:function(b){editLayer(b.id)},onAlphaSliderChange:function(z,C){if(fnm.isVisible()){var H=this.llist.tree.getSelected();if(!H){return}var B=H.data;if(!B){return}var G=B.grp?"layer_group_"+B.grp:"layer"+B.id;var E=fnw.getLayerByName(G);if(E){E.setAlpha(z)}if(C){var u=B.id;if(B.grp==2&&H.children.length>0){u=[];for(var F=0;F<H.children.length;F++){var D=H.children[F].data;u.push(D.id)}u=u.join()}if(!layerStateAID[u]){layerStateAID[u]={}}$clear(layerStateAID[u].intAlphaID);layerStateAID[u].intAlphaID=this.saveLayerState.delay(500,this,[u,"alpha",z,B.grp==2])}}}});if(fno.gcinit_auth.type>0&&fno.gcinit_auth.fullaccess){gcLayerModul.prototype.onNewLayerFromSelection=function(b){om.showMessage(b.msg);if(b.result=="yes"&&currentMapID){if(flashnavigator.html5){gcapp.gctoolbar.setTool("InfoTool")}else{gcapp.gctoolbar.setTool("DragTool")}gcproject.mapChange(currentMapID)}};gcLayerModul.prototype.layerFromSelection=function(){var g,f;if(!(currentMapID>=0)){alert(gclang.mmod.no_selection);return}if(!fnm.isVisible()){alert(gclang.mmod.not_visible);return}if(giscloud.ui.map){g=giscloud.ui.map.selection.selected&&giscloud.ui.map.selection.selected();if(g&&g.length>0){f={lid:g[0].layerId,fids:jQuery.map(g,function(a){return a.featureId.toString()})};fnl.newLayerFromSelection(f,this.onNewLayerFromSelection.bind(this))}else{if(gcapp.selo.selection!=null){fnl.newLayerFromSelection(gcapp.selo.selection,this.onNewLayerFromSelection.bind(this))}else{alert(gclang.lmod.no_selection);return}}}else{if(gcapp.selo.selection==null){alert(gclang.lmod.no_selection);return}fnl.newLayerFromSelection(gcapp.selo.selection,this.onNewLayerFromSelection.bind(this))}};gcLayerModul.prototype.layerChange=function(f){if(!(f>-1)){alert(gclang.lmod.no_selection);return}var g=fnl.getLayerById(f);if(g==null){return}currentLayerID=f;if(g.tip=="analysis"){gcanalysis.edit(g);return}if(g.tip=="fleet"){this.editFleetLayer(g);return}formManager.closeAll();layerform=formManager.open({fid:"layerform",dragable:true,title:gclang.lfrm.title,width:640,height:480,url:fno.liveSite+"layer/form",data:{lid:f},buttons:[{html:gclang.save,"class":"bluebutton",click:"saveLayer();"},{html:gclang.cancel,click:"clayerform.cancel();"}]})};gcLayerModul.prototype.createMobileLayer=function(){this.mobilelayerform=formManager.open({overlay:true,title:"Mobile Datasource Form",width:500,height:400,url:fno.liveSite+"datasource/form_mobilelayer",buttons:[{html:gclang.Create,"class":"bluebutton",click:"gcapp.mobiledatasource.save();"},{html:gclang.Cancel,click:"gcapp.gclayer.mobilelayerform.close();"}]});var b=this;this.mobilelayerform.addEvent("close",function(){})};gcLayerModul.prototype.createLayer=function(){if(!editable){alert(gclang.mmod.no_edit_permission);return}formManager.closeAll();layercreateform=formManager.open({fid:"layercreateform",dragable:false,title:"Create Layer",width:680,height:480,url:fno.liveSite+"modules_gc/layer/formcreatelayer.php",buttons:[{"class":"bluebutton",html:gclang.create,click:"ccl.create();"},{html:gclang.cancel,click:"layercreateform.close();"}]});return layercreateform}}var CLayerForm=new Class({Implements:[Options,Events],options:{pkey:"ogc_fid"},initialize:function(z,u){this.setOptions(this.options,u);this.attributes=[];this.brwsources=null;this.source=null;if(!["raster","tile"].contains(this.layerType)){this.columnsEditor.initialize()}if(flashnavigator.hasCanvas){var l=fnw.getLayerByName("layer"+$("layerid").value);if(l){var B=l.getRules();this.rulesBackup=[];for(var r=0;r<B.length;r++){this.rulesBackup[r]={};for(var j in B[r]){if(B[r].hasOwnProperty(j)){this.rulesBackup[r][j]=B[r][j]}}}}}},cancel:function(){if(flashnavigator.hasCanvas&&this.rulesBackup){var l=fnw.getLayerByName("layer"+$("layerid").value);var o=l.getRules();for(var p=0;p<o.length;p++){for(var j in o[p]){if(o[p].hasOwnProperty(j)){o[p][j]=null}}if(this.rulesBackup[p]){for(var j in this.rulesBackup[p]){if(this.rulesBackup[p].hasOwnProperty(j)){o[p][j]=this.rulesBackup[p][j]}}}}l.redraw()}layerform.close()},onGetInfo:function(J,W,Q,H,P,I,K){om.hideLoader();if(!K||K.length<=6){var T=this.getSource("object");if(newlayer&&T.type=="file"){if(confirm(gclang.lfrm.source_with_no_proj)){var N=showProjectionWizard({source:this.getSource()});N.addEvent("close",this.getInfo.bind(this));return}}}$("srcinfo").innerHTML="";var J=fnl.getType(J);if(W==1&&!noGeometryTypeUpdate){tipcomboObj.setValue(J);noGeometryTypeUpdate=false}else{if(W==2){tipcomboObj.setValue("raster")}}lyrf_typeLayerChange({value:tipcomboObj.getValue()});var T=this.getSource();if(H>=0){$("srcinfo").innerHTML=" "+gclang.lfrm.objects_count+": "+H}if(I&&I.length>0){}$("layerform").units.value=I;var M=P?P:new Array();if($("attributelist")){$("attributelist").dispose()}var R=new Element("select",{style:"display:none;",id:"attributelist",size:"20"});R.inject(document.body);var S=new Element("option");S.innerHTML=S.value="";R.appendChild(S);layerform.attributes=P;var V=[];for(var O=0;O<M.length;O++){var U=M[O];if(1){V.push(M[O].name)}}jQuery("#tooltip").tagit({availableTags:V,caseSensitive:false,onlyFromAvailableTags:true});this.calculateTile(Q);giveLayerNameBySource();if(newlayer){var G=explist.clist.getElement(0);explist.onStyleNewRange(G)}om.hideLoader();if(newlayer&&layerform_skipform&&Q){saveLayer()}},onCGIGetInfo:function(b){layerform.enable();om.hideLoader();if(!b){return}if(b.code>0){om.showError(b.msg);if(b.code==303){fnl.getInfo(this.getSource(),this.lyrf_onGetInfo303Error.bind(this));return}return}if(b.layers&&b.layers.length>1){sublayersform=formManager.open({overlay:true,title:"Sublayers list",width:400,height:480,url:fno.liveSite+"modules_gc/layer/sublayers_form.php",formdata:b,buttons:[{html:"Close",click:"msf_closeForm();"},{html:"Back",click:"sublayersform.close();"}]})}else{this.featurecount=b.featurecount;this.onGetInfo(b.type,b.driver,b.bound,b.featurecount,b.attributes,b.unit,b.proj4)}},lyrf_onGetInfo303Error:function(p){var o=this.getSource("object");if(!p){om.showMessage("onGetInfo303Error");return}if(p.code>0){om.showError(p.msg);return}if(!p.proj4||p.proj4.length<=6){if(o.type=="file"){if(confirm(gclang.lfrm.source_with_missing_proj)){var l=showProjectionWizard({source:this.getSource()});l.addEvent("close",this.getInfo.bind(this));return}else{var j=fn.getMap();if(j.proj4){this.setSource(null)}}}}},getInfo:function(o,r){var z=this.getSource("object");if(!z||!z.type){return}$("srcinfo").innerHTML="";noBoundUpdate=o;noGeometryTypeUpdate=r;if(z.type=="pg"){$("wms_layer_mess").hide();$("lyrf_maintabs").show();$("querywizard-form").show();layerform.disable();om.showLoader();var p=0;var B=fn.getMap();if(B&&B.proj4&&B.proj4.length>4){p=B.proj4}fnl.getPostGISInfo(z,p,$("encoding").value,this.onCGIGetInfo.bind(this))}else{if(z.type=="file"){$("wms_layer_mess").hide();$("lyrf_maintabs").show();$("querywizard-form").show();var u=fno.resources+z.src;var p=null;var B=fn.getMap();if(B&&B.proj4&&B.proj4.length>4){p=B.proj4}if(1){om.showLoader();layerform.disable();fnl.getPostGISInfo(z,p,$("encoding").value,this.onCGIGetInfo.bind(this))}else{alert("Application is not connected to map generator!  Please contact server administrator.")}}else{if(z.type=="wms"){$("wms_layer_mess").hide();$("querywizard-form").hide();$("lyrf_maintabs").show();if(newlayer&&layerform_skipform){saveLayer()}}else{if(z.type=="tile"){$("querywizard-form").hide();$("lyrf_maintabs").show();if(newlayer&&layerform_skipform){saveLayer()}}else{if(z.type=="gcmap"){$("wms_layer_mess").hide();$("querywizard-form").hide();$("lyrf_maintabs").show();this.calculateTile({xmin:-1,xmax:1,ymin:-1,ymax:1});if(newlayer&&layerform_skipform){saveLayer()}}}}}}},calculateTile:function(f,g){if(!f){return}if(!$("xmin").value||!$("ymin").value||!$("xmax").value||!$("ymax").value){if(!(g>0)){g=5}$("xmin").value=Format.round(f.xmin,g);$("ymin").value=Format.round(f.ymin,g);$("xmax").value=Format.round(f.xmax,g);$("ymax").value=Format.round(f.ymax,g)}},setSource:function(o){this.source=getSourceObject(o);var l=$("source");if(l){if(this.source){var p=this.source.type;if(p=="pg"){p="postgis"}l.value="Type: '"+p+"'";if(this.source.type=="wms"){l.value+=", Source: '"+this.source.url+"', Layers: '"+this.source.layer+"'"}else{if(this.source.type=="file"){var j=new String(this.source.src).substr(33);l.value+=", Source: '"+j+"'"}else{if(this.source.type=="wfs"){l.value+=", Source: '"+this.source.url+"', Layers: '"+this.source.layerid+"'"}else{if(this.source.type=="pg"){var j=new String(this.source.src);j=j.substr(j.indexOf(".")+1);l.value+=", Table: '"+j+"'"}else{l.value+=", Source: '"+this.source.src+"'"}}}}if(this.source.datasource_id){l.value+=", Datasource ID: "+this.source.datasource_id}}else{l.value=""}}setRenderMethod(this.source)},getSource:function(g){if(!this.source){return null}var f=$("driveroptions");if(f){this.source.driveroptions=f.value}return g=="object"?this.source:JSON.encode(this.source)},createWMTSLayer:function(W,T,U,Z,Q,I){var M=W.WGS84BoundingBox.LowerCorner.split(" ");var Y=W.WGS84BoundingBox.UpperCorner.split(" ");var S=new Proj4js.Proj("EPSG:4326");var H=new Proj4js.Proj("EPSG:"+T.epsg);var J=new Proj4js.Point(parseFloat(M[0]),parseFloat(M[1]));var K=new Proj4js.Point(parseFloat(Y[0]),parseFloat(Y[1]));var N=T.Left;var P=T.Top;if(N==90&&P==-180){P=90;N=-180}Proj4js.reportError=function(a){if(N<0){J.x=N}else{J.x=-N}if(P<0){J.y=P}else{J.y=-P}};Proj4js.transform(S,H,J);Proj4js.reportError=function(a){if(N<0){K.x=-N}else{K.x=N}if(P<0){K.y=-P}else{K.y=P}};Proj4js.transform(S,H,K);if(N>J.x&&N>K.x&&P<K.y&&P<K.y){N*=-1;P*=-1}if(J.x<N){J.x=N}if(K.y>P){K.y=P}if(!U){U=W.DefaultStyle}var R={type:"wmts",id:I,url:Q.url,layer:W.Identifier,name:W.Title,tile0:{originx:N,originy:P,resolution:T.scale,wmts:"true"},epsg:T.epsg,tilematrix:T.Identifier,xmin:J.x,xmax:K.x,ymin:J.y,ymax:K.y,format:Z,style:U};if(W.URLTemplate){R.URLTemplate=[];for(var O=0;O<W.URLTemplate.length;O++){var V=new String(W.URLTemplate[O]);V=V.replace("{TileMatrixSet}",T.Identifier);V=V.replace("{TileMatrix}","{z}");V=V.replace("{TileRow}","{y}");V=V.replace("{TileCol}","{x}");V=V.replace("{Style}",U);V=V.replace("{Time}",new Date());R.URLTemplate[O]=V}}this.onSelectSourceBrowser({files:[R]})},onSelectSourceBrowser:function(J){var S=this;if(!J||!J.files||!J.files.length){if(newlayer){layerform.close()}return}layerform_skipform=J.skipform;if(J.files.length>1&&(J.type=="file"||J.type=="postgis")){msourcesform=formManager.open({overlay:false,title:"Wizard for adding multiple layers ",width:400,height:480,url:fno.liveSite+"modules_gc/layer/multisources_form.php",formdata:J.files,buttons:[{html:"Close",click:"formManager.closeAll();"},{html:"Back",click:"msourcesform.close();"}]});return}var O=J.files[0],E=jQuery.Deferred();if(O.type=="datasources"&&O.datasource_type==40){var K=JSON.decode(O.params);var I=formManager.wmsInfo({url:K.url,select:true});I.addEvent("close",function(a){if(a&&a.layers&&a.layers.length>0){a.layers[0].type="wms";a.layers[0].id=O.id;S.onSelectSourceBrowser({files:a.layers})}});return}else{if(O.type=="datasources"&&O.datasource_type==80){var K=JSON.decode(O.params);var R=jQuery.map(K.layers,function(a){return'<option value="'+a.Identifier+'">'+a.Title+"</option>"}).join("");N="<div class='big'>";N+="<div>Layer:&nbsp;<select id='wmts_layer_dropdown'>"+R+"</select></div><br />";N+="<div>Tileset:&nbsp;<select id='wmts_tileset_dropdown'></select></div><br />";N+="<div>Format:&nbsp;<select id='wmts_format_dropdown'></select></div><br />";N+="<div>Style:&nbsp;<select id='wmts_style_dropdown'></select></div>";N+="</div>";var F=null;var M=null;var Q=null;var P=null;giscloud.ui.confirm(N,{width:460,title:"Choose a WMTS layer",yes_title:"Ok",no_title:"Cancel"}).yes(function(){if(!Proj4js.defs["EPSG:"+M.epsg]){giscloud.includeJs("/rest/1/geo_utils/epsg_to_proj4js?srid="+M.epsg,function(){S.createWMTSLayer(F,M,Q,P,K,O.id)})}else{S.createWMTSLayer(F,M,Q,P,K,O.id)}});$("wmts_layer_dropdown").onchange=function(){var b=$("wmts_layer_dropdown").value;for(var a=0;a<K.layers.length;a++){if(K.layers[a].Identifier==b){F=K.layers[a];break}}$("wmts_tileset_dropdown").innerHTML=jQuery.map(F.TileMatrixSetLink,function(f){return"<option>"+f+"</option>"}).join("");$("wmts_format_dropdown").innerHTML=jQuery.map(F.Format,function(f){return"<option>"+f+"</option>"}).join("");$("wmts_style_dropdown").innerHTML=jQuery.map(F.Style,function(f){return"<option>"+f+"</option>"}).join("");$("wmts_tileset_dropdown").onchange();$("wmts_format_dropdown").onchange();$("wmts_style_dropdown").onchange()};$("wmts_tileset_dropdown").onchange=function(){var a=$("wmts_tileset_dropdown").value;for(var b=0;b<K.tilesets.length;b++){if(K.tilesets[b].Identifier==a){M=K.tilesets[b];break}}};$("wmts_format_dropdown").onchange=function(){P=$("wmts_format_dropdown").value};$("wmts_style_dropdown").onchange=function(){Q=$("wmts_style_dropdown").value};$("wmts_layer_dropdown").onchange();$("wmts_tileset_dropdown").onchange();return}}var G=fnm.isReprojectable(O.epsg),N;if(["wms","wmts","tile","gcmap"].contains(O.type)||O.datasource_type==70){var H=fn.getMap().epsg;if(is_numeric(H)&&G.length){N=fnm.getReprojectionConfirmMsg(G);giscloud.ui.confirm(N,{width:460}).yes(function(){var a=jQuery.map(G,function(b){return giscloud.layers.remove(b.id)});jQuery.when.apply(jQuery,a).always(function(f,g,b){giscloud.maps.update(currentMapID,{epsg:O.epsg}).done(function(){gcproject.reload(true,false,false,null,function(){E.resolve()})})})}).no(function(){E.reject();if(newlayer){layerform.close()}})}else{if(H!=O.epsg){giscloud.ui.confirm("Spatial projection will be changed to EPSG:"+O.epsg+". Do you want to proceed?").yes(function(){giscloud.maps.update(currentMapID,{epsg:O.epsg}).done(function(){E.resolve()})}).no(function(){E.reject();if(newlayer){layerform.close()}})}else{E.resolve()}}}else{E.resolve()}var S=this;E.done(function(){$("layer_epsg").value=O.epsg;var b={type:O.type};switch(O.type){case"file":if(O.tip.toLowerCase()!="directory"){b.src=O.path}else{alert(gclang.lfrm.no_dir_as_source)}break;case"postgis":b.type="pg";b.src=O.schemaname+"."+O.name;b.connid=O.connid;break;case"datasources":if(O.datasource_type==70){b.type="wfs";var a=JSON.decode(O.params);b.url=a.url;b.layerid=a.layerid;b.geometry_type=a.geometry_type;b.datasource_id=O.id;var j=O;tipcomboObj.setValue(fnl.getType(a.geometry_type));$("xmin").value=j.x_min;$("ymin").value=j.y_min;$("xmax").value=j.x_max;$("ymax").value=j.y_max;$("layername").value=O.name;if(newlayer){var l=explist.clist.getElement(0);explist.onStyleNewRange(l)}}else{b.type="pg";var a=JSON.decode(O.params);b.src=a.src;b.datasource_id=O.id;b.connid=-1}break;case"wmts":tipcomboObj.setValue("wmts");$("layername").value=O.name;$("xmin").value=O.xmin;$("ymin").value=O.ymin;$("xmax").value=O.xmax;$("ymax").value=O.ymax;b={type:"tile",src:"wmts",layer:O.layer,format:O.format,style:O.style,tilematrix:O.tilematrix,tile0:O.tile0,url:O.url};b.datasource_id=O.id;console.log(O);if(O.URLTemplate){b.URLTemplate=O.URLTemplate}break;case"wms":b.datasource_id=O.id;b.url=O.url;b.style=O.style;if(O.srs){b.srs=O.srs}if(J.files.length>1){b.layer=[];for(var g=0;g<J.files.length;g++){b.layer.push(J.files[g].name)}b.layer=b.layer.join()}else{b.layer=O.name}$("layername").value=O.title;tipcomboObj.setValue("wms");$("srcinfo").innerHTML="";clearBound();if(!O.bound){alert("Can not find bound for selected WMS layer.");return}if(!b.layer){alert("Can not find layer name for selected WMS layer.");return}if(O.tile0){b.tile0=O.tile0}S.calculateTile(O.bound,100);S.getInfo();break;case"tile":tipcomboObj.setValue("tile");if(O.src=="tilejson"){$("layername").value=O.name;b=O;$("xmin").value=$("ymin").value=-20037508.3427892;$("xmax").value=$("ymax").value=20037508.3427892}else{b={type:"tile",src:O.code,datasource_id:O.datasource_id};$("layername").value=O.tileserver;$("srcinfo").innerHTML="";clearBound();S.calculateTile(O.bound,100)}S.getInfo();break;case"gcmap":b.type="gcmap";b.src=O.name;b.mid=O.id;$("layername").value=O.name;tipcomboObj.setValue("giscloud");$("xmin").value=$("ymin").value=-1;$("xmax").value=$("ymax").value=1;$("srcinfo").innerHTML="";break}S.setSource(b);if(S.getSource()&&!["wmts","wms","tile","gcmap"].contains(O.type)&&!["wfs"].contains(b.type)&&!O.url){sourceChange()}var f=Object.clone(b);if(f.src){f.src=f.src.substr(f.src.lastIndexOf("/")+1)}giscloud.log.push("layer_form_source_change",f)}).fail(function(){if(newlayer){layerform.close()}})},onSelectSource:function(g){var j={upload:true,selectmode:true,extensions:[gcFileExt.Spatial,gcFileExt.All],postgis:true,mobile:true,wms:true,tms:true,gcmap:true,datasources:true,arcmap:!!fno.showArcMapInSourceBrowser,mapbox:!!fno.showMapBoxInSourceBrowser,multipleSelection:true,opentype:g};if(!newlayer){var l=this.getSource("object");if(l&&l.type=="file"){j.dir=l.src}}if(newlayer){j.skipform=true}ff=formManager.fileBrowser(j);ff.addEvent("close",this.onSelectSourceBrowser.bind(this))}});function validateGeometry(u){if(u.directpgrender!="t"){var p=LiveValidation.massValidate([xmin,ymin,xmax,ymax]);if(!p){tabs.showTab(2);return false}}var r=LiveValidation.massValidate([onscaleVal,offscaleVal,nlevelsVal,layerclassVal,layeridVal]);if(!r){tabs.showTab(2);return false}var l=$("xmax").value-$("xmin").value;var o=$("ymax").value-$("ymin").value;if(u.directpgrender!="t"&&this.featurecount>0){if(l==0){om.showError("X bound coordinates are invalid!");tabs.showTab(2);return false}if(o==0){om.showError("Y bound coordinates are invalid!");tabs.showTab(2);return false}}return true}function onSaveLayer(b){om.hideLoader();layerform.enable();if(b&&b.result=="no"){om.showMessage(b.msg);return}if($("layerform").task.value=="new"){b.layer_name=$("layerform").name.value;b.mid=$("layerform").mid.value;giscloud.log.push("layer_new",b);if(IsNumeric(b.id)){$("layerform").task.value="update";$("layerform").layerid.value=b.id;gcproject.reload(false,false,true,b.id)}}else{b.layer_name=$("layerform").name.value;b.mid=$("layerform").mid.value;giscloud.log.push("layer_update",b);gcproject.reload(false,true,true,b.id)}om.showMessage(b.msg)}function saveLayer(){layertype=tipcomboObj.getValue();$("layerform").styles.value=explist.clist.serialize();$("layerform").mid.value=currentMapID;var l=clayerform.getSource("object");var u=om.getFormValues("layerform");u.source=JSON.encode(l);if(l.datasource_id!=0){u.datasource_id=l.datasource_id}u.tip=layertype;if($("mobileinput_device")){u.mobileinput_device=mod_mobileinput.getSelectedDevices()}if(!LiveValidation.massValidate([layernameVal,source])){return}if(!layertype||!(layertype.length>0)){alert("Layer type is not defined.");return}if(!validateGeometry(u)){return}if(!(currentMapID>0)){om.showMessage("<span class='messages error'>Map is not defined.</span>");return}var p=gcapp.gclayer.llist.getSelected();if(p&&p.type=="folder"&&p.data&&p.data.id){u.parent=p.data.id}om.showLoader("Saving layer..");layerform.disable(true);var r,o=new jQuery.Deferred();o=new jQuery.Deferred();r=clayerform.columnsEditor.save();fnl.saveLayer(u,o.resolve);jQuery.when(o,r).done(function(a){onSaveLayer.apply(null,a)})}function layerRegenerate(b){layerform.close()}function giveLayerNameBySource(){if(!($("layername").value.length>0)){var b=clayerform.getSource("object");$("layername").value=getNameFromSource(b)}}function getNameFromSource(b){if(!b){return null}if(typeof(b)=="string"){b=getSourceObject(b)}if(b.type=="pg"){return b.table}else{if(b.type=="file"){return b.src.substring(b.src.lastIndexOf("/")+1,b.src.lastIndexOf("."))}}}function clearBound(){$("xmin").value="";$("ymin").value="";$("xmax").value="";$("ymax").value=""}function getBoundFromSource(){clearBound();clayerform.getInfo()}function sourceChange(){clearBound();clayerform.getInfo()}function tileChange(){if(!$("xmax")){return}var g=$("xmax").value-$("xmin").value;var f=$("ymax").value-$("ymin").value;numOfTile=(Math.floor(g/$("tile").value)+1)*(Math.floor(f/$("tile").value)+1);$("numfiles").innerHTML=" "+numOfTile+" tiles"}function sourcesListRenderer(o,z,r){if(1){var B=new Element("input",{type:"text",style:"width:350px;margin-top:2px;",readonly:"readonly"});B.addClass("readonly");B.setStyle("cursor","pointer");B.addEvent("click",function(a){r.setSelection(a.target.getParent())});var p=new Element("a",{style:"margin-left:10px",html:"Browse"});p.addClass("linkbutton");p.addEvent("click",this.onSelectSource.bind(this));B.inject(o);p.inject(o)}else{var u=new Element("span",{style:"",html:"All sources"});u.inject(o)}}function sourcesListSerialize(g,f){}function onNewSourcesList(){}var CExpressionList=new Class({Implements:[Options,Events],options:{},initialize:function(l){this.setOptions(this.options,l);var p=[{func:Validate.Presence,options:{notFirst:true}},{func:Validate.Format,options:{pattern:/^[1-9]([0-9]*)(k*)$/i}}];var j=[{func:Validate.Format,options:{pattern:/^[1-9]([0-9]*)(k*)$/i}}];var o=[{func:Validate.Presence,options:{notFirst:true}},{func:Validate.Numericality,options:{onlyInteger:true,minimum:0}}];this.clist=new omRanges("styleranges",{input1Validation:p,input2Validation:j,input3Validation:o,renderFunction:this.styleRangeRenderer.bind(this),headerFunction:this.styleHeaderRenderer.bind(this),serializeFunction:this.styleRangeSerialize.bind(this),sortable:true});this.clist.addEvent("newrange",this.onStyleNewRange.bind(this));this.clist.deserialize(this.options.styles)},styleRangeRenderer:function(z,C){var E=new Element("input",{type:"text",style:"width:420px; margin:2px 0 0 35px; vertical-align:top; padding:2px;"});E.addEvent("keydown",function(a){if(!a.alt){return}$("attributelist").onchange=function(b){insertAtCaret(E,b.target.value);b.target.selectedIndex=0};$("attributelist").setStyle("top",E.getCoordinates().top+E.getSize().y);$("attributelist").setStyle("left",E.getCoordinates().left);show("attributelist")});E.addEvent("keyup",function(){om.hide("attributelist")});E.addClass("firstinput");var G=new Element("span",{title:"Click and hold to drag up or down"});G.addClass("updownicon");var B=new Element("span",{style:"margin-left:20px;"});B.addClass("styleicon");B.addEvent("click",this.onStyleIconClick.bind(this));z.setStyle("height","25px");var D=new Element("div",{style:"top:3px; left:17px","class":"labelcheckbox"});var H=new Element("div",{style:"top:6px; left:0px;","class":"visibilitycheckbox"});D.inject(z);E.inject(z);G.inject(z);B.inject(z);H.inject(z);var F=new omniCheckBox(D,{title:"Click to toggle label/expression.",size:16,toggleClass:"expression-label"});F.addEvent("change",this.labelCbChange.bind(this));D.store("parent",F);var u=new omniCheckBox(H,{title:"Click to toggle visibility of the expression.",size:10,toggleClass:"eye10"});H.store("parent",u);u.addEvent("change",this.visibilityCbChange.bind(this));u.set(true);if(C){if(C.showlabel){F.set(C.showlabel);if(C.label){E.value=C.label}}else{if(C.expression){E.value=C.expression}}u.set(C.visible===undefined?true:C.visible);if(C.label){E.store("label",C.label)}if(C.expression){E.store("expression",C.expression)}setDivStyle(tipcomboObj.getValue(),B,C)}},labelCbChange:function(g){var j=g.target.getParent();var l=j.getElement("input.firstinput");if(g.checked){l.store("expression",l.value);l.value=l.retrieve("label")==l.value?"":l.retrieve("label")}else{l.store("label",l.value);l.value=l.retrieve("expression")}},visibilityCbChange:function(g){var j=g.target.getParent();var l=j.getElement("input.firstinput");if(g.checked){l.store("visible",true)}else{l.store("visibility",false)}},globalLabelCbChange:function(l){var j=this.clist.ul.getElements("li");for(var p=0;p<j.length;p++){var o=j[p].getElement(".omcheckbox.labelcheckbox").retrieve("parent");o.set(l.checked)}},globalVisibilityCbChange:function(l){var j=this.clist.ul.getElements("li");for(var p=0;p<j.length;p++){var o=j[p].getElement(".visibilitycheckbox").retrieve("parent");o.set(l.checked)}},styleRangeSerialize:function(z,r){var E=tipcomboObj.getValue();var C=z.getElement("input.firstinput");var u=z.getElement(".omcheckbox.labelcheckbox");switch(E){case"point":break;default:}var F=explist.clist.getData(r);var B=z.getElement(".omcheckbox.labelcheckbox").retrieve("parent");F.showlabel=B.get();var D=z.getElement(".omcheckbox.visibilitycheckbox").retrieve("parent");F.visible=D.get();if(F.showlabel){F.expression=C.retrieve("expression");F.label=C.value}else{F.expression=C.value;F.label=C.retrieve("label")}return F},simpliSerialize:function(r,l){var p=r.getElement("input.firstinput");var u=r.getElement("input.secondinput");var o=r.getElement("input.valinput");return p.value+","+u.value+","+o.value},simpliDeserialize:function(g){var f=g.split(",");return{value1:f[0],value2:f[1],value3:f[2]}},styleHeaderRenderer:function(o,l){var p=new Element("span",{text:"From scale:"});p.addClass("hs1");p.inject(o);var r=new Element("span",{text:"To scale:"});r.addClass("hs2");r.inject(o);if(!l.inputButton){var u=new Element("span",{text:"Value:"});u.addClass("hs3");u.inject(o)}},styleHeaderRenderer:function(z){var E=new Element("div",{style:"position:relative;"});E.inject(z);var r=new Element("div",{style:"top:1px; left:0px"});r.inject(E);var F=new Element("div",{style:"top:-2px; left:17px"});F.inject(E);var u=new omniCheckBox(F,{title:"",size:16,toggleClass:"expression-label"});u.addEvent("change",this.globalLabelCbChange.bind(this));var B=new omniCheckBox(r,{title:"",size:10,toggleClass:"eye10"});B.addEvent("change",this.globalVisibilityCbChange.bind(this));var C=new Element("span",{text:gclang.lfrm.expression+":",style:"width:430px; margin-left:37px;"});C.addClass("hs1");C.inject(E);var D=new Element("span",{text:gclang.lfrm.appearance+":"});D.addClass("hs2");D.inject(E)},onStyleNewRange:function(l){var r=l.getElement(".omcheckbox.visibilitycheckbox").retrieve("parent");r.set(true);var p=tipcomboObj.getValue();if(p==""||p==null){return}if(p=="point"){var u={url:"/icons/defaulticon.png",iconsoverlap:2,fontsize:"12",fontcolor:"0,0,0",outline:"255,255,255"};explist.clist.setData(explist.clist.getIndexByLi(l),u);setDivStyle("point",l.getElement("span.styleicon"),u)}else{var o=getRandomStyle({geomtype:p});setDivStyle(tipcomboObj.getValue(),l.getElement("span.styleicon"),o);explist.clist.setData(explist.clist.getIndexByLi(l),o)}},onIconBrowserSelect:function(g){if(!g){return}if(!g.files){return}if(!g.files.length){return}var l=g.files[0].path;var j=explist.clist.getIndexByLi(icondiv.getParent());explist.clist.setData(j,{url:l});setDivStyle("point",icondiv,{url:l})},onStyleFormClose:function(g){window.active_expression_index=null;if(!g||!g.save){return}var l=tipcomboObj.getValue();var j=explist.clist.getIndexByLi(icondiv.getParent());explist.clist.setData(j,g);if(l=="geometry"&&g.symbol){l="point";tipcomboObj.setValue("point");setDivStyle("point",icondiv,g);return}setDivStyle(l,icondiv,g)},onStyleIconClick:function(o){var p=tipcomboObj.getValue();if(!(clayerform.getSource().length>0)){alert(gclang.lfrm.no_source);return}icondiv=o.target;icondiv=icondiv.get("tag")=="img"?icondiv.getParent():icondiv;switch(p){case"point trenutno isljuceno":iconBrowse=formManager.fileBrowser({upload:true,selectmode:true,showimages:true,extensions:[gcFileExt.Icons],postgis:false});iconBrowse.addEvent("close",this.onIconBrowserSelect.bind(this));break;default:window.active_expression_index=explist.clist.getIndexByLi(icondiv.getParent());var r=explist.clist.getData(window.active_expression_index);var u=clayerform.getSource();var l=formManager.style({element:icondiv,data:r});l.addEvent("close",this.onStyleFormClose.bind(this))}}});function lf_onRasterCbChange(j){var g=fn.getMap();if($("layerform_raster_cb").checked&&!g.proj4){$("layerform_raster_cb").checked=false;alert(gclang.lfrm.first_define_proj);return}var l=clayerform.getSource("object");if(l.type=="file"){}}function lf_onTilesSeedComplete(b){if(!b){return}if(b.result=="no"){om.showError(b.msg);return}om.showConfirm(b.msg)}function lf_onTilesSeedClick(b){if(!$("layerform_raster_cb").checked){alert(gclang.lfrm.no_seed_raster);return}fnm.rasterTilesSeed({mid:currentMapID,tolevel:$("tiles_seed_level").value},lf_onTilesSeedComplete)}function lyrf_onShowSourceFullInfoComplete(b){$("lyrf_fullsourceinfo").hideLoader();if(!b){$("lyrf_fullsourceinfo").innerHTML="Error getting data for data source."}else{if(b.code){$("lyrf_fullsourceinfo").innerHTML="Error "+b.code+": "+b.msg}else{$("lyrf_fullsourceinfo").innerHTML=formatGetInfo(b)}}}function lyrf_onShowSourceFullInfoClick(j){var l=$("lyrf_sourceinfo_bt").getElement("span.arrowicon");l.toggleClass("active");if(l.hasClass("active")){var g=clayerform.getSource("object");if(!g){return}if(g.type!="file"&&g.type!="pg"){$("lyrf_fullsourceinfo").innerHTML="Info is not available for this kind of source type";$("lyrf_fullsourceinfo").reveal();return}if(g.src.length>0){$("lyrf_fullsourceinfo").empty();$("lyrf_fullsourceinfo").showLoader();$("lyrf_fullsourceinfo").reveal();fnl.getInfo(g,lyrf_onShowSourceFullInfoComplete)}else{alert(gclang.lfrm.no_source)}}else{$("lyrf_fullsourceinfo").dissolve()}}function lyrf_typeLayerChange(g){var f=clayerform.getSource("object");if(!f){return}if((f.type=="pg")&&(g.value=="tile"||g.value=="maptemplate"||g.value=="wms"||g.value=="raster")){tipcomboObj.setValue(tipcomboObj.lastValue);alert(gclang.lfrm.cannot_set_source.replace("__TYPE__",g.value))}if((f.type=="file")&&(g.value=="tile"||g.value=="maptemplate"||g.value=="wms")){tipcomboObj.setValue(tipcomboObj.lastValue);alert(gclang.lfrm.cannot_set_source.replace("__TYPE__",g.value))}if((f.type=="tile")&&(g.value!="tile")){tipcomboObj.setValue(tipcomboObj.lastValue);alert(gclang.lfrm.cannot_set_source.replace("__TYPE__",g.value))}if((f.type=="gcmap")&&(g.value!="maptemplate")){tipcomboObj.setValue(tipcomboObj.lastValue);alert(gclang.lfrm.cannot_set_source.replace("__TYPE__",g.value))}if((f.type=="wms")&&(g.value!="wms")){tipcomboObj.setValue(tipcomboObj.lastValue);alert(gclang.lfrm.cannot_set_source.replace("__TYPE__",g.value))}}function setRenderMethod(f){var g=$("lyrfrm_directpgrender");if(!g){return}if(f.type=="pg"){g.show()}else{g.hide()}}(function(ar,aB,aI){var ak=null,aN=null,ax=null,ag=null,ap=null,aQ=null,aq=false,aj=false,aP=null,aK=null,aL=null,at=false,aS=null,aG=null,ai=null,az=false,aO=function(a){aK=ar.map(a,function(b){return b.name});return aK},an=function(b){var a=/^columnsListItem_([\w+\-]+)$/,f=ar.map(b,function(j){var g=j.match(a);return g&&g.length&&g[1]});return f},am=function(){aL=an(ax.sortable("toArray"))},aw=function(){var a={};ax.children().each(function(b,j){var g=ar(j),f=g.find("input[name='idfield']").val();a[f]={alias:g.find(".column-alias > input").val(),enabled:g.find(".column-enabled > input:checked").length>0,order:b}});return a},aD=function(){var a={};ax.children().each(function(f,b){var g=ar(b),j=g.find("input[name='idfield']").val(),l=g.find(".column-mapping > select").val();if(l){a[l]=j}});return a},aJ=function(b){var j=ax.children(),a=ax.find(".column-enabled > input:checked").length,f=a===0,g=a===j.length;if(aj){return}if(b===aI){if(g){aQ.prop("checked",true)}else{aQ.prop("checked",false)}}else{aj=true;j.find(".column-enabled > input[type=checkbox]").prop("checked",!!b);aj=false}},aC=function(){var f,b,a,g;if(aS&&ai&&ai.mappings){f=JSON.parse(ai.definition);b=ar.map(f.items||[],function(j){return j.name});a=ai.mappings[aN]||[];g={};ar.each(a,function(l,j){g[j]=l});ax.children().each(function(l,j){var r=ar(j),o=r.find("input[name='idfield']").val(),u=r.find(".column-mapping > select"),p=ar.map(b,function(z){return ar("<option/>",{val:z,text:z})});p.splice(0,0,ar("<option/>",{text:"-",val:null}));u.prop("disabled",false).find("option").remove().append.apply(u,p);u.val(g[o])})}else{ax.children().each(function(l,j){var o=ar(j),p=o.find(".column-mapping > select");p.prop("disabled",true).find("option").remove()})}},ao=function(){var f=ar(this),b=f.val(),a=f.closest(".list-item").find("input[name=idfield]").val();if(b){if(!ai.mappings[aN]){ai.mappings[aN]={}}ai.mappings[aN][b]=a}else{ar.each(ar.map(ai.mappings[aN],function(j,g){return(j===a)?g:null}),function(g,j){delete ai.mappings[aN][j]})}aC()},av=function(f){var a=aR(),b="[id$=_FID],[id$=_CREATED],[id$=_MODIFIED],[id$=_OWNER]";if(f&&f.length){aK=aO(f);ar.tmpl(aP,f).appendTo(ax);ar("tr",ax).filter(b).addClass("sys-field-item");ax.sortable({axis:"y",handle:".sort-handle",cursor:"n-resize",update:am});aQ=ar("#columnsList thead .column-enabled input[type=checkbox]");aJ();aQ.change(function(){aJ(aQ.prop("checked"))});ax.on("change",".column-enabled > input",function(){aJ()}).on("change",".column-mapping > select",ao);ap.prop("checked",a);aF(a);at=true}},ah=function(a){var b;if(a){b=ar.map(a,function(f,g){return ar.extend({name:g},f)});if(a.FID===aI){b.unshift({name:"FID",order:0,enabled:true,alias:null})}b.sort(function(f,g){return f.order-g.order})}return b},aF=function(a){if(a){ar(".sys-field-item",ax).show("fast")}else{ar(".sys-field-item",ax).hide("fast")}aR(a)},aR=function(f){var a,b=/gc_show_sys_fields=(0|1)/;if(f!=null){document.cookie="gc_show_sys_fields="+(f?1:0)}else{a=document.cookie.match(b);if(a&&a.length>1){return !!parseInt(a[1],10)}else{return ap.prop("checked")}}},aM=function(){var a,f,b;if(az){return}for(a=0,f=aS.length;a<f;a++){b=ar("<option/>",{text:aS[a].name,value:a});if(ai&&aS[a].id===ai.id){b.prop("selected",aS[a].id===ai.id);ai=aS[a]}aG.append(b)}},au=function(){if(az){aG.empty().prop("disabled",true);return}return om.rest("forms").done(function(a){aS=a.data;aM();aC()})},ay=function(){var a=parseInt(aG.val(),10);if(a>-1){ai=aS[a]}else{ai=null}aC()},al=function(){at=false;return giscloud.layers.byId(aN,{expand:"columns, form"}).done(function(a){aq=!!(a&&a.useInfoWindow!=="f");ag.attr("checked",aq);ai=a.form;az=user.id.toString()!==a.owner.toString()}).pipe(function(a){ak=a&&a.columns;return ak})},aH=function(){if(fnl&&fnl.layerData){ar.each(fnl.layerData,function(a,b){if(b.data&&(b.data.id===aN)){fnl.layerData[a].data.use_info_window=aq?"t":"f";return false}})}},aE=function(){var b=document.cookie&&document.cookie.match&&document.cookie.match(/\bPHPSESSID=(\w+)\b/i),a=b&&b[1];return om.rest("layers/"+aN+"/forms/"+ai.id,{mappings:ai.mappings[aN]},null,{method:"PUT",secure:true,sessid:a})},aA=function(){var a,b;if(at){aH();if(ai&&ai.id&&ai.mappings){a=ai.id;b=az?ar.Deferred().resolve():aE()}else{a=-1;b=ar.Deferred().resolve()}return ar.when(b,giscloud.layers.update(aN,{form:a,columns:aw(),use_info_window:aq}))}return ar.Deferred().resolve()},af=function(){at=false;if(["raster","tile"].contains(ar("#layertype").val())){return}aB("columnsList").showLoader();aN=ar("#layerid").val();if(!aN){return}ag=ar("#useInfoWindowCheckbox");ag.change(function(){aq=ag.is(":checked")});ap=ar("#displaySysFieldsCheckbox");ap.change(function(){aF(ap.is(":checked"))});ax=ar("#columnsList tbody");aP=ax.template();ax.children().first().remove();aG=ar("#chooseCustomForm").change(ay);al().pipe(ah).done(function(){aB("columnsList").hideLoader()}).done(av).done(au)};CLayerForm.implement({columnsEditor:{initialize:af,save:aA}})}(jQuery,$));var wrkCm=[{header:"ID",dataIndex:"id",dataType:"number",hidden:true},{header:"Owner",dataIndex:"owner",dataType:"number",hidden:true},{header:"Name",dataIndex:"name",dataType:"string",width:187}];var mapCm=[{header:"ID",dataIndex:"id",hidden:true},{header:"Owner",dataIndex:"owner",hidden:true},{header:"Name",dataIndex:"name",width:187}];var gcProjectModul=new Class({Extends:omModule,options:{id:"workspacemodule",position:"left",orientation:"vertical|horizontal",floating:"none|left|right"},initialize:function(b){this.setOptions(this.options,b);gcapp.addEvent("ready",this.appReady.bind(this))},appReady:function(){if(gcapp.isModuleRegistered(gcapp.gclayer)&&!gcapp.isModuleReady(gcapp.gclayer)){this.appReady.delay(50,this);return}if(__FIRSTINIT){this.openLastMap()}else{if(gcapp.gcmap){gcapp.gcmap.addEvent("ready",this.openLastMap.bind(this))}}},domReady:function(){},openLastMap:function(){if(openMapId==-2){}if(user.options&&is_numeric(user.options.DEFAULT_MAP_ID)){this.mapChange(user.options.DEFAULT_MAP_ID)}else{if(is_numeric(openMapId)&&openMapId>=0){this.mapChange(openMapId)}else{if(openMapId==-1){gcmainmenu.showGetStarted();alert(gclang.mmod.no_view_permission)}}}openMapId=null},resize:function(g,f){if(f){this.container.setStyle("height",f);this.tree.setStyle("height",f-70)}},workspaceClick:function(b){workspaceChange(b.row)},newWorkspace:function(){workspaceform=formManager.open({onOverlayClickClose:true,title:gclang.wmod.form_title,width:350,height:200,url:fno.liveSite+"modules_gc/projects/form.php",data:{"new":"yes"},buttons:[{html:gclang.save,click:"saveWorkspace();"},{html:gclang.close,click:"workspaceform.close();"}]});return workspaceform},editWorkspace:function(){if(!(currentWorkspaceID>0)){alert(gclang.wmod.no_selection);return}workspaceform=formManager.open({onOverlayClickClose:true,title:gclang.wmod.form_title,width:350,height:200,url:fno.liveSite+"modules_gc/projects/form.php",data:{workspaceid:currentWorkspaceID},buttons:[{html:gclang.close,click:"workspaceform.close();"}]})},onDuplicateWorkspace:function(b){om.showMessage(b.msg);loadWorkspaces()},duplicateWorkspace:function(){if(!(currentWorkspaceID>0)){alert(gclang.wmod.no_selection);return}fn_workspace.duplicateWorkspace(currentWorkspaceID,onDuplicateWorkspace)},onDeleteWorkspace:function(b){om.showMessage(b.msg);currentWorkspaceID=-1;loadWorkspaces()},deleteWorkspace:function(){if(!(currentWorkspaceID>0)){alert(gclang.wmod.no_selection);return}if(tree.selected.data.owner!=user.id){alert(gclang.wmod.not_owner);return}var g=confirm(gclang.wmod.delete_confirm.replace("__WRK_NAME__",tree.selected.data.name));if(g==true){var f=fn.getMap();if(f&&f.wid==tree.selected.data.id){currentMapID=-1;fnl.removeLayers();fn.setMap("")}fn_workspace.deletew(currentWorkspaceID,onDeleteWorkspace)}},onloadWorkspaces:function(l){wrkTbl.setData({data:l});if(lastWorkspaceRow>=0){var g=fn_workspace.getWorkspaceData(lastWorkspaceRow);if(g){fn.setWorkspace(g)}}else{fn.setWorkspace(null)}if(openWorkspaceId){var j=fn_workspace.getWorkspaceIndexById(openWorkspaceId);openWorkspaceId=null;if(j>=0){workspaceChange(j)}else{if(fn_workspace.getWorkspacesNum()==1){workspaceChange(0)}}}},treeDblClick:function(b){if(b.data.type==1){}else{if(b.data.type==2){}}},treeClick:function(l){var j=$("projecttree");var o=l.div.main.getPosition().y-j.getPosition().y-j.getSize().y+20;var p=j.getScroll().y;if(p<o){j.scrollTo(0,o)}if(l.data.type==1){currentWorkspaceID=l.data.id;this.setMapPrivileges(null);if($("workspaceauxmenu")){if(l.data.owner==user.id){$("workspaceauxmenu").show()}else{$("workspaceauxmenu").hide()}}if($("mapauxmenu")){$("mapauxmenu").hide()}}else{if(l.data.type==2){this.mapChange(l.data.id)}}},onTreeDataComplete:function(C){if(!C||!C.result||C.result=="no"){if(C.msg){alert(C.msg)}return}$("projecttree").hideLoader();var B=0;for(var z=0;z<C.data.length;z++){var E=C.data[z];if(E.shared!=0){continue}if(!B){B=tree.insert({text:"Private"})}var j=B.insert({text:E.name,id:"w"+E.id,data:E});for(var D=0;D<E.tables.length;D++){var u=E.tables[D];u.workspace=j;var F="map.png";if(u.owner!=user.id&&user.id!=-1){F="map-shared.png"}j.insert({text:u.name,id:"m"+u.id,icon:"/images/icons/"+F,data:u})}}var B=0;for(var z=0;z<C.data.length;z++){var E=C.data[z];if(E.shared==0||E.direct_share==0){continue}if(!B){B=tree.insert({text:"Shared"})}var j=B.insert({text:E.name,id:"w"+E.id,data:E});for(var D=0;D<E.tables.length;D++){var u=E.tables[D];if(u.shared==0||u.direct_share==0){continue}u.workspace=j;var F="map.png";if(u.owner!=user.id&&user.id!=-1){F="map-shared.png"}j.insert({text:u.name,id:"m"+u.id,icon:"/images/icons/"+F,data:u})}}var B=0;for(var z=0;z<C.data.length;z++){var E=C.data[z];if(E.shared==0||E.direct_share!=0){continue}if(!B){B=tree.insert({text:"Public"})}var j=B.insert({text:E.name,id:"w"+E.id,data:E});for(var D=0;D<E.tables.length;D++){var u=E.tables[D];if(u.shared==0||u.direct_share!=0){continue}u.workspace=j;var F="map.png";if(u.owner!=user.id&&user.id!=-1){F="map-shared.png"}j.insert({text:u.name,id:"m"+u.id,icon:"/images/icons/"+F,data:u})}}tree.expand();if(selectedSafeID){tree.select(tree.get("m"+selectedSafeID));selectedSafeID=null;return}},loadWorkspaces:function(g,f){if(g){selectedSafeID=currentMapID}tree.clear();$("projecttree").showLoader();fn_workspace.treeList(null,f)},openInMapViewer:function(b){window.open(fn.getViewerPermalink())},exportMap:function(b){if(!currentMapID){alert(gclang.mmod.no_selection);return}if(!gcapp.gcmap.proj_src){om.showMessage("You have to define map projection in the 'Map properties' form first to use this feature.");return}formManager.close("expf");this.exportmapform=formManager.open({fid:"expf",overlay:false,minimize:true,dragable:true,title:gclang.expmapfrm.title,width:580,height:350,url:fno.liveSite+"modules_gc/report/form_report.php",data:{mid:currentMapID},buttons:[{html:"Close",click:"gcproject.exportmapform.close();"}]});return this.exportmapform},mapClick:function(b){this.mapChange(b.row)},isMapAccessibleByPlan:function(j,l){if(user.active_subscription&&user.active_subscription.type==10&&j.owner!=user.id&&(l||j.share=="f")){var g=true;jQuery.each(j.owner_subscriptions||j.owner.subscriptions,function(b,a){if(a.app_instance_id==fno.gcinit_editor_id){if(a.type!=10){return g=false}}});return g}return true},setMapPrivileges:function(g){if(g&&(g.edit=="t"||g.owner==user.id)){if($("mapauxmenu")){$("mapauxmenu").show()}if(gcapp.ribbonMenu&&fno.gcinit_auth.logged>0){gcapp.ribbonMenu.tabs.enableTab(3)}var f=this.isMapAccessibleByPlan(g,true);if(gcapp.gctoolbar){gcapp.gctoolbar.options.edit=f}editable=f}else{if($("mapauxmenu")){$("mapauxmenu").hide()}if(gcapp.ribbonMenu&&fno.gcinit_auth.logged>0){gcapp.ribbonMenu.tabs.disableTab(3,gclang.mmod.no_edit_permission)}if(gcapp.gctoolbar){gcapp.gctoolbar.options.edit=false}editable=false}},onMapChangeGetData:function(o){if(gcapp.gclayer&&gcapp.gclayer.llist){gcapp.gclayer.llist.hideLoader()}gcapp.setAppState(true);if(!o){om.showMessage("Error: no map data");return}if(o.result=="no"){return}var r=this.isMapAccessibleByPlan(o);if(!r){mapNotAllowed();gcapp.ribbonMenu.tabs.showTab(0);return}this.setMapPrivileges(o);currentMapID=o.mid;if(gcapp.gcsearch&&gcapp.gcsearch.clearSearchResult){gcapp.gcsearch.clearSearchResult()}if(gcapp.selo&&gcapp.selo.hideInfoTable){gcapp.selo.hideInfoTable()}fnm.selection=null;fn.setMap(o);if(fno.gcinit_fleetmanagement){for(var u=0;u<o.layers.length;u++){var l=o.layers[u];if(l.data.tip=="fleet"){gcapp.gcfleetlayer=new gcFleetLayer({lid:l.data.id,source:l.data.source})}}}fnl.setData(o.layers);if(o.cache!="yes"){fn.unloadMap();om.showError("There was an error creating cache.");return}if(fno.gcinit_mobile&&!isNaN(fno.gcinit_dynamicRefreshInterval)&&fno.gcinit_dynamicRefreshInterval>0){if(o.dynamic_layer=="t"&&((fno.viewerSite!==fno.liveSite)||user.options.GISCLOUD_EDITOR)&&!user.options.MAP_NO_AUTO_REFRESH){$clear(dynamicLayerIntID);dynamicLayerIntID=this.dynamicLayerRefresh.periodical(fno.gcinit_dynamicRefreshInterval*1000)}}if(gcapp.gctoolbar){if(flashnavigator.html5){gcapp.gctoolbar.setTool("InfoTool")}else{gcapp.gctoolbar.setTool("DragTool")}}gcapp.bookmarks.byMapId(currentMapID,editable);if(fno.gcinit_auth.type>0){Cookie.write("giscloud_last_mid",currentMapID)}this.showMap(true);if(o.options&&o.options.DEFAULT_SELECTED_LAYER_ID){gcapp.gclayer.llist.setSelection([o.options.DEFAULT_SELECTED_LAYER_ID])}else{if(gcapp.options.saveState){var p=localStorage["giscloud-last-selected-layer"+currentMapID];if(gcapp.gclayer&&gcapp.gclayer.llist){gcapp.gclayer.llist.setSelection([p])}}}this.fireEvent("getmapdata",{target:this,mapdata:o,mid:currentMapID});giscloud.log.push("map_opened",{mid:currentMapID,name:o.name,html5:flashnavigator.html5})},mapChange:function(g,f){if(!gcapp.gcmap){return}$clear(dynamicLayerIntID);this.unloadProject();this.fireEvent("mapchange",{target:this,mid:g,rememberLayerSelection:f});giscloud.log.push("map_open",{mid:g});fnm.getMapDataByID(g,this.onMapChangeGetData.bind(this))},onReload:function(g,f){if(!g){om.showMessage("Error: no map data");return}if(g.result=="no"){return}currentMapID=g.mid;fn.setMap(g);fnl.setData(g.layers);if(g.cache!="yes"){gcapp.gcmap.unload();om.showError("There was an error creating cache.");return}this.showMap(true,false,f)},reload:function(z,u,r,o,p){if(!currentMapID){return}if(r){formManager.closeAll()}if(u){if(gcapp.gclayer&&gcapp.gclayer.llist){fnl.lastSelection=gcapp.gclayer.llist.getSelection()}}if(!z){if(gcapp.gclayer&&gcapp.gclayer.llist){gcapp.gclayer.llist.showLoader()}}var B=this;fnm.getMapDataByID(currentMapID,function(a){B.onReload(a,p);if(is_numeric(o)){if(gcapp.gclayer&&gcapp.gclayer.llist){gcapp.gclayer.llist.setSelection([o]);gcapp.gclayer.llist.zoomToLayer()}}})},refreshMap:function(b){giscloud.log.push("map_refresh",{mid:currentMapID});this.showMap(false,false,b)},showMap:function(j,g,l){fn.showMap(l);if(!j){gcapp.gclayer.loadLayerList(g)}},dynamicLayerRefresh:function(){if(fnm.isVisible()){fn.showMap()}},showProjectsWindow:function(){gcapp.ribbonMenu.tabs.showTab(0)},newMap:function(){if(user.id==-1){if(confirm("To create a new map you would need a free account. Do you want to sign-up now?")){window.location.href="/sign-up"}return}formManager.close("projectform");mapform=formManager.open({fid:"projectform",bootstrap:true,title:gclang.mmod.form_title_new,overlay:true,shadow:true,width:580,height:380,url:fno.liveSite+"map/form?new=yes",buttons:[{html:gclang.save,"class":"bluebutton",click:"saveMap(false);"},{html:gclang.close,click:"mapform.close();"}]});return mapform},hasOpenProject:function(){return(currentMapID!=null&&currentMapID!=-1&&currentMapID>=0)},unloadProject:function(){var b;if(gcapp.gctoolbar){if(flashnavigator.html5){gcapp.gctoolbar.setTool("InfoTool")}else{gcapp.gctoolbar.setTool("DragTool")}}if(gcapp.gcmap.marker&&gcapp.gcmap.marker.clear){gcapp.gcmap.marker.clear()}currentMapID=null;fn.unloadModule("main");fnl.removeLayers();gcproject.setMapPrivileges();formManager.closeAll();fn.setMap(null);if(gcapp.gcmap){gcapp.gcmap.unload()}if(gcapp.gcsearch){gcapp.gcsearch.clearSearchBt()}if(gcdatagrid){gcdatagrid.removeAll(true)}gcapp.setAppState(0)},onDeleteMap:function(b){if(b.result=="yes"){om.showConfirm(b.msg);om.hideLoader();gcapp.loadHomeWorkspace();this.unloadProject()}else{om.showError(b.msg)}},deleteMap:function(){if(!editable){alert(gclang.mmod.no_edit_permission);return}var f=fn.getMap();if(!f){alert(gclang.mmod.no_selection);return}if(f.owner!=user.id){var g=confirm(gclang.mmod.delete_not_owner.replace("__MAP_NAME__",f.name))}else{var g=confirm(gclang.mmod.delete_confirm.replace("__MAP_NAME__",f.name))}if(g==true){fnm.deleteMap(f.mid,this.onDeleteMap.bind(this))}},onloadMapList:function(l){if(!l){return}mapTbl.setData({data:l});if(currentMapID>=0){var j=fnm.getMapDataByID(currentMapID);if(j){fn.setMap(j)}}else{fn.setMap(null)}om.hideLoader();if(openMapId){var g=fnm.getMapIndexByID(openMapId);openMapId=null;if(g>=0){this.mapChange(g)}else{if(fnm.getMapsNum()){this.mapChange(0)}}}else{if(l.length==1){this.mapChange(0)}}},loadMapList:function(){loadWorkspaces(true)}});if(fno.gcinit_auth.type>0){gcProjectModul.prototype.editMap=function(f){var g=(f>=0)?f:currentMapID;if(!g){return}if(!editable){alert(gclang.mmod.no_edit_permission);return}buttons=new Array();buttons.push({html:gclang.save,"class":"bluebutton",click:"saveMap(false);"});buttons.push({html:gclang.close,click:"mapform.close();"});formManager.close("projectform");mapform=formManager.open({fid:"projectform",bootstrap:true,title:gclang.mmod.form_title_edit,overlay:false,dragable:true,width:580,height:440,url:fno.liveSite+"map/form?mapid="+g,buttons:buttons})};gcProjectModul.prototype.onDuplicateMap=function(b){om.showMessage(b.msg);if(b.result=="yes"&&b.newmid){openMapId=b.newmid;gcapp.loadHomeWorkspace();formManager.closeAll();this.mapChange(b.newmid)}};gcProjectModul.prototype.duplicateMap=function(){if(!editable){alert(gclang.mmod.no_edit_permission);return}var f=fn.getMap();if(!f){alert(gclang.mmod.no_selection);return}if(f.owner!=user.id){alert("Only map owner can duplicate the map.");return}else{var g=confirm(gclang.mmod.duplicate_confirm.replace("__MAP_NAME__",f.name))}if(g==true){fnm.duplicateMap(f.mid,this.onDuplicateMap.bind(this))}};gcProjectModul.prototype.isProjectOpen=function(){return(fnm.isVisible()&&currentMapID&&fn.getMap())};gcProjectModul.prototype.sharingAndPublishMap=function(f){if(!this.isProjectOpen()){alert(gclang.mmod.no_selection);return}var g=fn.getMap();mapsharingform=formManager.open({fid:"mapsharingform",overlay:false,dragable:true,title:gclang.mmod.form_shareandpublish_title,width:650,height:430,url:fno.liveSite+"map/formsharing?"+Hash.toQueryString({mid:currentMapID,bound:fnw.getViewBound(),proj4:g.proj4,basic_sharing:f?"yes":"no"}),buttons:[{html:gclang.close,click:"mapsharingform.close();"}]})};gcProjectModul.prototype.onCropToSelectedArea=function(b){if(b&&b.msg){om.showMessage(b.msg)}if(b.result=="yes"){removeAreaSelectionGeometry();gcapp.gclayer.loadLayerList();gcapp.gcmap.reloadMap()}};gcProjectModul.prototype.cropToSelectedArea=function(){gcapp.gctoolbar.setTool("crop")}}var selectedSafeID=null;var currentMapID=-1;var acancel=null;var clearSearchResult=null;var editable=false;var dynamicLayerIntID=null;var currentWorkspaceID=-1;var gcproject;gcproject=new gcProjectModul();gcapp.addEvent("domready",function(){this.signupcombo=new omniCombo("signupcombo",{side:"right",shadow:true,disableMenu:true,padding:20});if(!fno.mobilephone){this.signupcombo.addEvent("open",function(){(function(){jQuery("#username").focus().val("")}).delay(50)})}});function mapNotAllowed(){window.modal_map_not_allowed=giscloud.ui.modal({title:"Action not allowed",content:"<p class='lead' >Free subscription plan does not allow to work with maps created by the premium users. Please upgrade your subscription plan.</p><p class='text-center'><button class='btn btn-primary' onclick='window.modal_map_not_allowed.modal(\"hide\"); showSubscription(); return false;' >Upgrade subscription</button></p>",overlay:false})}function openDocsWindow(){var b=window.open(fno.gcinit_docs_url,"gc_win","menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");b.focus()}function showWelcomeVideo(){if(user.options.GISCLOUD_EDITOR){giscloud.ui.modal({title:"It's easy to get started",url:"/page/get_started_editor"}).on("hide",function(){jQuery("#myModal").remove()})}}function showAboutForm(b){formManager.close("abtf");aboutform=formManager.open({fid:"abtf",dragable:true,title:gclang.mainmenu.support_about,width:400,height:250,url:fno.liveSite+"modules_gc/about/about.php"})}function showFeedbackForm(){if(gcapp.loginform){gcapp.feedbackform.close()}formManager.closeAll();gcapp.feedbackform=formManager.open({overlay:true,shadow:true,dragable:false,title:"Please give us your feedback",width:590,height:390,url:fno.liveSite+"modules_gc/users/feedback_form.php",buttons:[{html:"Send Us Feedback!","class":"bluebutton",click:"gcfeedback.send()"},{html:gclang.close,click:"gcapp.feedbackform.close()"}]});return false}function showWelcomeForm(){if(user.owner_id&&user.owner_id!=user.id){formManager.fullpage({id:"no_subscription",url:"/page/no_subscription"});return}formManager.fullpage({id:"welcomescreen",url:"/page/welcome_editor"});return;window.welcomeform=formManager.open({url:"/modules_gc/about/welcome.php",overlay:true,shadow:true,width:530,height:user.options.FREE_BETA?450:480,noescape:true,noclosebutton:true,stayopen:true,title:"Welcome to GIS Cloud!",fid:"welcomenotification"})}function showChooseSubscriptionForm(){if(user.owner_id&&user.owner_id!=user.id){formManager.fullpage({id:"no_subscription",url:"/page/no_subscription"});return}if(fno.viewerSite===fno.liveSite){formManager.fullpage({id:"subscription_choose",url:"/page/welcome_viewer"})}else{formManager.fullpage({id:"subscription_choose",url:"/page/choosesubscription"})}return;window.choosesubscriptionform=formManager.open({url:"/modules_gc/about/choosesubscription.php",overlay:true,stayopen:true,shadow:true,width:user.options.FREE_BETA?370:430,height:user.options.FREE_BETA?210:480,noescape:true,noclosebutton:true,title:"GIS Cloud Subscription",fid:"choosesubscription"})}function showSubscription(){formManager.closeFullpage("subscription");formManager.fullpage({id:"subscription",url:"/page/subscription",closeButton:true})}function showSubscriptionEndedForm(){if(user.owner_id&&user.owner_id!=user.id){formManager.fullpage({id:"no_subscription",url:"/page/no_subscription?ended=yes"});return}formManager.fullpage({id:"subscription_ended",url:"/modules_gc/about/subscriptionended.php"});return;window.subscriptionendedform=formManager.open({url:"/modules_gc/about/subscriptionended.php",overlay:true,shadow:true,stayopen:true,width:490,height:300,noescape:true,noclosebutton:true,title:"GIS Cloud Subscription has ended",fid:"subscriptionended"})}function logIn(){om.gaq("user","login",$("username").value)}function logSubmit(){logOut()}function logOut(){var b=jQuery('<form id="login_form" action="'+window.location.href+'" method="post" ><input type="hidden" name="logreq" onclick="logOut();"  value="logout" /></form>');jQuery("body").append(b);b.submit();om.gaq("user","logout",user.id)}function forgotPasswordClick(){if(gcapp.loginform){gcapp.forgotpasswordform.close()}formManager.closeAll();gcapp.forgotpasswordform=formManager.open({bootstrap:true,overlay:true,shadow:true,dragable:false,title:"Forgot Your Password?",width:400,height:230,url:fno.liveSite+"modules_gc/users/forgot_password_form.php",buttons:[{html:gclang.close,click:"gcapp.forgotpasswordform.close()"}]});return false}function showRegistrationForm(){return giscloud.ui.modal({title:"Registration",url:"/registration/form"})}var loginform;function showLoginForm(){formManager.closeAll();q="";if(gcBadLogin){q="?badlogin=yes"}else{if(gcBadSite){q+="?badsite=yes"}else{if(gcDisabledApp){q+="?disabled_app=yes"}}}if(q){q+="&"}else{q="?"}q+="&redirect="+window.location.pathname;loginform=formManager.open({bootstrap:true,overlay:true,shadow:true,stayopen:true,dragable:false,title:"Sign In",width:270,height:330,url:fno.liveSite+"user/login_form"+q,buttons:[{html:gclang.close,click:"loginform.close()"}]});return false}function showMapNotAllowedMessage(){formManager.closeAll();gcapp.mapnotallowedform=formManager.showWindow({overlay:true,shadow:true,dragable:false,title:"You need permission to access this map.",width:300,height:130,text:"You don't have permission to access this map. You can request access from the owner or choose a different account.",buttons:[{html:gclang.close,click:"gcapp.mapnotallowedform.close()"}]});return false}(function(j,g,l){giscloud.date={daysInMonth:function(a,b){return new Date(b,a,0).getDate()},getTimelineDateIndex:function(b,p){var f=0,a=false;g(b).each(function(){if(a){return}var o=this;var B=o.options;for(var z=0;z<B.length;z++){if(p==B[z].value){a=true;break}f++}});return f},generateTimeline:function(a,b,z,u){var B=[],z=z||1;var f=parseInt(new Date()/1000);g(a).each(function(){var J=this;var G={label:J,options:[]};B.push(G);for(var o=1;o<=12;o++){var I=parseInt(+new Date(J,o-1)/1000);if(b){var H=giscloud.date.daysInMonth(o,J),p=Math.floor(H/z);for(var r=1;r<=H;r+=z){var I=parseInt(+new Date(J,o-1,r)/1000);if(u&&I>f){return B}G.options.push({value:I,text:r+"/"+o+"/"+J.toString().substr(2)})}}else{G.options.push({value:I,text:o+"/"+J.toString().substr(2)})}}});return B}}})(window,jQuery);if(fno.gcinit_auth.logged){function showUsers(){$("pageWrapper").load(fno.liveSite+"admin/users",{})}var rolesform;function showRoles(){$("pageWrapper").load(fno.liveSite+"role/form",{});return;rolesform=formManager.open({title:"Roles Management",width:400,height:450,url:fno.liveSite+"/role/form",buttons:[{html:gclang.close,click:"rolesform.close()"}]});return rolesform}var geocodingform;function showGeocoding(){geocodingform=formManager.open({fid:"geocodingform",oneInstance:true,stayopen:true,title:gclang.Geocoding_Wizard,width:700,height:user.options.GEOCODER_FORM_HEIGHT?user.options.GEOCODER_FORM_HEIGHT:540,minimize:true,url:fno.liveSite+"geocoding/geocoder/form",buttons:[{html:gclang.close,click:"geocodingform.close()"}]});return geocodingform}var agentmoduleform;function showAgentModule(){agentmoduleform=formManager.open({donotregister:true,overlay:false,dragable:true,title:"Agent Module",width:450,height:300,url:fno.liveSite+"modules_gc/agent/agent_form.php",buttons:[{html:gclang.close,click:"agentmoduleform.close()"}]});return agentmoduleform}var testmoduleform;function showTestModule(){testmoduleform=formManager.open({donotregister:true,overlay:false,dragable:true,title:"GIS Cloud Test Module",width:650,height:750,url:fno.liveSite+"modules_gc/install/form_test.php",buttons:[{html:gclang.close,click:"testmoduleform.close()"}]});return testmoduleform}var settingsform;function showSettings(){formManager.close("sttf");settingsform=formManager.open({fid:"sttf",overlay:false,dragable:true,title:gclang.settings.settings,width:550,height:400,url:fno.liveSite+"modules_gc/settings/settingsform.php",buttons:[{html:gclang.save,click:"saveSettings()"},{html:gclang.close,click:"settingsform.close()"}]});return settingsform}var userform;function myAccount(b){if(user.id==-1){if(confirm("To get an API key you would need a free account. Do you want to sign-up now?")){window.location.href="/sign-up"}return}formManager.close("myaccount");userform=formManager.open({fid:"myaccount",overlay:false,dragable:true,title:"",width:600,height:450,url:fno.liveSite+"user/form?"+(b?"tab="+b:""),buttons:[{html:gclang.save,"class":"bluebutton",click:"saveUser()"},{html:gclang.close,click:"userform.close()"}]});return userform}var formreferences;function referenceManager(){if(formreferences){formreferences.close()}formreferences=formManager.open({title:"Reference Manager",width:400,height:400,url:fno.liveSite+"modules_gc/media/form_references.php",data:{"new":"yes"},buttons:[{html:gclang.Close,click:"formreferences.close();"}],onClose:function(){}})}function fileManager(b){if(user.id==-1){if(confirm("To upload your data you would need a free account. Do you want to sign-up now?")){window.location.href="/sign-up"}return}if(window.ff){window.ff.close()}window.ff=formManager.fileBrowser({upload:true,showpostgis:false,multipleSelection:true,extensions:gcFileExt.AAll,open_upload_form:b});if(b){window.ff.container.hide()}}var dbmanagerform;function databaseManager(){formManager.close("dbf");dbmanagerform=formManager.open({fid:"dbf",minimize:true,overlay:false,dragable:true,title:gclang.dbman.header,width:800,height:620,url:fno.liveSite+"filemanager/form_database_manager",buttons:[{html:gclang.close,click:"dbmanagerform.close()"}]})}function openEditStructureForm(o,r,u){if(u){var l=["shp","dbf"],p=getFileExtension(r);if(jQuery.inArray(p,l)==-1){alert("At the moment only ESRI Shapefile format is supported.");return}}window.db_editstructure_form=formManager.open({overlay:false,minimize:true,dragable:true,title:"'"+o+"' "+gclang.dbman.edit_structure,width:500,height:600,url:fno.liveSite+"datasource/form_columns",fdata:{source:r},buttons:[{html:gclang.Close,click:"db_editstructure_form.close()"}]})}var dsmanagerform;function datasourceManager(){formManager.close("dsf");dsmanagerform=formManager.open({fid:"dsf",overlay:false,dragable:true,title:"Datasource Manager",width:800,height:500,url:fno.liveSite+"datasource/form_manager",buttons:[{html:gclang.close,click:"dsmanagerform.close()"}]})}var apollobrowserform;function apolloSourceBrowser(b){formManager.closeAll();apollobrowserform=formManager.open({fid:"apollobrowserform",overlay:false,dragable:true,fdata:{dsid:b,width:783,results_height:320},title:"ERDAS APOLLO Browser",minimize:true,width:800,height:500,url:fno.liveSite+"datasource/browser_apollo",buttons:[{html:gclang.close,click:"apollobrowserform.close()"}]})}var apolloprocessingform;function apolloProcessing(){formManager.closeAll();apolloprocessingform=formManager.open({fid:"apolloprocessingform",overlay:false,dragable:true,fdata:{},title:"Apollo Processing",minimize:true,width:800,height:500,url:fno.liveSite+"datasource/processing_apollo",buttons:[{html:gclang.close,click:"apolloprocessingform.close()"}]})}function cloudManager(){fn.loadModule("main",{url:fno.liveSite+"modules_gc/cloud/form_cloud_manager.php"})}var wmsform;function wmsServer(b){formManager.close("wmsf");wmsform=formManager.open({fid:"wmsf",overlay:false,dragable:true,title:gclang.wmsfrm.title,width:580,height:180,url:fno.liveSite+"modules_gc/map/forms/form_wms.php",buttons:[{html:"Ok",click:"wmsform.close()"}]});return wmsform}var projectionwizardform;function showProjectionWizard(b){formManager.close("prjf");projectionwizardform=formManager.open({fid:"prjf",dragable:true,title:gclang.reprjfrm.title,width:640,height:340,url:fno.liveSite+"modules_gc/layer/form_projection_wizard.php",data:b});return projectionwizardform}var mergewizardform;function showMergeWizard(){formManager.close("mrgf");mergewizardform=formManager.open({fid:"mrgf",minimize:true,dragable:true,title:gclang.Merge_Wizard,width:640,height:340,url:fno.liveSite+"layer/form_merge_wizard",buttons:[{html:gclang.Merge,"class":"bluebutton",click:"mrgf_module.run();"},{html:gclang.Close,click:"mrgf_module.close();"}]});return mergewizardform}var formsmanagerform;function showFormsManager(){formManager.close("formsmanager");formsmanagerform=formManager.open({fid:"formsmanager",dragable:true,title:gclang.Forms_Manager,width:770,height:510,url:fno.liveSite+"layer/form_forms_manager",buttons:[{html:gclang.Close,click:"formsManagerModule.close();"}]});return formsmanagerform}var addressmodelmanagerform;function showAddressModelManager(){addressmodelmanagerform=formManager.open({fid:"addressmodelmanager",oneInstance:true,dragable:true,title:gclang.Address_Models,width:500,height:510,url:fno.liveSite+"geocoding/geocoder/form_address_model_manager",buttons:[{html:gclang.Close,click:"addressmodelmanagerform.close();"}]});return formsmanagerform}var serverstatisticsform;function mm_serverStatistics(){serverstatisticsform=formManager.open({fid:"prjf",dragable:true,title:"Server Statistics",width:640,height:740,url:fno.liveSite+"modules_gc/cloud/form_server_statistics.php"});return serverstatisticsform}function taskManagerToggle(){PCM.toggle()}}function grab_img(u,p){if(Browser.ie){alert("Sorry but this feature doesn't work on any version of Internet Explorer. You can try using Chrome or Firefox instead.");return}jQuery(".leaflet-control-zoom").hide();var r=jQuery("#repf_canvas_legend").length>0;var o=jQuery("#repf_canvas_legend:checked").length>0?"yes":"no";var l=fn.getMap().name;jQuery("#flashcontent").html2canvas({logging:true,profile:false,useCORS:true,onrendered:function(a){jQuery(".leaflet-control-zoom").show();dataURL=a.toDataURL("image/png");dataURL=dataURL.replace(/^data:image\/(png|jpg);base64,/,"");backendImageHandlerUrl="/modules_gc/report/creport.php?module=report&task=exportimage_canvas&title="+l+"&legend="+o+"&mid="+currentMapID;jQuery.ajax({url:backendImageHandlerUrl,type:"POST",cache:false,dataType:"json",data:{mapimg:dataURL,vie:"yes"}}).success(function(b){if(p){p(b)}else{var f=fno.liveSite+"rest/1/tmp_files/"+b.imgname+"?inline=true";window.open(f)}});return false}})}var omniWMS=new Class({Extends:omModule,options:{url:fno.liveSite+"modules_gc/layer/cwms.php",module:"wms"},initialize:function(g){this.setOptions(this.options,g);var f=this},getWMSBound:function(C,p,D){var B=this.getGlobalBound(C,p?p.boundingbox:null,D);if(!B){if(C=="EPSG:4326"&&p.latlongbound){B=p.latlongbound}else{var u=fno.liveSite+"modules_gc/layer/cwms.php";var r={task:"getboundprojected",module:"wms",latlongbound:p.latlongbound,bound:p.boundingbox,srs:C};om.showLoader("Trying to get WMS layer bounding...");var z=new Request.JSON({url:u,async:false,data:r}).send();om.hideLoader();if(z.response.json.result=="no"){alert("Can't get WMS layer bounding");return}B=z.response.json}}return B},getGlobalBound:function(l,r,p){if(r){for(var o=0;o<r.length;o++){var u=r[o];if(u.srs==l){return u}}}else{if(!p||!p.boundingbox){return null}for(var o=0;o<p.boundingbox.length;o++){var u=p.boundingbox[o];if(u.srs==l||u.crs==l){return u}}}return null}});window.giscloud.wms=new omniWMS();(function(l,j){var g=false;gcapp.bookmarks={byMapId:function(a){giscloud.bookmarks.byMapId(a).done(function(b){if(g){l("#bookmarks_dropdown").gcautocomplete("closeContainer")}var f=[];l.each(b.data,function(r,u){f.push({label:u.name,state:u.state,id:u.id})});l("#bookmarks_dropdown").gcautocomplete({source:f,editable:editable,select:function(u,z){if(z.item.action=="new"){gcapp.bookmarks.create(z.item)}else{var B=z.item.state;gcapp.leaflet.setView(new L.LatLng(B.lat,B.lng),B.zoom)}},remove:function(r,u){gcapp.bookmarks.remove(u.item)},toggleBtn:"#ribb_bookmarks"});g=true})},create:function(a){var f=gcapp.leaflet.getCenter();var b={zoom:gcapp.leaflet.getZoom(),lat:f.lat,lng:f.lng};giscloud.bookmarks.create({name:a.value,map_id:currentMapID,state:JSON.encode(b)}).done(function(p){gcapp.bookmarks.byMapId(currentMapID)})},remove:function(a){if(confirm("Do you really want to delete '"+a.label+"' bookmark?")){giscloud.bookmarks.remove(a.id).done(function(b){om.showConfirm("Bookmark '"+a.label+"' has been deleted.");gcapp.bookmarks.byMapId(currentMapID)})}}}}(giscloud.exposeJQuery()));(function(l,g,j){l(j).bind("keydown","l",function(){gcapp.signupcombo.open()});l(j).bind("keydown","o",function(){logOut()});l(j).bind("keydown","p",function(){gcapp.gctoolbar.setTool("DragTool")});l(j).bind("keydown","i",function(){gcapp.gctoolbar.setTool("InfoTool")});l(j).bind("keydown","z",function(){gcapp.gctoolbar.setTool("SelectAreaTool")});l(j).bind("keydown","ctrl+d",function(){gcapp.gctoolbar.setTool("viewall")});l(j).bind("keydown","c",function(){if(!fno.app_instance_id){gcproject.newMap()}});l(j).bind("keydown","a",function(){if(gcapp.gclayer&&!fno.app_instance_id){gcapp.gclayer.newLayer()}});return;jQuery(j).keypress(function(b){if(!gcapp.isReady()){return}var a=String.fromCharCode(b.which);if(jQuery(b.currentTarget.activeElement).get(0).tagName!=jQuery("body").get(0).tagName||((b.ctrlKey||b.metaKey)&&jQuery.inArray(a,["x","c","v"])!=-1)){return}switch(a){case"l":gcapp.signupcombo.open();break;case"o":logSubmit();break;case"s":if(!fno.app_instance_id){gcproject.sharingAndPublishMap()}break;case"i":gcapp.gctoolbar.setTool("InfoTool");break;case"p":gcapp.gctoolbar.setTool("DragTool");break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(gcapp.homepage&&!fno.app_instance_id){gcapp.homepage.openMapByIndex(a-1)}break;case"h":if(gcapp.homepage&&!fno.app_instance_id){gcapp.loadHomeWorkspace()}break;case"w":if(gcapp.homepage&&!fno.app_instance_id){gcapp.gotoMapView()}break;case"g":if(b.ctrlKey&&currentMapID){fnm.clearMapCache(currentMapID,null,true)}break;case"f":if(!fno.app_instance_id){gcapp.gcsearch.focus()}break;case"c":if(!fno.app_instance_id){gcproject.newMap()}break;case"a":if(gcapp.gclayer&&!fno.app_instance_id){gcapp.gclayer.newLayer()}break}})})(jQuery,window,window.document);(function(j,p,l,o){giscloud.log={push:function(a,b){if(!j.tracker){return}b=b||{};b.name=a;j.tracker.pushEvent(b)}}})(window,jQuery,null,undefined);(function(f){var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};gcApp.utils={format_display_data:function(b,a){var p="";var o='<span class="comment">-</span>';switch(a){case"timestamp":p=gcApp.utils.niceDate(new Date(b*1000),true,true);break;case"period":p=gcApp.utils.nicePeriod(new Date(b*1000));break;case"bool":if(b==1||b=="t"){p='<span style="color:green;">'+gclang.Yes+"</span>"}else{if(b==0||b=="f"){p=gclang.No}else{p=o}}break;case"speed":if(gcApp.utils.isNumber(b)&&b>0){p=b+" [Km/h]"}else{p=o}break;default:if(b){p=b}else{p=o}}return p},nicePeriod:function(a){a=a/1000;h="";m="";s="";day="";retval="";if(a>60){if(a<3600){m=parseInt(a/60)+" min"}else{if(a<86400){h=parseInt(a/3600)+" h";m=parseInt((v%3600)/60)+" min"}else{d=parseInt(a/86400);v0=a;day=d+" dan";if(d>1){day+="a"}if(d==0){day="";a+=" ";h=parseInt((v0%86400)/3600);if(h>0){h=h+" h"}}}}}retval=day+h+m+s;return retval},niceDate:function(C,D,b){var B=["Jan","Feb","Mar","Apr","MayShort","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var a=gclang[B[C.getMonth()]];var z=a;if(b){z+=" "+C.getDate()}z+=", "+C.getFullYear();if(D){var u=C.getMinutes();if(u<10){u="0"+u}z+=" "+C.getHours()+":"+u}return z},isNumber:function(a){return !isNaN(parseFloat(a))&&isFinite(a)},truncateString:function(a,u,r){var b=a.length>u,p=b?a.substr(0,u-1):a;p=r&&b?p.substr(0,p.lastIndexOf(" ")):p;return b?p+"&hellip;":p},formatPrice:function(b,u,r,p){u=!(u>0)?1:u;p=!(p>0)?1:p;r=(p>1)?(p+" "+r+"s"):r;var a=u*b/100;a+=(a==parseInt(a))?".00":"";return"$"+a+" "+(r?("user/"+r):"")},subscribeUser:function(l,b,a){return om.kcall("rest/1/users/"+l+"/subscriptions.json",JSON.encode(b)).success(function(B,F,C){var E=C.getAllResponseHeaders("Location"),j=E&&E.match(/subscriptions\/(\d+)/),D=j[1];if(a){a(D)}}).fail(function(){if(a){a()}})},createProgressBar:function(r,a){var b,p,u;if(a>100){a=100;f("#"+r+":first-child").addClass("bar-danger")}f("#"+r+":first-child").html("<span>"+a+"%</span>");f("#"+r).css("width",a+"%")},getIntVal:function(b,a){var l=parseInt(b,10)||b;if(typeof a==="undefined"){a=0}return(l===0?0:(l||a))},escapeHtml:function(a){return String(a).replace(/[&<>"'\/]/g,function(b){return g[b]})}}})(jQuery);(function(b){b.fn.serializeObject=function(){var a=this,o={},p={},l={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};this.build=function(g,f,j){g[f]=j;return g};this.push_counter=function(f){if(p[f]===undefined){p[f]=0}return p[f]++};b.each(b(this).serializeArray(),function(){if(!l.validate.test(this.name)){return}var f,u=this.name.match(l.key),g=this.value,j=this.name;while((f=u.pop())!==undefined){j=j.replace(new RegExp("\\["+f+"\\]$"),"");if(f.match(l.push)){g=a.build([],a.push_counter(j),g)}else{if(f.match(l.fixed)){g=a.build([],f,g)}else{if(f.match(l.named)){g=a.build({},f,g)}}}}o=b.extend(true,o,g)});return o}})(jQuery);Proj4js={defaultDatum:"WGS84",transform:function(o,j,l){if(!o.readyToUse||!j.readyToUse){this.reportError("Proj4js initialization for "+o.srsCode+" not yet complete");return l}if((o.srsProjNumber=="900913"&&j.datumCode!="WGS84")||(j.srsProjNumber=="900913"&&o.datumCode!="WGS84")){var p=Proj4js.WGS84;this.transform(o,p,l);o=p}if(o.projName=="longlat"){l.x*=Proj4js.common.D2R;l.y*=Proj4js.common.D2R}else{if(o.to_meter){l.x*=o.to_meter;l.y*=o.to_meter}o.inverse(l)}if(o.from_greenwich){l.x+=o.from_greenwich}l=this.datum_transform(o.datum,j.datum,l);if(j.from_greenwich){l.x-=j.from_greenwich}if(j.projName=="longlat"){l.x*=Proj4js.common.R2D;l.y*=Proj4js.common.R2D}else{j.forward(l);if(j.to_meter){l.x/=j.to_meter;l.y/=j.to_meter}}return l},datum_transform:function(l,g,j){if(l.compare_datums(g)){return j}if(l.datum_type==Proj4js.common.PJD_NODATUM||g.datum_type==Proj4js.common.PJD_NODATUM){return j}if(l.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}if(g.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}if(l.es!=g.es||l.a!=g.a||l.datum_type==Proj4js.common.PJD_3PARAM||l.datum_type==Proj4js.common.PJD_7PARAM||g.datum_type==Proj4js.common.PJD_3PARAM||g.datum_type==Proj4js.common.PJD_7PARAM){l.geodetic_to_geocentric(j);if(l.datum_type==Proj4js.common.PJD_3PARAM||l.datum_type==Proj4js.common.PJD_7PARAM){l.geocentric_to_wgs84(j)}if(g.datum_type==Proj4js.common.PJD_3PARAM||g.datum_type==Proj4js.common.PJD_7PARAM){g.geocentric_from_wgs84(j)}g.geocentric_to_geodetic(j)}if(g.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}return j},reportError:function(b){},extend:function(l,o){l=l||{};if(o){for(var p in o){var j=o[p];if(j!==undefined){l[p]=j}}}return l},Class:function(){var j=function(){this.initialize.apply(this,arguments)};var l={};var o;for(var p=0;p<arguments.length;++p){if(typeof arguments[p]=="function"){o=arguments[p].prototype}else{o=arguments[p]}Proj4js.extend(l,o)}j.prototype=l;return j},bind:function(l,g){var j=Array.prototype.slice.apply(arguments,[2]);return function(){var a=j.concat(Array.prototype.slice.apply(arguments,[0]));return l.apply(g,a)}},scriptName:"proj4js-compressed.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath){return this.libPath}var u=this.scriptName;var z=u.length;var r=document.getElementsByTagName("script");for(var B=0;B<r.length;B++){var p=r[B].getAttribute("src");if(p){var o=p.lastIndexOf(u);if((o>-1)&&(o+z==p.length)){this.libPath=p.slice(0,-z);break}}}return this.libPath||""},loadScript:function(r,p,u,o){var l=document.createElement("script");l.defer=false;l.type="text/javascript";l.id=r;l.src=r;l.onload=p;l.onerror=u;l.loadCheck=o;if(/MSIE/.test(navigator.userAgent)){l.onreadystatechange=this.checkReadyState}document.getElementsByTagName("head")[0].appendChild(l)},checkReadyState:function(){if(this.readyState=="loaded"){if(!this.loadCheck()){this.onerror()}else{this.onload()}}}};Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,x0:0,y0:0,initialize:function(l){this.srsCodeInput=l;if(l.indexOf("urn:")==0){var j=l.split(":");if((j[1]=="ogc"||j[1]=="x-ogc")&&(j[2]=="def")&&(j[3]=="crs")){l=j[4]+":"+j[j.length-1]}}else{if(l.indexOf("http://")==0){var g=l.split("#");if(g[0].match(/epsg.org/)){l="EPSG:"+g[1]}else{if(g[0].match(/RIG.xml/)){l="IGNF:"+g[1]}}}}this.srsCode=l.toUpperCase();if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5)}else{if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5)}else{if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4)}else{this.srsAuth="";this.srsProjNumber=this.srsCode}}}this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();return}var b=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(b,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var b=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(b,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName)},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true}else{return false}},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84;this.defsLoaded()},loadProjCode:function(f){if(Proj4js.Proj[f]){this.initTransforms();return}var g=Proj4js.getScriptLocation()+"projCode/"+f+".js";Proj4js.loadScript(g,Proj4js.bind(this.loadProjCodeSuccess,this,f),Proj4js.bind(this.loadProjCodeFailure,this,f),Proj4js.bind(this.checkCodeLoaded,this,f))},loadProjCodeSuccess:function(b){if(Proj4js.Proj[b].dependsOn){this.loadProjCode(Proj4js.Proj[b].dependsOn)}else{this.initTransforms()}},loadProjCodeFailure:function(b){Proj4js.reportError("failed to find projection file for: "+b)},checkCodeLoaded:function(b){if(Proj4js.Proj[b]){return true}else{return false}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=true},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var r,l;if(!this.defData){return}var o=this.defData.split("+");for(var p=0;p<o.length;p++){var u=o[p].split("=");r=u[0].toLowerCase();l=u[1];switch(r.replace(/\s/gi,"")){case"":break;case"title":this.title=l;break;case"proj":this.projName=l.replace(/\s/gi,"");break;case"units":this.units=l.replace(/\s/gi,"");break;case"datum":this.datumCode=l.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=l.replace(/\s/gi,"");break;case"ellps":this.ellps=l.replace(/\s/gi,"");break;case"a":this.a=parseFloat(l);break;case"b":this.b=parseFloat(l);break;case"rf":this.rf=parseFloat(l);break;case"lat_0":this.lat0=l*Proj4js.common.D2R;break;case"lat_1":this.lat1=l*Proj4js.common.D2R;break;case"lat_2":this.lat2=l*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=l*Proj4js.common.D2R;break;case"lon_0":this.long0=l*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(l)*Proj4js.common.D2R;break;case"lonc":this.longc=l*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(l);break;case"y_0":this.y0=parseFloat(l);break;case"k_0":this.k0=parseFloat(l);break;case"k":this.k0=parseFloat(l);break;case"r_a":this.R_A=true;break;case"zone":this.zone=parseInt(l);break;case"south":this.utmSouth=true;break;case"towgs84":this.datum_params=l.split(",");break;case"to_meter":this.to_meter=parseFloat(l);break;case"from_greenwich":this.from_greenwich=l*Proj4js.common.D2R;break;case"pm":l=l.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[l]?Proj4js.PrimeMeridian[l]:parseFloat(l);this.from_greenwich*=Proj4js.common.D2R;break;case"no_defs":break;default:}}this.deriveConstants()},deriveConstants:function(){if(this.nagrids=="@null"){this.datumCode="none"}if(this.datumCode&&this.datumCode!="none"){var g=Proj4js.Datum[this.datumCode];if(g){this.datum_params=g.towgs84?g.towgs84.split(","):null;this.ellps=g.ellipse;this.datumName=g.datumName?g.datumName:this.datumCode}}if(!this.a){var f=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,f)}if(this.rf&&!this.b){this.b=(1-1/this.rf)*this.a}if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;this.b=this.a}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0}this.ep2=(this.a2-this.b2)/this.b2;if(!this.k0){this.k0=1}this.datum=new Proj4js.datum(this)}});Proj4js.Proj.longlat={init:function(){},forward:function(b){return b},inverse:function(b){return b}};Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"];Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"];Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:0.7853981633974483,R2D:57.29577951308232,D2R:0.017453292519943295,SEC_TO_RAD:0.00000484813681109536,EPSLN:1e-10,MAX_ITER:20,COS_67P5:0.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:0.16666666666666666,RA4:0.04722222222222222,RA6:0.022156084656084655,RV4:0.06944444444444445,RV6:0.04243827160493827,msfnz:function(p,j,o){var l=p*j;return o/(Math.sqrt(1-l*l))},tsfnz:function(p,r,u){var o=p*u;var l=0.5*p;o=Math.pow(((1-o)/(1+o)),l);return(Math.tan(0.5*(this.HALF_PI-r))/o)},phi2z:function(r,u){var z=0.5*r;var p,o;var B=this.HALF_PI-2*Math.atan(u);for(i=0;i<=15;i++){p=r*Math.sin(B);o=this.HALF_PI-2*Math.atan(u*(Math.pow(((1-p)/(1+p)),z)))-B;B+=o;if(Math.abs(o)<=1e-10){return B}}alert("phi2z has NoConvergence");return(-9999)},qsfnz:function(l,g){var j;if(l>1e-7){j=l*g;return((1-l*l)*(g/(1-j*j)-(0.5/l)*Math.log((1-j)/(1+j))))}else{return(2*g)}},asinz:function(b){if(Math.abs(b)>1){b=(b>1)?1:-1}return Math.asin(b)},e0fn:function(b){return(1-0.25*b*(1+b/16*(3+1.25*b)))},e1fn:function(b){return(0.375*b*(1+0.25*b*(1+0.46875*b)))},e2fn:function(b){return(0.05859375*b*b*(1+0.75*b))},e3fn:function(b){return(b*b*b*(35/3072))},mlfn:function(p,r,u,l,o){return(p*o-r*Math.sin(2*o)+u*Math.sin(4*o)-l*Math.sin(6*o))},srat:function(g,f){return(Math.pow((1-g)/(1+g),f))},sign:function(b){if(b<0){return(-1)}else{return(1)}},adjust_lon:function(b){b=(Math.abs(b)<this.PI)?b:(b-(this.sign(b)*this.TWO_PI));return b},adjust_lat:function(b){b=(Math.abs(b)<this.HALF_PI)?b:(b-(this.sign(b)*this.PI));return b},latiso:function(o,p,j){if(Math.abs(p)>this.HALF_PI){return +Number.NaN}if(p==this.HALF_PI){return Number.POSITIVE_INFINITY}if(p==-1*this.HALF_PI){return -1*Number.POSITIVE_INFINITY}var l=o*j;return Math.log(Math.tan((this.HALF_PI+p)/2))+o*Math.log((1-l)/(1+l))/2},fL:function(f,g){return 2*Math.atan(f*Math.exp(g))-this.HALF_PI},invlatiso:function(p,u){var l=this.fL(1,u);var r=0;var o=0;do{r=l;o=p*Math.sin(r);l=this.fL(Math.exp(p*Math.log((1+o)/(1-o))/2),u)}while(Math.abs(l-r)>1e-12);return l},sinh:function(g){var f=Math.exp(g);f=(f-1/f)/2;return f},cosh:function(g){var f=Math.exp(g);f=(f+1/f)/2;return f},tanh:function(g){var f=Math.exp(g);f=(f-1/f)/(f+1/f);return f},asinh:function(g){var f=(g>=0?1:-1);return f*(Math.log(Math.abs(g)+Math.sqrt(g*g+1)))},acosh:function(b){return 2*Math.log(Math.sqrt((b+1)/2)+Math.sqrt((b-1)/2))},atanh:function(b){return Math.log((b-1)/(b+1))/2},gN:function(a,l,o){var p=l*o;return a/Math.sqrt(1-p*p)}};Proj4js.datum=Proj4js.Class({initialize:function(f){this.datum_type=Proj4js.common.PJD_WGS84;if(f.datumCode&&f.datumCode=="none"){this.datum_type=Proj4js.common.PJD_NODATUM}if(f&&f.datum_params){for(var g=0;g<f.datum_params.length;g++){f.datum_params[g]=parseFloat(f.datum_params[g])}if(f.datum_params[0]!=0||f.datum_params[1]!=0||f.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM}if(f.datum_params.length>3){if(f.datum_params[3]!=0||f.datum_params[4]!=0||f.datum_params[5]!=0||f.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;f.datum_params[3]*=Proj4js.common.SEC_TO_RAD;f.datum_params[4]*=Proj4js.common.SEC_TO_RAD;f.datum_params[5]*=Proj4js.common.SEC_TO_RAD;f.datum_params[6]=(f.datum_params[6]/1000000)+1}}}if(f){this.a=f.a;this.b=f.b;this.es=f.es;this.ep2=f.ep2;this.datum_params=f.datum_params}},compare_datums:function(b){if(this.datum_type!=b.datum_type){return false}else{if(this.a!=b.a||Math.abs(this.es-b.es)>5e-11){return false}else{if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==b.datum_params[0]&&this.datum_params[1]==b.datum_params[1]&&this.datum_params[2]==b.datum_params[2])}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==b.datum_params[0]&&this.datum_params[1]==b.datum_params[1]&&this.datum_params[2]==b.datum_params[2]&&this.datum_params[3]==b.datum_params[3]&&this.datum_params[4]==b.datum_params[4]&&this.datum_params[5]==b.datum_params[5]&&this.datum_params[6]==b.datum_params[6])}else{if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,"snadgrids").s,pj_param(b.params,"snadgrids").s)==0}else{return true}}}}}},geodetic_to_geocentric:function(J){var D=J.x;var p=J.y;var I=J.z?J.z:0;var H;var M;var N;var K=0;var E;var O;var F;var G;if(p<-Proj4js.common.HALF_PI&&p>-1.001*Proj4js.common.HALF_PI){p=-Proj4js.common.HALF_PI}else{if(p>Proj4js.common.HALF_PI&&p<1.001*Proj4js.common.HALF_PI){p=Proj4js.common.HALF_PI}else{if((p<-Proj4js.common.HALF_PI)||(p>Proj4js.common.HALF_PI)){Proj4js.reportError("geocent:lat out of range:"+p);return null}}}if(D>Proj4js.common.PI){D-=(2*Proj4js.common.PI)}O=Math.sin(p);G=Math.cos(p);F=O*O;E=this.a/(Math.sqrt(1-this.es*F));H=(E+I)*G*Math.cos(D);M=(E+I)*G*Math.sin(D);N=((E*(1-this.es))+I)*O;J.x=H;J.y=M;J.z=N;return K},geocentric_to_geodetic:function(V){var p=1e-12;var T=(p*p);var ai=30;var ae;var af;var an;var ac;var am;var ad;var ag;var P;var R;var U;var Y;var Z;var aj;var S;var ah=V.x;var ak=V.y;var al=V.z?V.z:0;var ab;var W;var aa;aj=false;ae=Math.sqrt(ah*ah+ak*ak);af=Math.sqrt(ah*ah+ak*ak+al*al);if(ae/this.a<p){aj=true;ab=0;if(af/this.a<p){W=Proj4js.common.HALF_PI;aa=-this.b;return}}else{ab=Math.atan2(ak,ah)}an=al/af;ac=ae/af;am=1/Math.sqrt(1-this.es*(2-this.es)*ac*ac);P=ac*(1-this.es)*am;R=an*am;S=0;do{S++;ag=this.a/Math.sqrt(1-this.es*R*R);aa=ae*P+al*R-ag*(1-this.es*R*R);ad=this.es*ag/(ag+aa);am=1/Math.sqrt(1-ad*(2-ad)*ac*ac);U=ac*(1-ad)*am;Y=an*am;Z=Y*P-U*R;P=U;R=Y}while(Z*Z>T&&S<ai);W=Math.atan(Y/Math.abs(U));V.x=ab;V.y=W;V.z=aa;return V},geocentric_to_geodetic_noniter:function(Q){var ae=Q.x;var af=Q.y;var ah=Q.z?Q.z:0;var ab;var R;var Y;var ad;var V;var S;var W;var O;var Z;var U;var p;var ac;var N;var P;var T;var aa;var ag;ae=parseFloat(ae);af=parseFloat(af);ah=parseFloat(ah);ag=false;if(ae!=0){ab=Math.atan2(af,ae)}else{if(af>0){ab=Proj4js.common.HALF_PI}else{if(af<0){ab=-Proj4js.common.HALF_PI}else{ag=true;ab=0;if(ah>0){R=Proj4js.common.HALF_PI}else{if(ah<0){R=-Proj4js.common.HALF_PI}else{R=Proj4js.common.HALF_PI;Y=-this.b;return}}}}}V=ae*ae+af*af;ad=Math.sqrt(V);S=ah*Proj4js.common.AD_C;O=Math.sqrt(S*S+V);U=S/O;ac=ad/O;p=U*U*U;W=ah+this.b*this.ep2*p;aa=ad-this.a*this.es*ac*ac*ac;Z=Math.sqrt(W*W+aa*aa);N=W/Z;P=aa/Z;T=this.a/Math.sqrt(1-this.es*N*N);if(P>=Proj4js.common.COS_67P5){Y=ad/P-T}else{if(P<=-Proj4js.common.COS_67P5){Y=ad/-P-T}else{Y=ah/N+T*(this.es-1)}}if(ag==false){R=Math.atan(N/P)}Q.x=ab;Q.y=R;Q.z=Y;return Q},geocentric_to_wgs84:function(J){if(this.datum_type==Proj4js.common.PJD_3PARAM){J.x+=this.datum_params[0];J.y+=this.datum_params[1];J.z+=this.datum_params[2]}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var E=this.datum_params[0];var G=this.datum_params[1];var M=this.datum_params[2];var F=this.datum_params[3];var I=this.datum_params[4];var p=this.datum_params[5];var D=this.datum_params[6];var H=D*(J.x-p*J.y+I*J.z)+E;var K=D*(p*J.x+J.y-F*J.z)+G;var C=D*(-I*J.x+F*J.y+J.z)+M;J.x=H;J.y=K;J.z=C}}},geocentric_from_wgs84:function(H){if(this.datum_type==Proj4js.common.PJD_3PARAM){H.x-=this.datum_params[0];H.y-=this.datum_params[1];H.z-=this.datum_params[2]}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var D=this.datum_params[0];var G=this.datum_params[1];var I=this.datum_params[2];var E=this.datum_params[3];var C=this.datum_params[4];var M=this.datum_params[5];var p=this.datum_params[6];var F=(H.x-D)/p;var J=(H.y-G)/p;var K=(H.z-I)/p;H.x=F+M*J-C*K;H.y=-M*F+J+E*K;H.z=C*F-E*J+K}}}});Proj4js.Point=Proj4js.Class({initialize:function(l,o,p){if(typeof l=="object"){this.x=l[0];this.y=l[1];this.z=l[2]||0}else{if(typeof l=="string"){var j=l.split(",");this.x=parseFloat(j[0]);this.y=parseFloat(j[1]);this.z=parseFloat(j[2])||0}else{this.x=l;this.y=o;this.z=p||0}}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return("x="+this.x+",y="+this.y)},toShortString:function(){return(this.x+", "+this.y)}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");return}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1)}else{this.ns0=this.con}this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0},forward:function(B){var z=B.x;var D=B.y;this.sin_phi=Math.sin(D);this.cos_phi=Math.cos(D);var p=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi);var C=this.a*Math.sqrt(this.c-this.ns0*p)/this.ns0;var E=this.ns0*Proj4js.common.adjust_lon(z-this.long0);var u=C*Math.sin(E)+this.x0;var F=this.rh-C*Math.cos(E)+this.y0;B.x=u;B.y=F;return B},inverse:function(z){var D,u,p,C,r,B;z.x-=this.x0;z.y=this.rh-z.y+this.y0;if(this.ns0>=0){D=Math.sqrt(z.x*z.x+z.y*z.y);p=1}else{D=-Math.sqrt(z.x*z.x+z.y*z.y);p=-1}C=0;if(D!=0){C=Math.atan2(p*z.x,p*z.y)}p=D*this.ns0/this.a;u=(this.c-p*p)/this.ns0;if(this.e3>=1e-10){p=1-0.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;if(Math.abs(Math.abs(p)-Math.abs(u))>1e-10){B=this.phi1z(this.e3,u)}else{if(u>=0){B=0.5*PI}else{B=-0.5*PI}}}else{B=this.phi1z(e3,u)}r=Proj4js.common.adjust_lon(C/this.ns0+this.long0);z.x=r;z.y=B;return z},phi1z:function(E,z){var r,D,C;var F=Proj4js.common.asinz(0.5*z);if(E<Proj4js.common.EPSLN){return F}var u=E*E;for(var B=1;B<=25;B++){sinphi=Math.sin(F);cosphi=Math.cos(F);r=E*sinphi;D=1-r*r;C=0.5*D*D/cosphi*(z/(1-u)-sinphi/D+0.5/E*Math.log((1-r)/(1+r)));F=F+C;if(Math.abs(C)<=1e-7){return F}}Proj4js.reportError("aea:phi1z:Convergence error");return null}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");return}this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;if(!this.title){this.title="Oblique Stereographic Alternative"}},forward:function(b){b.x=Proj4js.common.adjust_lon(b.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[b]);sinc=Math.sin(b.y);cosc=Math.cos(b.y);cosl=Math.cos(b.x);k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl);b.x=k*cosc*Math.sin(b.x);b.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);b.x=this.a*b.x+this.x0;b.y=this.a*b.y+this.y0;return b},inverse:function(g){var l,j;g.x=(g.x-this.x0)/this.a;g.y=(g.y-this.y0)/this.a;g.x/=this.k0;g.y/=this.k0;if((rho=Math.sqrt(g.x*g.x+g.y*g.y))){c=2*Math.atan2(rho,this.R2);sinc=Math.sin(c);cosc=Math.cos(c);j=Math.asin(cosc*this.sinc0+g.y*sinc*this.cosc0/rho);l=Math.atan2(g.x*sinc,rho*this.cosc0*cosc-g.y*this.sinc0*sinc)}else{j=this.phic0;l=0}g.x=l;g.y=j;Proj4js.Proj.gauss.inverse.apply(this,[g]);g.x=Proj4js.common.adjust_lon(g.x+this.long0);return g}};function phi4z(ac,V,Y,Z,aa,a,M,N,ab){var R,O,Q,P,T,U,W,b,ad,S;ab=a;for(S=1;S<=15;S++){R=Math.sin(ab);tanphi=Math.tan(ab);N=tanphi*Math.sqrt(1-ac*R*R);O=Math.sin(2*ab);P=V*ab-Y*O+Z*Math.sin(4*ab)-aa*Math.sin(6*ab);T=V-2*Y*Math.cos(2*ab)+4*Z*Math.cos(4*ab)-6*aa*Math.cos(6*ab);U=2*P+N*(P*P+M)-2*a*(N*P+1);W=ac*O*(P*P+M-2*a*P)/(2*N);b=2*(a-P)*(N*T-2/O)-2*T;ad=U/(W+b);ab+=ad;if(Math.abs(ad)<=1e-10){return(ab)}}Proj4js.reportError("phi4z: No convergence");return null}function e4fn(j){var g,l;g=1+j;l=1-j;return(Math.sqrt((Math.pow(g,g))*(Math.pow(l,l))))}Proj4js.Proj.poly={init:function(){var b;if(this.lat0=0){this.lat0=90}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(I){var N,G;var p;var K;var H,F;var J;var D,E;var M=I.x;var O=I.y;H=Proj4js.common.adjust_lon(M-this.long0);if(Math.abs(O)<=1e-7){D=this.x0+this.a*H;E=this.y0-this.a*this.ml0}else{N=Math.sin(O);G=Math.cos(O);F=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,O);J=Proj4js.common.msfnz(this.e,N,G);H=N;D=this.x0+this.a*J*Math.sin(H)/N;E=this.y0+this.a*(F-this.ml0+J*(1-Math.cos(H))/N)}I.x=D;I.y=E;return I},inverse:function(I){var D,E;var F;var p;var M;var H,G;var J;var K,b;I.x-=this.x0;I.y-=this.y0;F=this.ml0+I.y/this.a;J=0;if(Math.abs(F)<=1e-7){K=I.x/this.a+this.long0;b=0}else{p=F*F+(I.x/this.a)*(I.x/this.a);J=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,p,M,b);if(J!=1){return(J)}K=Proj4js.common.adjust_lon((Proj4js.common.asinz(I.x*M/this.a)/Math.sin(b))+this.long0)}I.x=K;I.y=b;return I}};Proj4js.Proj.equi={init:function(){if(!this.x0){this.x0=0}if(!this.y0){this.y0=0}if(!this.lat0){this.lat0=0}if(!this.long0){this.long0=0}},forward:function(z){var u=z.x;var B=z.y;var o=Proj4js.common.adjust_lon(u-this.long0);var r=this.x0+this.a*o*Math.cos(this.lat0);var p=this.y0+this.a*B;this.t1=r;this.t2=Math.cos(this.lat0);z.x=r;z.y=p;return z},inverse:function(g){g.x-=this.x0;g.y-=this.y0;var j=g.y/this.a;if(Math.abs(j)>Proj4js.common.HALF_PI){Proj4js.reportError("equi:Inv:DataError")}var l=Proj4js.common.adjust_lon(this.long0+g.x/(this.a*Math.cos(this.lat0)));g.x=l;g.y=j}};Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts)}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts))}}},forward:function(z){var u=z.x;var B=z.y;if(B*Proj4js.common.R2D>90&&B*Proj4js.common.R2D<-90&&u*Proj4js.common.R2D>180&&u*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+u+" : "+B);return null}var r,D;if(Math.abs(Math.abs(B)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");return null}else{if(this.sphere){r=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(u-this.long0);D=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*B))}else{var C=Math.sin(B);var p=Proj4js.common.tsfnz(this.e,B,C);r=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(u-this.long0);D=this.y0-this.a*this.k0*Math.log(p)}z.x=r;z.y=D;return z}},inverse:function(z){var r=z.x-this.x0;var p=z.y-this.y0;var u,B;if(this.sphere){B=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-p/this.a*this.k0))}else{var o=Math.exp(-p/(this.a*this.k0));B=Proj4js.common.phi2z(this.e,o);if(B==-9999){Proj4js.reportError("merc:inverse: lat = -9999");return null}}u=Proj4js.common.adjust_lon(this.long0+r/(this.a*this.k0));z.x=u;z.y=B;return z}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");return}this.lat0=0;this.long0=((6*Math.abs(this.zone))-183)*Proj4js.common.D2R;this.x0=500000;this.y0=this.utmSouth?10000000:0;this.k0=0.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}};Proj4js.Proj.eqdc={init:function(){if(!this.mode){this.mode=0}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(this.mode!=0){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("eqdc:Init:EqualLatitudes")}this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);if(Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN){this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)}else{this.ns=this.sinphi}}else{this.ns=this.sinphi}this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0)},forward:function(D){var B=D.x;var E=D.y;var C=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,E);var F=this.a*(this.g-C);var p=this.ns*Proj4js.common.adjust_lon(B-this.long0);var z=this.x0+F*Math.sin(p);var u=this.y0+this.rh-F*Math.cos(p);D.x=z;D.y=u;return D},inverse:function(B){B.x-=this.x0;B.y=this.rh-B.y+this.y0;var u,D;if(this.ns>=0){var D=Math.sqrt(B.x*B.x+B.y*B.y);var u=1}else{D=-Math.sqrt(B.x*B.x+B.y*B.y);u=-1}var p=0;if(D!=0){p=Math.atan2(u*B.x,u*B.y)}var r=this.g-D/this.a;var C=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3);var z=Proj4js.common.adjust_lon(this.long0+p/this.ns);B.x=z;B.y=C;return B},phi3z:function(E,F,z,B,C){var D;var u;D=E;for(var r=0;r<15;r++){u=(E+z*Math.sin(2*D)-B*Math.sin(4*D)+C*Math.sin(6*D))/F-D;D+=u;if(Math.abs(u)<=1e-10){return D}}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(Q){var S=Q.x;var J=Q.y;var N=Proj4js.common.adjust_lon(S-this.long0);var P;var U,Y;var W=Math.sin(J);var R=Math.cos(J);if(this.sphere){var Z=R*Math.sin(N);if((Math.abs(Math.abs(Z)-1))<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");return(93)}else{U=0.5*this.a*this.k0*Math.log((1+Z)/(1-Z));P=Math.acos(R*Math.cos(N)/Math.sqrt(1-Z*Z));if(J<0){P=-P}Y=this.a*this.k0*(P-this.lat0)}}else{var V=R*N;var p=Math.pow(V,2);var K=this.ep2*Math.pow(R,2);var b=Math.tan(J);var T=Math.pow(b,2);P=1-this.es*Math.pow(W,2);var O=this.a/Math.sqrt(P);var M=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,J);U=this.k0*O*V*(1+p/6*(1-T+K+p/20*(5-18*T+Math.pow(T,2)+72*K-58*this.ep2)))+this.x0;Y=this.k0*(M-this.ml0+O*b*(p*(0.5+p/24*(5-T+9*K+4*Math.pow(K,2)+p/30*(61-58*T+Math.pow(T,2)+600*K-330*this.ep2)))))+this.y0}Q.x=U;Q.y=Y;return Q},inverse:function(ac){var al,an;var g;var Z;var ak=6;var aa,am;if(this.sphere){var V=Math.exp(ac.x/(this.a*this.k0));var W=0.5*(V-1/V);var r=this.lat0+ac.y/(this.a*this.k0);var Y=Math.cos(r);al=Math.sqrt((1-Y*Y)/(1+W*W));aa=Proj4js.common.asinz(al);if(r<0){aa=-aa}if((W==0)&&(Y==0)){am=this.long0}else{am=Proj4js.common.adjust_lon(Math.atan2(W,Y)+this.long0)}}else{var ai=ac.x-this.x0;var aj=ac.y-this.y0;al=(this.ml0+aj/this.k0)/this.a;an=al;for(Z=0;true;Z++){g=((al+this.e1*Math.sin(2*an)-this.e2*Math.sin(4*an)+this.e3*Math.sin(6*an))/this.e0)-an;an+=g;if(Math.abs(g)<=Proj4js.common.EPSLN){break}if(Z>=ak){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");return(95)}}if(Math.abs(an)<Proj4js.common.HALF_PI){var ao=Math.sin(an);var f=Math.cos(an);var ah=Math.tan(an);var p=this.ep2*Math.pow(f,2);var ag=Math.pow(p,2);var af=Math.pow(ah,2);var ap=Math.pow(af,2);al=1-this.es*Math.pow(ao,2);var ab=this.a/Math.sqrt(al);var ae=ab*(1-this.es)/al;var U=ai/(ab*this.k0);var ad=Math.pow(U,2);aa=an-(ab*ah*ad/ae)*(0.5-ad/24*(5+3*af+10*p-4*ag-9*this.ep2-ad/30*(61+90*af+298*p+45*ap-252*this.ep2-3*ag)));am=Proj4js.common.adjust_lon(this.long0+(U*(1-ad/6*(1+2*af+p-ad/20*(5-2*p+28*af-3*ag+8*this.ep2+24*ap)))/f))}else{aa=Proj4js.common.HALF_PI*Proj4js.common.sign(aj);am=this.long0}}ac.x=am;ac.y=aa;return ac}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var l=this.b/this.a;this.e=Math.sqrt(1-l*l);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var p=Math.sin(this.lat0);var j=Math.asin(p/this.rs);var o=Math.sin(j);this.cp=Proj4js.common.latiso(0,j,o)-this.rs*Proj4js.common.latiso(this.e,this.lat0,p);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*p*p);this.xs=this.x0;this.ys=this.y0-this.n2*j;if(!this.title){this.title="Gauss Schreiber transverse mercator"}},forward:function(z){var D=z.x;var B=z.y;var u=this.rs*(D-this.lc);var p=this.cp+(this.rs*Proj4js.common.latiso(this.e,B,Math.sin(B)));var r=Math.asin(Math.sin(u)/Proj4js.common.cosh(p));var C=Proj4js.common.latiso(0,r,Math.sin(r));z.x=this.xs+(this.n2*C);z.y=this.ys+(this.n2*Math.atan(Proj4js.common.sinh(p)/Math.cos(u)));return z},inverse:function(z){var o=z.x;var r=z.y;var p=Math.atan(Proj4js.common.sinh((o-this.xs)/this.n2)/Math.cos((r-this.ys)/this.n2));var u=Math.asin(Math.sin((r-this.ys)/this.n2)/Proj4js.common.cosh((o-this.xs)/this.n2));var B=Proj4js.common.latiso(0,u,Math.sin(u));z.x=this.lc+p/this.rs;z.y=Proj4js.common.invlatiso(this.e,(B-this.cp)/this.rs);return z}};Proj4js.Proj.ortho={init:function(b){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0)},forward:function(H){var K,G;var p;var D;var F;var E;var J=H.x;var g=H.y;p=Proj4js.common.adjust_lon(J-this.long0);K=Math.sin(g);G=Math.cos(g);D=Math.cos(p);E=this.sin_p14*K+this.cos_p14*G*D;F=1;if((E>0)||(Math.abs(E)<=Proj4js.common.EPSLN)){var I=this.a*F*G*Math.sin(p);var M=this.y0+this.a*F*(this.cos_p14*K-this.sin_p14*G*D)}else{Proj4js.reportError("orthoFwdPointError")}H.x=I;H.y=M;return H},inverse:function(F){var z;var B;var D,H;var p;var E;var G,C;F.x-=this.x0;F.y-=this.y0;z=Math.sqrt(F.x*F.x+F.y*F.y);if(z>this.a+1e-7){Proj4js.reportError("orthoInvDataError")}B=Proj4js.common.asinz(z/this.a);D=Math.sin(B);H=Math.cos(B);G=this.long0;if(Math.abs(z)<=Proj4js.common.EPSLN){C=this.lat0}C=Proj4js.common.asinz(H*this.sin_p14+(F.y*D*this.cos_p14)/z);E=Math.abs(lat0)-Proj4js.common.HALF_PI;if(Math.abs(E)<=Proj4js.common.EPSLN){if(this.lat0>=0){G=Proj4js.common.adjust_lon(this.long0+Math.atan2(F.x,-F.y))}else{G=Proj4js.common.adjust_lon(this.long0-Math.atan2(-F.x,F.y))}}E=H-this.sin_p14*Math.sin(C);if((Math.abs(E)>=Proj4js.common.EPSLN)||(Math.abs(x)>=Proj4js.common.EPSLN)){G=Proj4js.common.adjust_lon(this.long0+Math.atan2((F.x*D*this.cos_p14),(E*z)))}F.x=G;F.y=C;return F}};Proj4js.Proj.somerc={init:function(){var p=this.lat0;this.lambda0=this.long0;var u=Math.sin(p);var B=this.a;var C=this.rf;var z=1/C;var D=2*z-Math.pow(z,2);var r=this.e=Math.sqrt(D);this.R=B*Math.sqrt(1-D)/(1-D*Math.pow(u,2));this.alpha=Math.sqrt(1+D/(1-D)*Math.pow(Math.cos(p),4));this.b0=Math.asin(u/this.alpha);this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+p/2))+this.alpha*r/2*Math.log((1+r*u)/(1-r*u))},forward:function(p){var B=Math.log(Math.tan(Math.PI/4-p.y/2));var F=this.e/2*Math.log((1+this.e*Math.sin(p.y))/(1-this.e*Math.sin(p.y)));var D=-this.alpha*(B+F)+this.K;var b=2*(Math.atan(Math.exp(D))-Math.PI/4);var E=this.alpha*(p.x-this.lambda0);var C=Math.atan(Math.sin(E)/(Math.sin(this.b0)*Math.tan(b)+Math.cos(this.b0)*Math.cos(E)));var z=Math.asin(Math.cos(this.b0)*Math.sin(b)-Math.sin(this.b0)*Math.cos(b)*Math.cos(E));p.y=this.R/2*Math.log((1+Math.sin(z))/(1-Math.sin(z)))+this.y0;p.x=this.R*C+this.x0;return p},inverse:function(J){var K=J.x-this.x0;var I=J.y-this.y0;var E=K/this.R;var H=2*(Math.atan(Math.exp(I/this.R))-Math.PI/4);var M=Math.asin(Math.cos(this.b0)*Math.sin(H)+Math.sin(this.b0)*Math.cos(H)*Math.cos(E));var F=Math.atan(Math.sin(E)/(Math.cos(this.b0)*Math.cos(E)-Math.sin(this.b0)*Math.tan(H)));var O=this.lambda0+F/this.alpha;var p=0;var b=M;var N=-1000;var G=0;while(Math.abs(b-N)>1e-7){if(++G>20){Proj4js.reportError("omercFwdInfinity");return}p=1/this.alpha*(Math.log(Math.tan(Math.PI/4+M/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(b))/2));N=b;b=2*Math.atan(Math.exp(p))-Math.PI/2}J.x=O;J.y=b;return J}};Proj4js.Proj.stere={ssfn_:function(j,l,g){l*=g;return(Math.tan(0.5*(Proj4js.common.HALF_PI+j))*Math.pow((1-l)/(1+l),0.5*g))},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var g=Math.abs(this.lat0);if((Math.abs(g)-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE}else{this.mode=g>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT}this.phits=Math.abs(this.phits);if(this.es){var f;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e))}else{g=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,g);g*=this.e;this.akm1/=Math.sqrt(1-g*g)}break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:g=Math.sin(this.lat0);f=2*Math.atan(this.ssfn_(this.lat0,g,this.e))-Proj4js.common.HALF_PI;g*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-g*g);this.sinX1=Math.sin(f);this.cosX1=Math.cos(f);break}}else{switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-0.5*this.phits):2*this.k0;break}}},forward:function(E){var F=E.x;F=Proj4js.common.adjust_lon(F-this.long0);var B=E.y;var H,z;if(this.sphere){var G,D,p,C;G=Math.sin(B);D=Math.cos(B);p=Math.cos(F);C=Math.sin(F);switch(this.mode){case this.EQUIT:z=1+D*p;if(z<=Proj4js.common.EPSLN){F_ERROR}z=this.akm1/z;H=z*D*C;z*=G;break;case this.OBLIQ:z=1+this.sinph0*G+this.cosph0*D*p;if(z<=Proj4js.common.EPSLN){F_ERROR}z=this.akm1/z;H=z*D*C;z*=this.cosph0*G-this.sinph0*D*p;break;case this.N_POLE:p=-p;B=-B;case this.S_POLE:if(Math.abs(B-Proj4js.common.HALF_PI)<this.TOL){F_ERROR}z=this.akm1*Math.tan(Proj4js.common.FORTPI+0.5*B);H=C*z;z*=p;break}}else{p=Math.cos(F);C=Math.sin(F);G=Math.sin(B);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){X=2*Math.atan(this.ssfn_(B,G,this.e));sinX=Math.sin(X-Proj4js.common.HALF_PI);cosX=Math.cos(X)}switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*p));z=A*(this.cosX1*sinX-this.sinX1*cosX*p);H=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*p);z=A*sinX;H=A*cosX;break;case this.S_POLE:B=-B;p=-p;G=-G;case this.N_POLE:H=this.akm1*Proj4js.common.tsfnz(this.e,B,G);z=-H*p;break}H=H*C}E.x=H*this.a+this.x0;E.y=z*this.a+this.y0;return E},inverse:function(Q){var Y=(Q.x-this.x0)/this.a;var J=(Q.y-this.y0)/this.a;var S,K;var M,T,Z=0,P=0,I,N=0,W=0;var p;if(this.sphere){var R,V,O,U;V=Math.sqrt(Y*Y+J*J);R=2*Math.atan(V/this.akm1);O=Math.sin(R);U=Math.cos(R);S=0;switch(this.mode){case this.EQUIT:if(Math.abs(V)<=Proj4js.common.EPSLN){K=0}else{K=Math.asin(J*O/V)}if(U!=0||Y!=0){S=Math.atan2(Y*O,U*V)}break;case this.OBLIQ:if(Math.abs(V)<=Proj4js.common.EPSLN){K=this.phi0}else{K=Math.asin(U*sinph0+J*O*cosph0/V)}R=U-sinph0*Math.sin(K);if(R!=0||Y!=0){S=Math.atan2(Y*O*cosph0,R*V)}break;case this.N_POLE:J=-J;case this.S_POLE:if(Math.abs(V)<=Proj4js.common.EPSLN){K=this.phi0}else{K=Math.asin(this.mode==this.S_POLE?-U:U)}S=(Y==0&&J==0)?0:Math.atan2(Y,J);break}}else{I=Math.sqrt(Y*Y+J*J);switch(this.mode){case this.OBLIQ:case this.EQUIT:Z=2*Math.atan2(I*this.cosX1,this.akm1);M=Math.cos(Z);T=Math.sin(Z);if(I==0){P=Math.asin(M*this.sinX1)}else{P=Math.asin(M*this.sinX1+(J*T*this.cosX1/I))}Z=Math.tan(0.5*(Proj4js.common.HALF_PI+P));Y*=T;J=I*this.cosX1*M-J*this.sinX1*T;W=Proj4js.common.HALF_PI;N=0.5*this.e;break;case this.N_POLE:J=-J;case this.S_POLE:Z=-I/this.akm1;P=Proj4js.common.HALF_PI-2*Math.atan(Z);W=-Proj4js.common.HALF_PI;N=-0.5*this.e;break}for(p=this.NITER;p--;P=K){T=this.e*Math.sin(P);K=2*Math.atan(Z*Math.pow((1+T)/(1-T),N))-W;if(Math.abs(P-K)<this.CONV){if(this.mode==this.S_POLE){K=-K}S=(Y==0&&J==0)?0:Math.atan2(Y,J);Q.x=Proj4js.common.adjust_lon(S+this.long0);Q.y=K;return Q}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array();this.A[1]=+0.6399175073;this.A[2]=-0.1358797613;this.A[3]=+0.063294409;this.A[4]=-0.02526853;this.A[5]=+0.0117879;this.A[6]=-0.0055161;this.A[7]=+0.0026906;this.A[8]=-0.001333;this.A[9]=+0.00067;this.A[10]=-0.00034;this.B_re=new Array();this.B_im=new Array();this.B_re[1]=+0.7557853228;this.B_im[1]=0;this.B_re[2]=+0.249204646;this.B_im[2]=+0.003371507;this.B_re[3]=-0.001541739;this.B_im[3]=+0.04105856;this.B_re[4]=-0.10162907;this.B_im[4]=+0.01727609;this.B_re[5]=-0.26623489;this.B_im[5]=-0.36249218;this.B_re[6]=-0.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array();this.C_im=new Array();this.C_re[1]=+1.3231270439;this.C_im[1]=0;this.C_re[2]=-0.577245789;this.C_im[2]=-0.007809598;this.C_re[3]=+0.508307513;this.C_im[3]=-0.112208952;this.C_re[4]=-0.15094762;this.C_im[4]=+0.18200602;this.C_re[5]=+1.01418179;this.C_im[5]=+1.64497696;this.C_re[6]=+1.9660549;this.C_im[6]=+2.5127645;this.D=new Array();this.D[1]=+1.5627014243;this.D[2]=+0.5185406398;this.D[3]=-0.03333098;this.D[4]=-0.1052906;this.D[5]=-0.0368594;this.D[6]=+0.007317;this.D[7]=+0.0122;this.D[8]=+0.00394;this.D[9]=-0.0013},forward:function(Q){var S=Q.x;var Z=Q.y;var U=Z-this.lat0;var W=S-this.long0;var P=U/Proj4js.common.SEC_TO_RAD*0.00001;var T=W;var K=1;var I=0;for(n=1;n<=10;n++){K=K*P;I=I+this.A[n]*K}var R=I;var N=T;var J=1;var M=0;var V;var O;var Y=0;var p=0;for(n=1;n<=6;n++){V=J*R-M*N;O=M*R+J*N;J=V;M=O;Y=Y+this.B_re[n]*J-this.B_im[n]*M;p=p+this.B_im[n]*J+this.B_re[n]*M}x=(p*this.a)+this.x0;y=(Y*this.a)+this.y0;Q.x=x;Q.y=y;return Q},inverse:function(af){var ai=af.x;var ak=af.y;var aa=ai-this.x0;var ab=ak-this.y0;var al=ab/this.a;var ar=aa/this.a;var aj=1;var p=0;var aq;var W;var ad=0;var aw=0;for(n=1;n<=6;n++){aq=aj*al-p*ar;W=p*al+aj*ar;aj=aq;p=W;ad=ad+this.C_re[n]*aj-this.C_im[n]*p;aw=aw+this.C_im[n]*aj+this.C_re[n]*p}for(i=0;i<this.iterations;i++){var ah=ad;var an=aw;var ac;var ag;var au=al;var Y=ar;for(n=2;n<=6;n++){ac=ah*ad-an*aw;ag=an*ad+ah*aw;ah=ac;an=ag;au=au+(n-1)*(this.B_re[n]*ah-this.B_im[n]*an);Y=Y+(n-1)*(this.B_im[n]*ah+this.B_re[n]*an)}ah=1;an=0;var av=this.B_re[1];var Z=this.B_im[1];for(n=2;n<=6;n++){ac=ah*ad-an*aw;ag=an*ad+ah*aw;ah=ac;an=ag;av=av+n*(this.B_re[n]*ah-this.B_im[n]*an);Z=Z+n*(this.B_im[n]*ah+this.B_re[n]*an)}var at=av*av+Z*Z;ad=(au*av+Y*Z)/at;aw=(Y*av-au*Z)/at}var ae=ad;var am=aw;var V=1;var U=0;for(n=1;n<=9;n++){V=V*ae;U=U+this.D[n]*V}var ao=this.lat0+(U*Proj4js.common.SEC_TO_RAD*100000);var ap=this.long0+am;af.x=ap;af.y=ao;return af}};Proj4js.Proj.mill={init:function(){},forward:function(z){var u=z.x;var B=z.y;var o=Proj4js.common.adjust_lon(u-this.long0);var r=this.x0+this.a*o;var p=this.y0+this.a*Math.log(Math.tan((Proj4js.common.PI/4)+(B/2.5)))*1.25;z.x=r;z.y=p;return z},inverse:function(g){g.x-=this.x0;g.y-=this.y0;var l=Proj4js.common.adjust_lon(this.long0+g.x/this.a);var j=2.5*(Math.atan(Math.exp(0.8*g.y/this.a))-Proj4js.common.PI/4);g.x=l;g.y=j;return g}};Proj4js.Proj.gnom={init:function(b){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1000*this.a},forward:function(D){var G,C;var E;var H;var B;var p;var F=D.x;var g=D.y;E=Proj4js.common.adjust_lon(F-this.long0);G=Math.sin(g);C=Math.cos(g);H=Math.cos(E);p=this.sin_p14*G+this.cos_p14*C*H;B=1;if((p>0)||(Math.abs(p)<=Proj4js.common.EPSLN)){x=this.x0+this.a*B*C*Math.sin(E)/p;y=this.y0+this.a*B*(this.cos_p14*G-this.sin_p14*C*H)/p}else{Proj4js.reportError("orthoFwdPointError");x=this.x0+this.infinity_dist*C*Math.sin(E);y=this.y0+this.infinity_dist*(this.cos_p14*G-this.sin_p14*C*H)}D.x=x;D.y=y;return D},inverse:function(B){var z;var F;var p,E;var D;var u,C;B.x=(B.x-this.x0)/this.a;B.y=(B.y-this.y0)/this.a;B.x/=this.k0;B.y/=this.k0;if((z=Math.sqrt(B.x*B.x+B.y*B.y))){D=Math.atan2(z,this.rc);p=Math.sin(D);E=Math.cos(D);C=Proj4js.common.asinz(E*this.sin_p14+(B.y*p*this.cos_p14)/z);u=Math.atan2(B.x*p,z*this.cos_p14*E-B.y*this.sin_p14*p);u=Proj4js.common.adjust_lon(this.long0+u)}else{C=this.phic0;u=0}B.x=u;B.y=C;return B}};Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(z){var r,p,o;var u=z.x;var B=z.y;o=Proj4js.common.adjust_lon(u-this.long0);r=this.R*o*Math.cos(B)+this.x0;p=this.R*B+this.y0;z.x=r;z.y=p;return z},inverse:function(p){var j,l,o;p.x-=this.x0;p.y-=this.y0;j=p.y/this.R;if(Math.abs(j)>Proj4js.common.HALF_PI){Proj4js.reportError("sinu:Inv:DataError")}l=Math.abs(j)-Proj4js.common.HALF_PI;if(Math.abs(l)>Proj4js.common.EPSLN){l=this.long0+p.x/(this.R*Math.cos(j));o=Proj4js.common.adjust_lon(l)}else{o=this.long0}p.x=o;p.y=j;return p}};Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(O){var R=O.x;var p=O.y;var S=Proj4js.common.adjust_lon(R-this.long0);var U,W;if(Math.abs(p)<=Proj4js.common.EPSLN){U=this.x0+this.R*S;W=this.y0}var M=Proj4js.common.asinz(2*Math.abs(p/Proj4js.common.PI));if((Math.abs(S)<=Proj4js.common.EPSLN)||(Math.abs(Math.abs(p)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)){U=this.x0;if(p>=0){W=this.y0+Proj4js.common.PI*this.R*Math.tan(0.5*M)}else{W=this.y0+Proj4js.common.PI*this.R*-Math.tan(0.5*M)}}var J=0.5*Math.abs((Proj4js.common.PI/S)-(S/Proj4js.common.PI));var N=J*J;var I=Math.sin(M);var P=Math.cos(M);var T=P/(I+P-1);var g=T*T;var K=T*(2/I-1);var V=K*K;var Q=Proj4js.common.PI*this.R*(J*(T-V)+Math.sqrt(N*(T-V)*(T-V)-(V+N)*(g-V)))/(V+N);if(S<0){Q=-Q}U=this.x0+Q;Q=Math.abs(Q/(Proj4js.common.PI*this.R));if(p>=0){W=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-Q*Q-2*J*Q)}else{W=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-Q*Q-2*J*Q)}O.x=U;O.y=W;return O},inverse:function(N){var T;var R,I,U,G,J,K;var S,M;var O;var p;var Q;var H;var P;N.x-=this.x0;N.y-=this.y0;Q=Proj4js.common.PI*this.R;R=N.x/Q;I=N.y/Q;U=R*R+I*I;G=-Math.abs(I)*(1+U);J=G-2*I*I+R*R;K=-2*G+1+2*I*I+U*U;P=I*I/K+(2*J*J*J/K/K/K-9*G*J/K/K)/27;O=(G-J*J/3/K)/K;p=2*Math.sqrt(-O/3);Q=((3*P)/O)/p;if(Math.abs(Q)>1){if(Q>=0){Q=1}else{Q=-1}}H=Math.acos(Q)/3;if(N.y>=0){lat=(-p*Math.cos(H+Proj4js.common.PI/3)-J/3/K)*Proj4js.common.PI}else{lat=-(-p*Math.cos(H+PI/3)-J/3/K)*Proj4js.common.PI}if(Math.abs(R)<Proj4js.common.EPSLN){lon=this.long0}lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(U-1+Math.sqrt(1+2*(R*R-I*I)+U*U))/2/R);N.x=lon;N.y=lat;return N}};Proj4js.Proj.cea={init:function(){},forward:function(u){var r=u.x;var l=u.y;dlon=Proj4js.common.adjust_lon(r-this.long0);var o=this.x0+this.a*dlon*Math.cos(this.lat_ts);var p=this.y0+this.a*Math.sin(l)/Math.cos(this.lat_ts);u.x=o;u.y=p;return u},inverse:function(g){g.x-=this.x0;g.y-=this.y0;var l=Proj4js.common.adjust_lon(this.long0+(g.x/this.a)/Math.cos(this.lat_ts));var j=Math.asin((g.y/this.a)*Math.cos(this.lat_ts));g.x=l;g.y=j;return g}};Proj4js.Proj.eqc={init:function(){if(!this.x0){this.x0=0}if(!this.y0){this.y0=0}if(!this.lat0){this.lat0=0}if(!this.long0){this.long0=0}if(!this.lat_ts){this.lat_ts=0}if(!this.title){this.title="Equidistant Cylindrical (Plate Carre)"}this.rc=Math.cos(this.lat_ts)},forward:function(r){var p=r.x;var u=r.y;var l=Proj4js.common.adjust_lon(p-this.long0);var o=Proj4js.common.adjust_lat(u-this.lat0);r.x=this.x0+(this.a*l*this.rc);r.y=this.y0+(this.a*o);return r},inverse:function(g){var j=g.x;var l=g.y;g.x=Proj4js.common.adjust_lon(this.long0+((j-this.x0)/(this.a*this.rc)));g.y=Proj4js.common.adjust_lat(this.lat0+((l-this.y0)/(this.a)));return g}};Proj4js.Proj.cass={init:function(){if(!this.sphere){this.en=this.pj_enfn(this.es);this.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en)}},C1:0.16666666666666666,C2:0.008333333333333333,C3:0.041666666666666664,C4:0.3333333333333333,C5:0.06666666666666667,forward:function(r){var o,p;var l=r.x;var u=r.y;l=Proj4js.common.adjust_lon(l-this.long0);if(this.sphere){o=Math.asin(Math.cos(u)*Math.sin(l));p=Math.atan2(Math.tan(u),Math.cos(l))-this.phi0}else{this.n=Math.sin(u);this.c=Math.cos(u);p=this.pj_mlfn(u,this.n,this.c,this.en);this.n=1/Math.sqrt(1-this.es*this.n*this.n);this.tn=Math.tan(u);this.t=this.tn*this.tn;this.a1=l*this.c;this.c*=this.es*this.c/(1-this.es);this.a2=this.a1*this.a1;o=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2));p-=this.m0-this.n*this.tn*this.a2*(0.5+(5-this.t+6*this.c)*this.a2*this.C3)}r.x=this.a*o+this.x0;r.y=this.a*p+this.y0;return r},inverse:function(g){g.x-=this.x0;g.y-=this.y0;var j=g.x/this.a;var l=g.y/this.a;if(this.sphere){this.dd=l+this.lat0;phi=Math.asin(Math.sin(this.dd)*Math.cos(j));lam=Math.atan2(Math.tan(j),Math.cos(this.dd))}else{ph1=this.pj_inv_mlfn(this.m0+l,this.es,this.en);this.tn=Math.tan(ph1);this.t=this.tn*this.tn;this.n=Math.sin(ph1);this.r=1/(1-this.es*this.n*this.n);this.n=Math.sqrt(this.r);this.r*=(1-this.es)*this.n;this.dd=j/this.n;this.d2=this.dd*this.dd;phi=ph1-(this.n*this.tn/this.r)*this.d2*(0.5-(1+3*this.t)*this.d2*this.C3);lam=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(ph1)}g.x=Proj4js.common.adjust_lon(this.long0+lam);g.y=phi;return g},pj_enfn:function(f){en=new Array();en[0]=this.C00-f*(this.C02+f*(this.C04+f*(this.C06+f*this.C08)));en[1]=f*(this.C22-f*(this.C04+f*(this.C06+f*this.C08)));var g=f*f;en[2]=g*(this.C44-f*(this.C46+f*this.C48));g*=f;en[3]=g*(this.C66-f*this.C68);en[4]=g*f*this.C88;return en},pj_mlfn:function(o,l,p,j){p*=l;l*=l;return(j[0]*o-p*(j[1]+l*(j[2]+l*(j[3]+l*j[4]))))},pj_inv_mlfn:function(j,l,g){k=1/(1-l);phi=j;for(i=Proj4js.common.MAX_ITER;i;--i){s=Math.sin(phi);t=1-l*s*s;t=(this.pj_mlfn(phi,s,Math.cos(phi),g)-j)*(t*Math.sqrt(t))*k;phi-=t;if(Math.abs(t)<Proj4js.common.EPSLN){return phi}}Proj4js.reportError("cass:pj_inv_mlfn: Convergence error");return phi},C00:1,C02:0.25,C04:0.046875,C06:0.01953125,C08:0.01068115234375,C22:0.75,C44:0.46875,C46:0.013020833333333334,C48:0.007120768229166667,C66:0.3645833333333333,C68:0.005696614583333333,C88:0.3076171875};Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);cphi=Math.cos(this.lat0);cphi*=cphi;this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));this.phic0=Math.asin(sphi/this.C);this.ratexp=0.5*this.C*this.e;this.K=Math.tan(0.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(g){var l=g.x;var j=g.y;g.y=2*Math.atan(this.K*Math.pow(Math.tan(0.5*j+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(j),this.ratexp))-Proj4js.common.HALF_PI;g.x=this.C*l;return g},inverse:function(r){var u=1e-14;var p=r.x/this.C;var l=r.y;num=Math.pow(Math.tan(0.5*l+Proj4js.common.FORTPI)/this.K,1/this.C);for(var o=Proj4js.common.MAX_ITER;o>0;--o){l=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(r.y),-0.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(l-r.y)<u){break}r.y=l}if(!o){Proj4js.reportError("gauss:inverse:convergence failed");return null}r.x=p;r.y=l;return r}};Proj4js.Proj.omerc={init:function(){if(!this.mode){this.mode=0}if(!this.lon1){this.lon1=0;this.mode=1}if(!this.lon2){this.lon2=0}if(!this.lat2){this.lat2=0}var j=this.b/this.a;var l=1-Math.pow(j,2);var g=Math.sqrt(l);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-l);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-l));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;this.d=1;this.el=1}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);if((this.d*this.d-1)>0){if(this.lat0>=0){this.f=this.d+Math.sqrt(this.d*this.d-1)}else{this.f=this.d-Math.sqrt(this.d*this.d-1)}}else{this.f=this.d}this.el=this.f*Math.pow(this.ts,this.bl)}if(this.mode!=0){this.g=0.5*(this.f-1/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if((this.con>Proj4js.common.EPSLN)&&(Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN)){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}}else{Proj4js.reportError("omerc:Init:DataError")}}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=0.5*(this.f-1/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;if(this.dlon<-Proj4js.common.PI){this.lon2=this.lon2-2*Proj4js.common.PI}if(this.dlon>Proj4js.common.PI){this.lon2=this.lon2+2*Proj4js.common.PI}this.dlon=this.lon1-this.lon2;this.longc=0.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(0.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));if(Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError")}else{this.con=Math.abs(this.lat1)}if((this.con<=Proj4js.common.EPSLN)||(Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN)){Proj4js.reportError("omercInitDataError")}else{if(Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError")}}this.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}}},forward:function(W){var aa;var aj,b;var p;var Q,ac,ak;var ah,V,S;var Y,T,R;var ab,U;var Z;var al;var ag;var ai=W.x;var ae=W.y;aj=Math.sin(ae);al=Proj4js.common.adjust_lon(ai-this.longc);R=Math.sin(this.bl*al);if(Math.abs(Math.abs(ae)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){ag=Proj4js.common.tsfnz(this.e,ae,aj);Y=this.el/(Math.pow(ag,this.bl));Z=0.5*(Y-1/Y);ac=0.5*(Y+1/Y);ab=(Z*this.singam-R*this.cosgam)/ac;ah=Math.cos(this.bl*al);if(Math.abs(ah)<1e-7){T=this.al*this.bl*al}else{T=this.al*Math.atan((Z*this.cosgam+R*this.singam)/ah)/this.bl;if(ah<0){T=T+Proj4js.common.PI*this.al/this.bl}}}else{if(ae>=0){ab=this.singam}else{ab=-this.singam}T=this.al*ae/this.bl}if(Math.abs(Math.abs(ab)-1)<=Proj4js.common.EPSLN){Proj4js.reportError("omercFwdInfinity")}U=0.5*this.al*Math.log((1-ab)/(1+ab))/this.bl;T=T-this.u;var ad=this.x0+U*this.cosaz+T*this.sinaz;var af=this.y0+T*this.cosaz-U*this.sinaz;W.x=ad;W.y=af;return W},inverse:function(ab){var b;var ae;var ai;var aj,p;var Q;var T,af,ak;var ah,Z,V;var Y,aa,ac,ad,ag;var U,S,R;var al;var W;ab.x-=this.x0;ab.y-=this.y0;W=0;Y=ab.x*this.cosaz-ab.y*this.sinaz;aa=ab.y*this.cosaz+ab.x*this.sinaz;aa=aa+this.u;ac=Math.exp(-this.bl*Y/this.al);ad=0.5*(ac-1/ac);af=0.5*(ac+1/ac);U=Math.sin(this.bl*aa/this.al);S=(U*this.cosgam+ad*this.singam)/af;if(Math.abs(Math.abs(S)-1)<=Proj4js.common.EPSLN){lon=this.longc;if(S>=0){lat=Proj4js.common.HALF_PI}else{lat=-Proj4js.common.HALF_PI}}else{ah=1/this.bl;ag=Math.pow((this.el/Math.sqrt((1+S)/(1-S))),ah);lat=Proj4js.common.phi2z(this.e,ag);ae=this.longc-Math.atan2((ad*this.cosgam-U*this.singam),ah)/this.bl;lon=Proj4js.common.adjust_lon(ae)}ab.x=lon;ab.y=lat;return ab}};Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0}if(!this.k0){this.k0=1}if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");return}var J=this.b/this.a;this.e=Math.sqrt(1-J*J);var C=Math.sin(this.lat1);var E=Math.cos(this.lat1);var z=Proj4js.common.msfnz(this.e,C,E);var H=Proj4js.common.tsfnz(this.e,this.lat1,C);var D=Math.sin(this.lat2);var F=Math.cos(this.lat2);var B=Proj4js.common.msfnz(this.e,D,F);var I=Proj4js.common.tsfnz(this.e,this.lat2,D);var G=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(z/B)/Math.log(H/I)}else{this.ns=C}this.f0=z/(this.ns*Math.pow(H,this.ns));this.rh=this.a*this.f0*Math.pow(G,this.ns);if(!this.title){this.title="Lambert Conformal Conic"}},forward:function(z){var u=z.x;var B=z.y;if(B<=90&&B>=-90&&u<=180&&u>=-180){}else{Proj4js.reportError("lcc:forward: llInputOutOfRange: "+u+" : "+B);return null}var r=Math.abs(Math.abs(B)-Proj4js.common.HALF_PI);var C,D;if(r>Proj4js.common.EPSLN){C=Proj4js.common.tsfnz(this.e,B,Math.sin(B));D=this.a*this.f0*Math.pow(C,this.ns)}else{r=B*this.ns;if(r<=0){Proj4js.reportError("lcc:forward: No Projection");return null}D=0}var p=this.ns*Proj4js.common.adjust_lon(u-this.long0);z.x=this.k0*(D*Math.sin(p))+this.x0;z.y=this.k0*(this.rh-D*Math.cos(p))+this.y0;return z},inverse:function(z){var D,u,C;var B,r;x=(z.x-this.x0)/this.k0;y=(this.rh-(z.y-this.y0)/this.k0);if(this.ns>0){D=Math.sqrt(x*x+y*y);u=1}else{D=-Math.sqrt(x*x+y*y);u=-1}var p=0;if(D!=0){p=Math.atan2((u*x),(u*y))}if((D!=0)||(this.ns>0)){u=1/this.ns;C=Math.pow((D/(this.a*this.f0)),u);B=Proj4js.common.phi2z(this.e,C);if(B==-9999){return null}}else{B=-Proj4js.common.HALF_PI}r=Proj4js.common.adjust_lon(p/this.ns+this.long0);z.x=r;z.y=B;return z}};Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var g=Math.abs(this.lat0);if(Math.abs(g-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE}else{if(Math.abs(g)<Proj4js.common.EPSLN){this.mode=this.EQUIT}else{this.mode=this.OBLIQ}}if(this.es>0){var f;this.qp=Proj4js.common.qsfnz(this.e,1);this.mmf=0.5/(1-this.es);this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(0.5*this.qp);this.dd=1/this.rq;this.xmf=1;this.ymf=0.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(0.5*this.qp);f=Math.sin(this.lat0);this.sinb1=Proj4js.common.qsfnz(this.e,f)/this.qp;this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1);this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*f*f)*this.rq*this.cosb1);this.ymf=(this.xmf=this.rq)/this.dd;this.xmf*=this.dd;break}}else{if(this.mode==this.OBLIQ){this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0)}}},forward:function(J){var p,G;var Q=J.x;var P=J.y;Q=Proj4js.common.adjust_lon(Q-this.long0);if(this.sphere){var F,H,M;M=Math.sin(P);H=Math.cos(P);F=Math.cos(Q);switch(this.mode){case this.EQUIT:G=(this.mode==this.EQUIT)?1+H*F:1+this.sinph0*M+this.cosph0*H*F;if(G<=Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:y less than eps");return null}G=Math.sqrt(2/G);p=G*H*Math.sin(Q);G*=(this.mode==this.EQUIT)?M:this.cosph0*M-this.sinph0*H*F;break;case this.N_POLE:F=-F;case this.S_POLE:if(Math.abs(P+this.phi0)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:phi < eps");return null}G=Proj4js.common.FORTPI-P*0.5;G=2*((this.mode==this.S_POLE)?Math.cos(G):Math.sin(G));p=G*Math.sin(Q);G*=F;break}}else{var F,b,M,K,I=0,O=0,N=0;F=Math.cos(Q);b=Math.sin(Q);M=Math.sin(P);K=Proj4js.common.qsfnz(this.e,M);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){I=K/this.qp;O=Math.sqrt(1-I*I)}switch(this.mode){case this.OBLIQ:N=1+this.sinb1*I+this.cosb1*O*F;break;case this.EQUIT:N=1+O*F;break;case this.N_POLE:N=Proj4js.common.HALF_PI+P;K=this.qp-K;break;case this.S_POLE:N=P-Proj4js.common.HALF_PI;K=this.qp+K;break}if(Math.abs(N)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:b < eps");return null}switch(this.mode){case this.OBLIQ:case this.EQUIT:N=Math.sqrt(2/N);if(this.mode==this.OBLIQ){G=this.ymf*N*(this.cosb1*I-this.sinb1*O*F)}else{G=(N=Math.sqrt(2/(1+O*F)))*I*this.ymf}p=this.xmf*N*O*b;break;case this.N_POLE:case this.S_POLE:if(K>=0){p=(N=Math.sqrt(K))*b;G=F*((this.mode==this.S_POLE)?N:-N)}else{p=G=0}break}}J.x=this.a*p+this.x0;J.y=this.a*G+this.y0;return J},inverse:function(M){M.x-=this.x0;M.y-=this.y0;var p=M.x/this.a;var G=M.y/this.a;if(this.sphere){var D=0,K,J=0;K=Math.sqrt(p*p+G*G);var H=K*0.5;if(H>1){Proj4js.reportError("laea:Inv:DataError");return null}H=2*Math.asin(H);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){J=Math.sin(H);D=Math.cos(H)}switch(this.mode){case this.EQUIT:H=(Math.abs(K)<=Proj4js.common.EPSLN)?0:Math.asin(G*J/K);p*=J;G=D*K;break;case this.OBLIQ:H=(Math.abs(K)<=Proj4js.common.EPSLN)?this.phi0:Math.asin(D*sinph0+G*J*cosph0/K);p*=J*cosph0;G=(D-Math.sin(H)*sinph0)*K;break;case this.N_POLE:G=-G;H=Proj4js.common.HALF_PI-H;break;case this.S_POLE:H-=Proj4js.common.HALF_PI;break}lam=(G==0&&(this.mode==this.EQUIT||this.mode==this.OBLIQ))?0:Math.atan2(p,G)}else{var O,I,N,F,E=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:p/=this.dd;G*=this.dd;F=Math.sqrt(p*p+G*G);if(F<Proj4js.common.EPSLN){M.x=0;M.y=this.phi0;return M}I=2*Math.asin(0.5*F/this.rq);O=Math.cos(I);p*=(I=Math.sin(I));if(this.mode==this.OBLIQ){E=O*this.sinb1+G*I*this.cosb1/F;N=this.qp*E;G=F*this.cosb1*O-G*this.sinb1*I}else{E=G*I/F;N=this.qp*E;G=F*O}break;case this.N_POLE:G=-G;case this.S_POLE:N=(p*p+G*G);if(!N){M.x=0;M.y=this.phi0;return M}E=1-N/this.qp;if(this.mode==this.S_POLE){E=-E}break}lam=Math.atan2(p,G);H=this.authlat(Math.asin(E),this.apa)}M.x=Proj4js.common.adjust_lon(this.long0+lam);M.y=H;return M},P00:0.3333333333333333,P01:0.17222222222222222,P02:0.10257936507936508,P10:0.06388888888888888,P11:0.0664021164021164,P20:0.016415012942191543,authset:function(g){var j;var l=new Array();l[0]=g*this.P00;j=g*g;l[0]+=j*this.P01;l[1]=j*this.P10;j*=g;l[0]+=j*this.P02;l[1]+=j*this.P11;l[2]=j*this.P20;return l},authlat:function(g,l){var j=g+g;return(g+l[0]*Math.sin(j)+l[1]*Math.sin(j+j)+l[2]*Math.sin(j+j+j))}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0)},forward:function(G){var H=G.x;var J=G.y;var E;var I=Math.sin(G.y);var F=Math.cos(G.y);var p=Proj4js.common.adjust_lon(H-this.long0);var z=Math.cos(p);var D=this.sin_p12*I+this.cos_p12*F*z;if(Math.abs(Math.abs(D)-1)<Proj4js.common.EPSLN){E=1;if(D<0){Proj4js.reportError("aeqd:Fwd:PointError");return}}else{var g=Math.acos(D);E=g/Math.sin(g)}G.x=this.x0+this.a*E*F*Math.sin(p);G.y=this.y0+this.a*E*(this.cos_p12*I-this.sin_p12*F*z);return G},inverse:function(F){F.x-=this.x0;F.y-=this.y0;var z=Math.sqrt(F.x*F.x+F.y*F.y);if(z>(2*Proj4js.common.HALF_PI*this.a)){Proj4js.reportError("aeqdInvDataError");return}var C=z/this.a;var D=Math.sin(C);var H=Math.cos(C);var G=this.long0;var B;if(Math.abs(z)<=Proj4js.common.EPSLN){B=this.lat0}else{B=Proj4js.common.asinz(H*this.sin_p12+(F.y*D*this.cos_p12)/z);var E=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(E)<=Proj4js.common.EPSLN){if(lat0>=0){G=Proj4js.common.adjust_lon(this.long0+Math.atan2(F.x,-F.y))}else{G=Proj4js.common.adjust_lon(this.long0-Math.atan2(-F.x,F.y))}}else{E=H-this.sin_p12*Math.sin(B);if((Math.abs(E)<Proj4js.common.EPSLN)&&(Math.abs(F.x)<Proj4js.common.EPSLN)){}else{var p=Math.atan2((F.x*D*this.cos_p12),(E*z));G=Proj4js.common.adjust_lon(this.long0+Math.atan2((F.x*D*this.cos_p12),(E*z)))}}}F.x=G;F.y=B;return F}};Proj4js.Proj.moll={init:function(){},forward:function(F){var I=F.x;var p=F.y;var C=Proj4js.common.adjust_lon(I-this.long0);var D=p;var E=Proj4js.common.PI*Math.sin(p);for(var B=0;true;B++){var H=-(D+Math.sin(D)-E)/(1+Math.cos(D));D+=H;if(Math.abs(H)<Proj4js.common.EPSLN){break}if(B>=50){Proj4js.reportError("moll:Fwd:IterationError")}}D/=2;if(Proj4js.common.PI/2-Math.abs(p)<Proj4js.common.EPSLN){C=0}var G=0.900316316158*this.a*C*Math.cos(D)+this.x0;var J=1.4142135623731*this.a*Math.sin(D)+this.y0;F.x=G;F.y=J;return F},inverse:function(r){var l;var o;r.x-=this.x0;var o=r.y/(1.4142135623731*this.a);if(Math.abs(o)>0.999999999999){o=0.999999999999}var l=Math.asin(o);var p=Proj4js.common.adjust_lon(this.long0+(r.x/(0.900316316158*this.a*Math.cos(l))));if(p<(-Proj4js.common.PI)){p=-Proj4js.common.PI}if(p>Proj4js.common.PI){p=Proj4js.common.PI}o=(2*l+Math.sin(2*l))/Proj4js.common.PI;if(Math.abs(o)>1){o=1}var u=Math.asin(o);r.x=p;r.y=u;return r}};(function(j,g){var l=0;j.widget("ui.gcautocomplete",{version:"1.9.2",defaultElement:"<input>",options:{appendTo:"body",autoFocus:true,delay:0,minLength:0,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var a,f,p;var b=this;this.container=this.element.addClass("gc-autocomplete");this.element=this.element.children("input");this.isMultiLine=this._isMultiLine();this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"];this.isNewMenu=true;this.element.addClass("ui-gcautocomplete-input").attr("autocomplete","off");this._on(this.element,{keydown:function(u){if(this.element.prop("readOnly")){a=true;p=true;f=true;return}a=false;p=false;f=false;var o=j.ui.keyCode;switch(u.keyCode){case o.PAGE_UP:a=true;this._move("previousPage",u);break;case o.PAGE_DOWN:a=true;this._move("nextPage",u);break;case o.UP:a=true;this._keyEvent("previous",u);break;case o.DOWN:a=true;this._keyEvent("next",u);break;case o.ENTER:case o.NUMPAD_ENTER:if(this.menu.active){a=true;u.preventDefault();this.menu.select(u)}break;case o.TAB:if(this.menu.active){this.menu.select(u)}break;case o.ESCAPE:if(this.menu.element.is(":visible")){this._value(this.term);this.close(u);u.preventDefault()}break;default:f=true;this._searchTimeout(u);break}},keypress:function(u){if(a){a=false;u.preventDefault();return}if(f){return}var o=j.ui.keyCode;switch(u.keyCode){case o.PAGE_UP:this._move("previousPage",u);break;case o.PAGE_DOWN:this._move("nextPage",u);break;case o.UP:this._keyEvent("previous",u);break;case o.DOWN:this._keyEvent("next",u);break}},input:function(o){if(p){p=false;o.preventDefault();return}this._searchTimeout(o)},focus:function(){this.selectedItem=null;this.previous=this._value()},blur:function(o){if(this.cancelBlur){delete this.cancelBlur;return}clearTimeout(this.searching);this.close(o);this._change(o)}});this._initSource();this.menu=j("<ul>").addClass("ui-autocomplete").appendTo(this.container.children(".gc-container")[0]).menu({input:j(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu");this._on(this.menu.element,{mousedown:function(u){u.preventDefault();this.cancelBlur=true;this._delay(function(){delete this.cancelBlur});var o=this.menu.element[0];if(!j(u.target).closest(".ui-menu-item").length){this._delay(function(){var r=this;this.document.one("mousedown",function(B){if(B.target!==r.element[0]&&B.target!==o&&!j.contains(o,B.target)){r.close()}})})}},menufocus:function(z,o){return;if(this.isNewMenu){this.isNewMenu=false;if(z.originalEvent&&/^mouse/.test(z.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){j(z.target).trigger(z.originalEvent)});return}}var B=o.item.data("ui-autocomplete-item")||o.item.data("item.autocomplete");if(false!==this._trigger("focus",z,{item:B})){if(z.originalEvent&&/^key/.test(z.originalEvent.type)){this._value(B.value)}}else{this.liveRegion.text(B.value)}},menuselect:function(o,D){var B=D.item.data("ui-autocomplete-item")||D.item.data("item.autocomplete"),C=this.previous;if(this.element[0]!==this.document[0].activeElement){this.element.focus();this.previous=C;this._delay(function(){this.previous=C;this.selectedItem=B})}if(false!==this._trigger("select",o,{item:B})){this._value(B.value)}this.term=this._value();this.close(o);this.selectedItem=B}});b.__open=false;j(document).mouseup(function(o){if(b.__open&&!b.container.is(o.target)&&j(b.options.toggleBtn).has(o.target).length===0&&b.container.has(o.target).length===0){b.closeContainer()}});j(this.options.toggleBtn).click(function(){if(b.__open){b.closeContainer()}else{b.openContainer()}});this.liveRegion=j("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element);if(j.fn.bgiframe){this.menu.element.bgiframe()}this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching);this.element.removeClass("ui-gcautocomplete-input").removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove()},_setOption:function(b,a){this._super(b,a);if(b==="source"){this._initSource()}if(b==="appendTo"){this.menu.element.appendTo(this.document.find(a||"body")[0])}if(b==="disabled"&&a&&this.xhr){this.xhr.abort()}},_isMultiLine:function(){if(this.element.is("textarea")){return true}if(this.element.is("input")){return false}return this.element.prop("isContentEditable")},_initSource:function(){var a,f,b=this;if(j.isArray(this.options.source)){a=this.options.source;this.source=function(r,u){u(j.ui.gcautocomplete.filter(a,r.term))}}else{if(typeof this.options.source==="string"){f=this.options.source;this.source=function(r,u){if(b.xhr){b.xhr.abort()}b.xhr=j.ajax({url:f,data:r,dataType:"json",success:function(o){u(o)},error:function(){u([])}})}}else{this.source=this.options.source}}},_searchTimeout:function(a){clearTimeout(this.searching);this.searching=this._delay(function(){if(this.term!==this._value()){this.selectedItem=null;this.search(null,a)}},this.options.delay)},search:function(a,b){a=a!=null?a:this._value();this.term=this._value();if(a.length<this.options.minLength){return this.close(b)}if(this._trigger("search",b)===false){return}return this._search(a)},_search:function(a){this.pending++;this.element.addClass("ui-gcautocomplete-loading");this.cancelSearch=false;this.source({term:a},this._response())},_response:function(){var a=this,b=++l;return function(f){if(b===l){a.__response(f)}a.pending--;if(!a.pending){a.element.removeClass("ui-gcautocomplete-loading")}}},__response:function(a){if(!this.options.disabled){a=this._normalize(a);this._suggest(a);this._trigger("open")}else{this.close()}return;if(a){a=this._normalize(a)}this._trigger("response",null,{content:a});if(!this.options.disabled&&a&&a.length&&!this.cancelSearch){this._suggest(a);this._trigger("open")}else{this._close()}},openContainer:function(a){this.container.show();this.element.val("");this.search();this.element.focus();this.container.position(j.extend({of:this.options.toggleBtn},this.options.position));this.__open=true},closeContainer:function(a){this.container.hide();this.__open=false},close:function(b,a){if(!a){return}this.cancelSearch=true;this._close(b)},_close:function(a){if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this.isNewMenu=true;this._trigger("close",a)}},_change:function(a){if(this.previous!==this._value()){this._trigger("change",a,{item:this.selectedItem})}},_normalize:function(a){if(a.length&&a[0].label&&a[0].value){return a}return j.map(a,function(b){if(typeof b==="string"){return{label:b,value:b}}return j.extend({label:b.label||b.value,value:b.value||b.label},b)})},_suggest:function(b){var a=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(a,b);this.menu.refresh();a.show();this._resizeMenu();a.position(j.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next()}},_resizeMenu:function(){var b=this.menu.element;b.outerWidth(Math.max(b.width("").outerWidth()+40,this.element.outerWidth()+40));this.container.outerWidth(Math.max(b.width("").outerWidth()+8,this.element.outerWidth()+7));var a=34;this.container.outerHeight(Math.max(b.height("").outerHeight()+a,this.element.outerHeight()+a))},_renderMenu:function(a,b){var f=this,r=j.trim(f.element.val()),u;j.each(b,function(p,o){if(o.value==r){u=true}});if(this.options.editable&&r&&!u){j("<li></li>").data("ui-autocomplete-item",{action:"new",value:r}).append(j("<a></a>").text("Create new ("+r+")")).appendTo(a);if(b.length>0){a.append("<li class='ui-autocomplete-divider'><div></div></li>")}}j.each(b,function(o,B){var p=f._renderItemData(a,B);p.find(".ui-delete").click(function(z){f._trigger("remove",z,{item:B});z.stopPropagation()})})},_renderItemData:function(b,a){return this._renderItem(b,a).data("ui-autocomplete-item",a)},_renderItem:function(a,p){var f=j("<li></li>"),b;if(this.options.editable){b=j("<a></a>").html("<span class='gc-icon ui-delete' ></span>"+p.label)}else{b=j("<a></a>").text(p.label)}return f.append(b).appendTo(a)},_move:function(a,b){if(!this.menu.element.is(":visible")){this.search(null,b);return}if(this.menu.isFirstItem()&&/^previous/.test(a)||this.menu.isLastItem()&&/^next/.test(a)){this._value(this.term);this.menu.blur();return}this.menu[a](b)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(a,b){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(a,b);b.preventDefault()}}});j.extend(j.ui.gcautocomplete,{escapeRegex:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(a,f){var b=new RegExp(j.ui.gcautocomplete.escapeRegex(f),"i");return j.grep(a,function(p){return b.test(p.label||p.value||p)})}})}(jQuery));(function(f,g){giscloud.ui.datasources=giscloud.ui.datasources||{};giscloud.ui.datasources.shareForm=function(a){var b=formManager.open({fid:"datasourceshareform",overlay:false,dragable:true,title:"Share datasource",fdata:{dsid:a},width:600,height:350,url:fno.liveSite+"datasource/form_share",buttons:[{html:gclang.Close,click:"formManager.get('datasourceshareform').close()"}]});return b}})(jQuery,$);(function(b){b(function(){if(!b("body").hasClass("gc-responsive")){return}var a=b("#datagrid_pad").length>0?282:82;function g(){var f=b("body").height();b("#mapPanel").height(f-a)}b(window).resize(g);g();gcapp.addEvent("ready",function(){gcapp.gcsearch.searchResultGrid.pagination(false);giscloud.ui.search.overrideDefaultBehaviour();gcapp.gcmap.addEvent("ready",function(){gcproject.addEvent("getmapdata",function(){var j=fn.getMap().options.LOGO_LINK;b("a.brand").attr("href",j?j:"/").attr("target","_blank");gcapp.gclayer.llist.addEvent("toggle",function(p){b("#gc_layers_box").css("width",b("#layerlist .mif-tree-wrapper").prop("scrollWidth"))})});gcapp.gcsearch.options.hideContainer=true;var l=b("#gc_layers_box");if(l.length>0){var f=L.Control.extend({options:{position:"topleft"},onAdd:function(p){var j=L.DomUtil.create("div","leaflet-control-gc-layers");el=b(j);el.addClass("gc-pointer");el.html('<div id="gc_layer_list_toggle_bt" class="gc-icon gc-layers" ></div>');el.click(function(o){l.toggle()});return j}});gcapp.leaflet.addControl(new f())}})});gcapp.addEvent("ready",function(){})})})(jQuery);(function(b){b(function(){if(!b("body").hasClass("gc-responsive")||b("#quicksearch").length==0){return}var H=this,G,U,O,I,K={},J;function Q(f,g){return giscloud.ui.alert.color("red").show(f,g)}function S(f,g){return giscloud.ui.alert.color("green").show(f,g)}function T(f){var g=1300,j;if(f.isPoint()){j=giscloud.ui.map.bounds().clone().center(f.center()).width(g,true)}else{if(f.width()>g){j=f.clone()}else{j=f.clone().width(g,true)}}giscloud.ui.map.bounds(j)}function M(f){return b.map(f,function(p){var r=new giscloud.Feature(p),j=p.__layer_id,u,l;var o=fn.getMap().options.RESULT_FIELDS;var g=fns.getSearchResult(j,r.data);return{id:r.id,result:g,data:r.data,meta:p.__meta,bounds:r.bounds,layerId:r.layerId}})}function a(g){var f;if(!g||!g.total){Q("No results.",2000)}else{S(gclang.Results+": "+g.total,2000);f=M(g.data);giscloud.ui.search.displayResults(f,"id")}}function R(f,g){var j=giscloud.ui.map.bounds().center();return b.when(giscloud.rest.get("search.json",{query:f,columns_meta:true,perpage:100,fields:g,x:j.lon,y:j.lat,proj4:fn.getMap().proj4,srid:fn.getMap().srid})).pipe(function(l){return{total:l.total,data:l.data}}).done(a)}function N(l,g){var j=fns.getFields(),f;if(!U){U=new giscloud.FlagMarker().visible(false);giscloud.ui.map.addMarker(U)}f=R(g,j);S(gclang.Search_action);f.done(a).fail(function(){Q("Error")})}function P(g,f){var j=f.bounds.center();U.visible(false);T(f.bounds);f.count=1;f.format=true;gcapp.selo.showRecordInfo(f)}b(giscloud.ui.search).on("start",N);b(giscloud.ui.search).on("resultClick",P);b(document).mouseup(function(f){var l=b("#searchtab");if(gcapp.gcsearch.__open&&!l.is(f.target)&&l.has(f.target).length===0){gcapp.gcsearch.clearSearchResult()}var g=b("#gc_layers_box");var j=b(".leaflet-control-gc-layers");if(g.is(":visible")&&!g.is(f.target)&&g.has(f.target).length===0&&j.has(f.target).length===0){g.hide()}})})}(jQuery));